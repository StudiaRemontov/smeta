var Nn=Object.defineProperty,xn=Object.defineProperties;var Pn=Object.getOwnPropertyDescriptors;var Ke=Object.getOwnPropertySymbols;var es=Object.prototype.hasOwnProperty,ts=Object.prototype.propertyIsEnumerable;var Ye=(e,t,s)=>t in e?Nn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,m=(e,t)=>{for(var s in t||(t={}))es.call(t,s)&&Ye(e,s,t[s]);if(Ke)for(var s of Ke(t))ts.call(t,s)&&Ye(e,s,t[s]);return e},f=(e,t)=>xn(e,Pn(t));var be=(e,t)=>{var s={};for(var n in e)es.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&Ke)for(var n of Ke(e))t.indexOf(n)<0&&ts.call(e,n)&&(s[n]=e[n]);return s};var Xe=(e,t,s)=>(Ye(e,typeof t!="symbol"?t+"":t,s),s);import{c as u,o as l,p as x,a as P,b as c,r as h,d as y,w as C,n as N,F as b,e as S,f as R,t as $,g as T,h as w,m as k,i as H,j as Pe,k as A,l as Y,u as U,T as An,q as ne,v as te,s as ct,x as ke,y as B,z as Q,A as Ie,B as Ne,C as mo,D as je,E as po,G as En,H as X,I as Ce,J as Bn,K as yo,L as fo,M as ut,N as _t,O as Se,P as vo,Q as ht,R as Oe,S as We,U as Mn,V as mt,W as go,X as Jn,Y as bo,Z as Kn,_ as wo,$ as Ae,a0 as jn,a1 as qn,a2 as Hn,a3 as pt,a4 as Un,a5 as Wn,a6 as Fn,a7 as Gn,a8 as Qn,a9 as Zn,aa as zn,ab as Yn,ac as Xn,ad as er}from"./vendor.df2cfe3b.js";const tr=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}};tr();var sr="/assets/logo.2b67f5e3.png";var g=(e,t)=>{const s=e.__vccOpts||e;for(const[n,r]of t)s[n]=r;return s};const or={},nr=e=>(x("data-v-ee6b4ea0"),e=e(),P(),e),rr={class:"logo"},ar=nr(()=>c("img",{class:"logo__img",src:sr,alt:"\u0421\u0442\u0443\u0434\u0442\u044F \u0440\u0435\u043C\u043E\u043D\u0442\u043E\u0432"},null,-1)),ir=[ar];function lr(e,t){return l(),u("div",rr,ir)}var Te=g(or,[["render",lr],["__scopeId","data-v-ee6b4ea0"]]);const dr={},cr={width:"10",height:"9",viewBox:"0 0 10 9",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ur=c("path",{d:"M5.00008 8.41663L2.6546 4.66663L0.309111 0.916625L5.00008 0.916626L9.69105 0.916626L7.34557 4.66663L5.00008 8.41663Z",fill:"white"},null,-1),_r=[ur];function hr(e,t){return l(),u("svg",cr,_r)}var mr=g(dr,[["render",hr]]);const pr={},yr={width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},fr=c("rect",{width:"14",height:"14",rx:"2",fill:"white"},null,-1),vr=c("path",{d:"M7.00363 10.08C6.43697 10.08 5.92697 9.96333 5.47363 9.73C5.02697 9.49 4.67697 9.16 4.42363 8.74C4.1703 8.32 4.04363 7.84333 4.04363 7.31C4.04363 6.77667 4.1703 6.3 4.42363 5.88C4.67697 5.46 5.02697 5.13333 5.47363 4.9C5.92697 4.66 6.43697 4.54 7.00363 4.54C7.5703 4.54 8.07697 4.66 8.52363 4.9C8.9703 5.13333 9.3203 5.46 9.57363 5.88C9.82697 6.3 9.95363 6.77667 9.95363 7.31C9.95363 7.84333 9.82697 8.32 9.57363 8.74C9.3203 9.16 8.9703 9.49 8.52363 9.73C8.07697 9.96333 7.5703 10.08 7.00363 10.08ZM7.00363 8.8C7.40363 8.8 7.7303 8.66667 7.98363 8.4C8.24363 8.12667 8.37363 7.76333 8.37363 7.31C8.37363 6.85667 8.24363 6.49667 7.98363 6.23C7.7303 5.95667 7.40363 5.82 7.00363 5.82C6.60363 5.82 6.27363 5.95667 6.01363 6.23C5.75363 6.49667 5.62363 6.85667 5.62363 7.31C5.62363 7.76333 5.75363 8.12667 6.01363 8.4C6.27363 8.66667 6.60363 8.8 7.00363 8.8Z",fill:"black"},null,-1),gr=[fr,vr];function br(e,t){return l(),u("svg",yr,gr)}var wr=g(pr,[["render",br]]);const $r={components:{OpenIcon:mr,NavItemIcon:wr},data(){return{isListVisible:!1,links:[{text:"\u0421\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0438",to:"/directories"},{text:"\u041F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442\u0430",to:"/pricelists"},{text:"\u0421\u043C\u0435\u0442\u0430",to:"/outlay"}]}},methods:{toggleList(){this.isListVisible=!this.isListVisible}}},kr=e=>(x("data-v-092b9219"),e=e(),P(),e),Cr={class:"nav-menu"},Ir={class:"menu-item"},Sr={class:"menu-item__body"},Or=kr(()=>c("span",{class:"menu-item__title"}," \u0410\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0430 \u0441\u043C\u0435\u0442\u044B ",-1)),Tr={key:0,class:"menu-item__list"};function Rr(e,t,s,n,r,o){const a=h("NavItemIcon"),i=h("OpenIcon"),d=h("AppButton"),_=h("RouterLink");return l(),u("nav",Cr,[c("div",Ir,[y(a),c("div",Sr,[c("div",{class:"menu-item__head",onClick:t[0]||(t[0]=(...p)=>o.toggleList&&o.toggleList(...p))},[Or,y(d,{class:N(["menu-item__button",{rotated:r.isListVisible}])},{default:C(()=>[y(i)]),_:1},8,["class"])]),r.isListVisible?(l(),u("ul",Tr,[(l(!0),u(b,null,S(r.links,p=>(l(),u("li",{key:p.to,class:"menu-item__list-item"},[y(_,{class:"menu-item__list-link",to:p.to,"active-class":"menu-item__list-link--active"},{default:C(()=>[R($(p.text),1)]),_:2},1032,["to"])]))),128))])):T("",!0)])])])}var Vr=g($r,[["render",Rr],["__scopeId","data-v-092b9219"]]);const Lr={components:{AppLogo:Te,NavMenu:Vr}},Dr={class:"sidebar"},Nr={class:"sidebar__header"},xr={class:"sidebar__body"};function Pr(e,t,s,n,r,o){const a=h("AppLogo"),i=h("NavMenu");return l(),u("aside",Dr,[c("div",Nr,[y(a)]),c("div",xr,[y(i)])])}var Ar=g(Lr,[["render",Pr],["__scopeId","data-v-64fd4f8b"]]);const Er={},Br={width:"18",height:"16",viewBox:"0 0 18 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Mr=c("line",{y1:"1",x2:"18",y2:"1",stroke:"white","stroke-width":"2"},null,-1),Jr=c("line",{y1:"8",x2:"18",y2:"8",stroke:"white","stroke-width":"2"},null,-1),Kr=c("line",{y1:"15",x2:"18",y2:"15",stroke:"white","stroke-width":"2"},null,-1),jr=[Mr,Jr,Kr];function qr(e,t){return l(),u("svg",Br,jr)}var Hr=g(Er,[["render",qr]]);const Ur={},Wr=e=>(x("data-v-6612f46e"),e=e(),P(),e),Fr={class:"user-avatar"},Gr=Wr(()=>c("span",{class:"user-avatar__name"}," CPP ",-1)),Qr=[Gr];function Zr(e,t,s,n,r,o){return l(),u("div",Fr,Qr)}var zr=g(Ur,[["render",Zr],["__scopeId","data-v-6612f46e"]]);const Yr={},Xr={width:"14",height:"17",viewBox:"0 0 14 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ea=c("path",{d:"M6.99992 16.3334C7.91658 16.3334 8.66658 15.5834 8.66658 14.6667H5.33325C5.33325 15.5834 6.08325 16.3334 6.99992 16.3334ZM11.9999 11.3334V7.16671C11.9999 4.60837 10.6416 2.46671 8.24992 1.90004V1.33337C8.24992 0.641707 7.69158 0.083374 6.99992 0.083374C6.30825 0.083374 5.74992 0.641707 5.74992 1.33337V1.90004C3.36659 2.46671 1.99992 4.60004 1.99992 7.16671V11.3334L0.333252 13V13.8334H13.6666V13L11.9999 11.3334ZM10.3333 12.1667H3.66658V7.16671C3.66658 5.10004 4.92492 3.41671 6.99992 3.41671C9.07492 3.41671 10.3333 5.10004 10.3333 7.16671V12.1667Z",fill:"white"},null,-1),ta=[ea];function sa(e,t){return l(),u("svg",Xr,ta)}var oa=g(Yr,[["render",sa]]);const na={components:{NotificationIcon:oa}},ra=e=>(x("data-v-3aad635a"),e=e(),P(),e),aa=ra(()=>c("div",{class:"notification-button__counter"},"35",-1));function ia(e,t,s,n,r,o){const a=h("NotificationIcon"),i=h("AppButton");return l(),w(i,{class:"notification-button"},{default:C(()=>[y(a,{class:"notification-button__icon"}),aa]),_:1})}var la=g(na,[["render",ia],["__scopeId","data-v-3aad635a"]]);const da={components:{NotificationButton:la,UserAvatar:zr},computed:m({},k(["isOffline"]))},ca={class:"right-side"};function ua(e,t,s,n,r,o){const a=h("NotificationButton"),i=h("UserAvatar"),d=h("AppButton"),_=Pe("tooltip");return l(),u("div",ca,[H(c("i",{class:N([{visible:e.isOffline},"pi pi-exclamation-triangle offline-icon"])},null,2),[[_,"\u0420\u0435\u0436\u0438\u043C \u043E\u0444\u0444\u043B\u0430\u0439\u043D",void 0,{bottom:!0}]]),y(a),y(d,null,{default:C(()=>[y(i)]),_:1})])}var yt=g(da,[["render",ua],["__scopeId","data-v-3afc2e24"]]);const _a={components:{BurgerIcon:Hr,RightSide:yt}},ha={class:"app-header"},ma={class:"app-header__left-side"};function pa(e,t,s,n,r,o){const a=h("BurgerIcon"),i=h("AppButton"),d=h("RightSide");return l(),u("div",ha,[c("div",ma,[y(i,null,{default:C(()=>[y(a)]),_:1})]),y(d)])}var ya=g(_a,[["render",pa],["__scopeId","data-v-46fe451b"]]);const fa={components:{AppHeader:ya}},va={class:"app-container"},ga={class:"app-container__content"};function ba(e,t,s,n,r,o){const a=h("AppHeader"),i=h("RouterView");return l(),u("div",va,[y(a),c("div",ga,[y(i)])])}var wa=g(fa,[["render",ba],["__scopeId","data-v-06cbdee2"]]);const $a={components:{AppSidebar:Ar,AppContainer:wa}},ka={class:"main"};function Ca(e,t,s,n,r,o){const a=h("AppSidebar"),i=h("AppContainer");return l(),u("main",ka,[y(a),y(i)])}var Ia=g($a,[["render",Ca],["__scopeId","data-v-20aea961"]]);const Sa={components:{AppLogo:Te}},Oa={class:"left-side"};function Ta(e,t,s,n,r,o){const a=h("AppLogo");return l(),u("div",Oa,[y(a)])}var Ra=g(Sa,[["render",Ta],["__scopeId","data-v-5e5e4833"]]);const Va={},La={width:"13",height:"13",viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Da=c("path",{d:"M6.5 0.25C3.05 0.25 0.25 3.05 0.25 6.5C0.25 9.95 3.05 12.75 6.5 12.75C9.95 12.75 12.75 9.95 12.75 6.5C12.75 3.05 9.95 0.25 6.5 0.25ZM7.125 9.625H5.875V5.875H7.125V9.625ZM7.125 4.625H5.875V3.375H7.125V4.625Z",fill:"black"},null,-1),Na=[Da];function xa(e,t){return l(),u("svg",La,Na)}var $o=g(Va,[["render",xa]]);const ft={props:{outlay:{type:Object,required:!0}},computed:f(m({},k("outlay",{selected:"outlay"})),{isSelected(){var e;return((e=this.selected)==null?void 0:e._id)===this.outlay._id},date(){return new Date(this.outlay.createdAt).toLocaleDateString()},color(){return this.isSelected?"#00afec":"#808080"}}),methods:f(m({},A("outlay",["setOutlay"])),{selectOutlay(){this.setOutlay(this.outlay)},openMenu(e){this.$emit("open-menu",e,this.outlay._id)}})},ss=()=>{U(e=>({"20d46556":e.color}))},os=ft.setup;ft.setup=os?(e,t)=>(ss(),os(e,t)):ss;const Pa=ft,Aa=e=>(x("data-v-5688bfb4"),e=e(),P(),e),Ea={class:"outlay-item__dot-wrapper"},Ba={key:0,class:"outlay-item__dot"},Ma={class:"outlay-item__text"},Ja={class:"outlay-item__date"},Ka=["title"],ja=Aa(()=>c("i",{class:"pi pi-ellipsis-h icon"},null,-1)),qa=[ja];function Ha(e,t,s,n,r,o){return l(),u("div",{class:N(["outlay-item",{selected:o.isSelected,active:s.outlay.active}]),onClick:t[1]||(t[1]=(...a)=>o.selectOutlay&&o.selectOutlay(...a))},[c("div",Ea,[s.outlay.active?(l(),u("div",Ba)):T("",!0)]),c("div",Ma,[c("div",Ja,"\u043E\u0442 "+$(o.date),1),c("span",{class:"outlay-item__name",title:s.outlay.name},$(s.outlay.name),9,Ka)]),c("button",{class:"button",onClick:t[0]||(t[0]=Y((...a)=>o.openMenu&&o.openMenu(...a),["stop"]))},qa)],2)}var Ua=g(Pa,[["render",Ha],["__scopeId","data-v-5688bfb4"]]);const Wa={data(){return{isVisible:!1}},methods:{open(){this.isVisible=!0},close(){this.$emit("onClose"),this.isVisible=!1}}};function Fa(e,t,s,n,r,o){return l(),w(An,{name:"fade"},{default:C(()=>[r.isVisible?(l(),u("div",{key:0,class:"popup-modal",onMousedown:t[1]||(t[1]=(...a)=>o.close&&o.close(...a))},[c("div",{class:"popup-modal__window",onMousedown:t[0]||(t[0]=Y(()=>{},["stop"]))},[ne(e.$slots,"default",{},void 0,!0)],32)],32)):T("",!0)]),_:3})}var ae=g(Wa,[["render",Fa],["__scopeId","data-v-50fe556e"]]);const ns=()=>({okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0,name:""}),Ga={components:{PopupModal:ae},data(){return ns()},methods:{async show(e){return this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.name=e.name,this.$refs.popup.open(),await this.$nextTick(),this.$refs.input.focus(),new Promise((t,s)=>{this.resolvePromise=t,this.rejectPromise=s})},_confirm(){if(!this.name)return;const e={name:this.name};this.$refs.popup.close(),this.resolvePromise(e),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},reset(){Object.assign(this.$data,ns())}}},ko=e=>(x("data-v-24a6981c"),e=e(),P(),e),Qa={class:"modal"},Za=ko(()=>c("span",{class:"modal__title"},"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043D\u043E\u0432\u0443\u044E \u0441\u043C\u0435\u0442\u0443",-1)),za={class:"form__group"},Ya=ko(()=>c("label",{class:"form__label"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",-1)),Xa={class:"modal__actions"};function ei(e,t,s,n,r,o){const a=h("AppButton"),i=h("PopupModal");return l(),w(i,{ref:"popup"},{default:C(()=>[c("div",Qa,[Za,c("form",{class:"form",onSubmit:t[1]||(t[1]=Y((...d)=>o._confirm&&o._confirm(...d),["prevent"]))},[c("div",za,[Ya,H(c("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>e.name=d),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",ref:"input",class:"input"},null,512),[[te,e.name]])])],32),c("div",Xa,[y(a,{outlined:"",onClick:o._cancel},{default:C(()=>[R($(e.cancelButton),1)]),_:1},8,["onClick"]),y(a,{outlined:"",onClick:o._confirm},{default:C(()=>[R($(e.okButton),1)]),_:1},8,["onClick"])])])]),_:1},512)}var ti=g(Ga,[["render",ei],["__scopeId","data-v-24a6981c"]]);const si={components:{OutlayItem:Ua,Menu:ct,EditModal:ti},data(){return{selectedItem:null}},computed:f(m({},k("outlays",["outlays"])),{selectedOutlay(){return this.outlays.find(e=>e._id===this.selectedItem)},items(){var e;return[{label:"\u0421\u0434\u0435\u043B\u0430\u0442\u044C \u0430\u043A\u0442\u0438\u0432\u043D\u043E\u0439",command:async()=>{try{await this.setActive(this.selectedItem)}catch(t){const{response:s}=t,n=s?s.data.message:t.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:n,life:3e3})}},disabled:(e=this.selectedOutlay)==null?void 0:e.active},{label:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",command:async()=>{const t=await this.$refs["edit-modal"].show({okButton:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430",name:this.selectedOutlay.name});try{await this.update({id:this.selectedItem,data:m(m({},this.selectedOutlay),t)})}catch(s){const{response:n}=s,r=n?n.data.message:s.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:r,life:3e3})}},disabled:!1},{label:"\u041A\u043B\u043E\u043D\u0438\u0440\u043E\u0432\u0430\u0442\u044C",command:async()=>{try{const t=this.outlays.find(s=>s._id===this.selectedItem);await this.clone(t)}catch(t){const{response:s}=t,n=s?s.data.message:t.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:n,life:3e3})}},disabled:!1},{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",command:async()=>{try{await this.remove(this.selectedItem)}catch(t){const{response:s}=t,n=s?s.data.message:t.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:n,life:3e3})}finally{this.selectedItem=null}},disabled:!1}]},outlayList(){return[...this.outlays].reverse()}}),methods:f(m({},A("outlays",["create","remove","setActive","update","clone"])),{openMenu(e,t){this.selectedItem=t,this.$refs.menu.toggle(e)}})},oi={key:0,class:"outlay-list"};function ni(e,t,s,n,r,o){const a=h("Menu"),i=h("EditModal"),d=h("OutlayItem");return l(),u(b,null,[y(a,{ref:"menu",model:o.items,popup:!0},null,8,["model"]),y(i,{ref:"edit-modal"},null,512),e.outlays&&e.outlays.length>0?(l(),u("div",oi,[(l(!0),u(b,null,S(o.outlayList,_=>(l(),w(d,{key:_._id,outlay:_,onOpenMenu:o.openMenu},null,8,["outlay","onOpenMenu"]))),128))])):T("",!0)],64)}var ri=g(si,[["render",ni],["__scopeId","data-v-67bb4a75"]]);const rs=()=>({okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0}),ai={components:{PopupModal:ae},data(){return rs()},computed:m({},k("outlay",["outlay"])),methods:{show(){return this.$refs.popup.open(),new Promise((e,t)=>{this.resolvePromise=e,this.rejectPromise=t})},_confirm(){this.$refs.popup.close(),this.resolvePromise(!0),this.reset()},reset(){Object.assign(this.$data,rs())}}},Co=e=>(x("data-v-0c5666f3"),e=e(),P(),e),ii={class:"modal"},li=Co(()=>c("span",{class:"modal__title"},"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F",-1)),di=Co(()=>c("span",null," \u041E\u0431\u044A\u0435\u043A\u0442: .... ",-1)),ci={class:"modal__actions"},ui=R(" \u0417\u0430\u043A\u0440\u044B\u0442\u044C ");function _i(e,t,s,n,r,o){const a=h("AppButton"),i=h("PopupModal");return l(),w(i,{ref:"popup"},{default:C(()=>[c("div",ii,[li,di,c("div",ci,[y(a,{outlined:"",onClick:o._confirm},{default:C(()=>[ui]),_:1},8,["onClick"])])])]),_:1},512)}var hi=g(ai,[["render",_i],["__scopeId","data-v-0c5666f3"]]);const as=()=>({okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0,name:"",priceList:null}),mi={components:{PopupModal:ae},data(){return as()},computed:f(m(m({},k("priceList",["priceLists"])),k("edition",["editions"])),{priceListOptions(){return this.priceLists.map(e=>({label:e.name,value:e}))}}),methods:{async show(e){return this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.priceListOptions.length>0&&(this.priceList=this.priceLists[0]),this.$refs.popup.open(),await this.$nextTick(),this.$refs.input.focus(),new Promise((t,s)=>{this.resolvePromise=t,this.rejectPromise=s})},_confirm(){if(!this.priceList||!this.name)return;const e=this.priceList.editions.find(s=>{const n=this.editions.find(r=>r._id===s);return n?n.active===!0:!1});if(!e)return this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:"\u0412 \u0434\u0430\u043D\u043D\u043E\u043C \u043F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442\u0435 \u043D\u0435\u0442\u0443 \u0430\u043A\u0442\u0438\u0432\u043D\u043E\u0439 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u0438",life:3e3});const t={name:this.name,edition:e};this.$refs.popup.close(),this.resolvePromise(t),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},reset(){Object.assign(this.$data,as())}}},vt=e=>(x("data-v-59bddd38"),e=e(),P(),e),pi={class:"modal"},yi=vt(()=>c("span",{class:"modal__title"},"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043D\u043E\u0432\u0443\u044E \u0441\u043C\u0435\u0442\u0443",-1)),fi={class:"form__group"},vi=vt(()=>c("label",{class:"form__label"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",-1)),gi={class:"form__group"},bi=vt(()=>c("label",null,"\u041F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442",-1)),wi=["value"],$i={class:"modal__actions"};function ki(e,t,s,n,r,o){const a=h("AppButton"),i=h("PopupModal");return l(),w(i,{ref:"popup"},{default:C(()=>[c("div",pi,[yi,c("form",{class:"form",onSubmit:t[2]||(t[2]=Y((...d)=>o._confirm&&o._confirm(...d),["prevent"]))},[c("div",fi,[vi,H(c("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>e.name=d),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",ref:"input",class:"input"},null,512),[[te,e.name]])]),c("div",gi,[bi,H(c("select",{"onUpdate:modelValue":t[1]||(t[1]=d=>e.priceList=d),class:"select"},[(l(!0),u(b,null,S(o.priceListOptions,d=>(l(),u("option",{key:d.value,value:d.value},$(d.label),9,wi))),128))],512),[[ke,e.priceList]])])],32),c("div",$i,[y(a,{outlined:"",onClick:o._cancel},{default:C(()=>[R($(e.cancelButton),1)]),_:1},8,["onClick"]),y(a,{outlined:"",onClick:o._confirm},{default:C(()=>[R($(e.okButton),1)]),_:1},8,["onClick"])])])]),_:1},512)}var Ci=g(mi,[["render",ki],["__scopeId","data-v-59bddd38"]]);const Ii={},Si={class:"outlay-block"};function Oi(e,t){return l(),u("div",Si,[ne(e.$slots,"default",{},void 0,!0)])}var re=g(Ii,[["render",Oi],["__scopeId","data-v-6ad65585"]]);const Ti={components:{InfoCircleFill:$o,OutlayList:ri,InfoModal:hi,CreateModal:Ci,OutlayBlock:re},computed:f(m({},k("outlay",["invalidJobs"])),{invalidNodes(){return Object.values(this.invalidJobs).some(t=>t.length>0)}}),methods:f(m({},A("outlays",["create"])),{showInfo(){this.$refs["info-modal"].show()},async createOutlay(){const e=await this.$refs["create-modal"].show({okButton:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430"});if(e)try{await this.create(e)}catch(t){const{response:s}=t,n=s?s.data.message:t.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:n,life:3e3})}}})},Io=e=>(x("data-v-1e155734"),e=e(),P(),e),Ri={class:"center"},Vi={class:"center__info-wrapper"},Li=Io(()=>c("div",{class:"center__info-text"},[c("span",{class:"center__info-id"}," 12345 "),c("span",{class:"center__info-name"},"\u0421\u0435\u0440\u0433\u0435\u0439 \u0410\u043B\u0435\u043A\u0441\u0435\u0435\u0432\u0438\u0447")],-1)),Di=["disabled"],Ni=Io(()=>c("i",{class:"pi pi-plus create__icon"},null,-1)),xi=[Ni];function Pi(e,t,s,n,r,o){const a=h("CreateModal"),i=h("InfoModal"),d=h("InfoCircleFill"),_=h("OutlayBlock"),p=h("OutlayList");return l(),u(b,null,[y(a,{ref:"create-modal"},null,512),y(i,{ref:"info-modal"},null,512),c("div",Ri,[y(_,{class:"center__info"},{default:C(()=>[c("div",Vi,[Li,c("button",{class:"button",onClick:t[0]||(t[0]=(...v)=>o.showInfo&&o.showInfo(...v))},[y(d)])])]),_:1}),y(_,{class:N(["center__outlays",{disabled:o.invalidNodes}])},{default:C(()=>[c("button",{class:"button create",disabled:o.invalidNodes,onClick:t[1]||(t[1]=(...v)=>o.createOutlay&&o.createOutlay(...v))},xi,8,Di),y(p)]),_:1},8,["class"])])],64)}var Ai=g(Ti,[["render",Pi],["__scopeId","data-v-1e155734"]]);const Ei={components:{LeftSide:Ra,CenterSide:Ai,RightSide:yt},methods:m({},B("outlay",["toggleSides"]))},Bi=e=>(x("data-v-756650ea"),e=e(),P(),e),Mi={class:"header-row"},Ji={class:"right-side-wrapper"},Ki=Bi(()=>c("i",{class:"pi pi-arrows-h icon"},null,-1)),ji=[Ki];function qi(e,t,s,n,r,o){const a=h("LeftSide"),i=h("CenterSide"),d=h("RightSide");return l(),u("div",Mi,[y(a),y(i),c("div",Ji,[c("button",{class:"button",onClick:t[0]||(t[0]=(..._)=>e.toggleSides&&e.toggleSides(..._))},ji),y(d,{class:"right-side"})])])}var Hi=g(Ei,[["render",qi],["__scopeId","data-v-756650ea"]]);const E=e=>(e==null?void 0:e.toLocaleString("ru",{minimumFractionDigits:2,maximumFractionDigits:2}))||"\u041E\u0448\u0438\u0431\u043A\u0430";const gt={name:"TableRow",inject:["opacities"],props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String},computed:f(m({},k("outlay",["keys","quantityKey","priceKey","striped"])),{data(){return this.node.data},children(){return this.node.children||[]},isCategory(){return this.children.length>0},opacity(){return this.opacities[this.level-1]||0},headerStyle(){const t={gridTemplateColumns:`4fr repeat(${this.keys.length}, minmax(100px, 1fr))`};return this.isCategory&&(t.backgroundColor=`rgba(38, 138, 173, ${this.opacity})`),t},sum(){const e=this.node.data[this.quantityKey.id],t=this.node.data[this.priceKey.id];return E(e*t)},viewData(){if(this.isCategory)return[{key:this.keys[0].id,value:this.data[this.keys[0].id]}];const e=[this.quantityKey.id,this.priceKey.id,"quantity"];return this.keys.map(t=>e.includes(t.id)?{key:t.id,value:E(this.data[t.id])}:{key:t.id,value:this.data[t.id]})}})},is=()=>{U(e=>({"4205f458":e.level}))},ls=gt.setup;gt.setup=ls?(e,t)=>(is(),ls(e,t)):is;const Ui=gt,Wi=["data-id","data-level","data-room"],Fi={key:0,class:"table-cell"};function Gi(e,t,s,n,r,o){const a=h("TableRow",!0);return l(),u(b,null,[c("div",{class:N(["table-row",{category:o.isCategory,striped:e.striped}]),"data-id":s.node.key,"data-level":s.level,"data-room":s.room,style:Q(o.headerStyle)},[(l(!0),u(b,null,S(o.viewData,i=>(l(),u("div",{key:i.key,class:"table-cell"},$(i.value),1))),128)),o.isCategory?T("",!0):(l(),u("div",Fi,$(o.sum),1))],14,Wi),o.isCategory?(l(!0),u(b,{key:0},S(o.children,i=>(l(),w(a,{key:i.key,node:i,room:s.room,level:s.level+1},null,8,["node","room","level"]))),128)):T("",!0)],64)}var Qi=g(Ui,[["render",Gi],["__scopeId","data-v-987c3afc"]]);const Zi={props:{data:{type:Object,default(){return{}}},level:{type:Number}},computed:f(m({},k("outlay",["keys"])),{cells(){const e=this.keys[0].id,t=this.data[e],s={id:e,name:t};return this.level===0?[...this.keys.map((r,o)=>o===0?s:r),{id:"\u0421\u0443\u043C\u043C\u0430",name:"\u0421\u0443\u043C\u043C\u0430"}]:[s]}})};function zi(e,t,s,n,r,o){return l(!0),u(b,null,S(o.cells,a=>(l(),u("div",{key:a.id,class:N(["table-cell",{nowrap:o.cells.length===1}])},$(a.name),3))),128)}var Yi=g(Zi,[["render",zi],["__scopeId","data-v-44affd0a"]]);const Xi={emits:["clone"],computed:m({},k("outlay",["showOnlyChecked"]))},el=e=>(x("data-v-774e3082"),e=e(),P(),e),tl={class:"table-cell table-cell--actions"},sl=el(()=>c("i",{class:"pi pi-copy"},null,-1)),ol=[sl];function nl(e,t,s,n,r,o){return l(),u("div",tl,[c("button",{class:"button",onClick:t[0]||(t[0]=Y(a=>this.$emit("clone"),["stop"]))},ol)])}var So=g(Xi,[["render",nl],["__scopeId","data-v-774e3082"]]);const rl={inject:["changed"],props:{value:{required:!0},keyData:{type:Object},isSum:{type:Boolean,default:!1},isClone:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},index:Number},computed:f(m({},k("outlay",["priceKey","quantityKey"])),{viewValue(){var e,t;return((e=this.keyData)==null?void 0:e.id)===this.priceKey.id||((t=this.keyData)==null?void 0:t.id)===this.quantityKey.id||this.isSum?E(this.value):this.value},isValidQuantity(){var e;return((e=this.keyData)==null?void 0:e.id)!==this.quantityKey.id?!0:this.value>0}})},al=["title","data-cellIndex"],il={key:0};function ll(e,t,s,n,r,o){return l(),u("div",{class:N(["table-cell",{danger:!o.isValidQuantity&&s.isClone&&s.selected}]),title:o.viewValue,"data-cellIndex":s.index},[s.index===0&&o.changed?(l(),u("span",il," * ")):T("",!0),R(" "+$(o.viewValue),1)],10,al)}var bt=g(rl,[["render",ll],["__scopeId","data-v-2f393219"]]);const dl={components:{DefaultActions:So,ViewCell:bt},props:{node:{type:Object,default(){return{}}},sum:{type:Number,required:!0}},emits:["clone"],computed:m({},k("outlay",["keys"]))};function cl(e,t,s,n,r,o){const a=h("ViewCell"),i=h("DefaultActions");return l(),u(b,null,[(l(!0),u(b,null,S(e.keys,(d,_)=>(l(),w(a,{key:d.id,keyData:d,value:s.node.data[d.id],index:_},null,8,["keyData","value","index"]))),128)),y(a,{isSum:!0,value:s.sum},null,8,["value"]),y(i,{onClone:t[0]||(t[0]=d=>e.$emit("clone"))})],64)}var ul=g(dl,[["render",cl]]);const _l={props:{modelValue:{default:0},min:{type:Number,default:Number.MIN_VALUE},max:{type:Number,default:Number.MAX_VALUE},step:{type:Number,default:1}},emits:["update:modelValue","change"],data(){return{value:null}},computed:{newValue:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e),this.$emit("change",e)}}},methods:{inputHandler(e){const{data:t,target:s}=e;let n=s.value;if(t===","&&(n=n.replace(",","."),s.value=n),!n.includes(".")){const d=+n;this.newValue=d;return}const o=n.split(".");if(o.length!==2||!o.every(d=>d))return;const i=+n;this.newValue=i},increaseValue(){const e=this.newValue+this.step;this.max>=e&&(this.newValue=e)},decreaseValue(){const e=this.newValue-this.step;this.min<=e&&(this.newValue=e)},checkKey(e){const t=/^[0-9.,]*$/,{key:s,ctrlKey:n}=e;if(s==="ArrowUp")return e.preventDefault(),this.increaseValue();if(s==="ArrowDown")return e.preventDefault(),this.decreaseValue();if(s==="Space")return e.preventDefault();if(["ArrowRight","ArrowLeft","Backspace","Tab"].includes(s)||n&&/a/i.test(s))return;t.test(s)||e.preventDefault()},enterHandler(){this.$refs.input.blur()}}},hl=["value"];function ml(e,t,s,n,r,o){return l(),u("input",{value:o.newValue,class:"input",ref:"input",type:"text",onInput:t[0]||(t[0]=(...a)=>o.inputHandler&&o.inputHandler(...a)),onKeydown:t[1]||(t[1]=(...a)=>o.checkKey&&o.checkKey(...a)),onChange:t[2]||(t[2]=a=>e.$emit("change",a.target.value)),onKeyup:t[3]||(t[3]=Ie((...a)=>o.enterHandler&&o.enterHandler(...a),["enter"]))},null,40,hl)}var Re=g(_l,[["render",ml]]);const pl={components:{InputNumber:Re},props:{modelValue:{required:!0}},emits:["update:modelValue"],data(){return{isEditing:!1,coef:1,initValue:null}},computed:{newValue:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},viewValue(){return E(this.modelValue)}},mounted(){this.initValue=this.modelValue},methods:{changePrice(){this.coef<1&&(this.coef=1),this.newValue=this.initValue*this.coef},async toggleEditMode(){if(this.isEditing=!this.isEditing,this.isEditing){await this.$nextTick();const{input:e}=this.$refs;e.$el.focus(),e.$el.select()}}}},yl=e=>(x("data-v-d3e1fe46"),e=e(),P(),e),fl={class:"table-cell__wrapper"},vl=yl(()=>c("span",null,"x",-1));function gl(e,t,s,n,r,o){const a=h("InputNumber");return l(),u("div",{class:"table-cell",onClick:t[3]||(t[3]=Y((...i)=>o.toggleEditMode&&o.toggleEditMode(...i),["stop"]))},[c("div",fl,[c("span",null,$(o.viewValue),1),r.isEditing?(l(),u(b,{key:0},[vl,y(a,{modelValue:r.coef,"onUpdate:modelValue":[t[0]||(t[0]=i=>r.coef=i),o.changePrice],class:"input",ref:"input",onBlur:t[1]||(t[1]=i=>r.isEditing=!1),onKeyup:t[2]||(t[2]=Ie(i=>r.isEditing=!1,["enter"]))},null,8,["modelValue","onUpdate:modelValue"])],64)):T("",!0)])])}var bl=g(pl,[["render",gl],["__scopeId","data-v-d3e1fe46"]]);const wl={components:{InputNumber:Re},props:{modelValue:{required:!0},isEditing:Boolean},emits:["update:modelValue","save"],computed:{newValue:{get(){return this.modelValue},set(e){if(e<0)return this.$emit("update:modelValue",0);this.$emit("update:modelValue",e)}},isCorrectValue(){return this.modelValue>0},viewValue(){return E(this.modelValue)}},watch:{isEditing(e){!e||this.openEditMode()}},methods:{async openEditMode(){await this.$nextTick();const{input:e}=this.$refs;e.$el.focus(),e.$el.select()},save(){this.$emit("save")}}},$l={key:0};function kl(e,t,s,n,r,o){const a=h("InputNumber");return l(),u("div",{class:N(["table-cell",{danger:!o.isCorrectValue}])},[s.isEditing?(l(),w(a,{key:1,modelValue:o.newValue,"onUpdate:modelValue":t[0]||(t[0]=i=>o.newValue=i),class:"input",ref:"input",onBlur:o.save,onKeyup:Ie(o.save,["enter"])},null,8,["modelValue","onBlur","onKeyup"])):(l(),u("span",$l,$(o.viewValue),1))],2)}var Cl=g(wl,[["render",kl],["__scopeId","data-v-613b20b2"]]);const F={STRING:"\u0422\u0435\u043A\u0441\u0442",NUMBER:"\u0427\u0438\u0441\u043B\u043E",SELECT:"\u0421\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A",COUNTER:"\u0421\u0447\u0435\u0442\u0447\u0438\u043A",PRICE:"\u0421\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C",QUANTITY:"\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E",FORMULA:"\u0424\u043E\u0440\u043C\u0443\u043B\u0430",COLLECTION:"\u041D\u0430\u0431\u043E\u0440 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u043E\u0432",COLLECTION_VALUES:"\u041D\u0430\u0431\u043E\u0440 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u043E\u0432",BOOLEAN_ROOM_PARAMETERS:"\u041B\u043E\u0433\u0438\u0447\u0435\u0441\u043A\u0438\u0439 (\u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B \u043A\u043E\u043C\u043D\u0430\u0442\u044B)",BOOLEAN_ROOM_COMPUTED:"\u041B\u043E\u0433\u0438\u0447\u0435\u0441\u043A\u0438\u0439 (\u0440\u0430\u0441\u0441\u0447\u0435\u0442\u044B)"};var se={computed:{typeOptions(){return Object.values(F)},InputType(){return F}}};const Il={components:{DefaultActions:So,ViewCell:bt,PriceCell:bl,QuantityCell:Cl},mixins:[se],props:{node:{type:Object,default(){return{}}},sum:{type:Number,required:!0}},emits:["clone"],computed:f(m(m({},k("directory",["directories"])),k("outlay",["keys","edition"])),{data(){return this.node.data},keysWithType(){return this.keys.map(e=>{const s=this.directories.find(r=>r._id===this.edition.dirId).keys.find(r=>r.id===e.id),n=this.keys.find(r=>r.id===e.id);return f(m({},n),{type:s.type})})},type(){return this.key.type}}),methods:f(m({},B("outlay",["setNodeEditing","toggleNodeEditing"])),{closeEditing(){this.setNodeEditing({node:this.node,value:!1})},quantityClick(){this.toggleNodeEditing(this.node)}})};function Sl(e,t,s,n,r,o){const a=h("PriceCell"),i=h("QuantityCell"),d=h("ViewCell"),_=h("DefaultActions");return l(),u(b,null,[(l(!0),u(b,null,S(o.keysWithType,(p,v)=>(l(),u(b,{key:p.id},[p.type===e.InputType.PRICE?(l(),w(a,{key:0,modelValue:o.data[p.id],"onUpdate:modelValue":I=>o.data[p.id]=I},null,8,["modelValue","onUpdate:modelValue"])):p.type===e.InputType.QUANTITY?(l(),w(i,{key:1,modelValue:o.data[p.id],"onUpdate:modelValue":I=>o.data[p.id]=I,ref_for:!0,ref:"quantity",isEditing:s.node.isEditing,onSave:o.closeEditing,onClick:Y(o.quantityClick,["stop"])},null,8,["modelValue","onUpdate:modelValue","isEditing","onSave","onClick"])):(l(),w(d,{key:2,value:o.data[p.id],index:v,keyData:p},null,8,["value","index","keyData"]))],64))),128)),y(d,{value:s.sum,isSum:!0},null,8,["value"]),y(_,{onClone:t[0]||(t[0]=p=>e.$emit("clone"))})],64)}var Ol=g(Il,[["render",Sl],["__scopeId","data-v-3ef77a69"]]);const Tl={props:{isEditing:{type:Boolean,required:!0}},emits:["toggleEdit","remove"]},Rl=e=>(x("data-v-2eca9fc7"),e=e(),P(),e),Vl={class:"table-cell table-cell--actions"},Ll={key:0,class:"pi pi-check"},Dl={key:1,class:"pi pi-pencil"},Nl=Rl(()=>c("i",{class:"pi pi-trash"},null,-1)),xl=[Nl];function Pl(e,t,s,n,r,o){return l(),u("div",Vl,[c("button",{class:"button",onClick:t[0]||(t[0]=Y(a=>e.$emit("toggleEdit"),["stop"]))},[s.isEditing?(l(),u("i",Ll)):(l(),u("i",Dl))]),c("button",{class:"button",onClick:t[1]||(t[1]=Y(a=>e.$emit("remove"),["stop"]))},xl)])}var Al=g(Tl,[["render",Pl],["__scopeId","data-v-2eca9fc7"]]);const El={components:{InputNumber:Re},props:{modelValue:{required:!0}},emits:["update:modelValue"],data(){return{coef:1,initPrice:null}},computed:{newValue:{get(){return this.modelValue},set(e){const t=+e.toFixed(2);this.$emit("update:modelValue",t)}}},mounted(){this.initPrice=this.modelValue},methods:{changePrice(e){e<1&&(this.newValue=1),this.initPrice=e,this.coef=1},inputCoef(){this.coef<1&&(this.coef=1),this.newValue=this.initPrice*this.coef}}},Bl={class:"price-cell"};function Ml(e,t,s,n,r,o){const a=h("InputNumber");return l(),u("div",Bl,[y(a,{modelValue:o.newValue,"onUpdate:modelValue":[t[0]||(t[0]=i=>o.newValue=i),o.changePrice],class:"price"},null,8,["modelValue","onUpdate:modelValue"]),y(a,{modelValue:r.coef,"onUpdate:modelValue":[t[1]||(t[1]=i=>r.coef=i),o.inputCoef],class:"coef",step:.1},null,8,["modelValue","step","onUpdate:modelValue"])])}var Jl=g(El,[["render",Ml],["__scopeId","data-v-d2f9f22c"]]);const Kl={props:{modelValue:{required:!0},options:{type:Array,required:!0}},emits:["update:modelValue"],computed:{newValue:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}},jl=["value"];function ql(e,t,s,n,r,o){return H((l(),u("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>o.newValue=a),class:"select"},[(l(!0),u(b,null,S(s.options,a=>(l(),u("option",{key:a.value,value:a.text},$(a.text),9,jl))),128))],512)),[[ke,o.newValue]])}var Hl=g(Kl,[["render",ql],["__scopeId","data-v-049a0dc6"]]);const Ul={components:{CloneActions:Al,ViewCell:bt,PriceCell:Jl,SelectCell:Hl,InputNumber:Re},mixins:[se],props:{node:{type:Object,default(){return{}}},sum:{type:Number,required:!0},isEditing:{type:Boolean,required:!0},selected:{type:Boolean,required:!0}},emits:["toggleEdit","remove"],computed:f(m(m({},k("directory",["directories","roots"])),k("outlay",["keys","edition"])),{data(){return this.node.data},keysWithType(){return this.keys.map(e=>{const s=this.directories.find(r=>r._id===this.edition.dirId).keys.find(r=>r.id===e.id),n=this.keys.find(r=>r.id===e.id);return f(m({},n),{type:s.type})})},options(){return this.keysWithType.filter(t=>t.type===this.InputType.SELECT).reduce((t,s)=>{const r=this.roots.find(_=>_._id===this.edition.dirId).keys.find(_=>_.id===s.id),a=this.roots.find(_=>_._id===r.root).keys.filter(_=>r.keys.includes(_.id));if(!a.length)return[];const d=this.directories.find(_=>_._id===r.dirId).values.map(_=>{const p=a.map(v=>{if(v.type===this.InputType.SELECT){const I=_.data[v.id];return this.getValueOfCell(v.dirId,v.root,I,v.keys)}return _.data[v.id]});return{value:_.id,text:p.join(", ")}});return t[s.id]=d,t},{})}}),watch:{isEditing:{handler(e){!e||this.focusFirstCell()},immediate:!0}},methods:{getValueOfCell(e,t,s,n){const r=this.directories.find(d=>d._id===e);return r?this.roots.find(d=>d._id===t).keys.filter(d=>n.includes(d.id)).map(d=>{const _=r.values.find(p=>p.id===+s);if(d.type===this.InputType.SELECT){const p=_.data[d.id];return this.getValueOfCell(d.dirId,d.root,p,d.keys)}return _.data[d.id]}):null},async focusFirstCell(){await this.$nextTick();const{cell:e}=this.$refs;if(e&&e.length>0){const s=e[0].querySelector("input, select");if(!s)return;s.focus()}}}},Wl=["onUpdate:modelValue"];function Fl(e,t,s,n,r,o){const a=h("ViewCell"),i=h("InputNumber"),d=h("PriceCell"),_=h("SelectCell"),p=h("CloneActions");return l(),u(b,null,[s.isEditing?(l(!0),u(b,{key:1},S(o.keysWithType,v=>(l(),u("div",{ref_for:!0,ref:"cell",key:v.id,class:"table-cell",onClick:t[0]||(t[0]=Y(()=>{},["stop"])),onKeydown:t[1]||(t[1]=Ie(I=>e.$emit("toggleEdit"),["enter"]))},[v.type===e.InputType.STRING?H((l(),u("input",{key:0,"onUpdate:modelValue":I=>o.data[v.id]=I,class:"input",type:"text"},null,8,Wl)),[[te,o.data[v.id]]]):v.type===e.InputType.NUMBER||v.type===e.InputType.QUANTITY?(l(),w(i,{key:1,modelValue:o.data[v.id],"onUpdate:modelValue":I=>o.data[v.id]=I,class:"input"},null,8,["modelValue","onUpdate:modelValue"])):v.type===e.InputType.PRICE?(l(),w(d,{key:2,modelValue:o.data[v.id],"onUpdate:modelValue":I=>o.data[v.id]=I},null,8,["modelValue","onUpdate:modelValue"])):v.type===e.InputType.SELECT?(l(),w(_,{key:3,modelValue:o.data[v.id],"onUpdate:modelValue":I=>o.data[v.id]=I,options:o.options[v.id]},null,8,["modelValue","onUpdate:modelValue","options"])):T("",!0)],32))),128)):(l(!0),u(b,{key:0},S(e.keys,(v,I)=>(l(),w(a,{key:v.id,keyData:v,value:o.data[v.id],isClone:!0,selected:s.selected,index:I},null,8,["keyData","value","selected","index"]))),128)),y(a,{value:s.sum,isSum:!0},null,8,["value"]),y(p,{isEditing:s.isEditing,onToggleEdit:t[2]||(t[2]=v=>e.$emit("toggleEdit")),onRemove:t[3]||(t[3]=v=>e.$emit("remove"))},null,8,["isEditing"])],64)}var Gl=g(Ul,[["render",Fl],["__scopeId","data-v-692a547c"]]);const wt={name:"TalbeRow",components:{StretchedRow:Yi,DefaultRow:ul,SelectedRow:Ol,CloneRow:Gl},inject:["opacities"],provide(){return{changed:Ne(()=>this.changed)}},inheritAttrs:!1,props:{node:{type:Object},level:Number,index:Number,parent:{type:Object}},computed:f(m({},k("outlay",["keys","striped","selectedValues","quantityKey","priceKey","showOnlyChecked","currentRoomData","currentNode","initNodes"])),{data(){return this.node.data},children(){return this.showOnlyChecked?this.node.children.filter(e=>this.selectedValues.includes(e.key)):this.node.children},isCategory(){return this.children.length>0},isClone(){return this.node.isClone},rowAttrs(){return this.isCategory?{"data-id":this.node.key,"data-level":this.level}:{"data-id":this.node.key,"data-level":this.level}},opacity(){return this.opacities[this.level-1]||0},rowStyle(){const t={gridTemplateColumns:`4fr repeat(${this.keys.length}, minmax(100px, 1fr)) 50px`};return this.level>2&&this.isCategory&&(t.backgroundColor=`rgba(38, 138, 173, ${this.opacity})`),t},sum(){const e=this.data[this.quantityKey.id],t=this.data[this.priceKey.id];return e*t},selected(){return this.selectedValues.includes(this.node.key)},current(){var e;return((e=this.currentNode)==null?void 0:e.key)===this.node.key},changed(){const e=this.initNodes.find(n=>n.key===this.node.key);if(!e)return!1;const t=this.node.data[this.priceKey.id],s=e.data[this.priceKey.id];return t!==s}}),methods:f(m(m({},B("outlay",["selectJob","updateNodeChildren","toggleNodeEditing","setCurrentNode"])),A("outlay",["selectJob","unSelectJob","toggleCategoryJobs"])),{rowClickHandler(e){if(this.isCategory)return this.toggleCategoryJobs(this.node);const{target:t}=e,{cellindex:s}=t.dataset,n=parseInt(s);n>0||isNaN(n)||this.node.isEditing||(this.selectJob(this.node),this.setCurrentNode(this.node))},getNodeFromTree(e,t,s){const{key:n,children:r}=e;return n===t?[...s,e]:r.map(o=>this.getNodeFromTree(o,t,[...s,e])).flat()},async clone(){const e=JSON.parse(JSON.stringify(this.node)),t=f(m({},e),{data:f(m({},e.data),{[this.keys[0].id]:e.data[this.keys[0].id]+"*"}),key:Date.now()+"",isClone:!0,isEditing:!0}),{children:s}=this.parent,n=this.showOnlyChecked?s.findIndex(a=>a.key===this.node.key):this.index,r=[...s.slice(0,n+1),m({},t),...s.slice(n+1)];this.updateNodeChildren({node:this.parent,children:r}),this.currentRoomData.map(a=>this.getNodeFromTree(a,t.key,[])).flat().forEach(this.selectJob),await this.$nextTick(),this.setCurrentNode(t)},removeClone(){const e=this.parent.children.filter(t=>t.key!==this.node.key);this.updateNodeChildren({node:this.parent,children:e}),this.unSelectJob(this.node)},toggleEdit(){this.toggleNodeEditing(this.node)}})},ds=()=>{U(e=>({"2fbdf751":e.level}))},cs=wt.setup;wt.setup=cs?(e,t)=>(ds(),cs(e,t)):ds;const Ql=wt;function Zl(e,t,s,n,r,o){const a=h("StretchedRow"),i=h("DefaultRow"),d=h("SelectedRow"),_=h("CloneRow"),p=h("TableRow",!0);return l(),u(b,null,[c("div",mo({class:"table-row"},o.rowAttrs,{class:{parent:o.isCategory,selected:o.selected,striped:e.striped,current:o.current},style:[o.rowStyle,e.$attrs.style],onClick:t[0]||(t[0]=(...v)=>o.rowClickHandler&&o.rowClickHandler(...v))}),[o.isCategory?(l(),w(a,{key:0,data:o.data,level:s.level},null,8,["data","level"])):o.isClone?(l(),w(_,{key:2,node:s.node,sum:o.sum,selected:o.selected,isEditing:s.node.isEditing,onToggleEdit:o.toggleEdit,onRemove:o.removeClone},null,8,["node","sum","selected","isEditing","onToggleEdit","onRemove"])):(l(),u(b,{key:1},[o.selected?(l(),w(d,{key:1,ref:"selectedRow",node:s.node,sum:o.sum,onClone:o.clone},null,8,["node","sum","onClone"])):(l(),w(i,{key:0,node:s.node,sum:o.sum,onClone:o.clone},null,8,["node","sum","onClone"]))],64))],16),o.isCategory?(l(!0),u(b,{key:0},S(o.children,(v,I)=>(l(),w(p,{key:v.key,node:v,level:s.level+1,index:I,parent:s.node,style:Q(e.$attrs.style)},null,8,["node","level","index","parent","style"]))),128)):T("",!0)],64)}var zl=g(Ql,[["render",Zl],["__scopeId","data-v-7da99cb0"]]);const $t={name:"JobList",components:{TableRow:Qi,EditableTableRow:zl},inject:["editable"],props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String,hasTitle:{type:Boolean,default:!0}},emits:["select-node"],computed:f(m({},k("outlay",["keys","selectedValues","showOnlyChecked"])),{data(){return this.node.data},children(){return this.showOnlyChecked?this.node.children.filter(e=>this.selectedValues.includes(e.key)):this.node.children||[]},isCategory(){return this.children.length>0},title(){return this.isCategory&&this.hasTitle?this.data[this.keys[0].id]:null},headerStyle(){const e=this.keys.length;return this.editable?{gridTemplateColumns:`4fr repeat(${e}, minmax(100px, 1fr)) 50px`}:{gridTemplateColumns:`4fr repeat(${e}, minmax(100px, 1fr))`}},selected(){return this.selectedValues.includes(this.node.key)}}),methods:f(m({},A("outlay",["toggleCategoryJobs"])),{categoryClick(){!this.editable||this.toggleCategoryJobs(this.node)}})},us=()=>{U(e=>({"051c0d6d":e.level}))},_s=$t.setup;$t.setup=_s?(e,t)=>(us(),_s(e,t)):us;const Yl=$t,Xl={class:"jobs-list"};function ed(e,t,s,n,r,o){const a=h("EditableTableRow"),i=h("TableRow");return l(),u("div",Xl,[o.title?(l(),u("div",{key:0,class:"table-row table-row--category",style:Q(o.headerStyle)},[c("div",{class:"table-cell",onClick:t[0]||(t[0]=(...d)=>o.categoryClick&&o.categoryClick(...d))},$(o.title),1)],4)):T("",!0),o.editable?(l(!0),u(b,{key:1},S(o.children,(d,_)=>(l(),w(a,{key:d.key,node:d,level:s.level+1,room:s.room,parent:s.node,index:_},null,8,["node","level","room","parent","index"]))),128)):(l(!0),u(b,{key:2},S(o.children,d=>(l(),w(i,{key:d.key,node:d,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128))])}var td=g(Yl,[["render",ed],["__scopeId","data-v-703ec911"]]);const sd={props:{title:String,level:Number},emits:["name-click"],computed:f(m({},k("outlay",["keys"])),{cells(){const e=[...this.keys,{id:"\u0421\u0443\u043C\u043C\u0430",name:"\u0421\u0443\u043C\u043C\u0430"}];return this.title?e.map((t,s)=>s==0?f(m({},t),{name:this.title}):t):e}}),methods:{nameClick(){this.$emit("name-click")}}};function od(e,t,s,n,r,o){return l(!0),u(b,null,S(o.cells,(a,i)=>(l(),u("div",{key:a.id,class:"table-cell"},[i===0?(l(),u("span",{key:0,onClick:t[0]||(t[0]=(...d)=>o.nameClick&&o.nameClick(...d))},$(a.name),1)):(l(),u(b,{key:1},[R($(a.name),1)],64))]))),128)}var nd=g(sd,[["render",od],["__scopeId","data-v-8ac9d388"]]);const z=e=>/^[0-9a-fA-F]{24}$/.test(e);const kt={name:"TableGroup",components:{JobList:td,HeaderCells:nd},inject:["editable"],props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String,isRoom:Boolean},computed:f(m({},k("outlay",["keys","quantityKey","priceKey","selectedValues","selectedRoom","showOnlyChecked","selectedValues"])),{data(){return this.node.data},title(){return this.node.data[this.keys[0].id]},children(){return this.showOnlyChecked?this.node.children.filter(e=>this.selectedValues.includes(e.key)):this.node.children||[]},isCategory(){return this.children.length>0},categories(){return this.children.filter(e=>{const{children:t}=e;return t&&t.length>0})},sum(){const e=this.node.children.map(this.treeToListOnlyValues).flat();if(this.selectedRoom){const n=e.filter(r=>this.selectedValues.includes(r.key)).reduce((r,o)=>{const{data:a}=o,i=a[this.priceKey.id]*a[this.quantityKey.id];return r+i},0);return E(n)}const t=e.reduce((s,n)=>{const{data:r}=n,o=r[this.priceKey.id]*r[this.quantityKey.id];return s+o},0);return E(t)},result(){return`\u0418\u0442\u043E\u0433\u043E \u043F\u043E ${this.isRoom?"\u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u044E":"\u0440\u0430\u0437\u0434\u0435\u043B\u0443"} (${this.title})`},resultsRowStyle(){const e=this.keys.length;return{gridTemplateColumns:`${4+e-1}fr minmax(100px, 1fr)`}},categoryRowStyle(){return{gridTemplateColumns:`4fr repeat(${this.keys.length}, minmax(100px, 1fr)) ${this.selectedRoom?"50px":""}`}},selected(){return this.selectedValues.includes(this.node.key)}}),methods:f(m({},A("outlay",["toggleCategoryJobs"])),{treeToListOnlyValues(e){const{children:t,key:s}=e,n=t.map(this.treeToListOnlyValues).flat();return z(s)?n:[e]},toggleCategory(){!this.editable||this.toggleCategoryJobs(this.node)}})},hs=()=>{U(e=>({"47baa0e8":e.level}))},ms=kt.setup;kt.setup=ms?(e,t)=>(hs(),ms(e,t)):hs;const rd=kt,ad={class:"table-group"},id={key:0,class:"title-row"},ld={class:"table-cell table-cell--results"},dd=["title"];function cd(e,t,s,n,r,o){const a=h("HeaderCells"),i=h("TableGroup",!0),d=h("JobList");return l(),u("div",ad,[s.isRoom?(l(),u("div",id,$(o.title),1)):(l(),u("div",{key:1,class:"table-row table-row--category",style:Q(o.categoryRowStyle)},[y(a,{title:o.title,onNameClick:o.toggleCategory},null,8,["title","onNameClick"])],4)),s.isRoom&&o.children.length>0?(l(!0),u(b,{key:2},S(o.children,_=>(l(),w(i,{key:_.key,node:_,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128)):(l(),u(b,{key:3},[o.categories.length>0?(l(!0),u(b,{key:0},S(o.children,_=>(l(),w(d,{key:_.key,node:_,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128)):(l(),w(d,{key:1,node:s.node,level:s.level+1,room:s.room,hasTitle:!1},null,8,["node","level","room"]))],64)),c("div",{class:"results-row",style:Q(o.resultsRowStyle)},[c("div",ld,$(o.result),1),c("div",{class:"table-cell",title:o.sum},$(o.sum),9,dd)],4)])}var Oo=g(rd,[["render",cd],["__scopeId","data-v-6761ac9a"]]),De={$on:(...e)=>je.on(...e),$once:(...e)=>je.once(...e),$off:(...e)=>je.off(...e),$emit:(...e)=>je.emit(...e)};const To=e=>{const r=.8/e;return new Array(e).fill(0).map((o,a)=>1-a*r)};const ud={components:{TableGroup:Oo},provide(){return{editable:!0,opacities:Ne(()=>this.opacities)}},data(){return{category:null,subCategory:null,timeout:null,currentCategory:null,currentSubCategory:null,currentNodeIndex:0,opacities:[]}},computed:f(m({},k("outlay",["keys","showOnlyChecked","selectedRoom","outlay","currentRoomData","selectedValues","priceKey","roomsData","rooms","currentNode","quantityKey"])),{tableKeys(){return this.keys?this.keys.map((e,t)=>t===0&&this.currentCategory?f(m({},e),{name:this.currentCategory.data[this.keys[0].id]}):e):[]},tableData(){if(!this.selectedRoom)return[];const e=this.showOnlyChecked?this.currentRoomData.filter(t=>this.selectedValues.includes(t.key)):this.currentRoomData;return[{key:this.selectedRoom.id,data:{[this.keys[0].id]:this.selectedRoom.name},room:!0,children:e}]},nodes(){const e=this.tableData.map(this.treeToListOnlyValues).flat();return this.showOnlyChecked?e.filter(t=>this.selectedValues.includes(t.key)):e},headerStyle(){return{gridTemplateColumns:`4fr repeat(${this.tableKeys.length}, minmax(100px, 1fr)) 50px`}}}),watch:{selectedRoom(){this.currentNodeIndex=0;const e=this.nodes[this.currentNodeIndex];this.setCurrentNode(e)},currentRoomData:{handler(){this.selectedRoom&&this.save()},deep:!0},"selectedValues.length"(){this.selectedRoom&&this.save()}},async mounted(){this.setCurrentNode(this.nodes[this.currentNodeIndex]),De.$on("scrollTo",n=>{this.scrollTo(n),this.setCurrentNodeByKey(n)}),De.$on("selectNode",this.setCurrentNodeByKey),document.addEventListener("keydown",this.keyHandler);const e=this.tableData.map(n=>this.getTreeDepth(n,0)),s=Math.max(...e);this.opacities=To(s)},unmounted(){De.$off("scrollTo"),De.$off("selectNode"),document.removeEventListener("keydown",this.keyHandler)},methods:f(m(m(m({},B("outlay",["selectJob","setCurrentNode","toggleNodeEditing","setNodeEditing"])),B("outlays",["updateById"])),A("outlay",["saveLocaly","selectJob"])),{getTreeDepth(e,t){const{children:s}=e;let n=t;if(s&&s.length>0){const r=s.map(a=>this.getTreeDepth(a,t+1));n=Math.max(...r)}return n},isObjectId(e){return/^[0-9a-fA-F]{24}$/.test(e)},treeToListOnlyValues(e){const{children:t,key:s,room:n}=e,r=t.map(this.treeToListOnlyValues).flat();return this.isObjectId(s)||n?r:[e]},save(){this.timeout&&(this.timeout=clearTimeout(this.timeout)),this.timeout=setTimeout(async()=>{await this.saveLocaly()},500)},getNodeFromTree(e,t,s){const{key:n,children:r}=e;return n===t?[...s,e]:r.map(o=>this.getNodeFromTree(o,t,[...s,e])).flat()},scrollTo(e,t=!0){const{wrapper:s}=this.$refs;if(!s)return;const n=s.getBoundingClientRect(),r=s.querySelector(`.table-row[data-id="${e}"]`);if(!r)return;const o=r.getBoundingClientRect(),i=+r.dataset.level*32,d=o.top-n.top-i;s.scrollTo({top:d+s.scrollTop,behavior:t?"smooth":"instant"})},scrollToAndSelect(e){const{key:t}=e;this.scrollTo(t),this.selectNode(e)},selectNode(e){this.selectJob(e),this.setCurrentNodeByKey(e.key)},setCurrentNodeByKey(e){const t=this.nodes.findIndex(s=>s.key===e);t<0||(this.currentNodeIndex=t,this.setCurrentNode(this.nodes[t]))},keyHandler(e){const{key:t,code:s}=e,n=e.composedPath(),r=["INPUT","TEXTAREA","SELECT"];if(n.find(q=>r.includes(q.tagName))||(t!=="F12"&&t!=="F5"&&e.preventDefault(),document.querySelector(".popup-modal"))||!this.currentNode)return;if(s==="Space"){if(this.selectJob(this.currentNode),!this.showOnlyChecked)return;this.currentNodeIndex>=this.nodes.length-1&&(this.currentNodeIndex=this.nodes.length-1);const q=this.nodes[this.currentNodeIndex];return this.setCurrentNode(q)}if(t==="ArrowRight")return this.toggleNodeEditing(this.currentNode);if(t==="ArrowLeft"||t==="Enter")return this.setNodeEditing({node:this.currentNode,value:!1});const i=["ArrowUp","ArrowDown"];if(!i.includes(t))return;if(this.setCurrentNodeByKey(this.currentNode.key),t===i[0]){if(this.currentNodeIndex<=0)return this.currentNodeIndex=0;this.currentNodeIndex--}if(t===i[1]){if(this.currentNodeIndex>=this.nodes.length-1)return this.currentNodeIndex=this.nodes.length-1;this.currentNodeIndex++}const{wrapper:d}=this.$refs,_=d.getBoundingClientRect(),p=this.nodes[this.currentNodeIndex],v=d.querySelector(`.table-row[data-id="${p.key}"]`),I=v.getBoundingClientRect(),{clientHeight:O}=v,D=+v.dataset.level*32,V=I.top-_.top-D,K=_.height-D;if(V+O>=K){const q=V-K+d.scrollTop+O;d.scrollTo({top:q})}V+O<O&&this.scrollTo(p.key,!1),this.setCurrentNode(p)}})},_d={class:"tree-table",ref:"wrapper"},hd={class:"table-grid__body"};function md(e,t,s,n,r,o){const a=h("TableGroup");return l(),u("div",_d,[c("div",hd,[(l(!0),u(b,null,S(o.tableData,(i,d)=>(l(),w(a,{key:i.key,node:i,level:0,index:d,style:Q(o.headerStyle),isRoom:""},null,8,["node","index","style"]))),128))])],512)}var pd=g(ud,[["render",md],["__scopeId","data-v-7a97681f"]]);const yd="/api",J=po.create({baseURL:yd});var ot={directories:{moduleName:"directory",variableNameInModule:"directories"},editions:{moduleName:"edition",variableNameInModule:"editions"},priceLists:{moduleName:"priceList",variableNameInModule:"priceLists"},outlays:{moduleName:"outlays",variableNameInModule:"outlays"},acts:{moduleName:"acts",variableNameInModule:"acts"}};const fd="outlay",vd=1;let qe=null;const gd=Object.keys(ot);var j={async getDb(){return new Promise((e,t)=>{if(qe)return e(qe);const s=indexedDB.open(fd,vd);s.onerror=n=>{console.log("Error opening db",n),t("Error")},s.onsuccess=n=>{qe=n.target.result,e(qe)},s.onupgradeneeded=n=>{console.log("onupgradeneeded");const r=n.target.result;gd.forEach(o=>{r.createObjectStore(o,{keyPath:"_id"})})}})},async getCollectionData(e){const t=await this.getDb(e);return new Promise(s=>{const n=t.transaction([e],"readonly"),r=n.objectStore(e),o=[];n.oncomplete=()=>{s(o)},r.openCursor().onsuccess=a=>{const i=a.target.result;i&&(o.push(i.value),i.continue())}})},async saveDataInCollection(e,t){const s=await this.getDb(e);return new Promise(n=>{const r=s.transaction([e],"readwrite");r.oncomplete=()=>{n()};const o=r.objectStore(e),a=JSON.parse(JSON.stringify(t));o.put(a)})},async removeDataInCollection(e,t){const s=await this.getDb(e);return new Promise(n=>{const r=s.transaction([e],"readwrite");r.oncomplete=()=>{n()},r.objectStore(e).delete(t)})},async clearCollection(e){const t=await this.getDb(e);return new Promise(s=>{const n=t.transaction([e],"readwrite");n.oncomplete=()=>{s()},n.objectStore(e).clear()})},async setArrayToCollection(e,t){return await this.clearCollection(e),await Promise.all(t.map(async s=>{const n=await JSON.parse(JSON.stringify(s));return await this.saveDataInCollection(e,n)}))}};const nt=(e=Math,t=Date,s=16,n=r=>e.floor(r).toString(s))=>n(t.now()/1e3)+" ".repeat(s).replace(/./g,()=>n(e.random()*s));class Ro{constructor(t,s){this._id=nt(),this.name=t,this.edition=s,this.sale=0,this.active=!1,this.rooms=[];const n=new Date;this.createdAt=n,this.updatedAt=n}static getClone(t){const s=JSON.parse(JSON.stringify(t));s._id=nt(),s.active=!1;const n=new Date;return s.createdAt=n,s.updatedAt=n,s}}const ve="outlays",pe=class{static async getAll(){try{const t=await j.getCollectionData(ve);return pe.isOffline?t.filter(n=>!n.removedAt):(await J.get("/outlay")).data}catch(t){return Promise.reject(t)}}static async create(t){try{const s=t,{name:n,edition:r}=s,o=be(s,["name","edition"]),a=new Ro(n,r),i=m(m({},a),o);if(pe.isOffline)return await j.saveDataInCollection(ve,i),Promise.resolve({data:i});const d=await J.post("/outlay",i);return await j.saveDataInCollection(ve,i),d}catch(n){return Promise.reject(n)}}static async update(t){try{if(pe.isOffline)return await j.saveDataInCollection(ve,f(m({},t),{updatedAt:new Date})),Promise.resolve({data:t});const s=t,{_id:n}=s,r=be(s,["_id"]),o=await J.put(`/outlay/${n}`,r);return await j.saveDataInCollection(ve,o.data),o}catch(n){return Promise.reject(n)}}static async remove(t){try{if(pe.isOffline)return t.removedAt=new Date,await j.saveDataInCollection(ve,t),Promise.resolve({data:t});const s=await J.put(`/outlay/${t._id}`,f(m({},t),{removedAt:new Date}));return await j.removeDataInCollection(ve,t._id),s}catch(s){return Promise.reject(s)}}static async createArray(t){try{return pe.isOffline?void 0:await Promise.all(t.map(async n=>await J.post("/outlay",n)))}catch(s){return Promise.reject(s)}}static async updateArray(t){try{return pe.isOffline?void 0:await Promise.all(t.map(async n=>await J.put(`/outlay/${n._id}`,n)))}catch(s){return Promise.reject(s)}}};let ue=pe;Xe(ue,"isOffline",!1);const Z={width:"\u0428\u0438\u0440\u0438\u043D\u0430",height:"\u0412\u044B\u0441\u043E\u0442\u0430",length:"\u0414\u043B\u0438\u043D\u0430",perimeter:"\u041F\u0435\u0440\u0438\u043C\u0435\u0442\u0440",floorArea:"\u041F\u043B\u043E\u0449\u0430\u0434\u044C \u043F\u043E\u043B\u0430",wallArea:"\u041F\u043B\u043E\u0449\u0430\u0434\u044C \u0441\u0442\u0435\u043D",spaces:"\u041F\u0440\u043E\u0435\u043C\u044B"};var ie={computed:{roomOptions(){return Z}},methods:{calculate(e){try{return En.eval(e)}catch{return 0}},getPerimeter(e,t){return(e+t)*2},getFloorArea(e,t){return e*t},getWallArea(e,t,s){return e*t-s},calculateAllParameters(e){const t=this.calculate(e.spaces),s=this.calculate(e.width),n=this.calculate(e.height),r=this.calculate(e.length),o=this.getPerimeter(s,r),a=this.getFloorArea(s,r),i=this.getWallArea(o,n,t);return{computed:{[Z.perimeter]:o,[Z.floorArea]:a,[Z.wallArea]:i},options:{[Z.height]:n,[Z.width]:s,[Z.length]:r,[Z.spaces]:t}}}}};const bd=[F.PRICE,F.FORMULA,F.QUANTITY],wd=[F.PRICE,F.QUANTITY,F.STRING,F.SELECT],Vo=e=>{const{children:t,key:s}=e,n=t.map(Vo).flat();return z(s)?n:[e]},ps=e=>e!=null&&typeof e=="object",rt=(e,t)=>{const s=Object.keys(e),n=Object.keys(t);if(s.length!==n.length)return!1;for(const r of s){const o=e[r],a=t[r],i=ps(o)&&ps(a);if(i&&!rt(o,a)||!i&&o!==a)return!1}return!0},{methods:at}=ie,Lo=e=>{const{children:t}=e;return t&&t.length>0?t[0].children.length===0?[e]:e.children.map(Lo).flat():[]},ye=e=>{const{children:t}=e;return[e.key,...t.map(ye)].flat()},Do=e=>{const{children:t}=e;return t&&t.length>0?[e.key,...e.children.map(Do)].flat():[e.key]},ee=e=>{const{children:t}=e;return t&&t.length>0?t.map(ee).flat():[e]},$d=e=>/^[0-9a-fA-F]{24}$/.test(e),Ue=(e,t,s,n)=>{const{children:r}=e;if(r.length===0){const o=e.data[n];e.data[s]=t[o]||0;return}r.forEach(o=>Ue(o,t,s,n))},No=(e,t,s)=>{e.key==t?e.children=s:e.children.length>0&&e.children.forEach(n=>{No(n,t,s)})},it=(e,t)=>{const{key:s,children:n}=e,r=t.find(o=>o.key===s);return r?(e.children=X.exports.uniqBy([...r.children,...n],"key"),e.children=e.children.map(o=>f(m({},o),{isEditing:!1})),[e]):[f(m({},e),{children:n.map(o=>it(o,t)).flat()})]},ys=(e,t,s,n)=>{const r=JSON.parse(JSON.stringify(t)),{options:o}=e,{computed:a}=at.calculateAllParameters(o);return r.forEach(i=>Ue(i,a,s,n)),r},xe=(e,t)=>{const{children:s}=e;return e.children=s.filter(n=>t.includes(n.key)),e.children.length>0?(e.children.map(n=>xe(n,t)),e):[]},lt=(e,t,s)=>{const{key:n,children:r}=e;return n===t?s:r.map(o=>lt(o,t,[e,...s])).flat()},et=(e,t,s)=>{const n=new RegExp(`^${e}\\s[\u2116]\\d+$|^${e}$`),r=t.filter(a=>a.name.match(n));if(r.length===0)return e;const o=r.reduce((a,i)=>{const d=/№\d+/gm,p=i.name.replace(e,"").match(d);if(!p)return s(i),a;const O=+p[0].split("\u2116")[1];return O>a?O:a},0);return o?`${e} \u2116${o+1}`:`${e} \u21162`},xo=(e,t)=>{const{key:s,children:n}=e;return n&&n.length>0&&!t.includes(s)?!1:(e.children=n.filter(r=>xo(r,t)),!0)},Po=e=>{const t=e.reduce((s,n)=>{s[n.key]=s[n.key]||[];const{children:r}=n,o=r.length>0?r:n;return s[n.key].push(o),s},{});return Object.entries(t).map(([s,n])=>{const r=e.find(a=>a.key===s),{children:o}=r;if(o&&o.length>0){const a=n.flat();return r.children=Po(a),r}return r})};var kd={namespaced:!0,state:{outlay:null,edition:null,selectedRoom:null,showOnlyChecked:!1,keys:[],initNodes:[],initData:null,roomsData:{},selectedValues:{},room:null,quantityKey:null,priceKey:null,formulaKey:null,striped:!1,currentNode:null,showResults:!1,showLeftSide:!0,showRightSide:!0},mutations:{setOutlay(e){const{selectedValues:t,roomsData:s,outlay:n}=e;if(!n)return;const r=JSON.parse(JSON.stringify(n)),{rooms:o}=r,i=JSON.parse(JSON.stringify(o)).map(_=>{const I=JSON.parse(JSON.stringify(s[_.id])).filter(O=>t[_.id].includes(O.key)).map(O=>xe(O,t[_.id]));return f(m({},_),{jobs:I})}),d=f(m({},r),{rooms:i});Object.assign(e.outlay,d)},setSale(e,t){if(!e.outlay)return;const s=parseInt(t);if(isNaN(s)||s<0)return e.outlay.sale=0;if(s>20)return e.outlay.sale=20;e.outlay.sale=s},setSelectedRoom(e,t){e.showResults=!1,e.selectedRoom=t,e.showOnlyChecked=!1},setShowResults(e,t){e.selectedRoom=null,e.showResults=t},setShowOnlyChecked(e,t){e.showOnlyChecked=t},setCurrentNode(e,t){e.currentNode=t},setStriped(e,t){e.striped=t},selectJobs(e,t){const{outlay:s,selectedRoom:n,selectedValues:r}=e;if(!s)return;const o=r[n.id];t.forEach(a=>{o.includes(a.key)||o.push(a.key)})},unSelectJobs(e,t){const{outlay:s,selectedRoom:n,selectedValues:r}=e;if(!s)return;const o=r[n.id];r[n.id]=o.filter(a=>!t.includes(a))},updateNodeChildren(e,{node:t,children:s}){e.roomsData[e.selectedRoom.id].forEach(n=>{No(n,t.key,s)})},removeNode(e,t){!e.selectedRoom||(e.roomsData[e.selectedRoom.id]=e.roomsData[e.selectedRoom.id].filter(s=>s.key!==t))},toggleNodeEditing(e,t){t.isEditing=!t.isEditing},setNodeEditing(e,{node:t,value:s}){t.isEditing=s},resetOutlay(e){e.outlay=null,e.edition=null,e.quantityKey=null,e.priceKey=null,e.formulaKey=null,e.initData=null,e.keys=null,e.roomsData={},e.selectedValues={},e.showResults=!1},setShowLeftSide(e,t){e.showLeftSide=t},setShowRightSide(e,t){e.showRightSide=t},toggleSides(e){const{showLeftSide:t,showRightSide:s}=e;if(t===s){e.showLeftSide=!t,e.showRightSide=!s;return}e.showLeftSide=!0,e.showRightSide=!0}},actions:{setDefaultQuantity({state:e},t){const{roomsData:s}=e,{id:n,options:r}=t,o=JSON.parse(JSON.stringify(s[n]));return r?ys(t,o,e.quantityKey.id,e.formulaKey.id):void 0},setRoomData({state:e,rootGetters:t},s){const{initData:n}=e,{jobs:r,id:o,dirId:a}=s,i=r.map(Lo).flat(),d=JSON.parse(JSON.stringify(n)),_=t["directory/roomDirectory"],p=_.values.find(q=>q.id===a);if(!a||!p){const{options:q}=s;if(q){const{computed:W}=at.calculateAllParameters(q);d.forEach(G=>Ue(G,W,e.quantityKey.id,e.formulaKey.id))}const M=d.map(W=>it(W,i)).flat();e.roomsData[o]=M;return}const{keys:v}=_,I=v.find(q=>q.type===F.COLLECTION),O=p.data[I.id],L=d.filter(q=>xo(q,O)),{options:D}=s;if(D){const{computed:q}=at.calculateAllParameters(D);L.forEach(M=>Ue(M,q,e.quantityKey.id,e.formulaKey.id))}const K=Po([...r,...L]).map(q=>it(q,i)).flat();e.roomsData[o]=K},async setOutlay({state:e,commit:t,rootGetters:s,dispatch:n},r){if(!r)return t("resetOutlay");e.outlay=JSON.parse(JSON.stringify(r));const o=s["edition/editions"].find(p=>p._id===e.outlay.edition);e.edition=o;const a=s["directory/directories"].find(p=>p._id===o.dirId);e.quantityKey=a.keys.find(p=>p.type===F.QUANTITY),e.priceKey=a.keys.find(p=>p.type===F.PRICE),e.formulaKey=a.keys.find(p=>p.type===F.FORMULA);const i=JSON.parse(JSON.stringify(o.data.children)),d=JSON.parse(JSON.stringify(i));e.initNodes=d.map(ee).flat(),e.initData=i,e.keys=a.keys.filter(p=>wd.includes(p.type)),JSON.parse(JSON.stringify(e.outlay.rooms)).map(p=>{const v=JSON.parse(JSON.stringify(p));n("setRoomData",p);const{jobs:I,id:O}=v,L=I.map(Do).flat();e.selectedValues[O]=L}),t("setSelectedRoom",null)},updateRooms({state:e,dispatch:t},s){const{outlay:n}=e;!n||(n.rooms=s,t("saveLocaly"))},selectJob({state:e,dispatch:t},s){const{roomsData:n,selectedRoom:r,selectedValues:o}=e;if(o[r.id].includes(s.key))return t("unSelectJob",s);const d=JSON.parse(JSON.stringify(n[r.id])).map(p=>lt(p,s.key,[])).flat();[s,...d].forEach(p=>{o[r.id].includes(p.key)||o[r.id].push(p.key)})},unSelectJob({state:e,dispatch:t},s){const{roomsData:n,selectedRoom:r,selectedValues:o}=e;if(!o[r.id].includes(s.key))return t("selectJob",s);const d=JSON.parse(JSON.stringify(n[r.id])).map(_=>lt(_,s.key,[])).flat();o[r.id]=o[r.id].filter(_=>_!==s.key),d.forEach(_=>{const{children:p}=_;p.find(I=>o[r.id].includes(I.key))||(o[r.id]=o[r.id].filter(I=>I!==_.key))})},toggleCategoryJobs({state:e,dispatch:t},s){const{selectedValues:n,selectedRoom:r}=e,o=n[r.id],{children:a}=s,i=a.map(ye).flat();if(a.filter(I=>o.includes(I.key)).length===a.length)return n[r.id]=n[r.id].filter(I=>!i.includes(I)),t("selectJob",s);const _=[...n[r.id],...i],p=[...new Set(_)];if(n[r.id]=p,!n[r.id].includes(s.key))return t("selectJob",s)},async createRoom({commit:e,state:t,dispatch:s},{name:n,options:r,dirId:o=null}){if(!t.outlay)return;const{rooms:a}=t.outlay,i=et(n,a,_=>{_.name=`${_.name} \u21161`}),d={id:Date.now()+"",name:i,options:r,jobs:[],dirId:o};return t.outlay.rooms.push(d),s("setRoomData",d),t.selectedValues[d.id]=[],e("setSelectedRoom",d),await s("saveLocaly")},async cloneRoom({getters:e,state:t,dispatch:s,commit:n},{name:r,options:o,cloningRoomId:a,dirId:i}){const d=e.rooms.find(G=>G.id===a),_=JSON.parse(JSON.stringify(d)),{rooms:p}=t.outlay,v=et(r,p,G=>{G.name=`${G.name} \u21161`}),{jobs:I}=_,O={id:Date.now()+"",name:v,options:o,jobs:I,dirId:i},{selectedValues:L,roomsData:D,outlay:V}=t;V.rooms.push(O);const K=JSON.parse(JSON.stringify(D[a])),q=JSON.parse(JSON.stringify(L[a])),{options:M}=d,W=rt(o||{},M||{});return t.roomsData[O.id]=K,t.selectedValues[O.id]=q,W||s("setDefaultQuantity",O),n("setSelectedRoom",O),await s("saveLocaly")},async updateRoom({state:e,dispatch:t,commit:s},n){if(!e.outlay||!e.selectedRoom)return;const{rooms:r}=e.outlay;return e.outlay.rooms=r.map(o=>{if(o.id!==e.selectedRoom.id)return o;if(o.name!==n.name){const I=[...r].filter(O=>O.id!==e.selectedRoom.id);n.name=et(n.name,I,O=>{O.name=`${O.name} \u21161`})}const a=m(m({},o),n),{options:i,dirId:d}=a,{options:_,dirId:p}=o,v=rt(i,_);if(d!==p&&(t("setRoomData",a),e.selectedValues[a.id]=[]),!v){const{roomsData:I,quantityKey:O,formulaKey:L}=e,D=ys(a,I[a.id],O.id,L.id);e.roomsData[a.id]=D}return s("setSelectedRoom",a),a}),await t("saveLocaly")},async removeRoom({state:e,commit:t,dispatch:s},n){if(!!e.outlay)return e.outlay.rooms=e.outlay.rooms.filter(r=>r.id!==n),e.room===n&&(e.room=null),delete e.roomsData[n],delete e.selectedValues[n],t("setSelectedRoom",null),await s("saveLocaly")},async create({rootGetters:e},t){try{return await J.post("/outlay",f(m({},t),{edition:e["edition/active"]._id}))}catch(s){return Promise.reject(s)}},async update({state:e,commit:t}){if(!e.outlay)return;const{_id:s}=e.outlay;try{const n=await ue.update(e.outlay);return t("outlays/updateById",{id:s,data:n.data},{root:!0}),n}catch(n){return Promise.reject(n)}},async saveLocaly({state:e,commit:t}){try{t("setOutlay");const{outlay:s}=e;if(!s)return;const n=JSON.parse(JSON.stringify(s));await j.saveDataInCollection("outlays",f(m({},n),{updatedAt:new Date})),t("outlays/updateById",{id:s._id,data:n},{root:!0})}catch(s){return Promise.reject(s)}}},getters:{outlay:e=>e.outlay,edition:e=>e.edition,rooms:e=>{var t;return((t=e.outlay)==null?void 0:t.rooms)||[]},selectedRoom:e=>e.selectedRoom,roomsData:e=>e.roomsData,currentRoomData:e=>!e.selectedRoom||!e.outlay?[]:e.roomsData[e.selectedRoom.id],selectedValues:e=>e.outlay?e.selectedRoom?e.selectedValues[e.selectedRoom.id]||[]:Object.entries(e.selectedValues).reduce((t,[s,n])=>(t[s]=n,t),{}):[],roots:e=>!e.selectedRoom||!e.roomsData[e.selectedRoom.id]?[]:e.roomsData[e.selectedRoom.id].filter(t=>$d(t.key)),keys:e=>e.keys,showOnlyChecked:e=>e.showOnlyChecked,quantityKey:e=>e.quantityKey,priceKey:e=>e.priceKey,striped:e=>e.striped,sale:e=>e.outlay.sale,currentNode:e=>e.currentNode,showResults:e=>e.showResults,invalidJobs:e=>{const{outlay:t,quantityKey:s}=e;if(!t)return{};const{rooms:n}=t;return n.reduce((r,o)=>{const i=o.jobs.map(Vo).flat().filter(d=>d.data[s.id]===0);return r[o.id]=i,r},{})},showLeftSide:e=>e.showLeftSide,showRightSide:e=>e.showRightSide,initNodes:e=>e.initNodes}};const Cd={components:{TableGroup:Oo},provide(){return{editable:!1,opacities:Ne(()=>this.opacities)}},data(){return{opacities:[]}},computed:f(m({},k("outlay",["rooms","selectedValues","keys","roomsData","selectedRoom"])),{data(){if(!this.roomsData)return[];const e=[...this.rooms].reverse();return e.length===0||this.selectedRoom?[]:e.map(t=>{const n=JSON.parse(JSON.stringify(this.roomsData[t.id])).map(r=>xe(r,this.selectedValues[t.id])).flat();return t?{key:t.id,data:{[this.keys[0].id]:t.name},children:n,room:!0,level:0}:{}})},headerStyle(){return{gridTemplateColumns:`4fr repeat(${this.keys.length}, minmax(100px, 1fr))`}}}),mounted(){const e=this.data.map(n=>this.getTreeDepth(n,0)),s=Math.max(...e);this.opacities=To(s)},methods:{getTreeDepth(e,t){const{children:s}=e;let n=t;if(s&&s.length>0){const r=s.map(a=>this.getTreeDepth(a,t+1));n=Math.max(...r)}return n},treeToList(e,t){const{children:s}=e;return s&&s.length>0?s[0].children.length===0?[e]:[...t,e,...e.children.map(n=>this.treeToList(n,t)).flat()]:t},scrollTo(e,t){const{wrapper:s}=this.$refs;if(!s)return;const n=s.getBoundingClientRect(),r=s.querySelector(`.table-row[data-room="${e}"][data-id="${t}"]`);if(!r)return;const o=r.getBoundingClientRect(),i=+r.dataset.level*32,d=o.top-n.top-i;s.scrollTo({top:d+s.scrollTop,behavior:"smooth"})}}},Id={class:"tree-table",ref:"wrapper"},Sd={class:"table-grid"};function Od(e,t,s,n,r,o){const a=h("TableGroup");return l(),u("div",Id,[c("div",Sd,[(l(!0),u(b,null,S(o.data,i=>(l(),w(a,{ref_for:!0,ref:"table",key:i.key,node:i,room:i.key,level:0,isRoom:""},null,8,["node","room"]))),128))])],512)}var Td=g(Cd,[["render",Od],["__scopeId","data-v-d54f4f3e"]]),Ct=["\u0421\u043F\u0435\u0446\u0438\u0430\u043B\u044C\u043D\u044B\u0435 \u0440\u0430\u0431\u043E\u0442\u044B"];const Rd={mixins:[ie,se],computed:f(m(m(m({},k("directory",["roomDirectory"])),Ce("outlay",["selectedValues"])),k("outlay",["rooms","roomsData","quantityKey","priceKey","keys","sale"])),{roomList(){return[...this.rooms].reverse()},roomsWithOptions(){const{keys:e}=this.roomDirectory,t=e.find(r=>r.type===this.InputType.BOOLEAN_ROOM_PARAMETERS),s=e.find(r=>r.type===this.InputType.BOOLEAN_ROOM_COMPUTED);return this.roomList.filter(r=>{const{dirId:o}=r;if(!o)return!0;const a=this.roomDirectory.values.find(i=>i.id===o);return!(!a.data[t.id]||!a.data[s.id])}).map(r=>r.id)},parameters(){return{perimeter:this.roomOptions.perimeter,floorArea:this.roomOptions.floorArea,wallArea:this.roomOptions.wallArea}},roomParameters(){return this.roomList.map(e=>{const{options:t,id:s}=e;if(!this.roomsWithOptions.includes(s))return{id:s,computed:0};const{computed:n}=this.calculateAllParameters(t);return{id:s,computed:n}})},totalParameters(){return this.roomList.reduce((e,t)=>{const{options:s,id:n}=t;if(!this.roomsWithOptions.includes(n))return e;const{computed:r}=this.calculateAllParameters(s);return this.sumParameters(e,r)},{})},categories(){const e=this.roomList.reduce((n,r)=>[...n,...r.jobs],[]),t=X.exports.uniqBy(e,"key"),s=JSON.parse(JSON.stringify(this.roomsData));return t.map(n=>{const r=this.roomList.reduce((a,i)=>{const d=this.selectedValues[i.id],v=s[i.id].map(D=>xe(D,d)).find(D=>D.key===n.key);if(!v)return a[i.id]=0,a;const L=this.getOnlyMontage(v).map(this.treeToListOnlyValues).flat().reduce((D,V)=>{const{data:K}=V;return D+=K[this.quantityKey.id]*K[this.priceKey.id],D},0);return a[i.id]=L,a},{}),o=this.roomList.reduce((a,i)=>{const d=this.selectedValues[i.id],v=s[i.id].map(D=>xe(D,d)).find(D=>D.key===n.key);if(!v)return a[i.id]=0,a;const L=this.getSelectedItems(v.children,d).map(this.treeToListOnlyValues).flat().reduce((D,V)=>{const{data:K}=V,q=K[this.quantityKey.id]*K[this.priceKey.id];return D+q},0);return a[i.id]=L-r[i.id],a},{});return{id:n.key,name:n.data[this.keys[0].id],rooms:o,specMontage:r}})},sumOfCategory(){return this.categories.reduce((e,t)=>(e[t.id]=Object.entries(t.rooms).reduce((s,[n,r])=>s+r+t.specMontage[n],0),e),{})},priceOfRooms(){return this.roomList.map(e=>{const t=this.categories.reduce((n,r)=>(n+=Object.entries(r.rooms).reduce((a,[i,d])=>(i===e.id&&(a+=d),a),0),n),0),s=this.categories.reduce((n,r)=>(n+=Object.entries(r.specMontage).reduce((a,[i,d])=>(i===e.id&&(a+=d),a),0),n),0);return{id:e.id,result:t,specMontage:s}})},priceOfRoomsWithSale(){return this.priceOfRooms.map(e=>{const t=e.result/100*this.sale,s=e.result-t+e.specMontage;return f(m({},e),{result:s})})},totalPrice(){return this.priceOfRooms.reduce((e,t)=>(e+=t.result+t.specMontage,e),0)},totalPriceWithSale(){const e=this.priceOfRooms.reduce((n,r)=>(n+=r.result,n),0),t=e/100*this.sale;return e-t},specMontage(){return this.roomList.reduce((r,o)=>[...r,...o.jobs],[]).map(this.getOnlyMontage).flat().map(this.treeToListOnlyValues).flat().reduce((r,o)=>{const{data:a}=o;return r+=a[this.quantityKey.id]*a[this.priceKey.id],r},0)},workTime(){const e=this.getPriceForDay(this.totalPrice+this.specMontage);return Math.ceil(this.totalPrice/e)},subTableData(){const e=(this.totalPrice-this.specMontage)/100*this.sale,t=Bn(this.workTime,"\u0434\u0435\u043D\u044C","\u0434\u043D\u044F","\u0434\u043D\u0435\u0439");return[{text:"\u0421\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C \u0431\u0435\u0437 \u0443\u0447\u0435\u0442\u0430 \u0441\u043A\u0438\u0434\u043A\u0438",value:this.format(this.totalPrice),render:this.sale&&this.specMontage>0},{text:"\u0421\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C \u043E\u0431\u0449\u0435\u0441\u0442\u0440\u043E\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0445 \u0440\u0430\u0431\u043E\u0442",value:this.format(this.totalPrice-this.specMontage),render:this.sale||this.specMontage},{text:"\u0421\u043A\u0438\u0434\u043A\u0430 \u043D\u0430 \u043E\u0431\u0449\u0435\u0441\u0442\u0440\u043E\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0440\u0430\u0431\u043E\u0442\u044B",value:`${this.sale} %`,render:this.sale>0},{text:"\u0421\u0443\u043C\u043C\u0430 \u0441\u043A\u0438\u0434\u043A\u0438 \u043D\u0430 \u043E\u0431\u0449\u0435\u0441\u0442\u0440\u043E\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0440\u0430\u0431\u043E\u0442\u044B",value:this.format(e),render:this.sale>0},{text:"\u041E\u0431\u0449\u0435\u0441\u0442\u0440\u043E\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0440\u0430\u0431\u043E\u0442\u044B \u0441 \u0443\u0447\u0435\u0442\u043E\u043C \u0441\u043A\u0438\u0434\u043A\u0438",value:this.format(this.totalPriceWithSale),render:this.sale>0&&this.specMontage},{text:"\u0421\u043F\u0435\u0446\u043C\u043E\u043D\u0442\u0430\u0436",value:this.format(this.specMontage),render:this.specMontage>0},{text:"\u0418\u0442\u043E\u0433\u043E \u0441\u043C\u0435\u0442\u043D\u0430\u044F \u0441\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C",value:this.format(this.totalPriceWithSale+this.specMontage),render:!0},{text:"\u0421\u0440\u043E\u043A \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0440\u0430\u0431\u043E\u0442",value:`${this.workTime} ${t}`,render:!0}]}}),methods:{sumParameters(e,t){return Object.entries(t).reduce((s,[n,r])=>{const o=r+(e[n]||0);return s[n]=o,s},{})},treeToListOnlyValues(e){const{children:t,key:s}=e,n=t.map(this.treeToListOnlyValues).flat();return z(s)?n:[e]},getSelectedItems(e,t){return e.filter(s=>t.includes(s.key))},format(e){return E(e)},getOnlyMontage(e){let t=[];const{data:s,children:n}=e,r=s[this.keys[0].id];Ct.includes(r)&&t.push(e);const o=n.map(this.getOnlyMontage).flat();return t=[...t,...o],t},getPriceForDay(e){return e>=1e5&&e<3e5?5100:e>=3e5&&e<6e5?6900:e>=6e5&&e<1e6?8e3:e>=1e6&&e<2e6?1e4:e>=2e6?13e3:5100}}},Ve=e=>(x("data-v-095b292b"),e=e(),P(),e),Vd={class:"table-wrapper"},Ld={class:"results-table"},Dd={class:"results-table__row results-table__row--head"},Nd=Ve(()=>c("th",{class:"results-table__cell"},"\u041F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B",-1)),xd=Ve(()=>c("th",{class:"results-table__cell"},"\u0418\u0442\u043E\u0433\u043E",-1)),Pd={class:"results-table__cell"},Ad={class:"results-table__cell bold"},Ed={class:"results-table__row results-table__row--head"},Bd=Ve(()=>c("th",{class:"results-table__cell"},"\u041D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u0435 \u0440\u0430\u0431\u043E\u0442",-1)),Md=Ve(()=>c("th",{class:"results-table__cell"},"\u0418\u0442\u043E\u0433\u043E",-1)),Jd={class:"results-table__cell"},Kd={class:"results-table__cell bold price"},jd={class:"results-table__row results-table__row--head"},qd=Ve(()=>c("th",{class:"results-table__cell"},"\u0418\u0422\u041E\u0413\u041E \u041F\u041E \u0420\u0410\u0411\u041E\u0422\u0410\u041C",-1)),Hd={class:"results-table__cell price"},Ud={key:0,class:"results-table__row results-table__row--head"},Wd=Ve(()=>c("th",{class:"results-table__cell"},"\u0418\u0422\u041E\u0413\u041E \u0421\u041E \u0421\u041A\u0418\u0414\u041A\u041E\u0419",-1)),Fd={class:"results-table__cell price"},Gd={class:"subtable"},Qd={key:0,class:"subtable__row"},Zd={class:"subtable__cell"},zd={class:"subtable__cell bold price"};function Yd(e,t,s,n,r,o){return l(),u("div",Vd,[c("table",Ld,[c("tr",Dd,[Nd,(l(!0),u(b,null,S(o.roomList,a=>(l(),u("th",{key:a.id,class:"results-table__cell"},$(a.name),1))),128)),xd]),(l(!0),u(b,null,S(o.parameters,(a,i)=>(l(),u("tr",{key:i,class:"results-table__row"},[c("td",Pd,$(a),1),(l(!0),u(b,null,S(o.roomParameters,d=>(l(),u("td",{key:d.id,class:"results-table__cell"},$(d.computed[a]||"-"),1))),128)),c("td",Ad,$(o.totalParameters[a]),1)]))),128)),c("tr",Ed,[Bd,(l(!0),u(b,null,S(o.roomList,a=>(l(),u("th",{key:a.id,class:"results-table__cell"},$(a.name),1))),128)),Md]),(l(!0),u(b,null,S(o.categories,a=>(l(),u("tr",{key:a.id,class:"results-table__table__row"},[c("td",Jd,$(a.name),1),(l(!0),u(b,null,S(a.rooms,(i,d)=>(l(),u("td",{key:d,class:"results-table__cell price"},$(o.format(i+a.specMontage[d])),1))),128)),c("td",Kd,$(o.format(o.sumOfCategory[a.id])),1)]))),128)),c("tr",jd,[qd,(l(!0),u(b,null,S(o.priceOfRooms,a=>(l(),u("th",{key:a.id,class:"results-table__cell price"},$(o.format(a.result+a.specMontage)),1))),128)),c("th",Hd,$(o.format(o.totalPrice)),1)]),e.sale?(l(),u("tr",Ud,[Wd,(l(!0),u(b,null,S(o.priceOfRoomsWithSale,a=>(l(),u("th",{key:a.id,class:"results-table__cell price"},$(o.format(a.result)),1))),128)),c("th",Fd,$(o.format(o.totalPriceWithSale+o.specMontage)),1)])):T("",!0)]),c("table",Gd,[(l(!0),u(b,null,S(o.subTableData,a=>(l(),u(b,{key:a.text},[a.render?(l(),u("tr",Qd,[c("td",Zd,$(a.text),1),c("td",zd,$(a.value),1)])):T("",!0)],64))),128))])])}var Ao=g(Rd,[["render",Yd],["__scopeId","data-v-095b292b"]]);const Xd={components:{AutoComplete:yo,InputSwitch:fo,TreeTable:pd,TreeTableView:Td,MultiSelect:ut,ResultsTable:Ao,OutlayBlock:re},data(){return{screenHeight:null,selectedJob:null,filteredJobs:[],selectedFastJobs:[],fastJobs:[{label:"\u0420\u0430\u0431\u043E\u0442\u044B 1"},{label:"\u0420\u0430\u0431\u043E\u0442\u044B 2"},{label:"\u0420\u0430\u0431\u043E\u0442\u044B 3"}]}},computed:f(m({},k("outlay",["selectedRoom","roots","outlay","currentRoomData","roomsData","keys","rooms","selectedValues","showResults"])),{striped:{get(){return this.$store.getters["outlay/striped"]},set(e){this.setStriped(e)}},scrollHeight(){return`${this.screenHeight-100}px`},jobs(){return this.selectedRoom?this.roots.map(e=>this.getGroups(e,null)).flat():[...this.rooms].reverse().map(s=>({key:s.id,data:{[this.keys[0].id]:s.name},name:s.name,children:this.roomsData[s.id]})).map(s=>this.getGroupsWithRoom(s,null,s.key)).flat()}}),watch:{selectedRoom(){this.windowResize()},outlay(){this.windowResize()}},mounted(){this.windowResize(),window.addEventListener("resize",this.windowResize)},unmounted(){window.removeEventListener("resize",this.windowResize)},methods:f(m({},B("outlay",["selectJob","setStriped"])),{async windowResize(){if(!this.outlay||this.showResults)return;await this.$nextTick();const{autocomplete:e}=this.$refs,{top:t}=e.$el.getBoundingClientRect();this.screenHeight=window.innerHeight-t},getGroupsWithRoom(e,t=null,s){const{children:n,key:r,data:o}=e;if(n&&n.length>0){e.parent=t;const a=f(m({},e),{name:o[this.keys[0].id],items:[],roomId:s}),d=e.children.map(p=>this.getGroupsWithRoom(p,r,s)).flat().filter(p=>this.selectedValues[s].includes(p.key));if(z(n[0].key))return[m({},a),...d];const _=e.children.filter(p=>this.selectedValues[s].includes(p.key));return[f(m({},a),{items:_.map(p=>f(m({},p),{name:p.data[this.keys[0].id],roomId:s}))}),...d]}return[]},getGroups(e,t){const{children:s,key:n,data:r}=e;if(s&&s.length>0){e.parent=t;const o=f(m({},e),{name:r[this.keys[0].id],items:[]}),a=e.children.map(i=>this.getGroups(i,n)).flat();return z(s[0].key)?[m({},o),...a]:[f(m({},o),{items:e.children.map(i=>f(m({},i),{name:i.data[this.keys[0].id]}))}),...a]}return[]},getParentsOfNode(e){const t=this.jobs.find(s=>s.key===e);return t?t.parent?[this.getParentsOfNode(t.parent),t]:[t]:[]},getParentsOfRoom(e,t){const s=this.jobs.find(n=>n.key===t&&n.roomId===e);return s.parent?[this.getParentsOfRoom(e,s.parent),s]:[s]},async searchJob(e){const t=e.query,s=[];for(const r of this.jobs){const o=r.items.filter(a=>a.name.toLowerCase().includes(t.toLowerCase()));o&&o.length&&((this.selectedRoom?this.getParentsOfNode(r.parent):this.getParentsOfRoom(r.roomId,r.parent).flat()).forEach(i=>{s.push(i)}),s.push(f(m({},r),{items:o})))}if(this.selectedRoom)return this.filteredJobs=X.exports.uniqBy(s,"key");const n=s.reduce((r,o)=>(r[o.roomId]=r[o.roomId]||[],r[o.roomId].push(o),r),{});this.filteredJobs=Object.values(n).reduce((r,o)=>{const a=X.exports.uniqBy(o,"key");return[...r,...a]},[])},async findJob(e){const t=e.value.key,s=e.value.roomId,{table:n,autocomplete:r}=this.$refs,o=r.$el.querySelector("input");if(o&&(await this.$nextTick(),o.blur()),!this.selectedRoom)return n.scrollTo(s,t);n.scrollToAndSelect(e.value)},autoCompleteClickHanler(){this.selectedJob=null},autocompleteInput(){this.$refs.autocomplete.hideOverlay()}})},Eo=e=>(x("data-v-2e712aa0"),e=e(),P(),e),ec={key:0,class:"center__body"},tc={key:0,class:"body-actions"},sc={class:"search-wrapper"},oc=Eo(()=>c("i",{class:"pi pi-search"},null,-1)),nc={class:"body-actions__group"},rc={class:"switch-wrapper"},ac={class:"switch"},ic=Eo(()=>c("span",null,"\u0427\u0435\u0440\u0435\u0434\u043E\u0432\u043D\u0438\u0435 \u0446\u0432\u0435\u0442\u043E\u0432",-1)),lc={key:1,class:"results-wrapper"};function dc(e,t,s,n,r,o){const a=h("AutoComplete"),i=h("MultiSelect"),d=h("InputSwitch"),_=h("ResultsTable"),p=h("TreeTable"),v=h("TreeTableView"),I=h("OutlayBlock");return l(),w(I,{class:"center"},{default:C(()=>[e.outlay?(l(),u("div",ec,[e.showResults?T("",!0):(l(),u("div",tc,[c("div",sc,[oc,y(a,{modelValue:r.selectedJob,"onUpdate:modelValue":t[0]||(t[0]=O=>r.selectedJob=O),ref:"autocomplete",class:"search",field:"name",optionGroupLabel:"name",optionGroupChildren:"items",scrollHeight:o.scrollHeight,suggestions:r.filteredJobs,placeholder:"\u041F\u043E\u0438\u0441\u043A",delay:300,onInput:o.autocompleteInput,onComplete:t[1]||(t[1]=O=>o.searchJob(O)),onItemSelect:o.findJob,onClick:o.autoCompleteClickHanler},null,8,["modelValue","scrollHeight","suggestions","onInput","onItemSelect","onClick"])]),c("div",nc,[e.selectedRoom?(l(),w(i,{key:0,modelValue:r.selectedFastJobs,"onUpdate:modelValue":t[2]||(t[2]=O=>r.selectedFastJobs=O),class:"multiselect",placeholder:"\u0411\u044B\u0441\u0442\u0440\u044B\u0435 \u0440\u0430\u0431\u043E\u0442\u044B",options:r.fastJobs,optionLabel:"label"},null,8,["modelValue","options"])):T("",!0),c("div",rc,[c("div",ac,[y(d,{modelValue:o.striped,"onUpdate:modelValue":t[3]||(t[3]=O=>o.striped=O)},null,8,["modelValue"])]),ic])])])),e.showResults?(l(),u("div",lc,[y(_)])):e.selectedRoom?(l(),w(p,{key:2,ref:"table",striped:o.striped},null,8,["striped"])):e.rooms.length>0?(l(),w(v,{key:3,ref:"table"},null,512)):T("",!0)])):T("",!0)]),_:1})}var cc=g(Xd,[["render",dc],["__scopeId","data-v-2e712aa0"]]);const uc={},_c={width:"7",height:"7",viewBox:"0 0 7 7",fill:"none",xmlns:"http://www.w3.org/2000/svg"},hc=c("path",{d:"M7 3.5L0.25 6.53109L0.25 0.468911L7 3.5Z",fill:"#1C1D2A"},null,-1),mc=[hc];function pc(e,t){return l(),u("svg",_c,mc)}var Bo=g(uc,[["render",pc]]);const yc={name:"CategoryItem",components:{TriangleIcon:Bo},props:{category:{type:Object,required:!0}},data(){return{showChildren:!1}},computed:{sum(){return E(this.category.sum)},jobs(){return this.category.jobs.filter(t=>{const{id:s}=t;return z(s)}).map(t=>f(m({},t),{sum:E(t.sum)}))}}},fc={class:"category-item"},vc={class:"category-item__head"},gc=["title"],bc={class:"category-item__price"},wc={key:0,class:"category-item__list"},$c={class:"category-item__head"},kc=["title"],Cc={class:"category-item__price"};function Ic(e,t,s,n,r,o){const a=h("TriangleIcon");return l(),u("div",fc,[c("div",vc,[c("div",{class:"category-item__text",onClick:t[0]||(t[0]=i=>r.showChildren=!r.showChildren)},[c("button",{class:N(["button",{rotated:r.showChildren,hidden:o.jobs.length===0}])},[y(a,{class:"button__icon"})],2),c("span",{class:"category-item__name",title:s.category.name},$(s.category.name),9,gc)]),c("span",bc,$(o.sum),1)]),o.jobs&&o.jobs.length>0&&r.showChildren?(l(),u("div",wc,[(l(!0),u(b,null,S(o.jobs,i=>(l(),u("div",{key:i.key,class:"category-item"},[c("div",$c,[c("span",{class:"category-item__name",title:i.name},$(i.name),9,kc),c("span",Cc,$(i.sum.toLocaleString()),1)])]))),128))])):T("",!0)])}var Sc=g(yc,[["render",Ic],["__scopeId","data-v-6f9cec45"]]);const Oc={name:"CategoryList",components:{CategoryItem:Sc},props:{categories:{type:Array,required:!0}},computed:f(m({},k("outlay",["roomsData","selectedRoom"])),{categoryList(){return this.selectedRoom?this.categories.find(t=>t.id===this.selectedRoom.id).jobs:[...this.categories].reverse()}})},Tc={class:"category-list"};function Rc(e,t,s,n,r,o){const a=h("CategoryItem");return l(),u("div",Tc,[(l(!0),u(b,null,S(o.categoryList,i=>(l(),w(a,{key:i.id,category:i},null,8,["category"]))),128))])}var Vc=g(Oc,[["render",Rc],["__scopeId","data-v-2a84c66d"]]);const Lc={props:{data:{type:Array,required:!0}},data(){return{timeout:null}},computed:f(m({},k("outlay",["sale"])),{saleValue:{get(){return this.sale},set(e){this.setSale(e)}},totalSum(){return this.data.reduce((e,t)=>e+ +t.sum,0)},totalSumFormatted(){return E(this.totalSum)},totalSumWithSale(){if(!this.saleValue||this.saleValue<0||this.saleValue>20)return this.totalSumFormatted;const e=this.data.map(this.findCategoriesWithoutSale).flat();if(e.length>0){const n=e.reduce((i,d)=>i+=d.sum,0),o=(this.totalSum-n)/100*this.saleValue,a=this.totalSum-o;return E(a)}const t=this.totalSum/100*this.saleValue,s=this.totalSum-t;return E(s)}}),methods:f(m(m({},B("outlay",["setSale"])),A("outlay",["saveLocaly"])),{inputSale(e){const{target:t}=e,{valueAsNumber:s}=t;if(s<0){t.value=0;return}s>20&&(t.value=20),t.value=this.saleValue},changeSale(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(async()=>{await this.saveLocaly()},400)},findCategoriesWithoutSale(e){const{name:t,jobs:s}=e;let n=[];if(Ct.includes(t)&&n.push(e),s){const r=s.map(this.findCategoriesWithoutSale).flat();n=[...n,...r]}return n}})},Dc=e=>(x("data-v-a10b4164"),e=e(),P(),e),Nc={class:"results"},xc=R(" \u0411\u0435\u0437 \u0441\u043A\u0438\u0434\u043A\u0438: "),Pc={class:"result"},Ac={class:"right-side__sale"},Ec=Dc(()=>c("span",null,"\u0421\u043A\u0438\u0434\u043A\u0430, %: ",-1)),Bc=R(" \u0418\u0422\u041E\u0413\u041E: "),Mc={class:"result result--sale"};function Jc(e,t,s,n,r,o){return l(),u("div",Nc,[c("span",null,[xc,c("span",Pc,$(o.totalSumFormatted),1)]),c("div",Ac,[Ec,H(c("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>o.saleValue=a),class:"input",placeholder:"%",type:"number",max:20,min:0,onInput:t[1]||(t[1]=(...a)=>o.inputSale&&o.inputSale(...a)),onChange:t[2]||(t[2]=(...a)=>o.changeSale&&o.changeSale(...a))},null,544),[[te,o.saleValue]])]),c("span",null,[Bc,c("span",Mc,$(o.totalSumWithSale),1)])])}var Kc=g(Lc,[["render",Jc],["__scopeId","data-v-a10b4164"]]);const jc={props:{name:{required:!0,type:String},value:{required:!0}}},qc={class:"parameter"},Hc={class:"parameter__name"},Uc=["value"];function Wc(e,t,s,n,r,o){return l(),u("div",qc,[c("label",Hc,$(s.name),1),c("input",{value:s.value,disabled:"",class:"parameter__input"},null,8,Uc)])}var Mo=g(jc,[["render",Wc],["__scopeId","data-v-5cf19298"]]);const Fc={components:{ParameterItem:Mo},mixins:[ie],props:{parametersData:{type:Object,default(){return{}}}}},Gc={class:"computed-parameters"};function Qc(e,t,s,n,r,o){const a=h("ParameterItem");return l(),u("div",Gc,[y(a,{name:"S \u043F\u043E\u043B\u0430",value:s.parametersData[e.roomOptions.floorArea]},null,8,["value"]),y(a,{name:"S \u0441\u0442\u0435\u043D",value:s.parametersData[e.roomOptions.wallArea]},null,8,["value"]),y(a,{name:"\u041F\u0435\u0440\u0438\u043C\u0435\u0442\u0440",value:s.parametersData[e.roomOptions.perimeter]},null,8,["value"])])}var Jo=g(Fc,[["render",Qc],["__scopeId","data-v-8e89d10c"]]);const Zc={components:{ParameterItem:Mo},props:{parameters:{type:Object,default(){return{}}}}},zc={class:"room-options"};function Yc(e,t,s,n,r,o){const a=h("ParameterItem");return l(),u("div",zc,[(l(!0),u(b,null,S(s.parameters,(i,d)=>(l(),w(a,{key:d,name:d,value:i},null,8,["name","value"]))),128))])}var Xc=g(Zc,[["render",Yc],["__scopeId","data-v-58c12efa"]]);const eu={components:{RoomParameters:Xc,ComputedParameters:Jo},mixins:[ie],computed:f(m({},k("outlay",["selectedRoom"])),{parameters(){return this.selectedRoom.options},allParameters(){const e=this.calculateAllParameters(this.parameters);return Object.keys(e).reduce((t,s)=>(t[s]=Object.entries(e[s]).reduce((n,[r,o])=>(n[r]=E(o),n),{}),t),{})}})},tu={class:"title"},su={class:"groups"};function ou(e,t,s,n,r,o){const a=h("RoomParameters",!0),i=h("ComputedParameters");return l(),u(b,null,[c("span",tu,$(e.selectedRoom.name),1),c("div",su,[y(a,{parameters:o.allParameters.options},null,8,["parameters"]),y(i,{parametersData:o.allParameters.computed},null,8,["parametersData"])])],64)}var nu=g(eu,[["render",ou],["__scopeId","data-v-629bd96c"]]);const ru={components:{ComputedParameters:Jo},mixins:[ie,se],computed:f(m(m({},k("outlay",["rooms"])),k("directory",["roomDirectory"])),{roomsInResults(){const{keys:e}=this.roomDirectory,t=e.find(n=>n.type===this.InputType.BOOLEAN_ROOM_PARAMETERS),s=e.find(n=>n.type===this.InputType.BOOLEAN_ROOM_COMPUTED);return this.rooms.filter(n=>{const{dirId:r}=n;if(!r)return!0;const o=this.roomDirectory.values.find(a=>a.id===r);return!(!o.data[t.id]||!o.data[s.id])})},totalComputedParameters(){return this.roomsInResults.reduce((e,t)=>{const{options:s}=t,{computed:n}=this.calculateAllParameters(s);return this.sumParameters(e,n)},{})}}),methods:{sumParameters(e,t){return Object.entries(t).reduce((s,[n,r])=>{const o=r+(e[n]||0);return s[n]=o,s},{})}}},au=e=>(x("data-v-3a74554b"),e=e(),P(),e),iu=au(()=>c("span",{class:"title"}," \u0418\u0442\u043E\u0433\u043E\u0432\u044B\u0435 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B ",-1));function lu(e,t,s,n,r,o){const a=h("ComputedParameters");return l(),u(b,null,[iu,y(a,{parametersData:o.totalComputedParameters},null,8,["parametersData"])],64)}var du=g(ru,[["render",lu],["__scopeId","data-v-3a74554b"]]);const cu={components:{OutlayBlock:re,RoomParameters:nu,TotalParameters:du},computed:m({},k("outlay",["selectedRoom"]))},uu={class:"parameters"};function _u(e,t,s,n,r,o){const a=h("RoomParameters"),i=h("TotalParameters"),d=h("OutlayBlock");return l(),w(d,null,{default:C(()=>[c("div",uu,[e.selectedRoom&&e.selectedRoom.options?(l(),w(a,{key:0})):e.selectedRoom?T("",!0):(l(),w(i,{key:1}))])]),_:1})}var hu=g(cu,[["render",_u],["__scopeId","data-v-4d791800"]]);const mu={components:{OutlayBlock:re},props:{position:{type:String,default:"left"},modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],methods:{toggle(){return this.$emit("update:modelValue",!this.modelValue)}}},pu=e=>(x("data-v-527d6f51"),e=e(),P(),e),yu=pu(()=>c("i",{class:"pi pi-angle-double-left"},null,-1)),fu=[yu];function vu(e,t,s,n,r,o){const a=h("OutlayBlock");return l(),w(a,{class:N(["collapse-block",s.position])},{default:C(()=>[c("button",{class:N(["collapse-button button",[{rotated:s.position==="left"?!s.modelValue:s.modelValue},{hidden:!s.modelValue}]]),onClick:t[0]||(t[0]=(...i)=>o.toggle&&o.toggle(...i))},fu,2)]),_:1},8,["class"])}var Fe=g(mu,[["render",vu],["__scopeId","data-v-527d6f51"]]);const gu={components:{CategoryList:Vc,ResultsForm:Kc,ParameterList:hu,OutlayBlock:re,CollapseBlock:Fe},computed:f(m(m({},Ce("outlay",["selectedValues"])),k("outlay",["outlay","rooms","roomsData","quantityKey","priceKey","keys","selectedRoom","currentRoomData"])),{showRightSide:{get(){return this.$store.getters["outlay/showRightSide"]},set(e){return this.setShowRightSide(e)}},data(){if(this.selectedRoom){const s=JSON.parse(JSON.stringify(this.currentRoomData)),n=JSON.parse(JSON.stringify(this.selectedRoom));return[this.getRoomWithSum(n,s)]}const e=JSON.parse(JSON.stringify(this.roomsData));return[...this.rooms].map(s=>{const n=e[s.id];return this.getRoomWithSum(s,n)})}}),methods:f(m({},B("outlay",["setShowRightSide"])),{treeToListOnlyValues(e){const{children:t,key:s}=e,n=t.map(this.treeToListOnlyValues).flat();return z(s)?n:[e]},getSelectedItems(e,t){return e.filter(s=>t.includes(s.key))},getSubCategoriesWithSum(e,t){return e.map(s=>{const n=this.treeToListOnlyValues(s),o=this.getSelectedItems(n,t).reduce((a,i)=>{const d=i.data[this.quantityKey.id]*i.data[this.priceKey.id];return a+d},0);return{id:s.key,name:s.data[this.keys[0].id],sum:o}})},getSum(e){return e.reduce((t,s)=>t+=+s.sum,0)},getRoomWithSum(e,t){const s=this.selectedValues[e.id],r=this.getSelectedItems(t,s).map(a=>{const i=this.getSelectedItems(a.children,s),d=this.getSubCategoriesWithSum(i,s),_=this.getSum(d);return{id:a.key,name:a.data[this.keys[0].id],sum:_,jobs:d}}),o=this.getSum(r);return{id:e.id,name:e.name,jobs:r,sum:o}}})},bu={class:"wrapper"};function wu(e,t,s,n,r,o){const a=h("CollapseBlock"),i=h("ParameterList"),d=h("CategoryList"),_=h("ResultsForm"),p=h("OutlayBlock");return l(),u("div",bu,[y(a,{modelValue:o.showRightSide,"onUpdate:modelValue":t[0]||(t[0]=v=>o.showRightSide=v),position:"right"},null,8,["modelValue"]),y(i,{class:"wrapper__parameters"}),y(p,{class:"wrapper__results"},{default:C(()=>[y(d,{categories:o.data},null,8,["categories"]),y(_,{data:o.data},null,8,["data"])]),_:1})])}var $u=g(gu,[["render",wu],["__scopeId","data-v-2a253ca4"]]);const ku={},Cu={width:"11",height:"11",viewBox:"0 0 11 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Iu=c("path",{d:"M10.5 4.875H2.89375L6.3875 1.38125L5.5 0.5L0.5 5.5L5.5 10.5L6.38125 9.61875L2.89375 6.125H10.5V4.875Z",fill:"#545454"},null,-1),Su=[Iu];function Ou(e,t){return l(),u("svg",Cu,Su)}var Ko=g(ku,[["render",Ou]]);const Tu={},Ru={width:"13",height:"13",viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Vu=c("path",{d:"M9.625 0.875H2.125C1.43125 0.875 0.875 1.4375 0.875 2.125V10.875C0.875 11.5625 1.43125 12.125 2.125 12.125H10.875C11.5625 12.125 12.125 11.5625 12.125 10.875V3.375L9.625 0.875ZM6.5 10.875C5.4625 10.875 4.625 10.0375 4.625 9C4.625 7.9625 5.4625 7.125 6.5 7.125C7.5375 7.125 8.375 7.9625 8.375 9C8.375 10.0375 7.5375 10.875 6.5 10.875ZM8.375 4.625H2.125V2.125H8.375V4.625Z",fill:"#545454"},null,-1),Lu=[Vu];function Du(e,t){return l(),u("svg",Ru,Lu)}var jo=g(Tu,[["render",Du]]);const Nu={},xu={width:"9",height:"12",viewBox:"0 0 9 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Pu=c("path",{d:"M8.875 4.625H6.375V0.875H2.625V4.625H0.125L4.5 9L8.875 4.625ZM0.125 10.25V11.5H8.875V10.25H0.125Z",fill:"#545454"},null,-1),Au=[Pu];function Eu(e,t){return l(),u("svg",xu,Au)}var qo=g(Nu,[["render",Eu]]);const Bu={},Mu={width:"13",height:"13",viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ju=c("path",{d:"M10.875 4H2.125C1.0875 4 0.25 4.8375 0.25 5.875V9.625H2.75V12.125H10.25V9.625H12.75V5.875C12.75 4.8375 11.9125 4 10.875 4ZM9 10.875H4V7.75H9V10.875ZM10.875 6.5C10.5312 6.5 10.25 6.21875 10.25 5.875C10.25 5.53125 10.5312 5.25 10.875 5.25C11.2188 5.25 11.5 5.53125 11.5 5.875C11.5 6.21875 11.2188 6.5 10.875 6.5ZM10.25 0.875H2.75V3.375H10.25V0.875Z",fill:"#545454"},null,-1),Ku=[Ju];function ju(e,t){return l(),u("svg",Mu,Ku)}var Ho=g(Bu,[["render",ju]]);const qu={props:{bold:Boolean,results:Boolean,category:Boolean}};function Hu(e,t,s,n,r,o){return l(),u("tr",{class:N(["table-row",{bold:s.bold,results:s.results,category:s.category}])},[ne(e.$slots,"default",{},void 0,!0)],2)}var Ee=g(qu,[["render",Hu],["__scopeId","data-v-3a0c8d68"]]);const Uu={props:{result:Boolean,category:Boolean,right:Boolean,colspan:Number}},Wu=["colspan"];function Fu(e,t,s,n,r,o){return l(),u("td",{class:N(["table-cell",{result:s.result,category:s.category,right:s.right}]),colspan:s.colspan},[ne(e.$slots,"default",{},void 0,!0)],10,Wu)}var Be=g(Uu,[["render",Fu],["__scopeId","data-v-656c5c8e"]]);const Gu={name:"TableRow",components:{RowWrapper:Ee,CellWrapper:Be},props:{node:{type:Object,required:!0,default:()=>({})}},computed:f(m({},k("outlay",["keys","quantityKey","priceKey"])),{data(){return this.node.data},children(){return this.node.children||[]},isCategory(){return this.children.length>0},sum(){const e=this.node.data[this.quantityKey.id],t=this.node.data[this.priceKey.id];return E(e*t)},viewData(){const e=[this.quantityKey.id,this.priceKey.id,"quantity"];return this.keys.map(t=>e.includes(t.id)?{key:t.id,value:this.data[t.id]&&E(this.data[t.id])}:{key:t.id,value:this.data[t.id]||null})}})},Qu={key:0,class:"sum-cell"};function Zu(e,t,s,n,r,o){const a=h("CellWrapper"),i=h("RowWrapper"),d=h("TableRow",!0);return l(),u(b,null,[y(i,{bold:o.isCategory},{default:C(()=>[(l(!0),u(b,null,S(o.viewData,_=>(l(),w(a,{key:_.key},{default:C(()=>[R($(_.value),1)]),_:2},1024))),128)),y(a,{right:""},{default:C(()=>[o.isCategory?T("",!0):(l(),u("span",Qu,$(o.sum),1))]),_:1})]),_:1},8,["bold"]),o.isCategory?(l(!0),u(b,{key:0},S(o.children,_=>(l(),w(d,{key:_.key,node:_},null,8,["node"]))),128)):T("",!0)],64)}var zu=g(Gu,[["render",Zu],["__scopeId","data-v-f40d3a26"]]);const Yu={components:{TableRow:zu,RowWrapper:Ee,CellWrapper:Be},props:{node:{type:Object,required:!0}},computed:f(m({},k("outlay",["keys","quantityKey","priceKey"])),{children(){return this.node.children},title(){return this.children.length>0?this.node.data[this.keys[0].id]:null},visibleKeys(){return this.keys.map((e,t)=>t===0&&this.title?this.title:e.name)}})},Xu=R("\u0421\u0443\u043C\u043C\u0430");function e_(e,t,s,n,r,o){const a=h("CellWrapper"),i=h("RowWrapper"),d=h("TableRow");return l(),u(b,null,[o.title?(l(),w(i,{key:0,bold:""},{default:C(()=>[(l(!0),u(b,null,S(o.visibleKeys,_=>(l(),w(a,{key:_},{default:C(()=>[R($(_),1)]),_:2},1024))),128)),y(a,{result:""},{default:C(()=>[Xu]),_:1})]),_:1})):(l(),w(d,{key:1,node:s.node},null,8,["node"])),(l(!0),u(b,null,S(o.children,_=>(l(),w(d,{node:_,key:_.key},null,8,["node"]))),128))],64)}var t_=g(Yu,[["render",e_]]);const s_={components:{JobList:t_,RowWrapper:Ee,CellWrapper:Be},props:{node:{type:Object,required:!0}},computed:f(m({},k("outlay",["keys","quantityKey","priceKey"])),{title(){return this.node.data[this.keys[0].id]},children(){return this.node.children},sum(){const t=ee(this.node).flat().reduce((s,n)=>{const{data:r}=n;return s+=r[this.quantityKey.id]*r[this.priceKey.id],s},0);return E(t)}})};function o_(e,t,s,n,r,o){const a=h("CellWrapper"),i=h("RowWrapper"),d=h("JobList");return l(),u(b,null,[y(i,{category:""},{default:C(()=>[y(a,{category:"",colspan:e.keys.length+1},{default:C(()=>[R($(o.title),1)]),_:1},8,["colspan"])]),_:1}),(l(!0),u(b,null,S(o.children,_=>(l(),w(d,{key:_.key,node:_},null,8,["node"]))),128)),y(i,{results:""},{default:C(()=>[y(a,{result:"",colspan:e.keys.length},{default:C(()=>[R(" \u0418\u0442\u043E\u0433\u043E \u043F\u043E \u0440\u0430\u0437\u0434\u0435\u043B\u0443 ("+$(o.title)+") ",1)]),_:1},8,["colspan"]),y(a,{result:""},{default:C(()=>[R($(o.sum),1)]),_:1})]),_:1})],64)}var Uo=g(s_,[["render",o_]]);const n_={components:{CategoryRow:Uo,RowWrapper:Ee,CellWrapper:Be},props:{tableKeys:{type:Array,required:!0},tableData:{type:Array,required:!0},room:{type:Object,required:!0}},computed:f(m({},k("outlay",["quantityKey","priceKey"])),{sum(){const t=this.room.jobs.map(ee).flat().reduce((s,n)=>{const{data:r}=n;return s+=r[this.quantityKey.id]*r[this.priceKey.id],s},0);return E(t)}})},r_={class:"print-table"},a_=["width"];function i_(e,t,s,n,r,o){const a=h("CategoryRow"),i=h("CellWrapper"),d=h("RowWrapper");return l(),u("table",r_,[(l(!0),u(b,null,S(s.tableKeys,(_,p)=>(l(),u("col",{key:_.id,width:p===0?"50%":"100px"},null,8,a_))),128)),(l(!0),u(b,null,S(s.tableData,_=>(l(),w(a,{key:_.key,node:_},null,8,["node"]))),128)),y(d,null,{default:C(()=>[y(i,{result:"",colspan:s.tableKeys.length},{default:C(()=>[R(" \u0418\u0442\u043E\u0433\u043E \u043F\u043E \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u044E ("+$(s.room.name)+") ",1)]),_:1},8,["colspan"]),y(i,{result:""},{default:C(()=>[R($(o.sum),1)]),_:1})]),_:1})])}var l_=g(n_,[["render",i_],["__scopeId","data-v-6a4fc9ba"]]);const d_={components:{AppLogo:Te},mixins:[ie],props:{room:{type:Object,required:!0}},computed:{options(){return this.room.options},parameterKeys(){const e={[Z.length]:"\u0414\u043B\u0438\u043D\u0430, \u043C/\u043F",[Z.width]:"\u0428\u0438\u0440\u0438\u043D\u0430, \u043C/\u043F",[Z.height]:"\u0412\u044B\u0441\u043E\u0442\u0430, \u043C/\u043F",[Z.spaces]:"\u041F\u0440\u043E\u0435\u043C, \u043C2"};return Object.entries(e).map(([t,s])=>{const n=Object.keys(Z).find(r=>Z[r]===t);return{text:s,key:n}})},calculatedParameters(){return this.options?this.calculateAllParameters(this.options):0},calculated(){return this.calculatedParameters?this.calculatedParameters.computed:{}},calculatedOptions(){if(!this.calculatedParameters)return{};const{options:e}=this.calculatedParameters;return Object.entries(e).reduce((t,[s,n])=>{const r=Object.keys(this.roomOptions).find(o=>this.roomOptions[o]===s);return t[r]=n,t},{})}}},Wo=e=>(x("data-v-a9bd45f0"),e=e(),P(),e),c_={class:"page-header"},u_={class:"top"},__=Wo(()=>c("div",{class:"top__text"},[c("span",{class:"top__phone"}," 8 (495) 104-51-21 "),c("span",{class:"top__subtext"},"\u0441\u043B\u0443\u0436\u0431\u0430 \u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u043E\u0433\u043E \u043A\u043E\u043D\u0442\u0440\u043E\u043B\u044F")],-1)),h_=Wo(()=>c("div",{class:"address"},[c("span",{class:"text"}," \u0410\u0434\u0440\u0435\u0441 \u043E\u0431\u044A\u0435\u043A\u0442\u0430: "),c("div",{class:"underline"})],-1)),m_={class:"row"},p_=_t('<div class="row-text" data-v-a9bd45f0><span class="application" data-v-a9bd45f0>\u041F\u0440\u0438\u043B\u043E\u0436\u0435\u043D\u0438\u0435 \u043A \u21161 \u043A \u0434\u043E\u0433\u043E\u0432\u043E\u0440\u0443 \u2116 \u041A\u0421 <div class="application__underline" data-v-a9bd45f0></div> \u043E\u0442 <div class="application__underline" data-v-a9bd45f0></div> 2022\u0433.</span><span class="date" data-v-a9bd45f0> \u0421\u043C\u0435\u0442\u0430 \u043E\u0442 &quot; <div class="date__space" data-v-a9bd45f0></div> &quot; <div class="date__underline" data-v-a9bd45f0></div> 2022 </span></div>',1),y_={key:0,class:"parameters"},f_={class:"parameters-table"},v_={class:"parameters-table__row"},g_={class:"parameters-table__row"},b_={class:"parameters-table"},w_={class:"parameters-table__row"},$_={class:"parameters-table__row"};function k_(e,t,s,n,r,o){const a=h("AppLogo");return l(),u("div",c_,[c("div",u_,[y(a,{class:"top__logo"}),__]),h_,c("div",m_,[p_,o.options?(l(),u("div",y_,[c("table",f_,[c("tr",v_,[(l(!0),u(b,null,S(o.parameterKeys,i=>(l(),u("td",{key:i.key,class:"parameters-table__cell"},$(i.text),1))),128))]),c("tr",g_,[(l(!0),u(b,null,S(o.parameterKeys,i=>(l(),u("td",{key:i.key,class:"parameters-table__cell"},$(o.calculatedOptions[i.key]),1))),128))])]),c("table",b_,[c("tr",w_,[(l(!0),u(b,null,S(o.calculated,(i,d)=>(l(),u("td",{key:d,class:"parameters-table__cell"},$(d),1))),128))]),c("tr",$_,[(l(!0),u(b,null,S(o.calculated,(i,d)=>(l(),u("td",{key:d,class:"parameters-table__cell"},$(i),1))),128))])])])):T("",!0)])])}var C_=g(d_,[["render",k_],["__scopeId","data-v-a9bd45f0"]]);const I_={components:{PrintTable:l_,PageHeader:C_,ResultsTable:Ao,AppLogo:Te},props:{outlay:{required:!0,type:Object}},emits:["mounted"],computed:f(m({},k("outlay",["keys"])),{tableKeys(){return this.edition?[...this.keys,{id:"\u0421\u0443\u043C\u043C\u0430",name:"\u0421\u0443\u043C\u043C\u0430"}]:[]},tableData(){return[...this.outlay.rooms].reverse()}}),mounted(){this.$emit("mounted")}},Fo=e=>(x("data-v-cb7672c6"),e=e(),P(),e),S_={class:"container"},O_={class:"title"},T_=_t('<div class="signs" data-v-cb7672c6><span class="sign" data-v-cb7672c6> \u0421\u043E\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u043E: <div class="sign__underline" data-v-cb7672c6></div></span><div class="sign" data-v-cb7672c6> \u0421\u043E\u0433\u043B\u0430\u0441\u043E\u0432\u0430\u043D\u043E: <div class="sign__underline" data-v-cb7672c6></div></div></div>',1),R_={class:"results-table"},V_={class:"top"},L_=Fo(()=>c("div",{class:"top__text"},[c("span",{class:"top__phone"}," 8 (495) 104-51-21 "),c("span",{class:"top__subtext"},"\u0441\u043B\u0443\u0436\u0431\u0430 \u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u043E\u0433\u043E \u043A\u043E\u043D\u0442\u0440\u043E\u043B\u044F")],-1)),D_=Fo(()=>c("span",{class:"title"}," \u0421\u0432\u043E\u0434\u043D\u0430\u044F \u0442\u0430\u0431\u043B\u0438\u0446\u0430 ",-1));function N_(e,t,s,n,r,o){const a=h("PageHeader"),i=h("PrintTable"),d=h("AppLogo"),_=h("ResultsTable");return l(),u("div",S_,[(l(!0),u(b,null,S(o.tableData,p=>(l(),u("div",{class:"room",key:p.id},[y(a,{room:p},null,8,["room"]),c("span",O_,$(p.name),1),y(i,{tableKeys:e.keys,tableData:p.jobs,room:p},null,8,["tableKeys","tableData","room"]),T_]))),128)),c("div",R_,[c("div",V_,[y(d,{class:"top__logo"}),L_]),D_,y(_)])])}var Go=g(I_,[["render",N_],["__scopeId","data-v-cb7672c6"]]);const Qo=async(e,t)=>{try{const n="/api".split("/");n.pop();const r=n.join("/"),o=await po.get(`${r}/pdf/${e}.pdf`,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([o.data])),i=document.createElement("a");return i.href=a,i.setAttribute("download",`${t}.pdf`),document.body.appendChild(i),i.click(),i.remove(),Promise.resolve()}catch(s){return Promise.reject(s)}};const x_={components:{BackIcon:Ko,SaveIcon:jo,DownloadIcon:qo,PrintIcon:Ho,PrintPage:Go,OutlayBlock:re},data(){return{isDownloading:!1,isSaving:!1,isPrinting:!1}},computed:f(m({},k("outlay",["outlay","invalidJobs","selectedRoom"])),{isActionsDisabled(){return!Object.values(this.invalidJobs).every(s=>s.length===0)},actions(){return[{text:"\u041D\u0430\u0437\u0430\u0434",handler:()=>{this.setOutlay(null),this.$router.push("/")},icon:"BackIcon",disabled:!1,loading:!1},{text:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",handler:()=>{this.save()},icon:"SaveIcon",disabled:this.isSaving,loading:this.isSaving},{text:"\u0421\u043A\u0430\u0447\u0430\u0442\u044C",handler:()=>{this.download()},icon:"DownloadIcon",disabled:this.isDownloading||this.isActionsDisabled,loading:this.isDownloading},{text:"\u0420\u0430\u0441\u043F\u0435\u0447\u0430\u0442\u0430\u0442\u044C",handler:this.printHandler,icon:"PrintIcon",disabled:this.isPrinting||this.isActionsDisabled,loading:!1}]}}),mounted(){window.addEventListener("afterprint",this.afterPrint),window.addEventListener("keydown",this.keydownHandler)},unmounted(){window.removeEventListener("afterprint",this.afterPrint),window.removeEventListener("keydown",this.keydownHandler)},methods:f(m(m(m({},B("outlay",{prepareOutlay:"setOutlay"})),A("outlay",["update","setOutlay"])),A("outlays",["print"])),{async save(){this.isSaving=!0,this.prepareOutlay();try{await this.update()}catch(e){const{response:t}=e,s=t?t.data.message:e.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:s,life:3e3})}finally{this.isSaving=!1}},async download(){if(!this.outlay)return console.error("select outlay");this.isDownloading=!0;try{await this.update(),await this.print(this.outlay._id),await Qo("smeta",this.outlay.name)}catch(e){const{response:t}=e,s=t?t.data.message:e.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:s,life:3e3})}finally{this.isDownloading=!1}},keydownHandler(e){const{ctrlKey:t,code:s}=e;!t||s!=="KeyP"||(e.preventDefault(),this.printHandler())},async printHandler(){await this.$nextTick(),this.isPrinting=!0},afterPrint(){this.isPrinting=!1},readyForPrint(){window.print()}})},P_={class:"action-list"},A_=["disabled","onClick"],E_={class:"action__text"},B_={key:0,class:"pi pi-spin pi-spinner"};function M_(e,t,s,n,r,o){const a=h("PrintPage"),i=h("OutlayBlock");return l(),w(i,null,{default:C(()=>[c("div",P_,[(l(!0),u(b,null,S(o.actions,d=>(l(),u("button",{class:"button action",key:d.text,disabled:d.disabled,onClick:d.handler},[(l(),w(Se(d.icon),{class:"action__icon"})),c("span",E_,$(d.text),1),d.loading?(l(),u("i",B_)):T("",!0)],8,A_))),128))]),(l(),w(vo,{to:"#print"},[e.outlay&&r.isPrinting?(l(),w(a,{key:0,outlay:e.outlay,onMounted:o.readyForPrint},null,8,["outlay","onMounted"])):T("",!0)]))]),_:1})}var J_=g(x_,[["render",M_],["__scopeId","data-v-b9eb8a5e"]]);const K_={},j_={width:"12",height:"9",viewBox:"0 0 12 9",fill:"none",xmlns:"http://www.w3.org/2000/svg"},q_=c("path",{d:"M0.5 3.875H3.625V0.125H0.5V3.875ZM0.5 8.25H3.625V4.5H0.5V8.25ZM4.25 8.25H7.375V4.5H4.25V8.25ZM8 8.25H11.125V4.5H8V8.25ZM4.25 3.875H7.375V0.125H4.25V3.875ZM8 0.125V3.875H11.125V0.125H8Z",fill:"currentColor"},null,-1),H_=[q_];function U_(e,t){return l(),u("svg",j_,H_)}var Zo=g(K_,[["render",U_]]);const W_={},F_={width:"13",height:"13",viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},G_=c("path",{d:"M10.875 0.875H2.125C1.4375 0.875 0.875 1.4375 0.875 2.125V10.875C0.875 11.5625 1.4375 12.125 2.125 12.125H10.875C11.5625 12.125 12.125 11.5625 12.125 10.875V2.125C12.125 1.4375 11.5625 0.875 10.875 0.875ZM7.75 9.625H3.375V8.375H7.75V9.625ZM9.625 7.125H3.375V5.875H9.625V7.125ZM9.625 4.625H3.375V3.375H9.625V4.625Z",fill:"currentColor"},null,-1),Q_=[G_];function Z_(e,t){return l(),u("svg",F_,Q_)}var zo=g(W_,[["render",Z_]]);const z_={},Y_={width:"13",height:"13",viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},X_=c("path",{d:"M7.125 3.375H5.875V5.875H3.375V7.125H5.875V9.625H7.125V7.125H9.625V5.875H7.125V3.375ZM6.5 0.25C3.05 0.25 0.25 3.05 0.25 6.5C0.25 9.95 3.05 12.75 6.5 12.75C9.95 12.75 12.75 9.95 12.75 6.5C12.75 3.05 9.95 0.25 6.5 0.25ZM6.5 11.5C3.74375 11.5 1.5 9.25625 1.5 6.5C1.5 3.74375 3.74375 1.5 6.5 1.5C9.25625 1.5 11.5 3.74375 11.5 6.5C11.5 9.25625 9.25625 11.5 6.5 11.5Z",fill:"white"},null,-1),eh=[X_];function th(e,t){return l(),u("svg",Y_,eh)}var Yo=g(z_,[["render",th]]);const Xo={ROOMS:"\u041F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u044F",FAST_JOBS:"\u0411\u044B\u0441\u0442\u0440\u044B\u0435 \u0440\u0430\u0431\u043E\u0442\u044B"};const fs=()=>({title:void 0,okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0,name:"",length:null,width:null,height:null,spaces:null,formDataBefore:{width:null,height:null,length:null,spaces:null},roomTypes:[],room:null,invalid:!1}),sh={components:{PopupModal:ae,InputNumber:ht,InputText:Oe,Dropdown:We},mixins:[ie,se],data(){return fs()},computed:f(m(m({},k("outlay",["selectedRoom","rooms","edition"])),k("directory",["directories","roomDirectory"])),{calculatedWidth(){return this.calculate(this.width)},calculatedLength(){return this.calculate(this.length)},calculatedHeight(){return this.calculate(this.height)},calculatedSpaces(){return this.calculate(this.spaces)},perimeter(){return!this.calculatedWidth||!this.calculatedLength?0:this.getPerimeter(this.calculatedWidth,this.calculatedLength)},floorArea(){return!this.calculatedWidth||!this.calculatedLength?0:this.getFloorArea(this.calculatedWidth,this.calculatedLength)},wallArea(){return!this.perimeter||!this.calculatedHeight?0:this.getWallArea(this.perimeter,this.calculatedHeight,this.calculatedSpaces)},isCorrectFields(){return!this.name||this.invalid?!1:this.room&&!this.room.parameters?!0:this.isCorrectField(this.calculatedWidth)&&this.isCorrectField(this.calculatedLength)&&this.isCorrectField(this.calculatedHeight)},placeholders(){const e={width:null,height:null,length:null,spaces:null},t=this.rooms.find(n=>n.options);if(!t)return e;const{options:s}=t;return Object.assign(e,s)},showParameters(){return this.name&&!this.room||this.room&&this.room.parameters}}),watch:{length(e,t){this.formDataBefore.length=t},height(e,t){this.formDataBefore.height=t},width(e,t){this.formDataBefore.width=t}},methods:{getRoomsFromDirectory(){const e=this.directories.find(a=>a.name===Xo.ROOMS);if(!e)return console.warn("\u0421\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0430 \u0441 \u043A\u043E\u043C\u043D\u0430\u0442\u0430\u043C\u0438 \u043B\u0438\u0431\u043E \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442, \u043B\u0438\u0431\u043E \u0443\u043A\u0430\u0437\u0430\u043D\u043E \u043D\u0435\u0432\u0435\u0440\u043D\u043E\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0430"),[];const{values:t,keys:s}=e,n=s.reduce((a,i)=>{const{type:d}=i;return d===this.InputType.STRING&&(a.name=i.id),d===this.InputType.BOOLEAN_ROOM_COMPUTED&&(a.computed=i.id),d===this.InputType.BOOLEAN_ROOM_PARAMETERS&&(a.parameters=i.id),a},{});return t.filter(a=>!a.removed).map(a=>{const{data:i,id:d}=a;return{roomId:d,name:i[n.name],computed:i[n.computed],parameters:i[n.parameters]}})},async show(e){const t=this.getRoomsFromDirectory();if(this.roomTypes=t,this.title=e.title,this.okButton=e.okButton,this.cancelButton=e.cancelButton,e.edit){const{dirId:r,name:o}=this.selectedRoom;this.room=r&&this.roomTypes.find(a=>a.roomId===r),this.name=o,this.selectedRoom.options&&(this.width=this.selectedRoom.options.width,this.height=this.selectedRoom.options.height,this.length=this.selectedRoom.options.length,this.spaces=this.selectedRoom.options.spaces)}this.$refs.popup.open(),await this.$nextTick();const{input:s}=this.$refs,n=s.$el.querySelector("input");return n&&n.focus(),new Promise((r,o)=>{this.resolvePromise=r,this.rejectPromise=o})},capitalizeName(e){return e.charAt(0).toUpperCase()+e.slice(1)},_confirm(){if(!this.isCorrectFields)return;this.$refs.popup.close();const e=this.room&&this.room.roomId,t=this.capitalizeName(this.name),s=this.room&&this.room.parameters||!this.room?{width:this.width||"0",height:this.height||"0",length:this.length||"0",spaces:this.spaces||"0"}:null,n={name:t,options:s,dirId:e};this.resolvePromise(n),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},_remove(){this.$refs.popup.close(),this.resolvePromise({remove:!0}),this.reset()},reset(){Object.assign(this.$data,fs())},inputHandler(e,t){if(!/^[0-9+-/*.,]*$/.test(this[t]))return this[t]=this.formDataBefore[t];const{data:r}=e;r===","&&(this[t]=this[t].replace(",","."));const o=/[-]?\d+(\.\d+)?/g,a=this[t].match(o);!a||a.forEach(i=>{const d=+i;d>0&&(this[t]=this[t].replace(i,d))})},isCorrectField(e){return!isNaN(e)&&e>0},getAllCategories(e){const{children:t}=e;if(t&&t.length>0){const s=t.map(this.getAllCategories).flat();return[e.key,...s]}return[]},changeRoom(e){const{value:t}=e,{name:s}=t;this.name=s;const{values:n,keys:r}=this.roomDirectory,o=n.find(O=>O.id===t.roomId);if(!o)return console.warn("\u0434\u0430\u043D\u043D\u043E\u0439 \u043A\u043E\u043C\u043D\u0430\u0442\u044B \u0432 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0435 \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442");const{data:a}=o,i=r.find(O=>O.type===this.InputType.COLLECTION);if(!i)return console.warn("\u0412 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0435 \u043A\u043E\u043C\u043D\u0430\u0442 \u043D\u0435\u0442\u0443 \u043A\u043E\u043B\u043E\u043D\u043A\u0438 \u0441 \u043D\u0430\u0431\u043E\u0440\u043E\u043C \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u043E\u0432");const d=a[i.id];if(!d)return console.warn("\u0412 \u0434\u0430\u043D\u043D\u043E\u0439 \u043A\u043E\u043C\u043D\u0435\u0442\u0435 \u043D\u0435\u0442\u0443 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u043E\u0432, \u043E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443");const _=JSON.parse(JSON.stringify(this.edition)),{data:p}=_,v=p.children.map(this.getAllCategories).flat();if(!d.every(O=>v.indexOf(O)>=0))return this.invalid=!0,this.$toast.add({severity:"warn",summary:"\u041D\u0435\u0441\u043E\u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u0440\u0430\u0431\u043E\u0442 \u043A\u043E\u043C\u043D\u0430\u0442\u044B \u0438 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u0438",detail:"\u041E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443",life:3e3});this.invalid=!1},inputRoom(){this.invalid=!1}}},le=e=>(x("data-v-e7131d18"),e=e(),P(),e),oh={class:"modal"},nh={class:"modal__title"},rh={class:"form__flex"},ah={class:"form__group"},ih=le(()=>c("label",{class:"form__label"},"\u0422\u0438\u043F \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u044F",-1)),lh={class:"form__group"},dh=le(()=>c("label",{class:"form__label"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",-1)),ch=le(()=>c("span",null,"\u041F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u044F",-1)),uh={class:"form__grid"},_h={class:"form__group"},hh=le(()=>c("label",{class:"form__label"},"\u0414\u043B\u0438\u043D\u0430",-1)),mh={class:"form__group"},ph=le(()=>c("label",{class:"form__label"},"\u0428\u0438\u0440\u0438\u043D\u0430",-1)),yh={class:"form__group"},fh=le(()=>c("label",{class:"form__label"},"\u0412\u044B\u0441\u043E\u0442\u0430",-1)),vh=["placeholder"],gh={class:"form__group"},bh=le(()=>c("label",{class:"form__label"},"\u041F\u0440\u043E\u0435\u043C\u044B",-1)),wh=["placeholder"],$h=le(()=>c("span",null,"\u0412\u044B\u0447\u0438\u0441\u043B\u044F\u0435\u043C\u044B\u0435 \u0441\u0432\u043E\u0439\u0441\u0442\u0432\u0430",-1)),kh={class:"form__grid"},Ch={class:"form__group"},Ih=le(()=>c("label",{class:"form__label"},"\u041F\u0435\u0440\u0438\u043C\u0435\u0442\u0440",-1)),Sh={class:"form__group"},Oh=le(()=>c("label",{class:"form__label"},"\u041F\u043B\u043E\u0449\u0430\u0434\u044C \u043F\u043E\u043B\u0430",-1)),Th={class:"form__group"},Rh=le(()=>c("label",{class:"form__label"},"\u041F\u043B\u043E\u0449\u0430\u0434\u044C \u0441\u0442\u0435\u043D",-1)),Vh={class:"modal__actions"};function Lh(e,t,s,n,r,o){const a=h("Dropdown"),i=h("InputText"),d=h("InputNumber"),_=h("AppButton"),p=h("PopupModal");return l(),w(p,{ref:"popup"},{default:C(()=>[c("div",oh,[c("span",nh,$(e.title),1),c("form",{class:"form",onSubmit:t[13]||(t[13]=Y((...v)=>o._confirm&&o._confirm(...v),["prevent"]))},[c("div",rh,[c("div",ah,[ih,y(a,{modelValue:e.room,"onUpdate:modelValue":t[0]||(t[0]=v=>e.room=v),options:e.roomTypes,optionLabel:"name",ref:"input",filter:!0,placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u0435 \u0438\u043B\u0438 \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",emptyMessage:"\u041F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u0435 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E",dataKey:"roomId",filterPlaceholder:"\u041F\u043E\u0438\u0441\u043A",onChange:o.changeRoom,onInput:o.inputRoom},null,8,["modelValue","options","onChange","onInput"])]),c("div",lh,[dh,y(i,{modelValue:e.name,"onUpdate:modelValue":t[1]||(t[1]=v=>e.name=v),modelModifiers:{trim:!0},placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u044F"},null,8,["modelValue"])])]),o.showParameters?(l(),u(b,{key:0},[ch,c("div",uh,[c("div",_h,[hh,H(c("input",{"onUpdate:modelValue":t[2]||(t[2]=v=>e.length=v),class:"input",type:"text",onInput:t[3]||(t[3]=v=>o.inputHandler(v,"length"))},null,544),[[te,e.length]])]),c("div",mh,[ph,H(c("input",{"onUpdate:modelValue":t[4]||(t[4]=v=>e.width=v),class:"input",type:"text",onInput:t[5]||(t[5]=v=>o.inputHandler(v,"width"))},null,544),[[te,e.width]])]),c("div",yh,[fh,H(c("input",{"onUpdate:modelValue":t[6]||(t[6]=v=>e.height=v),class:"input",type:"text",placeholder:o.placeholders.height,onInput:t[7]||(t[7]=v=>o.inputHandler(v,"height"))},null,40,vh),[[te,e.height]])]),c("div",gh,[bh,H(c("input",{"onUpdate:modelValue":t[8]||(t[8]=v=>e.spaces=v),class:"input",type:"text",placeholder:o.placeholders.spaces,onInput:t[9]||(t[9]=v=>o.inputHandler(v,"spaces"))},null,40,wh),[[te,e.spaces]])])]),$h,c("div",kh,[c("div",Ch,[Ih,y(d,{modelValue:o.perimeter,"onUpdate:modelValue":t[10]||(t[10]=v=>o.perimeter=v),placeholder:"\u041F\u0435\u0440\u0438\u043C\u0435\u0442\u0435\u0440",disabled:!0,minFractionDigits:2,maxFractionDigits:2},null,8,["modelValue"])]),c("div",Sh,[Oh,y(d,{modelValue:o.floorArea,"onUpdate:modelValue":t[11]||(t[11]=v=>o.floorArea=v),placeholder:"\u041F\u043B\u043E\u0449\u0430\u0434\u044C \u043F\u043E\u043B\u0430",disabled:!0,minFractionDigits:2,maxFractionDigits:2},null,8,["modelValue"])]),c("div",Th,[Rh,y(d,{modelValue:o.wallArea,"onUpdate:modelValue":t[12]||(t[12]=v=>o.wallArea=v),placeholder:"\u041F\u043B\u043E\u0449\u0430\u0434\u044C \u0441\u0442\u0435\u043D",disabled:!0,minFractionDigits:2,maxFractionDigits:2},null,8,["modelValue"])])])],64)):T("",!0)],32),c("div",Vh,[y(_,{outlined:"",onClick:o._cancel},{default:C(()=>[R($(e.cancelButton),1)]),_:1},8,["onClick"]),y(_,{outlined:"",disabled:!o.isCorrectFields,onClick:o._confirm},{default:C(()=>[R($(e.okButton),1)]),_:1},8,["disabled","onClick"])])])]),_:1},512)}var en=g(sh,[["render",Lh],["__scopeId","data-v-e7131d18"]]);const Dh={},Nh={width:"12",height:"9",viewBox:"0 0 12 9",fill:"none",xmlns:"http://www.w3.org/2000/svg"},xh=c("path",{d:"M0.5 5.75H3V3.25H0.5V5.75ZM0.5 8.875H3V6.375H0.5V8.875ZM0.5 2.625H3V0.125H0.5V2.625ZM3.625 5.75H11.125V3.25H3.625V5.75ZM3.625 8.875H11.125V6.375H3.625V8.875ZM3.625 0.125V2.625H11.125V0.125H3.625Z",fill:"currentColor"},null,-1),Ph=[xh];function Ah(e,t){return l(),u("svg",Nh,Ph)}var tn=g(Dh,[["render",Ah]]);const It={components:{ViewListIcon:tn},props:{room:{type:Object,required:!0},active:Boolean,disabled:{type:Boolean,default:!0}},emits:["edit","remove","open-menu"],data(){return{items:[{label:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",icon:"pi pi-pencil",command:()=>{this.setSelectedRoom(this.room),this.$emit("edit")}},{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",icon:"pi pi-trash",command:()=>{this.$emit("remove",this.room.id)}}]}},computed:f(m({},k("outlay",["showOnlyChecked","quantityKey","invalidJobs","selectedRoom"])),{textColor(){return this.active?"#545454":"#c8c8c8"},viewMode:{get(){return this.showOnlyChecked&&this.active},set(e){var s,n;const t=this.invalidJobs[(s=this.selectedRoom)==null?void 0:s.id]||[];this.room.id!==((n=this.selectedRoom)==null?void 0:n.id)&&t.length>0||this.setViewMode(e)}},invalidNodes(){return this.invalidJobs[this.room.id]}}),methods:f(m({},B("outlay",["setSelectedRoom","setShowOnlyChecked"])),{openContext(e){this.$emit("open-menu",e,this.room)},async scrollToInvalid(){this.active||this.setSelectedRoom(this.room),await this.$nextTick();const e=this.invalidNodes[0];return De.$emit("scrollTo",e.key)},async setViewMode(e){if(this.setSelectedRoom(this.room),e&&(await this.$nextTick(),this.invalidNodes.length>0))return this.scrollToInvalid();this.setShowOnlyChecked(e)},clickHandler(){var t;const e=this.invalidJobs[(t=this.selectedRoom)==null?void 0:t.id];if(this.selectedRoom&&this.selectedRoom.id!==this.room.id&&e&&e.length>0)return this.$toast.add({severity:"warn",detail:"\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0443 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0445 \u0440\u0430\u0431\u043E\u0442",life:3e3});this.setSelectedRoom(this.room)}})},vs=()=>{U(e=>({"302b069c":e.textColor}))},gs=It.setup;It.setup=gs?(e,t)=>(vs(),gs(e,t)):vs;const Eh=It,Bh=e=>(x("data-v-6bc0e29a"),e=e(),P(),e),Mh={class:"room-item__text"},Jh=["title"],Kh={class:"room-item__counter-wrapper"},jh=Bh(()=>c("i",{class:"pi pi-ellipsis-h icon"},null,-1)),qh=[jh];function Hh(e,t,s,n,r,o){const a=h("ViewListIcon"),i=Pe("tooltip");return l(),u("div",{class:N(["room-item",{active:s.active}])},[c("div",Mh,[c("span",{class:"room-item__title",title:s.room.name,onClick:t[0]||(t[0]=(...d)=>o.clickHandler&&o.clickHandler(...d))},$(s.room.name),9,Jh),c("div",Kh,[o.invalidNodes&&o.invalidNodes.length>0?H((l(),u("span",{key:0,class:"room-item__counter",onClick:t[1]||(t[1]=(...d)=>o.scrollToInvalid&&o.scrollToInvalid(...d))},[R($(o.invalidNodes.length),1)])),[[i,"\u043D\u0435\u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u043D\u044B\u0445 \u0440\u0430\u0431\u043E\u0442",void 0,{top:!0}]]):T("",!0)])]),c("div",{class:"room-item__actions",onClick:t[4]||(t[4]=Y(()=>{},["stop"]))},[c("button",{class:"button",onClick:t[2]||(t[2]=d=>o.viewMode=!o.viewMode)},[y(a,{class:N(["icon",{active:s.active&&e.showOnlyChecked}])},null,8,["class"])]),c("button",{class:"button room-item__button",onClick:t[3]||(t[3]=Y((...d)=>o.openContext&&o.openContext(...d),["stop"]))},qh)])],2)}var Uh=g(Eh,[["render",Hh],["__scopeId","data-v-6bc0e29a"]]);const Wh={components:{RoomItem:Uh,RoomModal:en,Menu:ct,draggable:Mn},emits:["open-edit","clone"],data(){return{selectedItem:null,items:[{label:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",icon:"pi pi-pencil",command:()=>{this.setSelectedRoom(this.selectedItem),this.openEditModal()}},{label:"\u041A\u043B\u043E\u043D\u0438\u0440\u043E\u0432\u0430\u0442\u044C",icon:"pi pi-clone",command:()=>{this.$emit("clone",this.selectedItem.id)}},{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",icon:"pi pi-trash",command:()=>{this.remove(this.selectedItem.id)}}],dragOptions:{animation:200,ghostClass:"ghost"}}},computed:f(m({},k("outlay",["outlay","selectedRoom","rooms"])),{roomsModel:{get(){return[...this.rooms].reverse()},set(e){const t=[...e].reverse();this.updateRooms(t)}},activeRoomId(){var e;return(e=this.selectedRoom)==null?void 0:e.id}}),methods:f(m(m({},B("outlay",["setSelectedRoom"])),A("outlay",["removeRoom","updateRoom","updateRooms"])),{openMenu(e,t){this.selectedItem=t,this.$refs.menu.toggle(e)},async remove(e){try{await this.removeRoom(e)}catch(t){const{response:s}=t,n=s?s.data.message:t.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:n,life:3e3})}},async openEditModal(){const e=await this.$refs["edit-modal"].show({title:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u0435",okButton:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430",edit:!0});!e||this.updateRoom(e)}})};function Fh(e,t,s,n,r,o){const a=h("Menu"),i=h("RoomModal"),d=h("RoomItem"),_=h("draggable");return l(),u(b,null,[y(a,{ref:"menu",model:r.items,popup:!0},null,8,["model"]),y(i,{ref:"edit-modal"},null,512),y(_,mo({modelValue:o.roomsModel,"onUpdate:modelValue":t[0]||(t[0]=p=>o.roomsModel=p),"item-key":"id",tag:"transition-group","component-data":{tag:"div",type:"transition-group"}},r.dragOptions,{class:"room-list"}),{item:C(({element:p})=>[(l(),w(d,{key:p.id,room:p,active:o.activeRoomId===p.id,onEdit:o.openEditModal,onRemove:e.removeRoom,onOpenMenu:o.openMenu},null,8,["room","active","onEdit","onRemove","onOpenMenu"]))]),_:1},16,["modelValue"])],64)}var Gh=g(Wh,[["render",Fh],["__scopeId","data-v-6a320e21"]]);const Qh={components:{RoomsIcon:Zo,DocumentIcon:zo,RoomList:Gh,Button:mt,CirclePlusIcon:Yo,RoomModal:en,OutlayBlock:re},computed:f(m({},k("outlay",["selectedRoom","showResults","quantityKey","invalidJobs"])),{mainTabs(){return[{text:"\u0412\u0441\u0435 \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u044F",handler:()=>{this.setSelectedRoom(null)},icon:"RoomsIcon",active:!this.selectedRoom&&!this.showResults},{text:"\u0421\u0432\u043E\u0434\u043D\u0430\u044F",handler:()=>{this.setShowResults(!0)},icon:"DocumentIcon",active:this.showResults}]},invalidNodes(){return Object.values(this.invalidJobs).some(t=>t.length>0)}}),methods:f(m(m({},B("outlay",["setSelectedRoom","setShowResults"])),A("outlay",["createRoom","cloneRoom"])),{async openCreateModal(){const e=await this.$refs["room-modal"].show({title:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u0435",okButton:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430"});!e||this.createRoom(e)},async clone(e){const t=await this.$refs["room-modal"].show({title:"\u041A\u043B\u043E\u043D\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u0435",okButton:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430"});if(!!t)try{await this.cloneRoom(f(m({},t),{cloningRoomId:e}))}catch(s){const{response:n}=s,r=n?n.data.message:s.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:r,life:3e3})}}})},Zh={class:"rooms"},zh=["disabled"],Yh=R(" \u041F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u0435 "),Xh={class:"main-tabs"},em=["disabled","onClick"],tm={class:"main-tab__text"};function sm(e,t,s,n,r,o){const a=h("RoomModal"),i=h("CirclePlusIcon"),d=h("RoomList"),_=h("OutlayBlock");return l(),u(b,null,[y(a,{ref:"room-modal"},null,512),y(_,{class:"tab-list"},{default:C(()=>[c("div",Zh,[c("button",{class:"button create",disabled:o.invalidNodes,onClick:t[0]||(t[0]=(...p)=>o.openCreateModal&&o.openCreateModal(...p))},[y(i),Yh],8,zh),y(d,{onClone:o.clone},null,8,["onClone"])]),c("div",Xh,[(l(!0),u(b,null,S(o.mainTabs,p=>(l(),u("button",{key:p.text,class:N(["button main-tab",{active:p.active}]),disabled:o.invalidNodes,onClick:p.handler},[(l(),w(Se(p.icon),{class:"main-tab__icon"})),c("span",tm,$(p.text),1)],10,em))),128))])]),_:1})],64)}var om=g(Qh,[["render",sm],["__scopeId","data-v-305e8906"]]);const nm={components:{CollapseBlock:Fe,ActionList:J_,TabList:om},computed:{showLeftSide:{get(){return this.$store.getters["outlay/showLeftSide"]},set(e){return this.setShowLeftSide(e)}}},methods:m({},B("outlay",["setShowLeftSide"]))},rm={class:"wrapper"};function am(e,t,s,n,r,o){const a=h("CollapseBlock"),i=h("ActionList"),d=h("TabList");return l(),u("div",rm,[y(a,{modelValue:o.showLeftSide,"onUpdate:modelValue":t[0]||(t[0]=_=>o.showLeftSide=_)},null,8,["modelValue"]),y(i),y(d)])}var im=g(nm,[["render",am],["__scopeId","data-v-2b6c2c52"]]);const lm={components:{LeftSide:im,CenterSide:cc,RightSide:$u},computed:m({},k("outlay",["showLeftSide","showRightSide"])),mounted(){document.addEventListener("keydown",this.onKeyDown)},unmounted(){document.removeEventListener("keydown",this.onKeyDown)},methods:f(m({},B("outlay",["toggleSides"])),{onKeyDown(e){const{ctrlKey:t,keyCode:s}=e;t&&s===66&&this.toggleSides()}})},dm={class:"body-row"};function cm(e,t,s,n,r,o){const a=h("LeftSide"),i=h("CenterSide"),d=h("RightSide");return l(),u("div",dm,[c("div",{class:N(["left-side",{hidden:!e.showLeftSide}])},[y(a)],2),y(i),c("div",{class:N(["right-side",{hidden:!e.showRightSide}])},[y(d)],2)])}var um=g(lm,[["render",cm],["__scopeId","data-v-e2090a94"]]);const _m={components:{HeaderRow:Hi,BodyRow:um},data(){return{interval:null,loading:!0}},computed:m(m({},k("outlay",["outlay"])),k(["isOffline"])),watch:{outlay(){this.interval=clearInterval(this.interval),this.interval=setInterval(this.save,1e3*60)}},async mounted(){this.loading=!0,await this.setOutlay(null),this.interval=setInterval(this.save,1e3*60),this.loading=!1},unmounted(){clearInterval(this.interval),this.setOutlay(null)},methods:f(m({},A("outlay",["update","saveLocaly","setOutlay"])),{async save(){this.isOffline||(await this.update(),await this.saveLocaly())}})},hm=e=>(x("data-v-6da7fc56"),e=e(),P(),e),mm={class:"main"},pm=hm(()=>c("div",{id:"print",class:"print"},null,-1));function ym(e,t,s,n,r,o){const a=h("HeaderRow"),i=h("BodyRow");return l(),u(b,null,[c("main",mm,[y(a),e.outlay&&!r.loading?(l(),w(i,{key:0})):T("",!0)]),pm],64)}var fm=g(_m,[["render",ym],["__scopeId","data-v-6da7fc56"]]);const vm={computed:f(m(m({},Ce("acts",{actsLoaded:"contentLoaded"})),Ce("outlays",{outlaysLoaded:"contentLoaded"})),{contentLoaded(){return this.actsLoaded&&this.outlaysLoaded}})},gm={class:"wrapper"};function bm(e,t,s,n,r,o){const a=h("RouterView");return l(),u("div",gm,[o.contentLoaded?(l(),w(a,{key:0})):T("",!0)])}var wm=g(vm,[["render",bm],["__scopeId","data-v-1cf170a4"]]);const $m={components:{AppLogo:Te}},km={class:"left-side"};function Cm(e,t,s,n,r,o){const a=h("AppLogo");return l(),u("div",km,[y(a)])}var Im=g($m,[["render",Cm],["__scopeId","data-v-37e89fe7"]]);const oe={CONFIRMED:"confirmed",REJECTED:"rejected",NEW:"new"};const St={props:{act:{type:Object,required:!0}},computed:f(m({},k("acts",{selected:"act"})),{isSelected(){var e;return((e=this.selected)==null?void 0:e._id)===this.act._id},showDot(){return this.act.status!==oe.NEW},dotStyle(){return this.showDot?{backgroundColor:{[oe.CONFIRMED]:"#28c430",[oe.REJECTED]:"#de4848"}[this.act.status]}:{}},date(){return new Date(this.act.createdAt).toLocaleDateString()},color(){return this.isSelected?"#00afec":"#808080"}}),methods:f(m({},A("acts",["setAct"])),{selectAct(){this.setAct(this.act)},openMenu(e){this.$emit("open-menu",e,this.act._id)}})},bs=()=>{U(e=>({"3c9d6c78":e.color}))},ws=St.setup;St.setup=ws?(e,t)=>(bs(),ws(e,t)):bs;const Sm=St,Om=e=>(x("data-v-b8662a04"),e=e(),P(),e),Tm={class:"act-item__dot-wrapper"},Rm={class:"act-item__text"},Vm={class:"act-item__date"},Lm=["title"],Dm=Om(()=>c("i",{class:"pi pi-ellipsis-h icon"},null,-1)),Nm=[Dm];function xm(e,t,s,n,r,o){return l(),u("div",{class:N(["act-item",{selected:o.isSelected}]),onClick:t[1]||(t[1]=(...a)=>o.selectAct&&o.selectAct(...a))},[c("div",Tm,[o.showDot?(l(),u("div",{key:0,class:"act-item__dot",style:Q(o.dotStyle)},null,4)):T("",!0)]),c("div",Rm,[c("div",Vm,"\u043E\u0442 "+$(o.date),1),c("span",{class:"act-item__name",title:s.act.name},$(s.act.name),9,Lm)]),c("button",{class:"button",onClick:t[0]||(t[0]=Y((...a)=>o.openMenu&&o.openMenu(...a),["stop"]))},Nm)],2)}var Pm=g(Sm,[["render",xm],["__scopeId","data-v-b8662a04"]]);const Am={components:{ActItem:Pm,Menu:ct},data(){return{selectedItem:null}},computed:f(m({},k("acts",["acts"])),{actList(){return[...this.acts].reverse()},currentAct(){return this.acts.find(e=>e._id===this.selectedItem)},items(){return[{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",command:async()=>{try{await this.remove(this.selectedItem)}catch(e){const{response:t}=e,s=t?t.data.message:e.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:s,life:3e3})}finally{this.selectedItem=null}},disabled:this.currentAct&&this.currentAct.status!==oe.NEW}]}}),methods:f(m({},A("acts",["remove"])),{openMenu(e,t){this.selectedItem=t,this.$refs.menu.toggle(e)}})},Em={key:0,class:"act-list"};function Bm(e,t,s,n,r,o){const a=h("Menu"),i=h("ActItem");return l(),u(b,null,[y(a,{ref:"menu",model:o.items,popup:!0},null,8,["model"]),e.acts&&e.acts.length>0?(l(),u("div",Em,[(l(!0),u(b,null,S(o.actList,d=>(l(),w(i,{key:d._id,act:d,onOpenMenu:o.openMenu},null,8,["act","onOpenMenu"]))),128))])):T("",!0)],64)}var Mm=g(Am,[["render",Bm],["__scopeId","data-v-0aa3ea9c"]]);const $s=()=>({okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0}),Jm={components:{PopupModal:ae},data(){return $s()},computed:m({},k("outlay",["outlay"])),methods:{show(){return this.$refs.popup.open(),new Promise((e,t)=>{this.resolvePromise=e,this.rejectPromise=t})},_confirm(){this.$refs.popup.close(),this.resolvePromise(!0),this.reset()},reset(){Object.assign(this.$data,$s())}}},sn=e=>(x("data-v-922ac082"),e=e(),P(),e),Km={class:"modal"},jm=sn(()=>c("span",{class:"modal__title"},"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F",-1)),qm=sn(()=>c("span",null," \u041E\u0431\u044A\u0435\u043A\u0442: .... ",-1)),Hm={class:"modal__actions"},Um=R(" \u0417\u0430\u043A\u0440\u044B\u0442\u044C ");function Wm(e,t,s,n,r,o){const a=h("AppButton"),i=h("PopupModal");return l(),w(i,{ref:"popup"},{default:C(()=>[c("div",Km,[jm,qm,c("div",Hm,[y(a,{outlined:"",onClick:o._confirm},{default:C(()=>[Um]),_:1},8,["onClick"])])])]),_:1},512)}var Fm=g(Jm,[["render",Wm],["__scopeId","data-v-922ac082"]]);const Gm={components:{InfoCircleFill:$o,OutlayList:Mm,InfoModal:Fm,OutlayBlock:re},computed:m({},k("acts",["acts"])),methods:f(m({},A("acts",["create"])),{showInfo(){this.$refs["info-modal"].show()},canCreate(){const e=this.acts[this.acts.length-1];if(!e)return!0;const{status:t}=e;return t===oe.CONFIRMED},async createAct(){if(!this.canCreate())return this.$toast.add({severity:"warn",detail:"\u041F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0438\u0439 \u0430\u043A\u0442 \u0434\u043E\u043B\u0436\u0435\u043D \u0431\u044B\u0442\u044C \u0441\u043E\u0433\u043B\u0430\u0441\u043E\u0432\u0430\u043D",life:3e3});try{await this.create()}catch(t){const{response:s}=t,n=s?s.data.message:t.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:n,life:3e3})}}})},on=e=>(x("data-v-b0c595dc"),e=e(),P(),e),Qm={class:"center"},Zm={class:"center__info-wrapper"},zm=on(()=>c("div",{class:"center__info-text"},[c("span",{class:"center__info-id"}," 12345 "),c("span",{class:"center__info-name"},"\u0421\u0435\u0440\u0433\u0435\u0439 \u0410\u043B\u0435\u043A\u0441\u0435\u0435\u0432\u0438\u0447")],-1)),Ym=on(()=>c("i",{class:"pi pi-plus create__icon"},null,-1)),Xm=[Ym];function ep(e,t,s,n,r,o){const a=h("InfoModal"),i=h("InfoCircleFill"),d=h("OutlayBlock"),_=h("OutlayList");return l(),u(b,null,[y(a,{ref:"info-modal"},null,512),c("div",Qm,[y(d,{class:"center__info"},{default:C(()=>[c("div",Zm,[zm,c("button",{class:"button",onClick:t[0]||(t[0]=(...p)=>o.showInfo&&o.showInfo(...p))},[y(i)])])]),_:1}),y(d,{class:"center__outlays"},{default:C(()=>[c("button",{class:"button create",onClick:t[1]||(t[1]=(...p)=>o.createAct&&o.createAct(...p))},Xm),y(_)]),_:1})])],64)}var tp=g(Gm,[["render",ep],["__scopeId","data-v-b0c595dc"]]);const sp={components:{LeftSide:Im,CenterSide:tp,RightSide:yt},methods:m({},B("acts",["toggleSides"]))},op=e=>(x("data-v-8354d16a"),e=e(),P(),e),np={class:"header-row"},rp={class:"right-side-wrapper"},ap=op(()=>c("i",{class:"pi pi-arrows-h icon"},null,-1)),ip=[ap];function lp(e,t,s,n,r,o){const a=h("LeftSide"),i=h("CenterSide"),d=h("RightSide");return l(),u("div",np,[y(a),y(i),c("div",rp,[c("button",{class:"button",onClick:t[0]||(t[0]=(..._)=>e.toggleSides&&e.toggleSides(..._))},ip),y(d,{class:"right-side"})])])}var dp=g(sp,[["render",lp],["__scopeId","data-v-8354d16a"]]);class cp{constructor(t,s){this._id=nt(),this.name=t,this.outlay=s,this.status=oe.NEW,this.rooms=[];const n=new Date;this.createdAt=n,this.updatedAt=n}}const we="acts",$e=class{static async getAll(){try{const t=await j.getCollectionData(we);return $e.isOffline?t.filter(n=>!n.removedAt):(await J.get("/act")).data}catch(t){return Promise.reject(t)}}static async create(t,s){const n=new cp(t,s);return $e.isOffline?(await j.saveDataInCollection(we,n),Promise.resolve({data:n})):await J.post("/act",n)}static async update(t){try{if($e.isOffline)return await j.saveDataInCollection(we,f(m({},t),{updatedAt:new Date})),Promise.resolve({data:t});const s=t,{_id:n}=s,r=be(s,["_id"]),o=await J.put(`/act/${n}`,r);return await j.saveDataInCollection(we,o.data),o}catch(n){return Promise.reject(n)}}static async remove(t){try{if($e.isOffline)return await j.saveDataInCollection(we,f(m({},t),{removedAt:new Date})),Promise.resolve({data:t});const{_id:s}=t,n=await J.put(`/act/${s}`,f(m({},t),{removedAt:new Date}));return await j.removeDataInCollection(we,s),n}catch(s){return Promise.reject(s)}}};let ce=$e;Xe(ce,"isOffline",!1);const up=+"1209600000";var nn=(e,t,s)=>{const n=new Date(s).getTime(),r=t.filter(d=>{if(d.removedAt||e.find(O=>O._id===d._id))return!1;const p=new Date(d.updatedAt).getTime();return n>p?!1:Date.now()-p<up?!0:(console.warn("\u0423\u0434\u0430\u043B\u0435\u043D\u044B \u0443\u0441\u0442\u0430\u0440\u0435\u0432\u0448\u0438\u0435 \u0434\u0430\u043D\u043D\u044B\u0435"),!1)}),o=t.filter(d=>{const _=e.find(I=>I._id===d._id);if(!_||_&&_.removedAt)return!1;const p=new Date(_.updatedAt).getTime(),v=new Date(d.updatedAt).getTime();return n>v?!1:v>p}),i=t.filter(d=>d.removedAt).filter(d=>{const _=e.find(I=>I._id===d._id);if(!_)return!1;const p=new Date(_.updatedAt).getTime(),v=new Date(d.removedAt).getTime();return n>v?!1:v>p});return{created:r,updated:o,removed:i}};const dt=(e,t)=>{const{children:s}=e;return s.length===0?!0:(e.children=s.filter(t),e.children.length>0?(e.children=e.children.filter(n=>dt(n,t)),e.children.length>0):!1)},_p=e=>`\u0410\u043A\u0442 \u2116${e.reduce((s,n)=>{const r=/№\d+/gm,a=n.name.replace("\u0410\u043A\u0442","").match(r);if(!a)return s;const _=+a[0].split("\u2116")[1];return _>s?_:s},0)+1}`,rn=(e,t)=>{const{key:s,children:n,data:r}=e;if(n&&n.length>0)return e.children=e.children.map(i=>rn(i,t)),e;const o=t.find(i=>i.key===s);if(o)return o;const a=f(m({},r),{quantity:0});return f(m({},e),{data:a})},Ot=(e,t)=>{const{key:s,children:n}=e;return s===t?e:n.map(r=>Ot(r,t)).flat()},_e=e=>{const{children:t,data:s}=e;return t&&t.length>0?(e.children=t.filter(_e),e.children.length>0):s.quantity>0},tt=(e,t,s)=>{const n=JSON.parse(JSON.stringify(e)),o=t.rooms.map(i=>{const{id:d}=i,_=n[s._id][d].filter(_e);return{id:d,jobs:_}}).filter(i=>i.jobs.length>0);return f(m({},s),{rooms:o})},He=e=>{const t=e.reduce((s,n)=>{s[n.key]=s[n.key]||[];const{children:r}=n,o=r.length>0?r:n;return s[n.key].push(o),s},{});return Object.entries(t).map(([s,n])=>{const r=e.find(a=>a.key===s),{children:o}=r;if(o&&o.length>0){const a=n.flat();return r.children=He(a),r}return r})};var hp={namespaced:!0,state:{loading:!1,acts:[],activeTab:null,activeRoom:null,act:null,contentLoaded:!1,outlay:null,roomsData:{},showOnlyCompleted:!1,actsData:{},changeView:!1,hoveredItem:null,selectedItem:null,showLeftQuantity:!1,showLeftSide:!0,showRightSide:!0},mutations:{setActs(e,t){e.acts=t},pushAct(e,t){e.acts.push(t)},updateById(e,{id:t,data:s}){e.acts=e.acts.map(n=>n._id===t?s:n)},removeById(e,t){e.acts=e.acts.filter(s=>s._id!==t)},setActiveTab(e,t){e.activeTab=t,t!=="room"&&(e.activeRoom=null)},setActiveRoom(e,t){e.activeRoom=t,e.activeTab!=="room"&&(e.showOnlyCompleted=!1),e.activeTab="room"},setContentLoaded(e,t){e.contentLoaded=t},resetAct(e){e.act=null,e.roomsData={}},updateQuantity(e,{node:t,value:s}){const{activeRoom:n,roomsData:r}=e;if(!n)return;const{key:o}=t,a=r[n.id].map(i=>Ot(i,o)).flat();a.length>0&&(a[0].quantity=s)},setShowOnlyCompleted(e,t){if(e.showOnlyCompleted=t,!t)return;const{act:s,actsData:n,outlay:r}=e;if(!s)return;const o=JSON.parse(JSON.stringify(n)),i=r.rooms.map(d=>{const{id:_}=d,p=o[s._id][_].filter(_e);return{id:_,jobs:p}}).filter(d=>d.jobs.length>0);e.act.rooms=i},setChangeView(e,t){e.changeView=t},setHoveredItem(e,t){e.hoveredItem=t},setSelectedItem(e,t){e.selectedItem=t},setShowLeftQuantity(e,t){e.showLeftQuantity=t},setShowLeftSide(e,t){e.showLeftSide=t},setShowRightSide(e,t){e.showRightSide=t},toggleSides(e){const{showLeftSide:t,showRightSide:s}=e;if(t===s){e.showLeftSide=!t,e.showRightSide=!s;return}e.showLeftSide=!0,e.showRightSide=!0}},actions:{setOutlay({state:e},t){e.outlay=t},setActsData({state:e,rootGetters:t,getters:s}){const{outlay:n,act:r}=e,{acts:o}=s,i=t["outlays/outlays"].find(M=>M._id===n._id),d=JSON.parse(JSON.stringify(i)),{rooms:_}=d,p=o.findIndex(M=>M._id===r._id),v=[...o].slice(0,p+1),I=_.map(M=>{const{jobs:W,newJobs:G,id:ge}=M,me=He([...W,...G]);return{id:ge,jobs:me}}),D=v.filter(M=>M.rooms.length>0).map(M=>{const{rooms:W}=M;return W.reduce((G,ge)=>{const{jobs:me,id:fe}=ge;return G[fe]?(G[fe]=[...G[fe],...me],G):(G[fe]=me,G)},{})}).map(M=>{const[W,G]=Object.entries(M).flat();return{id:W,jobs:G}}),V=[...I,...D].reduce((M,W)=>M[W.id]?(M[W.id]=[...M[W.id],...W.jobs],M):(M[W.id]=W.jobs,M),{}),K=Object.entries(V).reduce((M,[W,G])=>(M[W]=He(G),M),{}),q=v.reduce((M,W)=>{const G=_.reduce((ge,me)=>{const fe=W.rooms.find(ze=>ze.id===me.id);let Xt=[];fe&&(Xt=fe.jobs.map(ee).flat());const Ln=JSON.parse(JSON.stringify(K[me.id])),Dn=He(Ln).map(ze=>rn(ze,Xt));return ge[me.id]=Dn,ge},{});return M[W._id]=G,M},{});e.actsData=q},async setAct({state:e,commit:t,dispatch:s},n){if(!n)return t("resetAct");const{act:r,acts:o}=e;r&&t("resetAct"),e.act=o.find(a=>a._id===n._id),await s("setActsData")},async fetchAll({state:e,commit:t,dispatch:s}){const{contentLoaded:n,loading:r}=e;if(!(n||r)){e.loading=!0;try{const o=await ce.getAll();t("setActs",o);const{act:a}=e;if(a){const i=o.find(d=>d._id===a._id);await s("setAct",i)}return await s("syncData"),t("setContentLoaded",!0),Promise.resolve(o)}catch(o){return Promise.reject(o)}finally{e.loading=!1}}},async syncData({dispatch:e,state:t,rootGetters:s}){try{const n=t.acts,r=s["status/status"],o=await j.getCollectionData("acts"),{updated:a,created:i,removed:d}=nn(n,o,r);await j.setArrayToCollection("acts",n),await Promise.all(a.map(async _=>{const I=_,{_id:p}=I,v=be(I,["_id"]);return await e("updateLocalData",{id:p,data:v})}),i.map(async _=>await e("createLocalData",_)),d.map(async _=>await e("remove",_._id)))}catch(n){return Promise.reject(n)}},async create({commit:e,state:t,dispatch:s,getters:n}){try{const{outlay:r}=t,{acts:o}=n,a=o.filter(_=>_.outlay===r._id),i=_p(a),d=await ce.create(i,r._id);return e("pushAct",d.data),s("setAct",d.data),d}catch(r){return Promise.reject(r)}},async save({state:e,commit:t}){try{const{act:s,actsData:n,outlay:r}=e;if(!s)return;const o=tt(n,r,s),a=await ce.update(o);return t("updateById",{id:s._id,data:a.data}),a}catch(s){return Promise.reject(s)}},async saveLocaly({state:e,commit:t,dispatch:s}){try{const{act:n,actsData:r,outlay:o}=e;if(!n)return;const a=tt(r,o,n);await j.saveDataInCollection("acts",f(m({},a),{updatedAt:new Date})),t("updateById",{id:n._id,data:a}),await s("setAct",a)}catch(n){return Promise.reject(n)}},async update({state:e,commit:t,dispatch:s},{id:n,data:r}){try{const{actsData:o,outlay:a,act:i}=e;if(!r)return;const d=tt(o,a,r),_=await ce.update(d);return t("updateById",{id:n,data:_.data}),i&&i._id===n&&await s("setAct",_.data),_}catch(o){return Promise.reject(o)}},async updateLocalData({commit:e,state:t,dispatch:s},{id:n,data:r}){try{const{act:o}=t,a=await ce.update(m({_id:n},r));return e("updateById",{id:n,data:a.data}),o&&o._id===n&&await s("setAct",a.data),a}catch(o){return Promise.reject(o)}},async createLocalData({commit:e},t){try{const s=await J.post("/act",t);return e("pushAct",s.data),s}catch(s){return Promise.reject(s)}},async remove({commit:e,dispatch:t,state:s},n){try{const{acts:r}=s,o=r.find(i=>i._id===n),a=await ce.remove(o);return s.act&&s.act._id===n&&t("setAct",null),e("removeById",n),a}catch(r){return Promise.reject(r)}},async print(e,t){try{if(!t)throw new Error("id is required");return await J.post(`/act/pdf/${t}`,{domain:window.location.origin})}catch(s){return Promise.reject(s)}},async removeAddedJob({state:e,dispatch:t,rootGetters:s},{roomId:n,nodeKey:r}){const{outlay:o,act:a}=e,d=s["outlays/outlays"].find(V=>V._id===o._id),{rooms:_}=d,p=_.find(V=>V.id===n),{newJobs:v}=p;p.newJobs=v.filter(V=>dt(V,K=>K.key!==r));const I=await t("outlays/update",{id:d._id,data:d},{root:!0});t("setOutlay",I.data);const{rooms:O}=a,L=O.find(V=>V.id===n);if(!L)return t("setActsData");const{jobs:D}=L;return L.jobs=D.filter(V=>dt(V,K=>K.key!==r)),await t("updateLocalData",{id:a._id,data:a})}},getters:{acts:e=>{const{outlay:t,acts:s}=e;return t?s.filter(n=>n.outlay===t._id&&!n.removedAt):[]},activeTab:e=>e.activeTab,activeRoom:e=>e.activeRoom,act:e=>e.act,outlay:e=>e.outlay,roomsData:e=>e.roomsData,showOnlyCompleted:e=>e.showOnlyCompleted,completedValues:e=>{const{acts:t,outlay:s,actsData:n}=e;if(!s)return{};const{rooms:r}=s;return Object.entries(n).map(([a,i])=>{const d=t.find(p=>p._id===a),_=d.rooms.map(p=>f(m({},p),{jobs:i[p.id]}));return f(m({},d),{rooms:_})}).reduce((a,i)=>{const d=r.reduce((_,p)=>{const v=i.rooms.find(V=>V.id===p.id),I=v?v.jobs:[],D=JSON.parse(JSON.stringify(I)).filter(_e).map(ye).flat();return _[p.id]=D,_},{});return a[i._id]=d,a},{})},actsData:e=>e.actsData,changeView:e=>e.changeView,hoveredItem:e=>e.hoveredItem,selectedItem:e=>e.selectedItem,showLeftQuantity:e=>e.showLeftQuantity,showLeftSide:e=>e.showLeftSide,showRightSide:e=>e.showRightSide}},de={computed:f(m({},k("outlay",["keys"])),{rowStyle(){return{gridTemplateColumns:`1fr repeat(${this.keys.length}, 100px)`}}})};const mp={},pp={class:"table-row-wrapper"};function yp(e,t){return l(),u("div",pp,[ne(e.$slots,"default",{},void 0,!0)])}var Me=g(mp,[["render",yp],["__scopeId","data-v-deb93edc"]]);const fp={props:{data:{type:Object,required:!0,default:()=>({})},isCategory:{type:Boolean,default:!1},added:Boolean,canRemove:Boolean,loading:Boolean},emits:["remove"],computed:f(m({},k("outlay",["keys","quantityKey","priceKey"])),{sum(){const e=this.data.quantity,t=this.data[this.priceKey.id];return E(e*t)},rowData(){const e=[this.quantityKey.id,this.priceKey.id,"quantity"];return this.keys.map(t=>{if(e.includes(t.id)){const s=t.id===this.quantityKey.id?this.data.quantity:this.data[t.id];return{key:t.id,value:E(s)}}return{key:t.id,value:this.data[t.id]}})}}),methods:{removeJob(){this.$emit("remove")}}},vp=e=>(x("data-v-0e1b34ce"),e=e(),P(),e),gp={key:0,class:"table-cell"},bp=["disabled"],wp=vp(()=>c("i",{class:"pi pi-times"},null,-1)),$p=[wp],kp=["title"],Cp={key:2,class:"table-cell"};function Ip(e,t,s,n,r,o){const a=Pe("tooltip");return l(),u(b,null,[s.isCategory?(l(),u("div",gp,$(o.rowData[0].value),1)):(l(!0),u(b,{key:1},S(o.rowData,(i,d)=>(l(),u(b,{key:i.key},[d===0?H((l(),u("div",{key:0,class:N(["table-cell first",{quantity:i.key===e.quantityKey.id}])},[s.added?(l(),u("button",{key:0,class:"table-cell__button button",disabled:!s.canRemove||s.loading,onClick:t[0]||(t[0]=(..._)=>o.removeJob&&o.removeJob(..._))},$p,8,bp)):T("",!0),c("span",null,$(i.value),1)],2)),[[a,i.value,void 0,{top:!0}]]):(l(),u("div",{key:1,class:N(["table-cell",{quantity:i.key===e.quantityKey.id}]),title:i.value},$(i.value),11,kp))],64))),128)),s.isCategory?T("",!0):(l(),u("div",Cp,$(o.sum),1))],64)}var an=g(fp,[["render",Ip],["__scopeId","data-v-0e1b34ce"]]);const Tt={name:"TableRow",components:{TableRowWrapper:Me,TableRowData:an},mixins:[de],props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String},data(){return{isRemoving:!1}},computed:f(m(m({},k("outlay",["keys","quantityKey","priceKey","striped"])),k("acts",["showOnlyCompleted","completedValues","hoveredItem","selectedItem","showLeftQuantity","act","acts"])),{data(){return this.node.data},children(){return this.showOnlyCompleted?this.node.children.filter(e=>this.completedValues[this.act._id][this.room].includes(e.key)):this.node.children||[]},isCategory(){return this.children.length>0},sum(){const e=this.node.data[this.quantityKey.id],t=this.node.data[this.priceKey.id];return E(e*t)},hovered(){return this.hoveredItem?this.node.key===this.hoveredItem.id&&this.room===this.hoveredItem.room:!1},selected(){return this.selectedItem?this.node.key===this.selectedItem.id&&this.room===this.selectedItem.room:!1},rowData(){const e=JSON.parse(JSON.stringify(this.data));if(this.showLeftQuantity){const t=e[this.quantityKey.id]-e.quantity,s=t<0?0:t;return e.quantity=s,e}return e.quantity=e[this.quantityKey.id],e},canRemove(){var o;const e=(o=this.node)==null?void 0:o.added,{status:t}=this.act;return t===oe.CONFIRMED||!e?!1:!this.acts.filter(a=>a.status===oe.CONFIRMED).some(a=>{const{rooms:i}=a,d=i.find(v=>v.id===this.room);if(!d)return!1;const{jobs:_}=d;return _.map(v=>Ot(v,this.node.key)).flat().length>0})}}),methods:f(m(m({},B("acts",["setHoveredItem"])),A("acts",["removeAddedJob"])),{mouseEnterHandler(){this.isCategory||this.setHoveredItem({id:this.node.key,room:this.room})},mouseLeaveHandler(){this.setHoveredItem(null)},async remove(){this.isRemoving=!0;try{await this.removeAddedJob({roomId:this.room,nodeKey:this.node.key})}catch(e){console.log(e)}finally{this.isRemoving=!1}}})},ks=()=>{U(e=>({"68b29933":e.level}))},Cs=Tt.setup;Tt.setup=Cs?(e,t)=>(ks(),Cs(e,t)):ks;const Sp=Tt;function Op(e,t,s,n,r,o){const a=h("TableRowData"),i=h("TableRowWrapper"),d=h("TableRow",!0);return l(),u(b,null,[y(i,{class:N(["table-row",{category:o.isCategory,striped:e.striped,hovered:o.hovered,selected:o.selected}]),"data-id":s.node.key,"data-level":s.level,"data-room":s.room,style:Q(e.rowStyle),onMouseenter:o.mouseEnterHandler,onMouseleave:o.mouseLeaveHandler},{default:C(()=>[y(a,{data:o.rowData,isCategory:o.isCategory,canRemove:o.canRemove,added:s.node.added,loading:r.isRemoving,onRemove:o.remove},null,8,["data","isCategory","canRemove","added","loading","onRemove"])]),_:1},8,["class","data-id","data-level","data-room","style","onMouseenter","onMouseleave"]),o.isCategory?(l(!0),u(b,{key:0},S(o.children,_=>(l(),w(d,{key:_.key,node:_,room:s.room,level:s.level+1},null,8,["node","room","level"]))),128)):T("",!0)],64)}var Tp=g(Sp,[["render",Op],["__scopeId","data-v-16c3d093"]]);const Rt={name:"JobList",components:{TableRow:Tp},mixins:[de],props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String,hasTitle:{type:Boolean,default:!0}},computed:f(m(m({},k("outlay",["keys"])),k("acts",["showOnlyCompleted","completedValues","act"])),{data(){return this.node.data},children(){return this.showOnlyCompleted?this.node.children.filter(e=>this.completedValues[this.act._id][this.room].includes(e.key)):this.node.children||[]},isCategory(){return this.children.length>0},title(){return this.isCategory&&this.hasTitle?this.data[this.keys[0].id]:null}})},Is=()=>{U(e=>({"853bc8f4":e.level}))},Ss=Rt.setup;Rt.setup=Ss?(e,t)=>(Is(),Ss(e,t)):Is;const Rp=Rt,Vp={class:"table-cell"};function Lp(e,t,s,n,r,o){const a=h("TableRow");return l(),u(b,null,[o.title?(l(),u("div",{key:0,class:"table-row table-row--category",style:Q(e.rowStyle)},[c("div",Vp,$(o.title),1)],4)):T("",!0),(l(!0),u(b,null,S(o.children,i=>(l(),w(a,{key:i.key,node:i,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128))],64)}var Dp=g(Rp,[["render",Lp],["__scopeId","data-v-94b02012"]]);const Np={props:{title:String,level:Number},computed:f(m({},k("outlay",["keys"])),{cells(){const e=[...this.keys,{id:"\u0421\u0443\u043C\u043C\u0430",name:"\u0421\u0443\u043C\u043C\u0430"}];return this.title?e.map((t,s)=>s==0?f(m({},t),{name:this.title}):t):e}})},xp={key:0};function Pp(e,t,s,n,r,o){return l(!0),u(b,null,S(o.cells,(a,i)=>(l(),u("div",{key:a.id,class:"table-cell"},[i===0?(l(),u("span",xp,$(a.name),1)):(l(),u(b,{key:1},[R($(a.name),1)],64))]))),128)}var Ap=g(Np,[["render",Pp],["__scopeId","data-v-238ae13e"]]);const Vt={name:"TableGroup",components:{JobList:Dp,HeaderCells:Ap},mixins:[de],props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String,isRoom:Boolean},computed:f(m(m({},k("outlay",["keys"])),k("acts",["showOnlyCompleted","completedValues","act"])),{data(){return this.node.data},title(){return this.node.data[this.keys[0].id]},children(){return this.showOnlyCompleted?this.node.children.filter(e=>this.completedValues[this.act._id][this.room].includes(e.key)):this.node.children||[]},isCategory(){return this.children.length>0},categories(){return this.children.filter(e=>{const{children:t}=e;return t&&t.length>0})}}),methods:f(m({},A("outlay",["toggleCategoryJobs"])),{treeToListOnlyValues(e){const{children:t,key:s}=e,n=t.map(this.treeToListOnlyValues).flat();return z(s)?n:[e]}})},Os=()=>{U(e=>({"56c2477b":e.level}))},Ts=Vt.setup;Vt.setup=Ts?(e,t)=>(Os(),Ts(e,t)):Os;const Ep=Vt,Bp={class:"table-group"},Mp={key:0,class:"title-row"};function Jp(e,t,s,n,r,o){const a=h("HeaderCells"),i=h("TableGroup",!0),d=h("JobList");return l(),u("div",Bp,[s.isRoom?(l(),u("div",Mp,$(o.title),1)):(l(),u("div",{key:1,class:"table-row table-row--category",style:Q(e.rowStyle)},[y(a,{title:o.title},null,8,["title"])],4)),s.isRoom&&o.children.length>0?(l(!0),u(b,{key:2},S(o.children,_=>(l(),w(i,{key:_.key,node:_,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128)):(l(),u(b,{key:3},[o.categories.length>0?(l(!0),u(b,{key:0},S(o.children,_=>(l(),w(d,{key:_.key,node:_,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128)):(l(),w(d,{key:1,node:s.node,level:s.level+1,room:s.room,hasTitle:!1},null,8,["node","level","room"]))],64))])}var Kp=g(Ep,[["render",Jp],["__scopeId","data-v-49c58862"]]);const Lt={name:"TableRow",components:{InputNumber:Re,TableRowWrapper:Me},props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String},data(){return{timeout:null}},computed:f(m(m({},k("outlay",["priceKey","striped"])),k("acts",["act","hoveredItem","selectedItem","showOnlyCompleted","completedValues"])),{data(){return this.node.data},children(){return this.showOnlyCompleted?this.node.children.filter(e=>this.completedValues[this.act._id][this.room].includes(e.key)):this.node.children||[]},isCategory(){return this.children.length>0},sum(){const e=this.data.quantity||0,t=this.data[this.priceKey.id];return E(e*t)},isEditable(){return this.act.status!==oe.CONFIRMED},hovered(){return this.hoveredItem?this.node.key===this.hoveredItem.id&&this.room===this.hoveredItem.room:!1},selected(){return this.selectedItem?this.node.key===this.selectedItem.id&&this.room===this.selectedItem.room:!1}}),watch:{selected(e){if(e){if(this.isCategory)return;this.selectInput()}}},methods:f(m(m({},B("acts",["updateById","setHoveredItem"])),A("acts",["saveLocaly"])),{changeHandler(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(async()=>{await this.saveLocaly()},300)},selectInput(){const{input:e}=this.$refs;e.$el.select()},mouseEnterHandler(){this.isCategory||this.setHoveredItem({id:this.node.key,room:this.room})},mouseLeaveHandler(){this.setHoveredItem(null)}})},Rs=()=>{U(e=>({ab524cd6:e.level}))},Vs=Lt.setup;Lt.setup=Vs?(e,t)=>(Rs(),Vs(e,t)):Rs;const jp=Lt,qp={class:"table-cell"},Hp={class:"table-cell"};function Up(e,t,s,n,r,o){const a=h("InputNumber"),i=h("TableRowWrapper"),d=h("TableRow",!0);return l(),u(b,null,[y(i,{class:N(["table-row",{category:o.isCategory,striped:e.striped,hovered:o.hovered,selected:o.selected}]),"data-id":s.node.key,"data-level":s.level,"data-room":s.room,onMouseenter:o.mouseEnterHandler,onMouseleave:o.mouseLeaveHandler},{default:C(()=>[o.isCategory?T("",!0):(l(),u(b,{key:0},[c("div",qp,[y(a,{modelValue:o.data.quantity,"onUpdate:modelValue":t[0]||(t[0]=_=>o.data.quantity=_),ref:"input",class:"input",disabled:!o.isEditable,min:0,onChange:o.changeHandler,onFocus:o.selectInput},null,8,["modelValue","disabled","onChange","onFocus"])]),c("div",Hp,$(o.sum),1)],64))]),_:1},8,["class","data-id","data-level","data-room","onMouseenter","onMouseleave"]),o.isCategory?(l(!0),u(b,{key:0},S(o.children,_=>(l(),w(d,{key:_.key,node:_,room:s.room,level:s.level+1},null,8,["node","room","level"]))),128)):T("",!0)],64)}var Wp=g(jp,[["render",Up],["__scopeId","data-v-45101170"]]);const Dt={name:"JobList",components:{TableRow:Wp},props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String,hasTitle:{type:Boolean,default:!0}},computed:f(m(m({},k("outlay",["keys"])),k("acts",["showOnlyCompleted","completedValues","act"])),{data(){return this.node.data},children(){return this.showOnlyCompleted?this.node.children.filter(e=>this.completedValues[this.act._id][this.room].includes(e.key)):this.node.children||[]},isCategory(){return this.children.length>0},title(){return this.isCategory&&this.hasTitle?this.data[this.keys[0].id]:null}})},Ls=()=>{U(e=>({"3acdf601":e.level}))},Ds=Dt.setup;Dt.setup=Ds?(e,t)=>(Ls(),Ds(e,t)):Ls;const Fp=Dt,Gp=e=>(x("data-v-52d63b2a"),e=e(),P(),e),Qp={key:0,class:"table-row table-row--category"},Zp=Gp(()=>c("div",{class:"table-cell"},null,-1)),zp=[Zp];function Yp(e,t,s,n,r,o){const a=h("TableRow");return l(),u(b,null,[o.title?(l(),u("div",Qp,zp)):T("",!0),(l(!0),u(b,null,S(o.children,i=>(l(),w(a,{key:i.key,node:i,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128))],64)}var Xp=g(Fp,[["render",Yp],["__scopeId","data-v-52d63b2a"]]);const ey={computed:m({},k("outlay",["keys"]))},ln=e=>(x("data-v-26c10881"),e=e(),P(),e),ty=ln(()=>c("div",{class:"table-cell"},"\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E",-1)),sy=ln(()=>c("div",{class:"table-cell"},"\u0421\u0443\u043C\u043C\u0430",-1));function oy(e,t,s,n,r,o){return l(),u(b,null,[ty,sy],64)}var ny=g(ey,[["render",oy],["__scopeId","data-v-26c10881"]]);const Nt={name:"TableGroup",components:{JobList:Xp,HeaderCells:ny},props:{node:{type:Object,required:!0,default:()=>{}},room:String,level:Number,isAct:Boolean},computed:f(m(m({},k("outlay",["keys"])),k("acts",["showOnlyCompleted","completedValues","act"])),{data(){return this.node.data},title(){return this.data[this.keys[0].id]},children(){return this.showOnlyCompleted?this.node.children.filter(e=>this.completedValues[this.act._id][this.room].includes(e.key)):this.node.children||[]},categories(){return this.children.filter(e=>{const{children:t}=e;return t&&t.length>0})}})},Ns=()=>{U(e=>({"9bf4fdf0":e.level}))},xs=Nt.setup;Nt.setup=xs?(e,t)=>(Ns(),xs(e,t)):Ns;const ry=Nt,ay={class:"table-group"},iy={key:0,class:"title-row"},ly={key:1,class:"table-row table-row--category"};function dy(e,t,s,n,r,o){const a=h("HeaderCells"),i=h("TableGroup",!0),d=h("JobList");return l(),u("div",ay,[s.isAct?(l(),u("div",iy,$(o.title),1)):(l(),u("div",ly,[y(a)])),s.isAct&&o.children.length>0?(l(!0),u(b,{key:2},S(o.children,_=>(l(),w(i,{key:_.key,node:_,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128)):(l(),u(b,{key:3},[o.categories.length>0?(l(!0),u(b,{key:0},S(o.children,_=>(l(),w(d,{key:_.key,node:_,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128)):(l(),w(d,{key:1,node:s.node,level:s.level+1,room:s.room,hasTitle:!1},null,8,["node","level","room"]))],64))])}var cy=g(ry,[["render",dy],["__scopeId","data-v-41a24150"]]);const uy={components:{TableGroup:cy},props:{data:{type:Array,required:!0,default:()=>[]},room:{type:Object,required:!0,default:()=>({})},act:{type:String,required:!0}},computed:f(m(m({},k("outlay",["priceKey"])),k("acts",["actsData"])),{sum(){const n=JSON.parse(JSON.stringify(this.actsData[this.act][this.room.id])).map(ee).flat().filter(r=>r.data.quantity>0).reduce((r,o)=>{const{data:a}=o,i=a.quantity,d=a[this.priceKey.id],_=i*d;return r+_},0);return E(n)}})},_y=e=>(x("data-v-0bdf5c1c"),e=e(),P(),e),hy={class:"tree-table"},my={class:"table-grid",ref:"wrapper"},py={class:"table-row"},yy=_y(()=>c("div",{class:"table-cell"},"\u0418\u0442\u043E\u0433\u043E",-1)),fy={class:"table-cell"};function vy(e,t,s,n,r,o){const a=h("TableGroup");return l(),u("div",hy,[c("div",my,[(l(!0),u(b,null,S(s.data,i=>(l(),w(a,{ref_for:!0,ref:"table",key:i.key,node:i,level:0,room:s.room.id,isAct:""},null,8,["node","room"]))),128)),c("div",py,[yy,c("div",fy,$(o.sum),1)])],512)])}var gy=g(uy,[["render",vy],["__scopeId","data-v-0bdf5c1c"]]);const by={components:{TableGroup:Kp,ActTable:gy},mixins:[de],props:{room:{required:!0,type:Object,default:()=>({})},actTable:Boolean},computed:f(m(m({},k("outlay",["rooms","keys"])),k("acts",["showOnlyCompleted","completedValues","actsData","act","acts"])),{croppedActs(){const e=this.acts.findIndex(t=>t._id===this.act._id);return[...this.acts].slice(0,e+1)},data(){const n=Object.entries(this.actsData).reduce((d,[_,p])=>this.croppedActs.find(I=>I._id===_)?[...d,p]:d,[]).map(d=>Object.entries(d).map(([v,I])=>({roomId:v,value:I})).find(v=>v.roomId===this.room.id).value).flat().reduce((d,_)=>{const p=ee(_);return[...d,...p]},[]).reduce((d,_)=>(d[_.key]=d[_.key]||[],d[_.key].push(_),d),{}),r=Object.values(n).map(d=>d.reduce((p,v)=>{if(!Object.keys(p).length)return v;const{data:I}=p,{data:O}=v,L=I.quantity+O.quantity,D=f(m({},I),{quantity:L});return f(m({},p),{data:D})},{})),a=JSON.parse(JSON.stringify(this.actsData[this.act._id][this.room.id])).map(d=>this.updateNodesInTree(d,r)).flat(),i=this.showOnlyCompleted?a.filter(d=>this.completedValues[this.act._id][this.room.id].includes(d.key)):a;return[{key:this.room.id,data:{[this.keys[0].id]:this.room.name},children:i,room:!0,level:0}]},actData(){const e=this.showOnlyCompleted?this.actsData[this.act._id][this.room.id].filter(t=>this.completedValues[this.act._id][this.room.id].includes(t.key)):this.actsData[this.act._id][this.room.id];return{key:this.act._id,data:[{key:this.room.id,data:{[this.keys[0].id]:this.act.name},children:e,room:!0,level:0}]}}}),methods:{scrollTo(e){const{wrapper:t}=this.$refs;if(!t)return;const s=this.getCordsOfRow(e);t.scrollTo({top:s,behavior:"smooth"})},getCordsOfRow(e){const{wrapper:t}=this.$refs;if(!t)return;const s=t.getBoundingClientRect(),n=t.querySelector(`.table-row[data-id="${e}"]`);if(!n)return;const r=n.getBoundingClientRect(),a=+n.dataset.level*32;return r.top-s.top-a+t.scrollTop},updateNodesInTree(e,t){const{key:s,children:n}=e,r=t.find(o=>o.key===s);return r||(n&&n.length>0&&(e.children=n.map(o=>this.updateNodesInTree(o,t))),e)}}},wy={class:"table-grid"},$y={class:"acts-wrapper"};function ky(e,t,s,n,r,o){const a=h("TableGroup"),i=h("ActTable");return o.data&&o.data[0].children.length>0?(l(),u("div",{key:0,ref:"wrapper",class:N(["table-wrapper",{acts:s.actTable}])},[c("div",{class:N(["tree-table",{acts:s.actTable}])},[c("div",wy,[(l(!0),u(b,null,S(o.data,d=>(l(),w(a,{ref_for:!0,ref:"table",key:d.key,node:d,room:d.key,level:0,isRoom:""},null,8,["node","room"]))),128)),c("div",{class:"table-row",style:Q(e.rowStyle)},[(l(!0),u(b,null,S(e.keys,d=>(l(),u("div",{key:d.id,class:"table-cell"}))),128))],4)])],2),c("div",$y,[y(i,{act:o.actData.key,data:o.actData.data,room:s.room},null,8,["act","data","room"])])],2)):T("",!0)}var dn=g(by,[["render",ky],["__scopeId","data-v-3c26423b"]]);const Cy={components:{RoomTable:dn},mixins:[de],computed:f(m(m({},k("outlay",["priceKey","keys","rooms"])),k("acts",["actsData","act"])),{roomList(){return[...this.rooms].reverse()},sum(){const e=this.rooms.reduce((t,s)=>{const a=JSON.parse(JSON.stringify(this.actsData[this.act._id][s.id])).map(ee).flat().filter(i=>i.data.quantity>0).reduce((i,d)=>{const{data:_}=d,p=_.quantity,v=_[this.priceKey.id],I=p*v;return i+I},0);return t+a},0);return E(e)}}),methods:{scrollTo(e,t){const{table:s,wrapper:n}=this.$refs,r=s.find(a=>a.room.id===e);if(!r)return;const o=r.getCordsOfRow(t);n.scrollTo({top:o,behavior:"smooth"})}}},Iy=e=>(x("data-v-5fdb4962"),e=e(),P(),e),Sy={class:"completed-table",ref:"wrapper"},Oy={class:"results-row"},Ty={class:"table-row table-row--result"},Ry=Iy(()=>c("div",{class:"act-table-cell"},"\u0418\u0442\u043E\u0433\u043E",-1)),Vy={class:"act-table-cell"};function Ly(e,t,s,n,r,o){const a=h("RoomTable");return l(),u("div",Sy,[(l(!0),u(b,null,S(o.roomList,i=>(l(),w(a,{key:i.id,room:i,ref_for:!0,ref:"table"},null,8,["room"]))),128)),c("div",Oy,[c("div",{class:"table-row table-row--stretched",style:Q(e.rowStyle)},[(l(!0),u(b,null,S(e.keys,i=>(l(),u("div",{key:i,class:"table-cell"}))),128))],4),c("div",Ty,[Ry,c("div",Vy,$(o.sum),1)])])],512)}var Dy=g(Cy,[["render",Ly],["__scopeId","data-v-5fdb4962"]]);const xt={name:"TableRow",components:{TableRowWrapper:Me},mixins:[de],props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String},computed:f(m(m({},k("outlay",["keys","quantityKey","priceKey","striped"])),k("acts",["hoveredItem","selectedItem"])),{data(){return this.node.data},children(){return this.node.children||[]},isCategory(){return this.children.length>0},sum(){const e=this.node.data[this.quantityKey.id],t=this.node.data[this.priceKey.id];return E(e*t)},hovered(){return this.hoveredItem?this.node.key===this.hoveredItem.id&&this.room===this.hoveredItem.room:!1},selected(){return this.selectedItem?this.node.key===this.selectedItem.id&&this.room===this.selectedItem.room:!1},viewData(){const e=[this.quantityKey.id,this.priceKey.id,"quantity"];return this.keys.map(t=>e.includes(t.id)?{key:t.id,value:E(this.data[t.id])}:{key:t.id,value:this.data[t.id]})}}),methods:f(m({},B("acts",["setHoveredItem"])),{mouseEnterHandler(){this.isCategory||this.setHoveredItem({id:this.node.key,room:this.room})},mouseLeaveHandler(){this.setHoveredItem(null)}})},Ps=()=>{U(e=>({"5e4aa954":e.level}))},As=xt.setup;xt.setup=As?(e,t)=>(Ps(),As(e,t)):Ps;const Ny=xt,xy={key:0,class:"table-cell"},Py=["title"],Ay={key:2,class:"table-cell"};function Ey(e,t,s,n,r,o){const a=h("TableRowWrapper"),i=h("TableRow",!0),d=Pe("tooltip");return l(),u(b,null,[y(a,{class:N(["table-row",{category:o.isCategory,striped:e.striped,hovered:o.hovered,selected:o.selected}]),"data-id":s.node.key,"data-level":s.level,"data-room":s.room,style:Q(e.rowStyle),onMouseenter:o.mouseEnterHandler,onMouseleave:o.mouseLeaveHandler},{default:C(()=>[o.isCategory?(l(),u("div",xy,$(o.viewData[0].value),1)):(l(!0),u(b,{key:1},S(o.viewData,(_,p)=>(l(),u(b,{key:_.key},[p===0?H((l(),u("div",{key:0,class:N(["table-cell",{quantity:_.key===e.quantityKey.id}])},[R($(_.value),1)],2)),[[d,_.value,void 0,{top:!0}]]):(l(),u("div",{key:1,class:N(["table-cell",{quantity:_.key===e.quantityKey.id}]),title:_.value},$(_.value),11,Py))],64))),128)),o.isCategory?T("",!0):(l(),u("div",Ay,$(o.sum),1))]),_:1},8,["class","data-id","data-level","data-room","style","onMouseenter","onMouseleave"]),o.isCategory?(l(!0),u(b,{key:0},S(o.children,_=>(l(),w(i,{key:_.key,node:_,room:s.room,level:s.level+1},null,8,["node","room","level"]))),128)):T("",!0)],64)}var By=g(Ny,[["render",Ey],["__scopeId","data-v-b630eae0"]]);const Pt={name:"JobList",components:{TableRow:By},mixins:[de],props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String,hasTitle:{type:Boolean,default:!0}},computed:f(m(m({},k("outlay",["keys"])),k("acts",["act"])),{data(){return this.node.data},children(){return this.node.children||[]},isCategory(){return this.children.length>0},title(){return this.isCategory&&this.hasTitle?this.data[this.keys[0].id]:null}})},Es=()=>{U(e=>({"015d6695":e.level}))},Bs=Pt.setup;Pt.setup=Bs?(e,t)=>(Es(),Bs(e,t)):Es;const My=Pt,Jy={class:"table-cell"};function Ky(e,t,s,n,r,o){const a=h("TableRow");return l(),u(b,null,[o.title?(l(),u("div",{key:0,class:"table-row table-row--category",style:Q(e.rowStyle)},[c("div",Jy,$(o.title),1)],4)):T("",!0),(l(!0),u(b,null,S(o.children,i=>(l(),w(a,{key:i.key,node:i,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128))],64)}var jy=g(My,[["render",Ky],["__scopeId","data-v-54447d4a"]]);const qy={props:{title:String,level:Number},computed:f(m({},k("outlay",["keys"])),{cells(){const e=[...this.keys,{id:"\u0421\u0443\u043C\u043C\u0430",name:"\u0421\u0443\u043C\u043C\u0430"}];return this.title?e.map((t,s)=>s==0?f(m({},t),{name:this.title}):t):e}})},Hy={key:0};function Uy(e,t,s,n,r,o){return l(!0),u(b,null,S(o.cells,(a,i)=>(l(),u("div",{key:a.id,class:"table-cell"},[i===0?(l(),u("span",Hy,$(a.name),1)):(l(),u(b,{key:1},[R($(a.name),1)],64))]))),128)}var Wy=g(qy,[["render",Uy],["__scopeId","data-v-1017d4fc"]]);const At={name:"TableGroup",components:{JobList:jy,HeaderCells:Wy},mixins:[de],props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String,isRoom:Boolean},computed:f(m({},k("outlay",["keys"])),{data(){return this.node.data},title(){return this.node.data[this.keys[0].id]},children(){return this.node.children||[]},categories(){return this.children.filter(e=>{const{children:t}=e;return t&&t.length>0})}})},Ms=()=>{U(e=>({"4e7d1769":e.level}))},Js=At.setup;At.setup=Js?(e,t)=>(Ms(),Js(e,t)):Ms;const Fy=At,Gy={class:"table-group"},Qy={key:0,class:"title-row"};function Zy(e,t,s,n,r,o){const a=h("HeaderCells"),i=h("TableGroup",!0),d=h("JobList");return l(),u("div",Gy,[s.isRoom?(l(),u("div",Qy,$(o.title),1)):(l(),u("div",{key:1,class:"table-row table-row--category",style:Q(e.rowStyle)},[y(a,{title:o.title},null,8,["title"])],4)),s.isRoom&&o.children.length>0?(l(!0),u(b,{key:2},S(o.children,_=>(l(),w(i,{key:_.key,node:_,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128)):(l(),u(b,{key:3},[o.categories.length>0?(l(!0),u(b,{key:0},S(o.children,_=>(l(),w(d,{key:_.key,node:_,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128)):(l(),w(d,{key:1,node:s.node,level:s.level+1,room:s.room,hasTitle:!1},null,8,["node","level","room"]))],64))])}var zy=g(Fy,[["render",Zy],["__scopeId","data-v-58fda96b"]]);const Et={name:"TableRow",components:{TableRowWrapper:Me},inject:["bold"],props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String},computed:f(m(m({},k("outlay",["priceKey","striped"])),k("acts",["hoveredItem","selectedItem"])),{data(){return this.node.data},children(){return this.node.children||[]},isCategory(){return this.children.length>0},sum(){const e=this.data.quantity||0,t=this.data[this.priceKey.id];return E(e*t)},hovered(){return this.hoveredItem?this.node.key===this.hoveredItem.id&&this.room===this.hoveredItem.room:!1},selected(){return this.selectedItem?this.node.key===this.selectedItem.id&&this.room===this.selectedItem.room:!1},quantity(){return E(this.data.quantity)}}),methods:f(m({},B("acts",["setHoveredItem"])),{mouseEnterHandler(){this.isCategory||this.setHoveredItem({id:this.node.key,room:this.room})},mouseLeaveHandler(){this.setHoveredItem(null)}})},Ks=()=>{U(e=>({"3e880d0a":e.level}))},js=Et.setup;Et.setup=js?(e,t)=>(Ks(),js(e,t)):Ks;const Yy=Et,Xy={class:"table-cell"},ef={class:"table-cell"};function tf(e,t,s,n,r,o){const a=h("TableRowWrapper"),i=h("TableRow",!0);return l(),u(b,null,[y(a,{class:N(["table-row",{category:o.isCategory,striped:e.striped,hovered:o.hovered,selected:o.selected,bold:o.bold}]),"data-id":s.node.key,"data-level":s.level,"data-room":s.room,onMouseenter:o.mouseEnterHandler,onMouseleave:o.mouseLeaveHandler},{default:C(()=>[o.isCategory?T("",!0):(l(),u(b,{key:0},[c("div",Xy,$(o.quantity),1),c("div",ef,$(o.sum),1)],64))]),_:1},8,["class","data-id","data-level","data-room","onMouseenter","onMouseleave"]),o.isCategory?(l(!0),u(b,{key:0},S(o.children,d=>(l(),w(i,{key:d.key,node:d,room:s.room,level:s.level+1},null,8,["node","room","level"]))),128)):T("",!0)],64)}var sf=g(Yy,[["render",tf],["__scopeId","data-v-719e7cb4"]]);const Bt={name:"JobList",components:{TableRow:sf},props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String,hasTitle:{type:Boolean,default:!0}},computed:f(m(m({},k("outlay",["keys"])),k("acts",["act"])),{data(){return this.node.data},children(){return this.node.children||[]},isCategory(){return this.children.length>0},title(){return this.isCategory&&this.hasTitle?this.data[this.keys[0].id]:null}})},qs=()=>{U(e=>({"4d19a300":e.level}))},Hs=Bt.setup;Bt.setup=Hs?(e,t)=>(qs(),Hs(e,t)):qs;const of=Bt,nf=e=>(x("data-v-75fee9da"),e=e(),P(),e),rf={key:0,class:"table-row table-row--category"},af=nf(()=>c("div",{class:"table-cell"},null,-1)),lf=[af];function df(e,t,s,n,r,o){const a=h("TableRow");return l(),u(b,null,[o.title?(l(),u("div",rf,lf)):T("",!0),(l(!0),u(b,null,S(o.children,i=>(l(),w(a,{key:i.key,node:i,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128))],64)}var cf=g(of,[["render",df],["__scopeId","data-v-75fee9da"]]);const uf={},cn=e=>(x("data-v-77b02dbf"),e=e(),P(),e),_f=cn(()=>c("div",{class:"table-cell"},"\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E",-1)),hf=cn(()=>c("div",{class:"table-cell"},"\u0421\u0443\u043C\u043C\u0430",-1));function mf(e,t){return l(),u(b,null,[_f,hf],64)}var pf=g(uf,[["render",mf],["__scopeId","data-v-77b02dbf"]]);const Mt={name:"TableGroup",components:{JobList:cf,HeaderCells:pf},props:{node:{type:Object,required:!0,default:()=>{}},room:String,level:Number,isAct:Boolean},computed:f(m(m({},k("outlay",["keys"])),k("acts",["act"])),{data(){return this.node.data},title(){return this.data[this.keys[0].id]},children(){return this.node.children||[]},categories(){return this.children.filter(e=>{const{children:t}=e;return t&&t.length>0})}})},Us=()=>{U(e=>({"6bd5c2fa":e.level}))},Ws=Mt.setup;Mt.setup=Ws?(e,t)=>(Us(),Ws(e,t)):Us;const yf=Mt,ff={class:"table-group"},vf={key:0,class:"title-row"},gf={key:1,class:"table-row table-row--category"};function bf(e,t,s,n,r,o){const a=h("HeaderCells"),i=h("TableGroup",!0),d=h("JobList");return l(),u("div",ff,[s.isAct?(l(),u("div",vf,$(o.title),1)):(l(),u("div",gf,[y(a)])),s.isAct&&o.children.length>0?(l(!0),u(b,{key:2},S(o.children,_=>(l(),w(i,{key:_.key,node:_,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128)):(l(),u(b,{key:3},[o.categories.length>0?(l(!0),u(b,{key:0},S(o.children,_=>(l(),w(d,{key:_.key,node:_,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128)):(l(),w(d,{key:1,node:s.node,level:s.level+1,room:s.room,hasTitle:!1},null,8,["node","level","room"]))],64))])}var un=g(yf,[["render",bf],["__scopeId","data-v-867ebb76"]]);const wf={components:{TableGroup:un},provide(){return{bold:!1}},props:{data:{type:Array,required:!0,default:()=>[]},room:{type:Object,required:!0,default:()=>({})},act:{type:Object,required:!0,default:()=>({})}},computed:f(m(m({},k("outlay",["keys","priceKey"])),k("acts",["actsData"])),{tempData(){const t=JSON.parse(JSON.stringify(this.data)).map(ye).flat(),n=JSON.parse(JSON.stringify(this.actsData[this.act._id][this.room.id])).filter(o=>this.filterByCompleted(o,t));return[{key:this.act._id,data:{[this.keys[0].id]:this.act.name},children:n,room:!0}]},sum(){const n=JSON.parse(JSON.stringify(this.actsData[this.act._id][this.room.id])).map(ee).flat().filter(r=>r.data.quantity>0).reduce((r,o)=>{const{data:a}=o,i=a.quantity,d=a[this.priceKey.id],_=i*d;return r+_},0);return E(n)}}),methods:{filterByCompleted(e,t){const{children:s,key:n}=e;return s&&s.length>0?(e.children=s.filter(r=>this.filterByCompleted(r,t)),e.children.length>0):t.includes(n)}}},$f=e=>(x("data-v-451b412a"),e=e(),P(),e),kf={class:"tree-table"},Cf={class:"table-grid",ref:"wrapper"},If={class:"table-row"},Sf=$f(()=>c("div",{class:"table-cell"},"\u0418\u0442\u043E\u0433\u043E",-1)),Of={class:"table-cell"};function Tf(e,t,s,n,r,o){const a=h("TableGroup");return l(),u("div",kf,[c("div",Cf,[(l(!0),u(b,null,S(o.tempData,i=>(l(),w(a,{ref_for:!0,ref:"table",key:i.key,node:i,level:0,room:s.room.id,isAct:""},null,8,["node","room"]))),128)),c("div",If,[Sf,c("div",Of,$(o.sum),1)])],512)])}var Rf=g(wf,[["render",Tf],["__scopeId","data-v-451b412a"]]);const Vf={components:{TableGroup:un},provide(){return{bold:!0}},props:{room:{required:!0,type:Object,default:()=>({})}},computed:f(m(m({},k("outlay",["keys","priceKey","quantityKey"])),k("acts",["roomsData","showOnlyCompleted","actsData","acts","act"])),{croppedActs(){const e=this.acts.findIndex(t=>t._id===this.act._id);return[...this.acts].slice(0,e+1)},data(){const n=Object.entries(this.actsData).reduce((i,[d,_])=>this.croppedActs.find(v=>v._id===d)?[...i,_]:i,[]).map(i=>Object.entries(i).map(([p,v])=>({roomId:p,value:v})).find(p=>p.roomId===this.room.id).value).flat().reduce((i,d)=>{const _=ee(d);return[...i,..._]},[]).reduce((i,d)=>(i[d.key]=i[d.key]||[],i[d.key].push(d),i),{}),r=Object.values(n).map(i=>i.reduce((_,p)=>{if(!Object.keys(_).length)return p;const{data:v}=_,{data:I}=p,O=v.quantity+I.quantity,L=f(m({},v),{quantity:O});return f(m({},_),{data:L})},{}));return JSON.parse(JSON.stringify(this.room.jobs)).map(i=>this.updateNodesInTree(i,r)).flat()},resultData(){const e=this.data;return[{key:this.room.id,data:{[this.keys[0].id]:"\u0418\u0442\u043E\u0433\u043E"},children:e,room:!0,level:0}]},leftData(){const t=JSON.parse(JSON.stringify(this.data)).map(this.getTreeWithLeftData).flat();return[{key:this.room.id,data:{[this.keys[0].id]:"\u041E\u0441\u0442\u0430\u043B\u043E\u0441\u044C"},children:t,room:!0,level:0}]},resultSum(){return this.getSum(this.resultData)},leftSum(){return this.getSum(this.leftData)}}),methods:{updateNodesInTree(e,t){const{key:s,children:n}=e,r=t.find(o=>o.key===s);return r||(n&&n.length>0&&(e.children=n.map(o=>this.updateNodesInTree(o,t))),e)},getTreeWithLeftData(e){const{children:t,data:s}=e;if(t&&t.length>0)return e.children=t.map(this.getTreeWithLeftData),e;const n=s[this.quantityKey.id]-s.quantity;return e.data.quantity=n<0?0:n,e},getSum(e){const n=JSON.parse(JSON.stringify(e)).map(ee).flat().reduce((r,o)=>{const{data:a}=o,i=a.quantity||0,d=a[this.priceKey.id]||0,_=i*d;return r+_},0);return E(n)}}},_n=e=>(x("data-v-a2baed7a"),e=e(),P(),e),Lf={class:"wrapper"},Df={class:"tree-table"},Nf={class:"table-grid",ref:"wrapper"},xf={class:"table-row"},Pf=_n(()=>c("div",{class:"table-cell"},"\u0418\u0442\u043E\u0433\u043E",-1)),Af={class:"table-cell"},Ef={class:"tree-table"},Bf={class:"table-grid",ref:"wrapper"},Mf={class:"table-row"},Jf=_n(()=>c("div",{class:"table-cell"},"\u0418\u0442\u043E\u0433\u043E",-1)),Kf={class:"table-cell"};function jf(e,t,s,n,r,o){const a=h("TableGroup");return l(),u("div",Lf,[c("div",Df,[c("div",Nf,[(l(!0),u(b,null,S(o.resultData,i=>(l(),w(a,{ref_for:!0,ref:"table",key:i.key,node:i,level:0,room:s.room.id,isAct:""},null,8,["node","room"]))),128)),c("div",xf,[Pf,c("div",Af,$(o.resultSum),1)])],512)]),c("div",Ef,[c("div",Bf,[(l(!0),u(b,null,S(o.leftData,i=>(l(),w(a,{ref_for:!0,ref:"table",key:i.key,node:i,level:0,room:s.room.id,isAct:""},null,8,["node","room"]))),128)),c("div",Mf,[Jf,c("div",Kf,$(o.leftSum),1)])],512)])])}var qf=g(Vf,[["render",jf],["__scopeId","data-v-a2baed7a"]]);const Hf={components:{TableGroup:zy,ActTable:Rf,ResultTable:qf},mixins:[de],props:{room:{required:!0,type:Object,default:()=>({})},acts:{required:!0,type:Array,default:()=>[]},actTable:Boolean},computed:{completed(){return this.room.jobs.map(ee).flat().map(({key:t})=>t)},data(){return[{key:this.room.id,data:{[this.keys[0].id]:this.room.name},children:this.room.jobs,room:!0,level:0}]},actData(){return this.acts.map(e=>{const t=this.data[0].children;return{act:e,data:[{key:this.room.id,data:{[this.keys[0].id]:e.name},children:t,room:!0}]}})}},methods:{scrollTo(e,t){const{wrapper:s}=this.$refs;if(!s)return;const n=this.getCordsOfRow(e,t);s.scrollTo({top:n,behavior:"smooth"})},getCordsOfRow(e,t){const{wrapper:s}=this.$refs;if(!s)return;const n=s.getBoundingClientRect(),r=s.querySelector(`.table-row[data-room="${e}"][data-id="${t}"]`);if(!r)return;const o=r.getBoundingClientRect(),i=+r.dataset.level*32;return o.top-n.top-i+s.scrollTop},filterByCompleted(e,t){const{children:s,key:n}=e;return s&&s.length>0?(e.children=s.filter(r=>this.filterByCompleted(r,t)),e.children.length>0):t.includes(n)}}},Uf={class:"table-grid",ref:"wrapper"},Wf={key:0,class:"acts-wrapper"};function Ff(e,t,s,n,r,o){const a=h("TableGroup"),i=h("ActTable"),d=h("ResultTable");return l(),u("div",{class:N(["table-wrapper",{acts:s.actTable}])},[c("div",{class:N(["tree-table",{acts:s.actTable}])},[c("div",Uf,[(l(!0),u(b,null,S(o.data,_=>(l(),w(a,{ref_for:!0,ref:"table",key:_.key,node:_,room:_.key,level:0,isRoom:""},null,8,["node","room"]))),128)),c("div",{class:"table-row",style:Q(e.rowStyle)},[(l(!0),u(b,null,S(e.keys,_=>(l(),u("div",{key:_.id,class:"table-cell"}))),128))],4)],512)],2),o.actData&&o.actData.length>0?(l(),u("div",Wf,[(l(!0),u(b,null,S(o.actData,_=>(l(),w(i,{key:_.key,act:_.act,data:_.data,room:s.room},null,8,["act","data","room"]))),128)),y(d,{acts:o.actData,room:s.room},null,8,["acts","room"])])):T("",!0)],2)}var Gf=g(Hf,[["render",Ff],["__scopeId","data-v-4d8d95d2"]]);const Qf={components:{RoomTable:Gf},mixins:[de],computed:f(m(m({},k("outlay",["priceKey","rooms"])),k("acts",["actsData","act","acts"])),{croppedActs(){const e=this.acts.findIndex(t=>t._id===this.act._id);return[...this.acts].slice(0,e+1)},completed(){return this.rooms.reduce((e,t)=>{const s=JSON.parse(JSON.stringify(this.roomsData[t.id])),r=JSON.parse(JSON.stringify(s)).filter(_e).map(ye).flat(),o=new Set(r);return e[t.id]=[...o],e},{})},roomsData(){const e=this.croppedActs.reduce((t,s)=>(this.rooms.forEach(n=>{const r=JSON.parse(JSON.stringify(this.actsData[s._id][n.id]));if(t[n.id]){t[n.id]=[...t[n.id],...r];return}t[n.id]=r}),t),{});return Object.entries(e).reduce((t,[s,n])=>{const r=this.mergeChildren(n);return t[s]=r,t},{})},tableData(){return this.completed?[...this.rooms].reverse().map(s=>{const r=JSON.parse(JSON.stringify(this.roomsData[s.id])).filter(o=>this.filterByCompleted(o,this.completed[s.id]));return f(m({},s),{jobs:r})}):[]},sum(){const e=this.rooms.reduce((t,s)=>{const a=JSON.parse(JSON.stringify(this.actsData[s.id])).map(ee).flat().filter(i=>i.data.quantity>0).reduce((i,d)=>{const{data:_}=d,p=_.quantity,v=_[this.priceKey.id],I=p*v;return i+I},0);return t+a},0);return E(e)}}),methods:{sumQuantities(e){return e.reduce((s,n)=>{if(!Object.keys(s).length)return n;const{data:r}=s,{data:o}=n,a=r.quantity+o.quantity,i=f(m({},r),{quantity:a});return f(m({},s),{data:i})},{})},mergeChildren(e){const t=e.reduce((s,n)=>{s[n.key]=s[n.key]||[];const{children:r}=n,o=r.length>0?r:n;return s[n.key].push(o),s},{});return e&&e.length>0&&e[0].children.length===0?Object.values(t).map(this.sumQuantities):Object.entries(t).map(([s,n])=>{const r=e.find(a=>a.key===s),{children:o}=r;if(o&&o.length>0){const a=n.flat();return r.children=this.mergeChildren(a),r}return r})},filterByCompleted(e,t){const{children:s,key:n}=e;return s&&s.length>0?(e.children=s.filter(r=>this.filterByCompleted(r,t)),e.children.length>0):t.includes(n)},scrollTo(e,t){const{table:s,wrapper:n}=this.$refs,r=s.find(a=>a.room.id===e);if(!r)return;const o=r.getCordsOfRow(e,t);n.scrollTo({top:o,behavior:"smooth"})}}},Zf={class:"acts-table",ref:"wrapper"};function zf(e,t,s,n,r,o){const a=h("RoomTable");return l(),u("div",Zf,[(l(!0),u(b,null,S(o.tableData,i=>(l(),w(a,{ref_for:!0,ref:"table",acts:o.croppedActs,key:i.id,room:i,actTable:""},null,8,["acts","room"]))),128))],512)}var Yf=g(Qf,[["render",zf],["__scopeId","data-v-2dd97ac6"]]);const Jt={name:"TableRow",components:{TableRowWrapper:Me,TableRowData:an},props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String},computed:f(m(m({},k("outlay",["keys","quantityKey","priceKey","striped"])),k("acts",["hoveredItem","selectedItem"])),{data(){return this.node.data},children(){return this.node.children||[]},isCategory(){return this.children.length>0},visibleKeys(){return this.keys.map(t=>t.id===this.quantityKey.id?f(m({},t),{name:"\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E",id:"quantity"}):t)},headerStyle(){return{gridTemplateColumns:`4fr repeat(${this.keys.length}, minmax(100px, 1fr))`}},sum(){const e=this.node.data.quantity,t=this.node.data[this.priceKey.id];return E(e*t)},hovered(){return this.hoveredItem?this.node.key===this.hoveredItem.id&&this.room===this.hoveredItem.room:!1},selected(){return this.selectedItem?this.node.key===this.selectedItem.id&&this.room===this.selectedItem.room:!1}}),methods:f(m({},B("acts",["setHoveredItem"])),{mouseEnterHandler(){this.isCategory||this.setHoveredItem({id:this.node.key,room:this.room})},mouseLeaveHandler(){this.setHoveredItem(null)}})},Fs=()=>{U(e=>({"7a035924":e.level}))},Gs=Jt.setup;Jt.setup=Gs?(e,t)=>(Fs(),Gs(e,t)):Fs;const Xf=Jt;function ev(e,t,s,n,r,o){const a=h("TableRowData"),i=h("TableRowWrapper"),d=h("TableRow",!0);return l(),u(b,null,[y(i,{class:N(["table-row",{category:o.isCategory,striped:e.striped,hovered:o.hovered,selected:o.selected}]),"data-id":s.node.key,"data-level":s.level,"data-room":s.room,style:Q(o.headerStyle),onMouseenter:o.mouseEnterHandler,onMouseleave:o.mouseLeaveHandler},{default:C(()=>[y(a,{data:o.data,isCategory:o.isCategory},null,8,["data","isCategory"])]),_:1},8,["class","data-id","data-level","data-room","style","onMouseenter","onMouseleave"]),o.isCategory?(l(!0),u(b,{key:0},S(o.children,_=>(l(),w(d,{key:_.key,node:_,room:s.room,level:s.level+1},null,8,["node","room","level"]))),128)):T("",!0)],64)}var tv=g(Xf,[["render",ev],["__scopeId","data-v-f3602f2a"]]);const Kt={name:"JobList",components:{TableRow:tv},props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String,hasTitle:{type:Boolean,default:!0}},emits:["select-node"],computed:f(m({},k("outlay",["keys","selectedValues","showOnlyChecked"])),{data(){return this.node.data},children(){return this.showOnlyChecked?this.node.children.filter(e=>this.selectedValues.includes(e.key)):this.node.children||[]},isCategory(){return this.children.length>0},title(){return this.isCategory&&this.hasTitle?this.data[this.keys[0].id]:null},headerStyle(){return{gridTemplateColumns:`4fr repeat(${this.keys.length}, minmax(100px, 1fr)) 50px`}},selected(){return this.selectedValues.includes(this.node.key)}}),methods:m({},A("outlay",["toggleCategoryJobs"]))},Qs=()=>{U(e=>({"77eb20da":e.level}))},Zs=Kt.setup;Kt.setup=Zs?(e,t)=>(Qs(),Zs(e,t)):Qs;const sv=Kt,ov={class:"table-cell"};function nv(e,t,s,n,r,o){const a=h("TableRow");return l(),u(b,null,[o.title?(l(),u("div",{key:0,class:"table-row table-row--category",style:Q(o.headerStyle)},[c("div",ov,$(o.title),1)],4)):T("",!0),(l(!0),u(b,null,S(o.children,i=>(l(),w(a,{key:i.key,node:i,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128))],64)}var rv=g(sv,[["render",nv],["__scopeId","data-v-5b72d876"]]);const av={props:{title:String,level:Number},emits:["name-click"],computed:f(m({},k("outlay",["keys","quantityKey"])),{cells(){const e=[...this.keys,{id:"\u0421\u0443\u043C\u043C\u0430",name:"\u0421\u0443\u043C\u043C\u0430"}];return this.title?e.map((t,s)=>t.id===this.quantityKey.id?f(m({},t),{name:"\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E"}):s==0?f(m({},t),{name:this.title}):t):e}}),methods:{nameClick(){this.$emit("name-click")}}};function iv(e,t,s,n,r,o){return l(!0),u(b,null,S(o.cells,(a,i)=>(l(),u("div",{key:a.id,class:"table-cell"},[i===0?(l(),u("span",{key:0,onClick:t[0]||(t[0]=(...d)=>o.nameClick&&o.nameClick(...d))},$(a.name),1)):(l(),u(b,{key:1},[R($(a.name),1)],64))]))),128)}var lv=g(av,[["render",iv],["__scopeId","data-v-023923e5"]]);const jt={name:"TableGroup",components:{JobList:rv,HeaderCells:lv},props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String,isRoom:Boolean},computed:f(m({},k("outlay",["keys","priceKey","selectedValues","selectedRoom","showOnlyChecked","selectedValues"])),{data(){return this.node.data},title(){return this.node.data[this.keys[0].id]},children(){return this.showOnlyChecked?this.node.children.filter(e=>this.selectedValues.includes(e.key)):this.node.children||[]},isCategory(){return this.children.length>0},categories(){return this.children.filter(e=>{const{children:t}=e;return t&&t.length>0})},sum(){const e=this.node.children.map(this.treeToListOnlyValues).flat();if(this.selectedRoom){const n=e.filter(r=>this.selectedValues.includes(r.key)).reduce((r,o)=>{const{data:a}=o,i=a[this.priceKey.id]*a.quantity;return r+i},0);return E(n)}const t=e.reduce((s,n)=>{const{data:r}=n,o=r[this.priceKey.id]*r.quantity;return s+o},0);return E(t)},result(){return`\u0418\u0442\u043E\u0433\u043E \u043F\u043E ${this.isRoom?"\u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u044E":"\u0440\u0430\u0437\u0434\u0435\u043B\u0443"} (${this.title})`},resultsRowStyle(){const e=this.keys.length;return{gridTemplateColumns:`${4+e-1}fr minmax(100px, 1fr)`}},categoryRowStyle(){return{gridTemplateColumns:`4fr repeat(${this.keys.length}, minmax(100px, 1fr)) ${this.selectedRoom?"50px":""}`}}}),methods:f(m({},A("outlay",["toggleCategoryJobs"])),{treeToListOnlyValues(e){const{children:t,key:s}=e,n=t.map(this.treeToListOnlyValues).flat();return z(s)?n:[e]}})},zs=()=>{U(e=>({"0f951f9f":e.level}))},Ys=jt.setup;jt.setup=Ys?(e,t)=>(zs(),Ys(e,t)):zs;const dv=jt,cv={class:"table-group"},uv={key:0,class:"title-row"},_v={class:"table-cell table-cell--results"},hv=["title"];function mv(e,t,s,n,r,o){const a=h("HeaderCells"),i=h("TableGroup",!0),d=h("JobList");return l(),u("div",cv,[s.isRoom?(l(),u("div",uv,$(o.title),1)):(l(),u("div",{key:1,class:"table-row table-row--category",style:Q(o.categoryRowStyle)},[y(a,{title:o.title},null,8,["title"])],4)),s.isRoom&&o.children.length>0?(l(!0),u(b,{key:2},S(o.children,_=>(l(),w(i,{key:_.key,node:_,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128)):(l(),u(b,{key:3},[o.categories.length>0?(l(!0),u(b,{key:0},S(o.children,_=>(l(),w(d,{key:_.key,node:_,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128)):(l(),w(d,{key:1,node:s.node,level:s.level+1,room:s.room,hasTitle:!1},null,8,["node","level","room"]))],64)),c("div",{class:"results-row",style:Q(o.resultsRowStyle)},[c("div",_v,$(o.result),1),c("div",{class:"table-cell",title:o.sum},$(o.sum),9,hv)],4)])}var pv=g(dv,[["render",mv],["__scopeId","data-v-69773a53"]]);const yv={components:{TableGroup:pv},computed:f(m(m({},k("outlay",["rooms","keys"])),k("acts",["actsData","acts","completedValues","changeView","act"])),{croppedActs(){const e=this.acts.findIndex(t=>t._id===this.act._id);return[...this.acts].slice(0,e+1)},completed(){return this.rooms.reduce((e,t)=>{const r=JSON.parse(JSON.stringify(this.roomsData[t.id])).filter(_e).map(ye).flat(),o=new Set(r);return e[t.id]=[...o],e},{})},dataWithRooms(){return this.getDataWithRooms()},viewData(){return this.changeView?this.getDataWithCategories():this.dataWithRooms},roomsData(){const t=JSON.parse(JSON.stringify(this.croppedActs)).reduce((s,n)=>(this.rooms.forEach(r=>{const o=JSON.parse(JSON.stringify(this.actsData[n._id][r.id]));if(s[r.id]){s[r.id]=[...s[r.id],...o];return}s[r.id]=o}),s),{});return Object.entries(t).reduce((s,[n,r])=>{const o=this.mergeChildren(r);return s[n]=o,s},{})}}),methods:{updateNodesInTree(e,t){const{key:s,children:n}=e,r=t.find(o=>o.key===s);return r||(n&&n.length>0&&(e.children=n.map(o=>this.updateNodesInTree(o,t))),e)},sumQuantities(e){return e.reduce((s,n)=>{if(!Object.keys(s).length)return n;const{data:r}=s,{data:o}=n,a=r.quantity+o.quantity,i=f(m({},r),{quantity:a});return f(m({},s),{data:i})},{})},mergeChildren(e){const t=e.reduce((s,n)=>{s[n.key]=s[n.key]||[];const{children:r}=n,o=r.length>0?r:n;return s[n.key].push(o),s},{});return e&&e.length>0&&e[0].children.length===0?Object.values(t).map(this.sumQuantities):Object.entries(t).map(([s,n])=>{const r=e.find(a=>a.key===s),{children:o}=r;if(o&&o.length>0){const a=n.flat();return r.children=this.mergeChildren(a),r}return r})},getDataWithRooms(){const e=[...this.rooms].reverse();return JSON.parse(JSON.stringify(e)).map(s=>{const o=this.roomsData[s.id].flat().reduce((p,v)=>{const I=ee(v);return[...p,...I]},[]).reduce((p,v)=>(p[v.key]=p[v.key]||[],p[v.key].push(v),p),{}),a=Object.values(o).map(this.sumQuantities),_=JSON.parse(JSON.stringify(this.roomsData[s.id])).map(p=>this.updateNodesInTree(p,a)).flat().filter(_e);return{key:s.id,data:{[this.keys[0].id]:s.name},children:_,room:!0,level:0}})},getDataWithCategories(){const t=JSON.parse(JSON.stringify(this.dataWithRooms)).map(n=>n.children).flat();return this.mergeChildren(t)},scrollTo(e,t){const{wrapper:s}=this.$refs;if(!s)return;const n=s.getBoundingClientRect(),r=this.getRow(e,t);if(!r)return;const o=r.getBoundingClientRect(),i=+r.dataset.level*32,d=o.top-n.top-i;s.scrollTo({top:d+s.scrollTop,behavior:"smooth"})},getRow(e,t){const{wrapper:s}=this.$refs;return this.changeView?s.querySelector(`.table-row[data-id="${t}"]`):s.querySelector(`.table-row[data-room="${e}"][data-id="${t}"]`)}}},fv={class:"tree-table"},vv={class:"table-grid",ref:"wrapper"};function gv(e,t,s,n,r,o){const a=h("TableGroup");return l(),u("div",fv,[c("div",vv,[(l(!0),u(b,null,S(o.viewData,i=>(l(),w(a,{ref_for:!0,ref:"table",key:i.key,node:i,room:i.key,level:0,isRoom:!e.changeView},null,8,["node","room","isRoom"]))),128))],512)])}var bv=g(yv,[["render",gv],["__scopeId","data-v-4c37cef6"]]);const qt={inject:["keys"],computed:{gridStyleRepeat(){return this.keys.length-1}}},Xs=()=>{U(e=>({"0cfc35b1":e.gridStyleRepeat}))},eo=qt.setup;qt.setup=eo?(e,t)=>(Xs(),eo(e,t)):Xs;const wv=qt,$v={class:"table-row-wrapper"};function kv(e,t,s,n,r,o){return l(),u("div",$v,[ne(e.$slots,"default",{},void 0,!0)])}var hn=g(wv,[["render",kv],["__scopeId","data-v-0050dfac"]]);const Cv={},Iv={class:"table-cell"};function Sv(e,t){return l(),u("div",Iv,[ne(e.$slots,"default",{},void 0,!0)])}var Ht=g(Cv,[["render",Sv],["__scopeId","data-v-4fce8812"]]);const Ov={components:{TableRowWrapper:hn,TableCellWrapper:Ht},inject:["keys"],props:{name:{type:String,required:!0},showKeys:{type:Boolean,required:!0}},computed:{viewData(){const e=f(m({},this.keys[0]),{name:this.name});return(this.showKeys?this.keys:[e]).map((s,n)=>n===0?e:s)}}};function Tv(e,t,s,n,r,o){const a=h("TableCellWrapper"),i=h("TableRowWrapper");return l(),w(i,null,{default:C(()=>[(l(!0),u(b,null,S(o.viewData,d=>(l(),w(a,{key:d.id},{default:C(()=>[R($(d.name),1)]),_:2},1024))),128))]),_:1})}var Rv=g(Ov,[["render",Tv]]);const Vv={components:{TableCellWrapper:Ht,InputNumber:Re},props:{modelValue:{required:!0}},emits:["update:modelValue","change"],computed:{newValue:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}};function Lv(e,t,s,n,r,o){const a=h("InputNumber"),i=h("TableCellWrapper");return l(),w(i,null,{default:C(()=>[y(a,{modelValue:o.newValue,"onUpdate:modelValue":t[0]||(t[0]=d=>o.newValue=d),class:"input",onClick:t[1]||(t[1]=Y(()=>{},["stop"]))},null,8,["modelValue"])]),_:1})}var Dv=g(Vv,[["render",Lv],["__scopeId","data-v-497032df"]]);const Nv={components:{TableRowWrapper:hn,QuantityCell:Dv,TableCellWrapper:Ht},mixins:[se],inject:["keys","selectedNodes","updateNode"],props:{node:{type:Object,required:!0,default:()=>({})}},emits:["checked"],data(){return{timeout:null}},computed:{selected(){return this.selectedNodes[this.node.key]},data(){return this.node.data}},methods:{clickNode(){this.$emit("checked")},updateHandler(){this.timeout&&(this.timeout=clearTimeout(this.timeout)),this.timeout=setTimeout(()=>{this.updateNode(this.node)},300)}}};function xv(e,t,s,n,r,o){const a=h("QuantityCell"),i=h("TableCellWrapper"),d=h("TableRowWrapper");return l(),w(d,{class:N(["values-row",{selected:o.selected}]),onClick:o.clickNode},{default:C(()=>[(l(!0),u(b,null,S(o.keys,_=>(l(),u(b,{key:_.id},[_.type===e.InputType.QUANTITY?(l(),w(a,{key:0,modelValue:o.data[_.id],"onUpdate:modelValue":[p=>o.data[_.id]=p,o.updateHandler]},null,8,["modelValue","onUpdate:modelValue"])):(l(),w(i,{key:1},{default:C(()=>[R($(o.data[_.id]),1)]),_:2},1024))],64))),128))]),_:1},8,["class","onClick"])}var Pv=g(Nv,[["render",xv],["__scopeId","data-v-2e1ce1f0"]]);const Ut={name:"TableGroup",components:{KeysRow:Rv,ValuesRow:Pv},inject:["keys","selectedNodes","pushNodes","removeNodes"],props:{node:{type:Object,required:!0,default:()=>({})},level:Number},emits:["selected","unselected"],data(){return{rowColors:["#268aad","#57abc8"]}},computed:{children(){return this.node.children},groupName(){return this.children&&this.children.length===0?null:this.node.data[this.keys[0].id]},rowBackground(){return this.rowColors[this.level]||"#fff"},rowColor(){return this.level>1?"#000":"#fff"}},methods:{getAllChildren(e){const{children:t}=e;return t&&t.length>0?[e,...e.children.map(this.getAllChildren)].flat():e},onSelect(){return this.pushNodes([this.node]),this.$emit("selected")},onUnselect(){const{children:e}=this.node;e.some(s=>this.selectedNodes[s.key])||(this.removeNodes([this.node]),this.$emit("unselected"))},onChecked(){return!this.selectedNodes[this.node.key]?(this.pushNodes([this.node]),this.$emit("selected")):(this.removeNodes([this.node]),this.$emit("unselected"))},checkGroup(){const e=!!this.selectedNodes[this.node.key],t=this.getAllChildren(this.node);if(!e)return this.pushNodes([this.node,...t]),this.$emit("selected");if(t.some(n=>!this.selectedNodes[n.key]))return this.pushNodes(t);this.removeNodes([this.node,...t]),this.$emit("unselected")}}},to=()=>{U(e=>({"89b6c9b0":e.level,edfc68f6:e.rowColor,b8f80368:e.rowBackground}))},so=Ut.setup;Ut.setup=so?(e,t)=>(to(),so(e,t)):to;const Av=Ut,Ev={class:"table-group"};function Bv(e,t,s,n,r,o){const a=h("KeysRow"),i=h("TableGroup",!0),d=h("ValuesRow");return l(),u("div",Ev,[o.children&&o.children.length>0?(l(),u(b,{key:0},[y(a,{name:o.groupName,showKeys:!s.level,class:"keys-row",onClick:o.checkGroup},null,8,["name","showKeys","onClick"]),(l(!0),u(b,null,S(o.children,_=>(l(),w(i,{key:_.key,node:_,level:s.level+1,onSelected:o.onSelect,onUnselected:o.onUnselect},null,8,["node","level","onSelected","onUnselected"]))),128))],64)):(l(),w(d,{key:1,node:s.node,onChecked:o.onChecked},null,8,["node","onChecked"]))])}var Mv=g(Av,[["render",Bv],["__scopeId","data-v-0525e4c2"]]);const Jv={components:{TableGroup:Mv},inject:["keys"],props:{data:{type:Array,required:!0}}},Kv={class:"jobs-table"},jv={class:"table-grid",ref:"wrapper"};function qv(e,t,s,n,r,o){const a=h("TableGroup");return l(),u("div",Kv,[c("div",jv,[(l(!0),u(b,null,S(s.data,i=>(l(),w(a,{key:i.key,node:i,level:0},null,8,["node"]))),128))],512)])}var Hv=g(Jv,[["render",qv],["__scopeId","data-v-01de033e"]]);const Uv={components:{Dialog:go,JobsTable:Hv,InputText:Oe},provide(){return{keys:Ne(()=>this.keysWithType),selectedNodes:Ne(()=>this.selectedNodes),pushNodes:this.pushNodes,removeNodes:this.removeNodes,updateNode:this.updateNodeInTable}},props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{loading:!1,initted:!1,tableData:null,filteredTableData:null,selectedNodes:{},keys:null,edition:null,search:""}},computed:f(m(m(m(m({},k("outlay",["outlay"])),k("edition",["editions"])),k("directory",["directories"])),k("acts",["act","activeRoom"])),{display:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},keysWithType(){if(!this.edition)return[];const{dirId:e}=this.edition,t=this.directories.find(r=>r._id===e),{keys:s}=t;return this.keys.map(r=>s.find(a=>a.id===r.id))},addButtonDisabled(){return!(Object.keys(this.selectedNodes).length>0)||this.loading}}),methods:f(m(m({},A("outlays",["update"])),A("acts",["setActsData","setOutlay"])),{onShow(){this.initTableData()},filterNodes(e,t){const{children:s}=e;return s.length===0?!0:(e.children=s.filter(t),e.children.length>0?(e.children=e.children.filter(n=>this.filterNodes(n,t)),e.children.length>0):!1)},createTableData(){if(!this.outlay)return;const e=JSON.parse(JSON.stringify(this.outlay)),t=e.rooms.find(I=>I.id===this.activeRoom.id),{jobs:s,newJobs:n}=t,o=[...s,...n].map(ee).flat(),i=X.exports.uniqBy(o,"key").map(I=>I.key),{edition:d}=e,_=this.editions.find(I=>I._id===d);this.edition=JSON.parse(JSON.stringify(_));const{data:p}=JSON.parse(JSON.stringify(_));this.tableData=p.children.filter(I=>this.filterNodes(I,O=>!i.includes(O.key)));const v=this.tableData.filter(I=>I.children.length>0);this.tableData=JSON.parse(JSON.stringify(v)),this.filteredTableData=JSON.parse(JSON.stringify(v)),this.keys=_.keys},initTableData(){this.createTableData(),this.initted=!0},pushNodes(e){e.forEach(t=>{this.selectedNodes[t.key]||(this.selectedNodes[t.key]=t)})},removeNodes(e){e.forEach(t=>{this.selectedNodes[t.key]&&delete this.selectedNodes[t.key]})},createTreeFromNodes(){const e=JSON.parse(JSON.stringify(this.tableData)),t=Object.keys(this.selectedNodes);return e.filter(n=>this.filterNodes(n,r=>t.includes(r.key)?(r.added=!0,!0):!1))},mergeNodes(e){const t=e.reduce((s,n)=>{s[n.key]=s[n.key]||[];const{children:r}=n,o=r.length>0?r:n;return s[n.key].push(o),s},{});return Object.entries(t).map(([s,n])=>{const r=e.find(a=>a.key===s),{children:o}=r;if(o&&o.length>0){const a=n.flat();return r.children=this.mergeNodes(a),r}return r})},async save(){this.loading=!0;try{const e=this.outlay.rooms.find(d=>d.id===this.activeRoom.id);if(!e)return this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:"\u041F\u0435\u0440\u0435\u0434 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435\u043C \u043D\u0443\u0436\u043D\u043E \u0432\u044B\u0431\u0440\u0430\u0442\u044C \u043A\u043E\u043C\u043D\u0430\u0442\u0443",life:3e3});const t=JSON.parse(JSON.stringify(e)),{newJobs:s}=t,n=JSON.parse(JSON.stringify(this.createTreeFromNodes())),r=this.mergeNodes([...n,...s].flat());t.newJobs=r;const o=JSON.parse(JSON.stringify(this.outlay)),a=o.rooms.map(d=>d.id===this.activeRoom.id?t:d),i=f(m({},o),{rooms:a});await this.update({id:i._id,data:i}),this.setActsData(),this.close()}catch(e){console.log(e)}finally{this.loading=!1}},close(){const{dialog:e}=this.$refs;e.close(),this.selectedNodes={},this.search=null},onInput(){if(this.timeout&&(this.timeout=clearTimeout(this.timeout)),!this.search){this.filteredTableData=JSON.parse(JSON.stringify(this.tableData));return}this.timeout=setTimeout(()=>{if(!this.search)return;const e=JSON.parse(JSON.stringify(this.tableData));this.filteredTableData=e.filter(t=>this.filterNodes(t,s=>{const{data:n,children:r}=s;if(r.length>0)return!0;const a=(n[this.keys[0].id]||"").toLowerCase(),i=this.search.toLowerCase();return a.includes(i)}))},1e3)},updateNode(e,t){const{key:s,children:n}=e,{key:r}=t;return s===r?t:(e.children=n.map(o=>this.updateNode(o,t)),e)},updateNodeInTable(e){this.tableData=this.tableData.map(t=>this.updateNode(t,e))}})},Wv=e=>(x("data-v-90638d9c"),e=e(),P(),e),Fv=Wv(()=>c("span",{class:"modal-title"},"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0440\u0430\u0431\u043E\u0442\u044B",-1)),Gv={key:0,class:"modal-body"},Qv={class:"search"},Zv=["disabled"],zv={key:0,class:"pi pi-spin pi-spinner"},Yv=R(" \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C "),Xv=["disabled"];function eg(e,t,s,n,r,o){const a=h("InputText"),i=h("JobsTable"),d=h("Dialog");return l(),w(d,{visible:o.display,"onUpdate:visible":t[3]||(t[3]=_=>o.display=_),ref:"dialog",style:{width:"70vw"},modal:!0,draggable:!1,closeOnEscape:!1,closable:!o.addButtonDisabled,onShow:o.onShow},{header:C(()=>[Fv]),footer:C(()=>[c("button",{class:"button save-button",disabled:o.addButtonDisabled,onClick:t[1]||(t[1]=(..._)=>o.save&&o.save(..._))},[r.loading?(l(),u("i",zv)):T("",!0),Yv],8,Zv),c("button",{class:"button cancel-button",disabled:r.loading,onClick:t[2]||(t[2]=(..._)=>o.close&&o.close(..._))}," \u041E\u0442\u043C\u0435\u043D\u0430 ",8,Xv)]),default:C(()=>[r.initted?(l(),u("div",Gv,[c("div",Qv,[y(a,{modelValue:r.search,"onUpdate:modelValue":t[0]||(t[0]=_=>r.search=_),class:"search-input",placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0440\u0430\u0431\u043E\u0442\u044B",onInput:o.onInput},null,8,["modelValue","onInput"])]),y(i,{data:r.filteredTableData},null,8,["data"])])):T("",!0)]),_:1},8,["visible","closable","onShow"])}var tg=g(Uv,[["render",eg],["__scopeId","data-v-90638d9c"]]);const sg={components:{AutoComplete:yo,InputSwitch:fo,RoomTable:dn,OutlayBlock:re,CompletedTable:Dy,ActsTable:Yf,OutlayTable:bv,AddModal:tg},data(){return{screenHeight:null,selectedJob:null,filteredJobs:[],displayModal:!1}},computed:f(m(m({},k("outlay",["selectedRoom","roots","outlay","roomsData","keys","rooms","selectedValues","showResults"])),k("acts",["activeTab","activeRoom","act","actsData","showOnlyCompleted"])),{striped:{get(){return this.$store.getters["outlay/striped"]},set(e){this.setStriped(e)}},changeView:{get(){return this.$store.getters["acts/changeView"]},set(e){this.setChangeView(e)}},showLeftQuantity:{get(){return this.$store.getters["acts/showLeftQuantity"]},set(e){this.setShowLeftQuantity(e)}},scrollHeight(){return`${this.screenHeight-100}px`},jobs(){if(!this.activeTab)return[];if(!this.activeRoom){const s=JSON.parse(JSON.stringify(this.act.rooms)).reduce((o,a)=>(o[a.id]=a.jobs,o),{});return[...this.rooms].reverse().map(o=>({key:o.id,data:{[this.keys[0].id]:o.name},name:o.name,children:s[o.id]})).map(o=>this.getGroupsWithRoom(o,null,o.key)).flat()}if(this.showOnlyCompleted){const s=this.act.rooms.find(r=>r.id===this.activeRoom.id),{jobs:n}=JSON.parse(JSON.stringify(s));return n.map(r=>this.getGroups(r,null)).flat()}const e=this.actsData[this.act._id][this.activeRoom.id].flat();return JSON.parse(JSON.stringify(e)).map(s=>this.getGroups(s,null)).flat()},addButtonDisabled(){return!this.activeRoom||this.act.status===oe.CONFIRMED}}),watch:{activeTab(){this.windowResize(),this.setSelectedItem(null)},activeRoom(){this.setSelectedItem(null)},outlay(){this.windowResize()}},mounted(){this.windowResize(),window.addEventListener("resize",this.windowResize)},unmounted(){window.removeEventListener("resize",this.windowResize)},methods:f(m(m({},B("outlay",["setStriped"])),B("acts",["setChangeView","setSelectedItem","setShowLeftQuantity"])),{async windowResize(){if(!this.outlay)return;await this.$nextTick();const{autocomplete:e}=this.$refs,{top:t}=e.$el.getBoundingClientRect();this.screenHeight=window.innerHeight-t},getGroupsWithRoom(e,t=null,s){const{children:n,key:r,data:o}=e;if(n&&n.length>0){e.parent=t;const a=f(m({},e),{name:o[this.keys[0].id],items:[],roomId:s}),i=e.children.map(_=>this.getGroupsWithRoom(_,r,s)).flat();if(z(n[0].key))return[m({},a),...i];const d=e.children;return[f(m({},a),{items:d.map(_=>f(m({},_),{name:_.data[this.keys[0].id],roomId:s}))}),...i]}return[]},getGroups(e,t){const{children:s,key:n,data:r}=e;if(s&&s.length>0){e.parent=t;const o=f(m({},e),{name:r[this.keys[0].id],items:[]}),a=e.children.map(i=>this.getGroups(i,n)).flat();return z(s[0].key)?[m({},o),...a]:[f(m({},o),{items:e.children.map(i=>f(m({},i),{name:i.data[this.keys[0].id]}))}),...a]}return[]},getParentsOfNode(e){const t=this.jobs.find(s=>s.key===e);return t?t.parent?[this.getParentsOfNode(t.parent),t]:[t]:[]},getParentsOfRoom(e,t){const s=this.jobs.find(n=>n.key===t&&n.roomId===e);return s.parent?[this.getParentsOfRoom(e,s.parent),s]:[s]},async searchJob(e){const t=e.query,s=[];for(const r of this.jobs){const o=r.items.filter(a=>a.name.toLowerCase().includes(t.toLowerCase()));o&&o.length&&((this.selectedRoom?this.getParentsOfNode(r.parent):this.getParentsOfRoom(r.roomId,r.parent).flat()).forEach(i=>{s.push(i)}),s.push(f(m({},r),{items:o})))}if(this.selectedRoom)return this.filteredJobs=X.exports.uniqBy(s,"key");const n=s.reduce((r,o)=>(r[o.roomId]=r[o.roomId]||[],r[o.roomId].push(o),r),{});this.filteredJobs=Object.values(n).reduce((r,o)=>{const a=X.exports.uniqBy(o,"key");return[...r,...a]},[])},async findJob(e){const t=e.value.key,s=e.value.roomId,{table:n,autocomplete:r}=this.$refs,o=r.$el.querySelector("input");if(o&&(await this.$nextTick(),o.blur()),this.activeRoom)return this.setSelectedItem({id:t,room:this.activeRoom.id}),n.scrollTo(t);this.setSelectedItem({id:t,room:s}),n.scrollTo(s,t)},autoCompleteClickHanler(){this.selectedJob=null},autocompleteInput(){this.$refs.autocomplete.hideOverlay()},selectRow(e){const{target:t}=e,s=t.closest(".table-row");if(!s)return;const{dataset:{id:n,room:r}}=s;this.setSelectedItem({id:n,room:r})},openModal(){if(!this.activeRoom)return this.$toast.add({severity:"warn",summary:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043E\u043C\u043D\u0430\u0442\u0443",detail:"\u041F\u0435\u0440\u0435\u0434 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435\u043C \u043D\u0443\u0436\u043D\u043E \u0432\u044B\u0431\u0440\u0430\u0442\u044C \u043A\u043E\u043C\u043D\u0430\u0442\u0443",life:3e3});this.displayModal=!0}})},Ge=e=>(x("data-v-5da0ae8c"),e=e(),P(),e),og={key:0,class:"center__body"},ng={key:0,class:"body-actions"},rg={class:"body-actions__top"},ag={class:"search-wrapper"},ig=Ge(()=>c("i",{class:"pi pi-search"},null,-1)),lg=["disabled"],dg={class:"body-actions__group"},cg={class:"switch-wrapper"},ug={class:"switch"},_g=Ge(()=>c("span",null,"\u0427\u0435\u0440\u0435\u0434\u043E\u0432\u043D\u0438\u0435 \u0446\u0432\u0435\u0442\u043E\u0432",-1)),hg={key:0,class:"switch-wrapper"},mg={class:"switch"},pg=Ge(()=>c("span",null,"\u0412\u0441\u0435\u0433\u043E / \u041E\u0441\u0442\u0430\u043B\u043E\u0441\u044C",-1)),yg={key:1,class:"switch-wrapper"},fg={class:"switch"},vg=Ge(()=>c("span",null,"\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0432\u0438\u0434",-1));function gg(e,t,s,n,r,o){const a=h("AddModal"),i=h("AutoComplete"),d=h("InputSwitch"),_=h("CompletedTable"),p=h("ActsTable"),v=h("OutlayTable"),I=h("RoomTable"),O=h("OutlayBlock");return l(),w(O,{class:"center"},{default:C(()=>[e.outlay?(l(),u("div",og,[y(a,{modelValue:r.displayModal,"onUpdate:modelValue":t[0]||(t[0]=L=>r.displayModal=L)},null,8,["modelValue"]),e.showResults?T("",!0):(l(),u("div",ng,[c("div",rg,[c("div",ag,[ig,y(i,{modelValue:r.selectedJob,"onUpdate:modelValue":t[1]||(t[1]=L=>r.selectedJob=L),ref:"autocomplete",class:"search",field:"name",optionGroupLabel:"name",optionGroupChildren:"items",scrollHeight:o.scrollHeight,suggestions:r.filteredJobs,placeholder:"\u041F\u043E\u0438\u0441\u043A",delay:300,onInput:o.autocompleteInput,onComplete:t[2]||(t[2]=L=>o.searchJob(L)),onItemSelect:o.findJob,onClick:o.autoCompleteClickHanler},null,8,["modelValue","scrollHeight","suggestions","onInput","onItemSelect","onClick"])]),c("button",{class:"body-actions__button button",disabled:o.addButtonDisabled,onClick:t[3]||(t[3]=(...L)=>o.openModal&&o.openModal(...L))}," \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0440\u0430\u0431\u043E\u0442\u0443 ",8,lg)]),c("div",dg,[c("div",cg,[c("div",ug,[y(d,{modelValue:o.striped,"onUpdate:modelValue":t[4]||(t[4]=L=>o.striped=L)},null,8,["modelValue"])]),_g]),e.activeTab==="room"||e.activeTab==="completed"?(l(),u("div",hg,[c("div",mg,[y(d,{modelValue:o.showLeftQuantity,"onUpdate:modelValue":t[5]||(t[5]=L=>o.showLeftQuantity=L)},null,8,["modelValue"])]),pg])):e.activeTab==="results"?(l(),u("div",yg,[c("div",fg,[y(d,{modelValue:o.changeView,"onUpdate:modelValue":t[6]||(t[6]=L=>o.changeView=L)},null,8,["modelValue"])]),vg])):T("",!0)])])),c("div",{class:"tables-wrapper",onClick:t[7]||(t[7]=(...L)=>o.selectRow&&o.selectRow(...L))},[e.activeTab==="completed"?(l(),w(_,{key:0,ref:"table"},null,512)):e.activeTab==="acts"?(l(),w(p,{key:1,ref:"table"},null,512)):e.activeTab==="results"?(l(),w(v,{key:2,ref:"table"},null,512)):e.activeTab==="room"&&e.activeRoom?(l(),w(I,{key:3,room:e.activeRoom,ref:"table"},null,8,["room"])):T("",!0)])])):T("",!0)]),_:1})}var bg=g(sg,[["render",gg],["__scopeId","data-v-5da0ae8c"]]);const wg={name:"CategoryItem",components:{TriangleIcon:Bo},props:{category:{type:Object,required:!0}},data(){return{showChildren:!1}},computed:{sum(){return E(this.category.sum)},jobs(){return this.category.jobs.filter(s=>{const{id:n}=s;return z(n)}).filter(s=>s.sum).map(s=>f(m({},s),{sum:E(s.sum)}))}}},$g={class:"category-item"},kg={class:"category-item__head"},Cg=["title"],Ig={class:"category-item__price"},Sg={key:0,class:"category-item__list"},Og={class:"category-item__head"},Tg=["title"],Rg={class:"category-item__price"};function Vg(e,t,s,n,r,o){const a=h("TriangleIcon");return l(),u("div",$g,[c("div",kg,[c("div",{class:"category-item__text",onClick:t[0]||(t[0]=i=>r.showChildren=!r.showChildren)},[c("button",{class:N(["button",{rotated:r.showChildren,hidden:o.jobs.length===0}])},[y(a,{class:"button__icon"})],2),c("span",{class:"category-item__name",title:s.category.name},$(s.category.name),9,Cg)]),c("span",Ig,$(o.sum),1)]),o.jobs&&o.jobs.length>0&&r.showChildren?(l(),u("div",Sg,[(l(!0),u(b,null,S(o.jobs,i=>(l(),u("div",{key:i.key,class:"category-item"},[c("div",Og,[c("span",{class:"category-item__name",title:i.name},$(i.name),9,Tg),c("span",Rg,$(i.sum.toLocaleString()),1)])]))),128))])):T("",!0)])}var Lg=g(wg,[["render",Vg],["__scopeId","data-v-47d2d714"]]);const Dg={name:"CategoryList",components:{CategoryItem:Lg},props:{categories:{type:Array,required:!0}},computed:f(m({},k("acts",["activeRoom","changeView"])),{categoryList(){return this.changeView?this.categories[0].jobs.filter(e=>e.sum):this.activeRoom?this.categories.find(t=>t.id===this.activeRoom.id).jobs.filter(t=>t.sum):[...this.categories].reverse()}})},Ng={class:"category-list"};function xg(e,t,s,n,r,o){const a=h("CategoryItem");return l(),u("div",Ng,[(l(!0),u(b,null,S(o.categoryList,i=>(l(),w(a,{key:i.id,category:i},null,8,["category"]))),128))])}var Pg=g(Dg,[["render",xg],["__scopeId","data-v-64e16e68"]]);const Ag={props:{data:{type:Array,required:!0}},computed:f(m({},k("acts",["actsData"])),{totalSum(){return this.data.reduce((e,t)=>e+ +t.sum,0)},totalSumFormatted(){return E(this.totalSum)}}),methods:f(m(m({},B("outlay",["setSale"])),A("outlay",["saveLocaly"])),{findCategoriesWithoutSale(e){const{name:t,jobs:s}=e;let n=[];if(Ct.includes(t)&&n.push(e),s){const r=s.map(this.findCategoriesWithoutSale).flat();n=[...n,...r]}return n}})},Eg={class:"results"},Bg=R(" \u0418\u0422\u041E\u0413\u041E: "),Mg={class:"result result--sale"};function Jg(e,t,s,n,r,o){return l(),u("div",Eg,[c("span",null,[Bg,c("span",Mg,$(o.totalSumFormatted),1)])])}var Kg=g(Ag,[["render",Jg],["__scopeId","data-v-3f383b98"]]);const jg={props:{name:{required:!0,type:String},value:{required:!0}}},qg={class:"parameter"},Hg={class:"parameter__name"},Ug=["value"];function Wg(e,t,s,n,r,o){return l(),u("div",qg,[c("label",Hg,$(s.name),1),c("input",{value:s.value,disabled:"",class:"parameter__input"},null,8,Ug)])}var mn=g(jg,[["render",Wg],["__scopeId","data-v-6bd70964"]]);const Fg={components:{ParameterItem:mn},mixins:[ie],props:{parametersData:{type:Object,default(){return{}}}}},Gg={class:"computed-parameters"};function Qg(e,t,s,n,r,o){const a=h("ParameterItem");return l(),u("div",Gg,[y(a,{name:"S \u043F\u043E\u043B\u0430",value:s.parametersData[e.roomOptions.floorArea]},null,8,["value"]),y(a,{name:"S \u0441\u0442\u0435\u043D",value:s.parametersData[e.roomOptions.wallArea]},null,8,["value"]),y(a,{name:"\u041F\u0435\u0440\u0438\u043C\u0435\u0442\u0440",value:s.parametersData[e.roomOptions.perimeter]},null,8,["value"])])}var pn=g(Fg,[["render",Qg],["__scopeId","data-v-55842e46"]]);const Zg={components:{ParameterItem:mn},props:{parameters:{type:Object,default(){return{}}}}},zg={class:"room-options"};function Yg(e,t,s,n,r,o){const a=h("ParameterItem");return l(),u("div",zg,[(l(!0),u(b,null,S(s.parameters,(i,d)=>(l(),w(a,{key:d,name:d,value:i},null,8,["name","value"]))),128))])}var Xg=g(Zg,[["render",Yg],["__scopeId","data-v-01aebbae"]]);const e1={components:{RoomParameters:Xg,ComputedParameters:pn},mixins:[ie],computed:f(m({},k("acts",["activeRoom"])),{parameters(){return this.activeRoom.options},allParameters(){const e=this.calculateAllParameters(this.parameters);return Object.keys(e).reduce((t,s)=>(t[s]=Object.entries(e[s]).reduce((n,[r,o])=>(n[r]=E(o),n),{}),t),{})}})},t1={class:"title"},s1={class:"groups"};function o1(e,t,s,n,r,o){const a=h("RoomParameters",!0),i=h("ComputedParameters");return l(),u(b,null,[c("span",t1,$(e.activeRoom.name),1),c("div",s1,[y(a,{parameters:o.allParameters.options},null,8,["parameters"]),y(i,{parametersData:o.allParameters.computed},null,8,["parametersData"])])],64)}var n1=g(e1,[["render",o1],["__scopeId","data-v-c6358858"]]);const r1={components:{ComputedParameters:pn},mixins:[ie,se],computed:f(m(m({},k("outlay",["rooms"])),k("directory",["roomDirectory"])),{roomsWithOptions(){const{keys:e}=this.roomDirectory,t=e.find(n=>n.type===this.InputType.BOOLEAN_ROOM_PARAMETERS),s=e.find(n=>n.type===this.InputType.BOOLEAN_ROOM_COMPUTED);return this.rooms.filter(n=>{const{dirId:r}=n;if(!r)return!0;const o=this.roomDirectory.values.find(a=>a.id===r);return!(!o.data[t.id]||!o.data[s.id])})},totalComputedParameters(){return this.roomsWithOptions.reduce((e,t)=>{const{options:s}=t,{computed:n}=this.calculateAllParameters(s);return this.sumParameters(e,n)},{})}}),methods:{sumParameters(e,t){return Object.entries(t).reduce((s,[n,r])=>{const o=r+(e[n]||0);return s[n]=o,s},{})}}},a1=e=>(x("data-v-7ecbdf66"),e=e(),P(),e),i1=a1(()=>c("span",{class:"title"}," \u0418\u0442\u043E\u0433\u043E\u0432\u044B\u0435 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B ",-1));function l1(e,t,s,n,r,o){const a=h("ComputedParameters");return l(),u(b,null,[i1,y(a,{parametersData:o.totalComputedParameters},null,8,["parametersData"])],64)}var d1=g(r1,[["render",l1],["__scopeId","data-v-7ecbdf66"]]);const c1={components:{OutlayBlock:re,RoomParameters:n1,TotalParameters:d1},computed:m({},k("acts",["activeRoom","activeTab"]))},u1={class:"parameters"};function _1(e,t,s,n,r,o){const a=h("RoomParameters"),i=h("TotalParameters"),d=h("OutlayBlock");return l(),w(d,null,{default:C(()=>[c("div",u1,[e.activeTab==="room"&&e.activeRoom&&e.activeRoom.options?(l(),w(a,{key:0})):e.activeRoom?T("",!0):(l(),w(i,{key:1}))])]),_:1})}var h1=g(c1,[["render",_1],["__scopeId","data-v-4fdb984a"]]);const m1={components:{CategoryList:Pg,ResultsForm:Kg,ParameterList:h1,OutlayBlock:re,CollapseBlock:Fe},computed:f(m(m(m({},Ce("outlay",["selectedValues"])),k("outlay",["outlay","rooms","roomsData","quantityKey","priceKey","keys","selectedRoom","currentRoomData"])),k("acts",["actsData","act","acts","activeRoom","activeTab","changeView"])),{showRightSide:{get(){return this.$store.getters["acts/showRightSide"]},set(e){return this.setShowRightSide(e)}},croppedActs(){const e=this.acts.findIndex(t=>t._id===this.act._id);return[...this.acts].slice(0,e+1)},completed(){return this.rooms.reduce((e,t)=>{const n=(this.activeTab==="completed"?[this.act]:this.croppedActs).map(o=>JSON.parse(JSON.stringify(this.actsData[o._id][t.id])).filter(_e).map(ye).flat()).flat(),r=new Set(n);return e[t.id]=[...r],e},{})},data(){if(this.rooms.length===0)return[];if(this.activeRoom){const s=JSON.parse(JSON.stringify(this.actsData[this.act._id][this.activeRoom.id])),n=JSON.parse(JSON.stringify(this.activeRoom));return[this.getRoomWithSum(n,s)]}if(this.activeTab==="completed")return[...this.rooms].map(n=>{const r=JSON.parse(JSON.stringify(this.actsData[this.act._id][n.id]));return this.getRoomWithSum(n,r)});const e=this.getDataWithRoom();if(this.changeView){const s=JSON.parse(JSON.stringify(this.rooms[0])),n=this.getDataWithCategories(e);return[this.getRoomWithSum2(s,n)]}return[...this.rooms].map(s=>{const n=e[s.id];return this.getRoomWithSum(s,n)})},roomsData(){const t=JSON.parse(JSON.stringify(this.croppedActs)).reduce((s,n)=>(this.rooms.forEach(r=>{const o=JSON.parse(JSON.stringify(this.actsData[n._id][r.id]));if(s[r.id]){s[r.id]=[...s[r.id],...o];return}s[r.id]=o}),s),{});return Object.entries(t).reduce((s,[n,r])=>{const o=this.mergeChildren(r);return s[n]=o,s},{})}}),methods:f(m({},B("acts",["setShowRightSide"])),{mergeChildren(e){const t=e.reduce((s,n)=>{s[n.key]=s[n.key]||[];const{children:r}=n,o=r.length>0?r:n;return s[n.key].push(o),s},{});return e&&e.length>0&&e[0].children.length===0?Object.values(t).map(this.sumQuantities):Object.entries(t).map(([s,n])=>{const r=e.find(a=>a.key===s),{children:o}=r;if(o&&o.length>0){const a=n.flat();return r.children=this.mergeChildren(a),r}return r})},treeToListOnlyValues(e){const{children:t,key:s}=e,n=t.map(this.treeToListOnlyValues).flat();return z(s)?n:[e]},getSelectedItems(e,t){return e.filter(s=>t.includes(s.key))},getSubCategoriesWithSum(e,t){return e.map(s=>{const n=this.treeToListOnlyValues(s),o=this.getSelectedItems(n,t).reduce((a,i)=>{const d=i.data.quantity*i.data[this.priceKey.id];return a+d},0);return{id:s.key,name:s.data[this.keys[0].id],sum:o}})},getSum(e){return e.reduce((t,s)=>t+=+s.sum,0)},getRoomWithSum(e,t){const s=this.croppedActs.map(a=>this.completed[e.id]).flat(),r=this.getSelectedItems(t,s).map(a=>{const i=this.getSelectedItems(a.children,s),d=this.getSubCategoriesWithSum(i,s),_=this.getSum(d);return{id:a.key,name:a.data[this.keys[0].id],sum:_,jobs:d}}),o=this.getSum(r);return{id:e.id,name:e.name,jobs:r,sum:o}},getRoomWithSum2(e,t){const s=t.map(ye).flat(),r=this.getSelectedItems(t,s).map(a=>{const i=this.getSelectedItems(a.children,s),d=this.getSubCategoriesWithSum(i,s),_=this.getSum(d);return{id:a.key,name:a.data[this.keys[0].id],sum:_,jobs:d}}),o=this.getSum(r);return{id:e.id,name:e.name,jobs:r,sum:o}},sumQuantities(e){return e.reduce((s,n)=>{if(!Object.keys(s).length)return n;const{data:r}=s,{data:o}=n,a=r.quantity+o.quantity,i=f(m({},r),{quantity:a});return f(m({},s),{data:i})},{})},updateNodesInTree(e,t){const{key:s,children:n}=e,r=t.find(o=>o.key===s);return r||(n&&n.length>0&&(e.children=n.map(o=>this.updateNodesInTree(o,t))),e)},getDataWithRoom(){return this.rooms.reduce((e,t)=>{const r=this.roomsData[t.id].flat().reduce((d,_)=>{const p=ee(_);return[...d,...p]},[]).reduce((d,_)=>(d[_.key]=d[_.key]||[],d[_.key].push(_),d),{}),o=Object.values(r).map(d=>d.reduce((p,v)=>{if(!Object.keys(p).length)return v;const{data:I}=p,{data:O}=v,L=I.quantity+O.quantity,D=f(m({},I),{quantity:L});return f(m({},p),{data:D})},{})),i=JSON.parse(JSON.stringify(this.roomsData[t.id])).map(d=>this.updateNodesInTree(d,o)).flat();return e[t.id]=i,e},{})},getDataWithCategories(e){const t=JSON.parse(JSON.stringify(e)),s=Object.values(t).flat();return this.mergeChildren(s)}})},p1={class:"wrapper"};function y1(e,t,s,n,r,o){const a=h("CollapseBlock"),i=h("ParameterList"),d=h("CategoryList"),_=h("ResultsForm"),p=h("OutlayBlock");return l(),u("div",p1,[y(a,{modelValue:o.showRightSide,"onUpdate:modelValue":t[0]||(t[0]=v=>o.showRightSide=v),position:"right"},null,8,["modelValue"]),y(i,{class:"wrapper__parameters"}),y(p,{class:"wrapper__results"},{default:C(()=>[y(d,{categories:o.data},null,8,["categories"]),y(_,{data:o.data},null,8,["data"])]),_:1})])}var f1=g(m1,[["render",y1],["__scopeId","data-v-f2c2b58c"]]);const v1={},g1={version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"405.272px",height:"405.272px",viewBox:"0 0 405.272 405.272",style:{"enable-background":"new 0 0 405.272 405.272"},"xml:space":"preserve"},b1=c("g",null,[c("path",{d:`M393.401,124.425L179.603,338.208c-15.832,15.835-41.514,15.835-57.361,0L11.878,227.836\r
		c-15.838-15.835-15.838-41.52,0-57.358c15.841-15.841,41.521-15.841,57.355-0.006l81.698,81.699L336.037,67.064\r
		c15.841-15.841,41.523-15.829,57.358,0C409.23,82.902,409.23,108.578,393.401,124.425z`})],-1),w1=[b1];function $1(e,t){return l(),u("svg",g1,w1)}var k1=g(v1,[["render",$1]]);const C1={components:{CategoryRow:Uo,RowWrapper:Ee,CellWrapper:Be},props:{tableKeys:{type:Array,required:!0},tableData:{type:Array,required:!0},room:{type:Object,required:!0}},computed:f(m({},k("outlay",["quantityKey","priceKey"])),{sum(){const t=this.tableData.map(ee).flat().reduce((s,n)=>{const{data:r}=n;return s+=r.quantity*r[this.priceKey.id],s},0);return E(t)}})},I1={class:"print-table"},S1=["width"];function O1(e,t,s,n,r,o){const a=h("CategoryRow"),i=h("CellWrapper"),d=h("RowWrapper");return l(),u("table",I1,[(l(!0),u(b,null,S(s.tableKeys,(_,p)=>(l(),u("col",{key:_.id,width:p===0?"50%":"100px"},null,8,S1))),128)),(l(!0),u(b,null,S(s.tableData,_=>(l(),w(a,{key:_.key,node:_},null,8,["node"]))),128)),y(d,null,{default:C(()=>[y(i,{result:"",colspan:s.tableKeys.length},{default:C(()=>[R(" \u0418\u0442\u043E\u0433\u043E \u043F\u043E \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u044E ("+$(s.room.name)+") ",1)]),_:1},8,["colspan"]),y(i,{result:""},{default:C(()=>[R($(o.sum),1)]),_:1})]),_:1})])}var T1=g(C1,[["render",O1],["__scopeId","data-v-984d7c50"]]);const R1={components:{AppLogo:Te},mixins:[ie],props:{room:{type:Object,required:!0},act:{type:Object,required:!0}},computed:{options(){return this.room.options},parameterKeys(){const e={[Z.length]:"\u0414\u043B\u0438\u043D\u0430, \u043C/\u043F",[Z.width]:"\u0428\u0438\u0440\u0438\u043D\u0430, \u043C/\u043F",[Z.height]:"\u0412\u044B\u0441\u043E\u0442\u0430, \u043C/\u043F",[Z.spaces]:"\u041F\u0440\u043E\u0435\u043C, \u043C2"};return Object.entries(e).map(([t,s])=>{const n=Object.keys(Z).find(r=>Z[r]===t);return{text:s,key:n}})},calculatedParameters(){return this.options?this.calculateAllParameters(this.options):0},calculated(){return this.calculatedParameters?this.calculatedParameters.computed:{}},calculatedOptions(){if(!this.calculatedParameters)return{};const{options:e}=this.calculatedParameters;return Object.entries(e).reduce((t,[s,n])=>{const r=Object.keys(this.roomOptions).find(o=>this.roomOptions[o]===s);return t[r]=n,t},{})}}},Je=e=>(x("data-v-7fdc9092"),e=e(),P(),e),V1={class:"page-header"},L1={class:"top"},D1=Je(()=>c("div",{class:"top__text"},[c("span",{class:"top__phone"}," 8 (495) 104-51-21 "),c("span",{class:"top__subtext"},"\u0441\u043B\u0443\u0436\u0431\u0430 \u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u043E\u0433\u043E \u043A\u043E\u043D\u0442\u0440\u043E\u043B\u044F")],-1)),N1=Je(()=>c("div",{class:"address"},[c("span",{class:"text"}," \u0410\u0434\u0440\u0435\u0441 \u043E\u0431\u044A\u0435\u043A\u0442\u0430: "),c("div",{class:"underline"})],-1)),x1={class:"row"},P1={class:"row-text"},A1=Je(()=>c("span",{class:"application"},"\u041F\u043E \u0434\u043E\u0433\u043E\u0432\u043E\u0440\u0443 \u2116\u041A\u0421 62190 \u043E\u0442 30.11.2021\u0433.",-1)),E1={class:"date"},B1=Je(()=>c("div",{class:"date__space"},null,-1)),M1=R(' " '),J1=Je(()=>c("div",{class:"date__underline"},null,-1)),K1=R(" 2022 "),j1={key:0,class:"parameters"},q1={class:"parameters-table"},H1={class:"parameters-table__row"},U1={class:"parameters-table__row"},W1={class:"parameters-table"},F1={class:"parameters-table__row"},G1={class:"parameters-table__row"};function Q1(e,t,s,n,r,o){const a=h("AppLogo");return l(),u("div",V1,[c("div",L1,[y(a,{class:"top__logo"}),D1]),N1,c("div",x1,[c("div",P1,[A1,c("span",E1,[R($(s.act.name)+' \u043E\u0442 " ',1),B1,M1,J1,K1])]),o.options?(l(),u("div",j1,[c("table",q1,[c("tr",H1,[(l(!0),u(b,null,S(o.parameterKeys,i=>(l(),u("td",{key:i.key,class:"parameters-table__cell"},$(i.text),1))),128))]),c("tr",U1,[(l(!0),u(b,null,S(o.parameterKeys,i=>(l(),u("td",{key:i.key,class:"parameters-table__cell"},$(o.calculatedOptions[i.key]),1))),128))])]),c("table",W1,[c("tr",F1,[(l(!0),u(b,null,S(o.calculated,(i,d)=>(l(),u("td",{key:d,class:"parameters-table__cell"},$(d),1))),128))]),c("tr",G1,[(l(!0),u(b,null,S(o.calculated,(i,d)=>(l(),u("td",{key:d,class:"parameters-table__cell"},$(i),1))),128))])])])):T("",!0)])])}var Z1=g(R1,[["render",Q1],["__scopeId","data-v-7fdc9092"]]);const z1={components:{PrintTable:T1,PageHeader:Z1},props:{act:{required:!0,type:Object}},emits:["mounted"],computed:f(m(m({},k("outlay",["keys","outlay","quantityKey"])),k("acts",["actsData"])),{tableKeys(){return[...this.keys,{id:"\u0421\u0443\u043C\u043C\u0430",name:"\u0421\u0443\u043C\u043C\u0430"}]},tableData(){return[...this.outlay.rooms].reverse()},roomData(){return JSON.parse(JSON.stringify(Object.entries(this.actsData[this.act._id]))).reduce((t,[s,n])=>{const r=n.filter(_e);return r.forEach(this.replaceQuantity),t[s]=r,t},{})}}),mounted(){this.$emit("mounted")},methods:{replaceQuantity(e){const{data:t,children:s}=e;s&&s.length>0&&s.forEach(this.replaceQuantity);const{quantity:n}=t;n&&(e.data[this.quantityKey.id]=n)}}},Y1={class:"container"},X1={class:"title"},eb=_t('<div class="text" data-v-cfc4bf86><p data-v-cfc4bf86>\u0412\u044B\u0448\u0435\u043F\u0435\u0440\u0435\u0447\u0438\u0441\u043B\u0435\u043D\u043D\u044B\u0435 \u0443\u0441\u043B\u0443\u0433\u0438 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u044B \u043F\u043E\u043B\u043D\u043E\u0441\u0442\u044C\u044E \u0438 \u0432 \u0441\u0440\u043E\u043A.</p><p data-v-cfc4bf86> \u0417\u0430\u043A\u0430\u0437\u0447\u0438\u043A \u043F\u0440\u0435\u0442\u0435\u043D\u0437\u0438\u0439 \u043F\u043E \u043E\u0431\u044A\u0435\u043C\u0443, \u043A\u0430\u0447\u0435\u0441\u0442\u0432\u0443 \u0438 \u0441\u0440\u043E\u043A\u0430\u043C \u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F \u0443\u0441\u043B\u0443\u0433 \u043D\u0435 \u0438\u043C\u0435\u0435\u0442. </p></div><div class="signs" data-v-cfc4bf86><span class="sign" data-v-cfc4bf86> \u0421\u0434\u0430\u043B: <div class="sign__underline" data-v-cfc4bf86></div><span data-v-cfc4bf86>/</span><div class="sign__underline sign__underline--full" data-v-cfc4bf86></div></span><div class="sign" data-v-cfc4bf86> \u041F\u0440\u0438\u043D\u044F\u043B: <div class="sign__underline" data-v-cfc4bf86></div><span data-v-cfc4bf86>/</span><div class="sign__underline sign__underline--full" data-v-cfc4bf86></div></div></div>',2);function tb(e,t,s,n,r,o){const a=h("PageHeader"),i=h("PrintTable");return l(),u("div",Y1,[(l(!0),u(b,null,S(o.tableData,d=>(l(),u("div",{class:"room",key:d.id},[y(a,{act:s.act,room:d},null,8,["act","room"]),c("span",X1,$(d.name),1),y(i,{tableKeys:e.keys,tableData:o.roomData[d.id],room:d},null,8,["tableKeys","tableData","room"]),eb]))),128))])}var yn=g(z1,[["render",tb],["__scopeId","data-v-cfc4bf86"]]);const sb={components:{BackIcon:Ko,SaveIcon:jo,DownloadIcon:qo,PrintIcon:Ho,PrintPage:yn,OutlayBlock:re,ConfirmIcon:k1},data(){return{isSaving:!1,isInConfirmation:!1,isDownloading:!1,isPrinting:!1}},computed:f(m(m({},k("outlay",["outlay"])),k("acts",["act"])),{actions(){return[{text:"\u041D\u0430\u0437\u0430\u0434",handler:()=>{this.setAct(null),this.$router.push("/")},icon:"BackIcon",disabled:!1,loading:!1},{text:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",handler:()=>{this.saveHandler()},icon:"SaveIcon",disabled:this.isSaving,loading:this.isSaving},{text:"\u0421\u043E\u0433\u043B\u0430\u0441\u043E\u0432\u0430\u043D\u0438\u0435",handler:this.confirm,icon:"ConfirmIcon",disabled:this.act.status===oe.CONFIRMED,loading:this.isInConfirmation},{text:"\u0421\u043A\u0430\u0447\u0430\u0442\u044C",handler:this.download,icon:"DownloadIcon",disabled:this.isDownloading||this.act.status!==oe.CONFIRMED,loading:this.isDownloading},{text:"\u0420\u0430\u0441\u043F\u0435\u0447\u0430\u0442\u0430\u0442\u044C",handler:this.printHandler,icon:"PrintIcon",disabled:this.isPrinting,loading:!1}]}}),mounted(){window.addEventListener("afterprint",this.afterPrint),window.addEventListener("keydown",this.keydownHandler)},unmounted(){window.removeEventListener("afterprint",this.afterPrint),window.removeEventListener("keydown",this.keydownHandler)},methods:f(m({},A("acts",["save","setAct","update","print"])),{async saveHandler(){try{this.isSaving=!0,await this.save()}catch(e){const{response:t}=e,s=t?t.data.message:e.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:s,life:3e3})}finally{this.isSaving=!1}},async confirm(){this.isInConfirmation=!0;try{const e=f(m({},this.act),{status:oe.CONFIRMED});await this.update({id:e._id,data:e})}catch(e){const{response:t}=e,s=t?t.data.message:e.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:s,life:3e3})}finally{this.isInConfirmation=!1}},async download(){if(!!this.act){this.isDownloading=!0;try{await this.save(),await this.print(this.act._id),await Qo("act",this.act.name)}catch(e){const{response:t}=e,s=t?t.data.message:e.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:s,life:3e3})}finally{this.isDownloading=!1}}},keydownHandler(e){const{ctrlKey:t,code:s}=e;!t||s!=="KeyP"||(e.preventDefault(),this.printHandler())},async printHandler(){await this.$nextTick(),this.isPrinting=!0},afterPrint(){this.isPrinting=!1},readyForPrint(){window.print()}})},ob={class:"action-list"},nb=["disabled","onClick"],rb={class:"action__text"},ab={key:0,class:"pi pi-spin pi-spinner"};function ib(e,t,s,n,r,o){const a=h("PrintPage"),i=h("OutlayBlock");return l(),w(i,null,{default:C(()=>[c("div",ob,[(l(!0),u(b,null,S(o.actions,d=>(l(),u("button",{class:"button action",key:d.text,disabled:d.disabled,onClick:d.handler},[(l(),w(Se(d.icon),{class:"action__icon"})),c("span",rb,$(d.text),1),d.loading?(l(),u("i",ab)):T("",!0)],8,nb))),128))]),(l(),w(vo,{to:"#act-print"},[e.act&&r.isPrinting?(l(),w(a,{key:0,act:e.act,onMounted:o.readyForPrint},null,8,["act","onMounted"])):T("",!0)]))]),_:1})}var lb=g(sb,[["render",ib],["__scopeId","data-v-cb11b282"]]);const Wt={components:{ViewListIcon:tn},props:{room:{type:Object,required:!0},active:Boolean},computed:f(m({},k("acts",["showOnlyCompleted"])),{textColor(){return this.active?"#545454":"#c8c8c8"},viewMode:{get(){return this.showOnlyCompleted&&this.active},set(e){this.setShowOnlyCompleted(e)}}}),methods:m({},B("acts",["setActiveRoom","setShowOnlyCompleted"]))},oo=()=>{U(e=>({d66b7b0c:e.textColor}))},no=Wt.setup;Wt.setup=no?(e,t)=>(oo(),no(e,t)):oo;const db=Wt,cb={class:"room-item__text"},ub=["title"],_b={class:"room-item__actions"};function hb(e,t,s,n,r,o){const a=h("ViewListIcon");return l(),u("div",{class:N(["room-item",{active:s.active}]),onClick:t[1]||(t[1]=i=>e.setActiveRoom(s.room))},[c("div",cb,[c("span",{class:"room-item__title",title:s.room.name},$(s.room.name),9,ub)]),c("div",_b,[c("button",{class:"button",onClick:t[0]||(t[0]=i=>o.viewMode=!o.viewMode)},[y(a,{class:N(["icon",{active:s.active&&e.showOnlyCompleted}])},null,8,["class"])])])],2)}var mb=g(db,[["render",hb],["__scopeId","data-v-abf09400"]]);const pb={components:{RoomItem:mb},emits:["open-edit","clone"],computed:f(m(m({},k("acts",["activeRoom"])),k("outlay",["outlay"])),{rooms(){return[...this.outlay.rooms].reverse()},activeRoomId(){var e;return(e=this.activeRoom)==null?void 0:e.id}})},yb={class:"room-list"};function fb(e,t,s,n,r,o){const a=h("RoomItem");return l(),u("div",yb,[(l(!0),u(b,null,S(o.rooms,i=>(l(),w(a,{key:i.id,room:i,active:o.activeRoomId===i.id},null,8,["room","active"]))),128))])}var vb=g(pb,[["render",fb],["__scopeId","data-v-208c58ab"]]);const gb={components:{RoomsIcon:Zo,DocumentIcon:zo,RoomList:vb,Button:mt,CirclePlusIcon:Yo,OutlayBlock:re},computed:f(m({},k("acts",["activeTab"])),{mainTabs(){return[{text:"\u0412\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u043D\u044B\u0435 \u0440\u0430\u0431\u043E\u0442\u044B",handler:()=>{this.setActiveTab("completed"),this.setShowOnlyCompleted(!0)},icon:"RoomsIcon",active:this.activeTab==="completed"},{text:"\u0421\u0432\u043E\u0434\u043D\u0430\u044F \u043F\u043E \u0430\u043A\u0442\u0430\u043C",handler:()=>{this.setActiveTab("acts")},icon:"DocumentIcon",active:this.activeTab==="acts"},{text:"\u0421\u043C\u0435\u0442\u0430 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u0438 2",handler:()=>{this.setActiveTab("results")},icon:"DocumentIcon",active:this.activeTab==="results"}]}}),methods:m({},B("acts",["setActiveTab","setShowOnlyCompleted"]))},bb={class:"rooms"},wb={class:"main-tabs"},$b=["onClick"],kb={class:"main-tab__text"};function Cb(e,t,s,n,r,o){const a=h("RoomList"),i=h("OutlayBlock");return l(),w(i,{class:"tab-list"},{default:C(()=>[c("div",bb,[y(a)]),c("div",wb,[(l(!0),u(b,null,S(o.mainTabs,d=>(l(),u("button",{key:d.text,class:N(["button main-tab",{active:d.active}]),onClick:d.handler},[(l(),w(Se(d.icon),{class:"main-tab__icon"})),c("span",kb,$(d.text),1)],10,$b))),128))])]),_:1})}var Ib=g(gb,[["render",Cb],["__scopeId","data-v-57fa0b04"]]);const Sb={components:{ActionList:lb,TabList:Ib,CollapseBlock:Fe},computed:{showLeftSide:{get(){return this.$store.getters["acts/showLeftSide"]},set(e){return this.setShowLeftSide(e)}}},methods:m({},B("acts",["setShowLeftSide"]))},Ob={class:"wrapper"};function Tb(e,t,s,n,r,o){const a=h("CollapseBlock"),i=h("ActionList"),d=h("TabList");return l(),u("div",Ob,[y(a,{modelValue:o.showLeftSide,"onUpdate:modelValue":t[0]||(t[0]=_=>o.showLeftSide=_)},null,8,["modelValue"]),y(i),y(d)])}var Rb=g(Sb,[["render",Tb],["__scopeId","data-v-ae60c846"]]);const Vb={components:{LeftSide:Rb,CenterSide:bg,RightSide:f1},computed:m({},k("acts",["showLeftSide","showRightSide"])),mounted(){document.addEventListener("keydown",this.onKeyDown)},unmounted(){document.removeEventListener("keydown",this.onKeyDown)},methods:f(m({},B("acts",["toggleSides"])),{onKeyDown(e){const{ctrlKey:t,keyCode:s}=e;t&&s===66&&this.toggleSides()}})},Lb={class:"body-row"};function Db(e,t,s,n,r,o){const a=h("LeftSide"),i=h("CenterSide"),d=h("RightSide");return l(),u("div",Lb,[c("div",{class:N(["left-side",{hidden:!e.showLeftSide}])},[y(a)],2),y(i),c("div",{class:N(["right-side",{hidden:!e.showRightSide}])},[y(d)],2)])}var Nb=g(Vb,[["render",Db],["__scopeId","data-v-d6352628"]]);const xb={components:{HeaderRow:dp,BodyRow:Nb},data(){return{loading:!0}},computed:f(m(m({},k("outlays",["outlays"])),k("acts",["act"])),{id(){return this.$route.params.id}}),async mounted(){if(!!this.id)try{await this.fetchAll();const e=this.outlays.find(t=>t._id===this.id);if(!e)return;await this.prepateOutlay(e),this.setOutlay(e)}catch(e){console.log(e)}finally{this.loading=!1}},unmounted(){this.setOutlay(null)},methods:m(m({},A("acts",["fetchAll","setOutlay"])),A("outlay",{prepateOutlay:"setOutlay"}))},Pb=e=>(x("data-v-486b1d93"),e=e(),P(),e),Ab={class:"main"},Eb=Pb(()=>c("div",{id:"act-print",class:"print"},null,-1));function Bb(e,t,s,n,r,o){const a=h("HeaderRow"),i=h("BodyRow");return l(),u(b,null,[c("main",Ab,[y(a),e.act&&!r.loading?(l(),w(i,{key:0})):T("",!0)]),Eb],64)}var Mb=g(xb,[["render",Bb],["__scopeId","data-v-486b1d93"]]);const Jb={components:{MainLayout:Ia,OutlayLayout:fm,ActLayout:Mb,PrintLayout:wm,Toast:Jn},data(){return{loading:!1}},computed:f(m({},k(["isOffline"])),{layout(){var e,t;return((t=(e=this.$route)==null?void 0:e.meta)==null?void 0:t.layout)||"MainLayout"}}),watch:{isOffline(e){e||this.fetchData()}},async mounted(){this.loading=!0,await this.initApp(),await this.fetchData(),navigator.connection.addEventListener("change",this.onConnectionChange),this.loading=!1},unmounted(){navigator.connection.removeEventListener("change",this.onConnectionChange)},methods:f(m(m({},B(["setIsOffline"])),A(["initApp","fetchAll"])),{async fetchData(){try{await this.fetchAll()}catch(e){const{response:t}=e,s=t?t.data.message:e.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:s,life:3e3})}},async onConnectionChange(){const e=navigator.onLine;this.setIsOffline(!e)}})};function Kb(e,t,s,n,r,o){const a=h("Toast");return l(),u(b,null,[r.loading?T("",!0):(l(),w(Se(o.layout),{key:0})),y(a,{position:"top-center"})],64)}var jb=g(Jb,[["render",Kb]]);const qb={},Hb={class:"index-view"};function Ub(e,t,s,n,r,o){return l(),u("div",Hb,"Index")}var Wb=g(qb,[["render",Ub]]);const Fb={},Gb={class:"app-content"},Qb={class:"app-content__header"},Zb={class:"app-content__body"};function zb(e,t){return l(),u("div",Gb,[c("div",Qb,[ne(e.$slots,"header",{},void 0,!0)]),c("div",Zb,[ne(e.$slots,"body",{},void 0,!0)])])}var Ft=g(Fb,[["render",zb],["__scopeId","data-v-b0fbb878"]]);const Yb={props:{url:{type:String,required:!0},text:{type:String,required:!0},delimeter:{type:Boolean,default:!1}}},Xb={key:0,class:"link__delimeter"};function e0(e,t,s,n,r,o){const a=h("RouterLink");return l(),u(b,null,[y(a,{class:"link",to:s.url},{default:C(()=>[R($(s.text),1)]),_:1},8,["to"]),s.delimeter?(l(),u("span",Xb,"/")):T("",!0)],64)}var t0=g(Yb,[["render",e0],["__scopeId","data-v-124bc896"]]);const s0={components:{NavigationLink:t0},computed:f(m({},k("directory",["directories","loading"])),{directoryId(){return this.$route.params.id},directory(){return this.directoryId?this.directories.find(e=>e._id===this.directoryId):null},parentTree(){return this.directory?this.getParentTree(this.directory):[]},links(){const e={text:"\u0421\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0438",url:"/directories"},t=this.parentTree.map(s=>({text:s.name,url:`/directories/${s._id}`}));return[e,...t]}}),watch:{parentTree:{handler(e){if(e.length===0)return this.setRoot(null);const t=e[0];this.setRoot(t._id)},immediate:!0}},methods:f(m({},B("directory",["setRoot"])),{getParentTree(e){if(e.parent){const t=this.directories.find(({_id:s})=>s===e.parent);return[...this.getParentTree(t),e]}return[e]}})};function o0(e,t,s,n,r,o){const a=h("NavigationLink");return l(),u("div",{class:N(["links",{disabled:e.loading}])},[(l(!0),u(b,null,S(o.links,(i,d)=>(l(),w(a,{key:i.url,url:i.url,delimeter:d!==o.links.length-1,text:i.text},null,8,["url","delimeter","text"]))),128))],2)}var n0=g(s0,[["render",o0],["__scopeId","data-v-78ab9234"]]);const r0={components:{AppContent:Ft,NavigationLinks:n0}};function a0(e,t,s,n,r,o){const a=h("NavigationLinks"),i=h("RouterView"),d=h("AppContent");return l(),w(d,null,{header:C(()=>[y(a)]),body:C(()=>[y(i)]),_:1})}var i0=g(r0,[["render",a0]]);const l0={computed:{hasHeaderSlot(){return!!this.$slots.header}}},d0={class:"content-body"},c0={key:0,class:"content-body__header"},u0={class:"content-body__content"};function _0(e,t,s,n,r,o){return l(),u("div",d0,[o.hasHeaderSlot?(l(),u("div",c0,[ne(e.$slots,"header",{},void 0,!0)])):T("",!0),c("div",u0,[ne(e.$slots,"content",{},void 0,!0)])])}var Le=g(l0,[["render",_0],["__scopeId","data-v-41a401f4"]]);const h0={modelValue:{required:!0,default:""},emits:["update:modelValue"],methods:{focus(){this.$refs.input.focus()}}},m0={ref:"input",class:"app-input",type:"text"};function p0(e,t,s,n,r,o){return l(),u("input",m0,null,512)}var fn=g(h0,[["render",p0],["__scopeId","data-v-249b6485"]]);const y0={},f0={width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},v0=c("path",{d:"M13.7219 15L8.55979 9.83731C7.45222 10.6247 6.08923 10.9672 4.74096 10.7971C3.3927 10.627 2.15756 9.95653 1.28035 8.91869C0.403128 7.88084 -0.0521453 6.55132 0.00475691 5.19364C0.0616591 3.83595 0.626583 2.54919 1.58757 1.58838C2.54829 0.627145 3.83513 0.0619404 5.19299 0.00479688C6.55086 -0.0523467 7.88064 0.402742 8.91874 1.27986C9.95683 2.15697 10.6275 3.39208 10.7977 4.74036C10.968 6.08864 10.6254 7.45168 9.8379 8.55928L15 13.722L13.7228 14.9991L13.7219 15ZM5.41918 1.80695C4.58823 1.80676 3.78262 2.09297 3.13808 2.61736C2.49353 3.14176 2.04945 3.87228 1.88065 4.68584C1.71185 5.49941 1.82866 6.34629 2.21138 7.08379C2.59411 7.8213 3.21937 8.40435 3.9818 8.73471C4.74424 9.06507 5.59726 9.12255 6.39712 8.89746C7.19699 8.67236 7.89482 8.17846 8.37304 7.49897C8.85126 6.81947 9.08063 5.99592 9.02251 5.16706C8.96439 4.33821 8.62233 3.55471 8.05397 2.9486L8.60044 3.49052L7.98442 2.87634L7.97358 2.8655C7.63899 2.52887 7.24093 2.26198 6.80246 2.08027C6.36398 1.89857 5.89381 1.80567 5.41918 1.80695Z",fill:"#808080"},null,-1),g0=[v0];function b0(e,t){return l(),u("svg",f0,g0)}var w0=g(y0,[["render",b0]]);const $0={components:{AppInput:fn,SearchIcon:w0}},k0={class:"search-input"};function C0(e,t,s,n,r,o){const a=h("SearchIcon"),i=h("AppInput");return l(),u("div",k0,[y(a),y(i,{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0434\u043B\u044F \u043F\u043E\u0438\u0441\u043A\u0430..."})])}var Gt=g($0,[["render",C0],["__scopeId","data-v-4ae1be5a"]]);const I0={},S0={width:"20",height:"4",viewBox:"0 0 20 4",fill:"none",xmlns:"http://www.w3.org/2000/svg"},O0=c("circle",{cx:"2",cy:"2",r:"2",fill:"#808080"},null,-1),T0=c("circle",{cx:"18",cy:"2",r:"2",fill:"#808080"},null,-1),R0=c("circle",{cx:"10",cy:"2",r:"2",fill:"#808080"},null,-1),V0=[O0,T0,R0];function L0(e,t){return l(),u("svg",S0,V0)}var vn=g(I0,[["render",L0]]);const D0={props:{items:{type:Array,required:!0}},emits:["update:modelValue"],data(){return{isItemsVisible:!1}},methods:{toggle(){this.isItemsVisible?this.hideItems():this.showItems()},showItems(){this.isItemsVisible=!0},hideItems(){this.isItemsVisible=!1},clickHandler(e){e(),this.hideItems()}}},N0={class:"app-dropdown"},x0={ref:"items",class:"app-dropdown__items"},P0=["onClick"];function A0(e,t,s,n,r,o){const a=h("AppButton");return l(),u("div",N0,[y(a,{class:"app-dropdown__body",onClick:o.toggle},{default:C(()=>[ne(e.$slots,"default",{},void 0,!0)]),_:3},8,["onClick"]),r.isItemsVisible?(l(),u(b,{key:0},[c("div",{class:"app-dropdown__backdrop",onClick:t[0]||(t[0]=(...i)=>o.hideItems&&o.hideItems(...i))}),c("ul",x0,[(l(!0),u(b,null,S(s.items,i=>(l(),u("li",{key:i.text,class:"app-dropdown__item",onClick:d=>o.clickHandler(i.handler)},$(i.text),9,P0))),128))],512)],64)):T("",!0)])}var gn=g(D0,[["render",A0],["__scopeId","data-v-6261e4c9"]]),Qe={methods:{getRoot(e){const t=this.directories.find(s=>s._id===e);return t!=null&&t.parent?this.getRoot(t.parent):t},getTree(e){const t=this.directories.find(s=>s._id===e);return t?t.parent?[...this.getTree(t.parent),t]:[t]:[]}}};const E0={components:{ThreeDotsIcon:vn,AppDropdown:gn},mixins:[Qe],props:{directory:{type:Object,required:!0}},data(){return{isEditing:!1,items:[{text:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",handler:async()=>{this.isEditing=!0,await this.$nextTick(),this.$refs.input.focus()}},{text:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",handler:async()=>{const{values:e}=this.directory;if((!e||(e==null?void 0:e.length)===0)&&!this.subFolders.length)return await this.removeDirectory(this.directory._id);const t=this.editions.find(i=>i.dirId===this.directory._id);if(t){const i=this.priceLists.find(d=>d.editions.includes(t._id));if(i)return this.$emit("alert",{priceList:i.name})}if(e){const i=this.checkIfArchitectureInUse(this.directory),d=i.map(({name:_})=>_);if(i.length>0)return this.$emit("alert",{directories:d});if(e.length>0)return this.$emit("remove",{id:this.directory._id,folderName:this.directory.name,subItemsLength:e.length})}const o=this.getItemsInsideDirectory(this.directory).filter(i=>i.data).map(i=>this.checkIfArchitectureInUse(i)).flat().map(i=>[...this.getRoots(i.parent),i]);if(o.length>0)return this.$emit("alert",{paths:o});const a=this.subFolders.length;if(a>0)return this.$emit("remove",{id:this.directory._id,folderName:this.directory.name,subItemsLength:a})}}]}},computed:f(m(m(m({},k("directory",["directories","root","roots"])),k("edition",["editions"])),k("priceList",["priceLists"])),{subFolders(){return this.directories.filter(e=>e.parent===this.directory._id)},counter(){if(this.subFolders.length>0)return this.subFolders.length;const{values:e}=this.directory;return(e?e.length:0)>0?e.length:"\u041D\u0435\u0442 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432"}}),methods:f(m(m({},B("directory",["setRoot"])),A("directory",["removeDirectory","updateById"])),{openFolder(){this.directory.parent||this.setRoot(this.directory._id),this.$router.push(`/directories/${this.directory._id}`)},async focusInput(){this.isEditing=!0,await this.$nextTick(),this.$refs.input.focus(),this.$refs.input.select()},async update(e){this.$refs.input.blur();const t=e.target.value;await this.updateById({id:this.directory._id,data:{name:t}})},getItemsInsideDirectory(e){const{data:t}=e;if(t)return[];const s=this.directories.filter(n=>n.parent===e._id);if(s.length>0){const n=s.map(r=>this.getItemsInsideDirectory(r)).flat();return[...s,...n]}return[]},checkIfArchitectureInUse(e){return this.roots.filter(t=>{const{parent:s}=t;return s?!1:t.keys.some(n=>n.dirId===e._id)})}})},B0={class:"directory-item__header"},M0=["title"],J0=["value"],K0={key:0,class:"directory-item__counter"};function j0(e,t,s,n,r,o){const a=h("ThreeDotsIcon"),i=h("AppDropdown");return l(),u("li",{class:"directory-item",onDblclick:t[4]||(t[4]=(...d)=>o.openFolder&&o.openFolder(...d))},[c("div",B0,[r.isEditing?(l(),u("input",{key:1,ref:"input",value:s.directory.name,class:"directory-item__input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0430\u043A\u0438",onChange:t[1]||(t[1]=(...d)=>o.update&&o.update(...d)),onFocus:t[2]||(t[2]=d=>r.isEditing=!0),onBlur:t[3]||(t[3]=d=>r.isEditing=!1)},null,40,J0)):(l(),u("span",{key:0,onDblclick:t[0]||(t[0]=Y((...d)=>o.focusInput&&o.focusInput(...d),["stop"])),class:"directory-item__name",title:s.directory.name},$(s.directory.name),41,M0)),r.isEditing?T("",!0):(l(),w(i,{key:2,ref:"dropdown",items:r.items},{default:C(()=>[y(a)]),_:1},8,["items"]))]),r.isEditing?T("",!0):(l(),u("span",K0,$(o.counter),1))],32)}var q0=g(E0,[["render",j0],["__scopeId","data-v-6d12a921"]]);const H0={},U0={width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg"},W0=c("path",{d:"M15 0C6.72 0 0 6.72 0 15C0 23.28 6.72 30 15 30C23.28 30 30 23.28 30 15C30 6.72 23.28 0 15 0ZM22.5 16.5H16.5V22.5H13.5V16.5H7.5V13.5H13.5V7.5H16.5V13.5H22.5V16.5Z",fill:"#C8C8C8"},null,-1),F0=[W0];function G0(e,t){return l(),u("svg",U0,F0)}var Q0=g(H0,[["render",G0]]);const Z0={components:{PlusIcon:Q0},props:{text:{type:String,default:""}}},z0={class:"directory-create"},Y0={class:"directory-create__body"},X0={class:"directory-create__text"};function ew(e,t,s,n,r,o){const a=h("PlusIcon");return l(),u("li",z0,[c("div",Y0,[y(a),c("span",X0,$(s.text),1)])])}var bn=g(Z0,[["render",ew],["__scopeId","data-v-3490001a"]]);const tw={data(){return{name:""}},computed:{parent(){var e;return(e=this.$route.params)==null?void 0:e.id}},mounted(){this.$refs.input.focus()},methods:f(m({},A("directory",["createDirectory"])),{async create(){if(!this.name)return this.$emit("created");const e={name:this.name,parent:this.parent};try{await this.createDirectory(e),this.name="",this.$emit("created")}catch(t){const{response:s}=t,n=s?s.data.message:t.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:n,life:3e3})}}})},sw={class:"directory-item"};function ow(e,t,s,n,r,o){return l(),u("li",sw,[H(c("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>r.name=a),onKeyup:t[1]||(t[1]=Ie((...a)=>o.create&&o.create(...a),["enter"])),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0430\u043A\u0438",onBlur:t[2]||(t[2]=(...a)=>o.create&&o.create(...a)),ref:"input",class:"directory-item__input"},null,544),[[te,r.name]])])}var wn=g(tw,[["render",ow],["__scopeId","data-v-0033d587"]]);const ro=()=>({title:void 0,message:void 0,folderName:void 0,okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0,keyWord:""}),nw={components:{PopupModal:ae},data(){return ro()},computed:{isWordCorrect(){return this.folderName===this.keyWord}},methods:{async show(e){return this.title=e.title,this.message=e.message,this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.folderName=e.folderName,this.$refs.popup.open(),await this.$nextTick(),this.$refs.input.focus(),new Promise((t,s)=>{this.resolvePromise=t,this.rejectPromise=s})},_confirm(){!this.isWordCorrect||(this.$refs.popup.close(),this.resolvePromise(!0),this.reset())},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},reset(){Object.assign(this.$data,ro())}}},rw={class:"modal"},aw={class:"modal__title"},iw={class:"modal__message"},lw=R(" \u0427\u0442\u043E\u0431\u044B \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0430\u043F\u043A\u0443 \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0430\u043F\u043A\u0438 "),dw={class:"modal__actions"};function cw(e,t,s,n,r,o){const a=h("AppButton"),i=h("PopupModal");return l(),w(i,{ref:"popup"},{default:C(()=>[c("div",rw,[c("span",aw,$(e.title),1),c("span",iw,$(e.message),1),c("span",null,[lw,c("strong",null,$(e.folderName),1)]),H(c("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>e.keyWord=d),class:"input",ref:"input",type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0430\u043F\u043A\u0438",onKeyup:t[1]||(t[1]=Ie((...d)=>o._confirm&&o._confirm(...d),["enter"]))},null,544),[[te,e.keyWord]]),c("div",dw,[y(a,{outlined:"",onClick:o._cancel},{default:C(()=>[R($(e.cancelButton),1)]),_:1},8,["onClick"]),y(a,{outlined:"",disabled:!o.isWordCorrect,onClick:o._confirm},{default:C(()=>[R($(e.okButton),1)]),_:1},8,["disabled","onClick"])])])]),_:1},512)}var $n=g(nw,[["render",cw],["__scopeId","data-v-3bacd03c"]]);const ao=()=>({title:void 0,okButton:void 0,directories:null,priceList:null,resolvePromise:void 0,rejectPromise:void 0}),uw={components:{PopupModal:ae},data(){return ao()},methods:{show(e){return this.title=e.title,this.okButton=e.okButton,this.directories=e.directories,this.priceList=e.priceList,this.$refs.popup.open(),new Promise(t=>{this.resolvePromise=t})},_confirm(){this.$refs.popup.close(),this.resolvePromise(!0),this.reset()},reset(){Object.assign(this.$data,ao())}}},_w=e=>(x("data-v-039e94e8"),e=e(),P(),e),hw={class:"modal"},mw={class:"modal__title"},pw={key:0},yw=R(" \u0414\u0430\u043D\u043D\u044B\u0439 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F \u0432 \u043F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442\u0435 "),fw=_w(()=>c("span",null," \u0421\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F \u0432 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0445 \u0430\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0430\u0445: ",-1)),vw={class:"modal__actions"};function gw(e,t,s,n,r,o){const a=h("AppButton"),i=h("PopupModal");return l(),w(i,{ref:"popup"},{default:C(()=>[c("div",hw,[c("span",mw,$(e.title),1),e.priceList?(l(),u("span",pw,[yw,c("strong",null,$(e.priceList),1)])):e.directories?(l(),u(b,{key:1},[fw,c("ul",null,[(l(!0),u(b,null,S(e.directories,d=>(l(),u("li",{key:d},[c("strong",null,$(d),1)]))),128))])],64)):T("",!0),c("div",vw,[y(a,{outlined:"",onClick:o._confirm},{default:C(()=>[R($(e.okButton),1)]),_:1},8,["onClick"])])])]),_:1},512)}var bw=g(uw,[["render",gw],["__scopeId","data-v-039e94e8"]]);const ww={components:{DirectoryItem:q0,CreateButton:bn,DirectoryForm:wn,RemoveModal:$n,AlertModal:bw},props:{items:{type:Array}},data(){return{formVisible:!1}},methods:f(m({},A("directory",["removeDirectory"])),{async openRemove({id:e,folderName:t,subItemsLength:s}){if(await this.$refs["remove-modal"].show({title:"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0435",message:`\u0414\u0430\u043D\u043D\u0430\u044F \u043F\u0430\u043F\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u0440\u0436\u0438\u0442 ${s} \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430. \u041F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u044D\u0442\u043E\u0439 \u043F\u0430\u043F\u043A\u0438 \u0432\u0441\u0435 \u0432\u043B\u043E\u0436\u0435\u043D\u043D\u044B\u0435 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u044B \u0431\u0443\u0434\u0443\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u044B.`,folderName:t,okButton:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430"}))try{await this.removeDirectory(e)}catch(r){const{response:o}=r,a=o?o.data.message:r.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:a,life:3e3})}},openAlert({priceList:e,directories:t}){this.$refs["alert-modal"].show({title:"\u0414\u0430\u043D\u043D\u044B\u0439 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A \u043D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0443\u0434\u0430\u043B\u0438\u0442\u044C",directories:t,priceList:e,okButton:"\u041E\u043A"})}})},$w={class:"directory-list"};function kw(e,t,s,n,r,o){const a=h("DirectoryItem"),i=h("DirectoryForm"),d=h("CreateButton"),_=h("RemoveModal"),p=h("AlertModal");return l(),u("ul",$w,[(l(!0),u(b,null,S(s.items,v=>(l(),w(a,{key:v.id,directory:v,onRemove:o.openRemove,onAlert:o.openAlert},null,8,["directory","onRemove","onAlert"]))),128)),r.formVisible?(l(),w(i,{key:0,onCreated:t[0]||(t[0]=v=>r.formVisible=!1)})):(l(),w(d,{key:1,text:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0430\u043F\u043A\u0443",onClick:t[1]||(t[1]=v=>r.formVisible=!0)})),y(_,{ref:"remove-modal"},null,512),y(p,{ref:"alert-modal"},null,512)])}var kn=g(ww,[["render",kw],["__scopeId","data-v-0a7652e9"]]);const Cw={components:{ContentBody:Le,SearchInput:Gt,DirectoryList:kn},data(){return{search:""}},computed:m({},k("directory",["roots"]))};function Iw(e,t,s,n,r,o){const a=h("SearchInput"),i=h("DirectoryList"),d=h("ContentBody");return l(),w(d,null,{header:C(()=>[y(a,{class:"search-input"})]),content:C(()=>[y(i,{items:e.roots},null,8,["items"])]),_:1})}var Sw=g(Cw,[["render",Iw],["__scopeId","data-v-19ced106"]]);const io=()=>({title:void 0,okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0,name:"",type:"",selectedDirectory:"",selectedCollection:"",visibleKeys:[],updateMode:!1}),Ow={components:{PopupModal:ae},mixins:[se,Qe],data(){return io()},computed:f(m({},k("directory",["directories","root","roots"])),{id(){return this.$route.params.id},filteredTypeOptions(){const t=[this.InputType.PRICE,this.InputType.QUANTITY,this.InputType.COUNTER].filter(s=>this.type===s?!1:this.root.keys.find(n=>n.type===s));return this.typeOptions.filter(s=>!t.includes(s))},options(){return this.id?this.directories.filter(s=>s._id!==this.id&&s.values).map(s=>{const o=this.getParentTree(s).map(a=>a.name).join("/");return f(m({},s),{text:o})}):[]},collectionOptions(){return this.id?this.roots.filter(t=>t._id!==this.id).map(t=>f(m({},t),{text:t.name})):[]},avaliableKeys(){if(!this.selectedDirectory)return[];const e=this.directories.find(s=>s._id===this.selectedDirectory);return e?(e.parent?this.getRoot(e.parent):e).keys:[]}}),methods:{async show(e){return this.reset(),this.title=e.title,this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.type=this.InputType.STRING,e.key&&(this.updateMode=!0,this.name=e.key.name,this.type=e.key.type,this.selectedDirectory=e.key.dirId,this.visibleKeys=e.key.keys,this.selectedCollection=e.key.rootDir),this.$refs.popup.open(),await this.$nextTick(),this.$refs.input.focus(),new Promise((t,s)=>{this.resolvePromise=t,this.rejectPromise=s})},_confirm(){this.$refs.popup.close();const e={name:this.name,type:this.type};if(this.type===this.InputType.SELECT||this.type===this.InputType.FORMULA){if(!this.selectedDirectory)return;const t=this.getRoot(this.selectedDirectory)._id,s=this.selectedDirectory;e.dirId=s,e.root=t,e.keys=this.visibleKeys}if(this.type===this.InputType.COLLECTION||this.type===this.InputType.COLLECTION_VALUES){if(!this.selectedCollection)return;e.rootDir=this.selectedCollection}this.resolvePromise(e),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},_remove(){this.$refs.popup.close(),this.resolvePromise({remove:!0}),this.reset()},reset(){Object.assign(this.$data,io())},resetSelectData(){this.selectedDirectory="",this.visibleKeys=[]},getParentTree(e){if(e.parent){const t=this.directories.find(({_id:s})=>s===e.parent);return[...this.getParentTree(t),e]}return[e]}}},Ze=e=>(x("data-v-5ac471de"),e=e(),P(),e),Tw={class:"modal"},Rw={class:"modal__title"},Vw={class:"form__group"},Lw=Ze(()=>c("label",{class:"form__label"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",-1)),Dw={class:"form__group"},Nw=Ze(()=>c("label",{class:"form__label"},"\u0422\u0438\u043F",-1)),xw=["value"],Pw={key:0,class:"form__group"},Aw=["value"],Ew={key:0},Bw=Ze(()=>c("span",null,"\u0417\u043D\u0430\u0447\u0435\u043D\u0438\u044F \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0442\u044C",-1)),Mw=["id","value"],Jw=["for"],Kw={key:1,class:"form__group"},jw=Ze(()=>c("span",null," \u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A \u0441 \u0440\u0430\u0431\u043E\u0442\u0430\u043C\u0438 ",-1)),qw=["value"],Hw=R(" \u0423\u0434\u0430\u043B\u0438\u0442\u044C "),Uw={class:"modal__actions"};function Ww(e,t,s,n,r,o){const a=h("AppButton"),i=h("PopupModal");return l(),w(i,{ref:"popup"},{default:C(()=>[c("div",Tw,[c("span",Rw,$(e.title),1),c("form",{class:"form",onSubmit:t[7]||(t[7]=Y((...d)=>o._confirm&&o._confirm(...d),["prevent"]))},[c("div",Vw,[Lw,H(c("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>e.name=d),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",ref:"input",class:"input"},null,512),[[te,e.name]])]),c("div",Dw,[Nw,H(c("select",{"onUpdate:modelValue":t[1]||(t[1]=d=>e.type=d),class:"select",onChange:t[2]||(t[2]=(...d)=>o.resetSelectData&&o.resetSelectData(...d))},[(l(!0),u(b,null,S(o.filteredTypeOptions,d=>(l(),u("option",{class:"select__option",key:d,value:d},$(d),9,xw))),128))],544),[[ke,e.type]])]),e.type===e.InputType.SELECT||e.type===e.InputType.FORMULA?(l(),u("div",Pw,[H(c("select",{"onUpdate:modelValue":t[3]||(t[3]=d=>e.selectedDirectory=d),class:"select",onChange:t[4]||(t[4]=d=>e.visibleKeys=[])},[(l(!0),u(b,null,S(o.options,d=>(l(),u("option",{key:d._id,value:d._id},$(d.text),9,Aw))),128))],544),[[ke,e.selectedDirectory]]),e.selectedDirectory?(l(),u("div",Ew,[Bw,(l(!0),u(b,null,S(o.avaliableKeys,d=>(l(),u("div",{class:"key",key:d.id},[H(c("input",{"onUpdate:modelValue":t[5]||(t[5]=_=>e.visibleKeys=_),id:d.id,value:d.id,type:"checkbox"},null,8,Mw),[[bo,e.visibleKeys]]),c("label",{for:d.id},$(d.name),9,Jw)]))),128))])):T("",!0)])):e.type===e.InputType.COLLECTION||e.type===e.InputType.COLLECTION_VALUES?(l(),u("div",Kw,[jw,H(c("select",{"onUpdate:modelValue":t[6]||(t[6]=d=>e.selectedCollection=d),class:"select"},[(l(!0),u(b,null,S(o.collectionOptions,d=>(l(),u("option",{key:d._id,value:d._id},$(d.text),9,qw))),128))],512),[[ke,e.selectedCollection]])])):T("",!0)],32),e.updateMode?(l(),w(a,{key:0,outlined:"",variant:"danger",onClick:o._remove},{default:C(()=>[Hw]),_:1},8,["onClick"])):T("",!0),c("div",Uw,[y(a,{outlined:"",onClick:o._cancel},{default:C(()=>[R($(e.cancelButton),1)]),_:1},8,["onClick"]),y(a,{outlined:"",onClick:o._confirm},{default:C(()=>[R($(e.okButton),1)]),_:1},8,["onClick"])])])]),_:1},512)}var Fw=g(Ow,[["render",Ww],["__scopeId","data-v-5ac471de"]]);class lo{constructor(t,s){this.id=Date.now()+"",this.name=t,this.type=s}static getDefaultValue(t){return t===F.STRING?"":[F.NUMBER,F.QUANTITY,F.PRICE].includes(t)?1:t===F.BOOLEAN_ROOM_PARAMETERS||t===F.BOOLEAN_ROOM_COMPUTED?!0:null}}const Qt=(e,t)=>{const s=t.filter(r=>r.parent===e._id),n=s.map(r=>Qt(r,t));return[...s,...n].flat()},co=(e,t)=>Qt(e,t).filter(n=>n.values);var Gw={namespaced:!0,state:{root:null,directories:[],contentLoaded:!1,loading:!1},mutations:{setLoading(e,t){e.loading=t},setRoot(e,t){e.root=t},setDirectories(e,t){e.directories=t},setContentLoaded(e,t){e.contentLoaded=t},pushDirectory(e,t){e.directories.push(t)},updateDirectory(e,{id:t,data:s}){e.directories=e.directories.map(n=>n._id===t?s:n)},updateDirectoryValues(e,{id:t,values:s}){const n=e.directories.find(r=>r._id===t);n.values=s},removeDirectory(e,t){e.directories=e.directories.filter(s=>s._id!==t)},removeEmptyRows(e,{id:t}){const s=e.directories.find(n=>n._id===t);!s||(s.values=s.values.filter(n=>!Object.values(n.data).every(o=>!o)))}},actions:{createTableRow({getters:e},t){const s=e.directories.find(a=>a._id===t);if(!s)return;const{values:n}=s,o=(s.parent?e.root.keys:s.keys).reduce((a,i)=>(a[i.id]=i.type===F.NUMBER?0:"",a),{});n.push({id:Date.now()+"",data:o})},async createDirectory({commit:e},t){try{const s=await J.post("/directory",t);return e("pushDirectory",s.data),await j.saveDataInCollection("directories",s.data),s}catch(s){return console.log(s),Promise.reject(s)}},async fetchAll({state:e,commit:t,rootGetters:s}){if(!(e.contentLoaded||s.isOffline))try{const n=await J.get("/directory");return t("setDirectories",n.data),t("setContentLoaded",!0),await j.setArrayToCollection("directories",n.data),n}catch(n){console.log(n)}},async updateDirectoryValues(e,{id:t,values:s}){try{s=s&&s.filter(r=>!Object.values(r.data).every(a=>!a));const n={values:s};await J.put(`/directory/${t}`,n),await j.saveDataInCollection("directories",n)}catch(n){return Promise.reject(n)}},async updateById({commit:e},{id:t,data:s}){try{const n=await J.put(`/directory/${t}`,s);return e("updateDirectory",{id:n.data._id,data:n.data}),await j.saveDataInCollection("directories",n.data),n}catch(n){return console.log(n),Promise.reject(n)}},async removeDirectory({commit:e},t){if(!!t)try{const s=await J.delete(`/directory/${t}`);return s.data.forEach(n=>{e("removeDirectory",n._id)}),await j.removeDataInCollection("directories",t),s}catch(s){return console.log(s),Promise.reject(s)}},async createKey({state:e,getters:t,dispatch:s},{name:n,type:r}){try{const o=new lo(n,r),{directories:a}=e,i=a.find(I=>I._id===t.root._id),d=JSON.parse(JSON.stringify(i));d.keys.push(o);const _=lo.getDefaultValue(o.type);d.values&&(d.values=d.values.map(I=>(I.data[o.id]=_,I)));const p=await s("updateById",{id:i._id,data:d});if(o.type===F.COUNTER)return p;const v=co(i,a);return await Promise.all(v.map(async I=>{const O=JSON.parse(JSON.stringify(I));if(!!O.values.length)return O.values=I.values.map(L=>(L.data[o.id]=_,L)),await s("updateById",{id:I._id,data:I})}))}catch(o){return Promise.reject(o)}},async removeKey({state:e,dispatch:t,getters:s},n){try{const{directories:r}=e,o=r.find(d=>d._id===s.root._id),a=JSON.parse(JSON.stringify(o));a.keys=a.keys.filter(d=>d.id!==n),await t("updateById",{id:o._id,data:a});const i=co(o,r);return await Promise.all(i.map(async d=>{const _=JSON.parse(JSON.stringify(d));if(!!_.values.length)return _.values=d.values.map(p=>(p.data=Object.entries(p.data).reduce((v,[I,O])=>(n!==I&&(v[I]=O),v),{}),p)),await t("updateById",{id:d._id,data:d})}))}catch(r){return Promise.reject(r)}},async updateKey({state:e,getters:t,dispatch:s},{id:n,newKey:r}){try{const{directories:o}=e,a=o.find(_=>_._id===t.root._id),i=JSON.parse(JSON.stringify(a)),{keys:d}=i;return i.keys=d.map(_=>_.id===n?m({id:n},r):_),await s("updateById",{id:a._id,data:i})}catch(o){return Promise.reject(o)}},async updateValues({state:e,commit:t},{id:s,values:n}){try{const r=e.directories.find(_=>_._id===s),o=JSON.parse(JSON.stringify(r)),a=o.values.filter(_=>_.removed);o.values=[...n,...a];const i=await J.put(`/directory/${s}`,o),d=i.data.values;return t("updateDirectoryValues",{id:s,values:d}),await j.saveDataInCollection("directories",i.data),i}catch(r){return Promise.reject(r)}}},getters:{loading:e=>e.loading,root:e=>e.root?e.directories.find(t=>t._id===e.root):null,roots:e=>e.directories.filter(t=>!t.parent),directories:e=>e.directories,roomDirectory:e=>{const{directories:t}=e;return t.find(n=>n.name===Xo.ROOMS)}}},Qw=["\u041F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u0435","\u041D\u0430\u0431\u043E\u0440 \u0440\u0430\u0431\u043E\u0442"];const Zw={components:{TreeSelect:Kn},mixins:[se],props:{value:{required:!0},field:{required:!0,type:String},rowIndex:{required:!0,type:Number}},emits:["change"],data(){return{timeout:null,hasUnmounted:!1,selectedCollections:{},roomTypes:Qw}},computed:f(m({},k("directory",["root","roots","directories"])),{key(){return this.root.keys.find(e=>e.id===this.field)},type(){var e;return(e=this.key)==null?void 0:e.type},componentName(){const e=[this.InputType.NUMBER,this.InputType.PRICE,this.InputType.QUANTITY],t=[this.InputType.SELECT,this.InputType.FORMULA];return e.includes(this.type)?"InputNumber":t.includes(this.type)?"Dropdown":"InputText"},newValue:{get(){return this.value},set(e){if([this.InputType.PRICE,this.InputType.QUANTITY,this.InputType.NUMBER].includes(this.type)){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{if(!this.hasUnmounted)return this.$emit("change",this.rowIndex,this.field,e)},300);return}this.$emit("change",this.rowIndex,this.field,e)}},treeSelectValues:{get(){return this.type!==this.InputType.COLLECTION||!this.value?{}:this.value.reduce((e,t)=>(e[t]={checked:!0},e),{})},set(e){const t=Object.keys(e);this.$emit("change",this.rowIndex,this.field,t)}},options(){if(this.type!==this.InputType.SELECT&&this.type!==this.InputType.FORMULA)return[];const e=this.roots.find(r=>r._id===this.key.root);if(!e)return[];const t=e.keys.filter(r=>this.key.keys.includes(r.id));if(!t.length)return[];const n=this.directories.find(r=>r._id===this.key.dirId).values.map(r=>{const o=t.map(a=>{if(a.type===this.InputType.SELECT){const i=r.data[a.id];return this.getValueOfCell(a.dirId,a.root,i,a.keys)}return r.data[a.id]});return{value:r.id,text:o.join(", ")}});return[{value:void 0,text:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",hidden:!0},...n]},collections(){if(this.type!==this.InputType.COLLECTION)return[];const{rootDir:e}=this.key,t=this.roots.find(o=>o._id===e),s=Qt(t,this.directories),n=this.createTree(t,s),{children:r}=n;return r}}),unmounted(){this.hasUnmounted=!0},methods:{getValueOfCell(e,t,s,n){const r=this.directories.find(d=>d._id===e);return r?this.roots.find(d=>d._id===t).keys.filter(d=>n.includes(d.id)).map(d=>{const _=r.values.find(p=>p.id===+s);if(d.type===this.InputType.SELECT){const p=_.data[d.id];return this.getValueOfCell(d.dirId,d.root,p,d.keys)}return _.data[d.id]}):null},createTreeNode(e){return{key:e._id,label:e.name,children:[]}},createTree(e,t){const s=this.createTreeNode(e),n=t.filter(r=>r.parent===e._id);return s.children=n.map(r=>this.createTree(r,t)),s}}},zw=["hidden","value"];function Yw(e,t,s,n,r,o){const a=h("TreeSelect");return o.type===e.InputType.STRING?H((l(),u("input",{key:0,"onUpdate:modelValue":t[0]||(t[0]=i=>o.newValue=i),class:"input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",type:"text"},null,512)),[[te,o.newValue,void 0,{lazy:!0}]]):o.type===e.InputType.NUMBER?H((l(),u("input",{key:1,"onUpdate:modelValue":t[1]||(t[1]=i=>o.newValue=i),class:"input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",type:"number"},null,512)),[[te,o.newValue,void 0,{lazy:!0}]]):o.type===e.InputType.PRICE||o.type===e.InputType.QUANTITY?H((l(),u("input",{key:2,"onUpdate:modelValue":t[2]||(t[2]=i=>o.newValue=i),class:"input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",type:"number",min:0},null,512)),[[te,o.newValue,void 0,{lazy:!0}]]):o.type===e.InputType.SELECT||o.type===e.InputType.FORMULA?H((l(),u("select",{key:3,"onUpdate:modelValue":t[3]||(t[3]=i=>o.newValue=i),class:"input"},[(l(!0),u(b,null,S(o.options,i=>(l(),u("option",{key:i.value,hidden:i.hidden,value:i.value},$(i.text),9,zw))),128))],512)),[[ke,o.newValue]]):o.type===e.InputType.COLLECTION?(l(),w(a,{key:4,modelValue:o.treeSelectValues,"onUpdate:modelValue":t[4]||(t[4]=i=>o.treeSelectValues=i),class:"tree-select",options:o.collections,selectionMode:"checkbox",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u044B"},null,8,["modelValue","options"])):o.type===e.InputType.BOOLEAN_ROOM_PARAMETERS||o.type===e.InputType.BOOLEAN_ROOM_COMPUTED?H((l(),u("input",{key:5,"onUpdate:modelValue":t[5]||(t[5]=i=>o.newValue=i),type:"checkbox"},null,512)),[[bo,o.newValue]]):T("",!0)}var Xw=g(Zw,[["render",Yw],["__scopeId","data-v-a7ab3474"]]);const e$={components:{KeyModal:Fw,DataTable:wo,Column:Ae,Button:mt,TableCell:Xw},mixins:[se],props:{directory:{type:Object,required:!0}},computed:f(m(m({},k("directory",["root"])),k("edition",["editions"])),{directoryId(){return this.$route.params.id},allKeys(){var e;return(e=this.root)==null?void 0:e.keys.map(t=>f(m({},t),{id:t.id+""}))},eidtableKeys(){var e;return(e=this.root)==null?void 0:e.keys.filter(t=>t.type!==this.InputType.COUNTER)},counter(){var e;return(e=this.root)==null?void 0:e.keys.find(t=>t.type===this.InputType.COUNTER)},data(){var e;return(e=this.tableData)!=null&&e.length?this.tableData.map(t=>t.data):[]},values(){return this.directory.values.filter(e=>!e.removed)},tableData(){return this.values.map(e=>e.data)},isArchirectureInUse(){return this.editions.find(e=>{var t;return e.dirId===((t=this.root)==null?void 0:t._id)})}}),watch:{directoryId(e,t){!t||this.removeEmptyRows({id:t})}},methods:f(m(m({},B("directory",["removeEmptyRows","setLoading","updateDirectory"])),A("directory",["createTableRow","updateValues","createKey","removeKey","updateKey"])),{async createRow(){this.createTableRow(this.directoryId)},removeRow(e){const t=this.values.map((s,n)=>n===e?f(m({},s),{removed:!0}):s);this.updateValues({id:this.directoryId,values:t})},getKeysToEdit(e,t,s){const n=[],r=this.allKeys.find(o=>o.id===t);if(!r)return n;if(r.type===this.InputType.BOOLEAN_ROOM_PARAMETERS&&!s){const o=this.allKeys.find(a=>a.type===this.InputType.BOOLEAN_ROOM_COMPUTED);return o&&n.push({key:o.id,value:!1}),n}if(r.type===this.InputType.BOOLEAN_ROOM_COMPUTED&&s){const o=this.allKeys.find(d=>d.type===this.InputType.BOOLEAN_ROOM_PARAMETERS);if(!o)return n;this.values[e].data[o.id]||n.push({key:t,value:!1})}return n},async change(e,t,s){try{const n=this.getKeysToEdit(e,t,s),o=JSON.parse(JSON.stringify(this.values)).map((a,i)=>(i===e&&(a.data[t]=s,n.length>0&&n.forEach(d=>{a.data[d.key]=d.value})),a));await this.updateValues({id:this.directoryId,values:o}),n.length>0&&this.updateDirectory({id:this.directory._id,data:this.directory})}catch{this.updateDirectory({id:this.directory._id,data:this.directory})}},async createKeyHandler(){if(this.isArchirectureInUse)return console.error("\u0414\u0430\u043D\u043D\u0430\u044F \u0430\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0430 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F \u0432 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u0438");const e=await this.$refs["key-modal"].show({title:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043A\u043E\u043B\u043E\u043D\u043A\u0443",okButton:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430"});!e||this.createKey(e)},async editKey(e){if(this.isArchirectureInUse)return console.error("\u0414\u0430\u043D\u043D\u0430\u044F \u0430\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0430 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F \u0432 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u0438");const t=this.allKeys.find(n=>n.id===e),s=await this.$refs["key-modal"].show({title:"\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u043A\u043E\u043B\u043E\u043D\u043A\u0443",okButton:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430",key:t});if(!!s)try{if(s.remove)return await this.removeKey(e);await this.updateKey({id:e,newKey:s})}catch(n){const{response:r}=n,o=r?r.data.message:n.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:o,life:3e3})}}})},t$={class:"table-header"},s$=R("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u044D\u043B\u0435\u043C\u0435\u043D\u0442");function o$(e,t,s,n,r,o){const a=h("KeyModal"),i=h("Button"),d=h("Column"),_=h("TableCell"),p=h("DataTable",!0);return l(),u(b,null,[y(a,{ref:"key-modal"},null,512),y(p,{ref:"table",value:o.tableData,resizableColumns:!0,showGridlines:"",scrollable:!0,scrollHeight:"flex"},jn({default:C(()=>[o.counter?(l(),w(d,{key:0,field:o.counter.id,header:o.counter.name},{header:C(()=>[y(i,{icon:"pi pi-pencil",class:"p-button-rounded p-button-text",onClick:t[0]||(t[0]=v=>o.editKey(o.counter.id))})]),body:C(({index:v})=>[R($(v+1),1)]),_:1},8,["field","header"])):T("",!0),(l(!0),u(b,null,S(o.eidtableKeys,v=>(l(),w(d,{key:v.id,field:v.id,header:v.name,class:"column"},{header:C(({column:I})=>[y(i,{icon:"pi pi-pencil",class:"p-button-rounded p-button-text",onClick:O=>o.editKey(I.key)},null,8,["onClick"])]),body:C(({data:I,field:O,index:L})=>[y(_,{value:I[O],field:O,rowIndex:L,onChange:o.change},null,8,["value","field","rowIndex","onChange"])]),_:2},1032,["field","header"]))),128)),y(d,{field:"create",class:"create-cell"},{header:C(()=>[y(i,{label:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043A\u043E\u043B\u043E\u043D\u043A\u0443",onClick:o.createKeyHandler,icon:"pi pi-plus"},null,8,["onClick"])]),body:C(({index:v})=>[y(i,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:I=>o.removeRow(v)},null,8,["onClick"])]),_:1})]),_:2},[o.allKeys&&o.allKeys.length>0?{name:"header",fn:C(()=>[c("div",t$,[y(i,{onClick:o.createRow},{default:C(()=>[s$]),_:1},8,["onClick"])])])}:void 0]),1032,["value"])],64)}var n$=g(e$,[["render",o$],["__scopeId","data-v-4a59ff9b"]]);const uo=()=>({title:void 0,message:void 0,okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0}),r$={components:{PopupModal:ae},data(){return uo()},methods:{show(e){return this.title=e.title,this.message=e.message,this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.$refs.popup.open(),new Promise(t=>{this.resolvePromise=t})},_confirm(){this.$refs.popup.close(),this.resolvePromise(!0),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},reset(){Object.assign(this.$data,uo())}}},a$={class:"modal"},i$={class:"modal__title"},l$={class:"modal__actions"};function d$(e,t,s,n,r,o){const a=h("AppButton"),i=h("PopupModal");return l(),w(i,{ref:"popup"},{default:C(()=>[c("div",a$,[c("span",i$,$(e.title),1),c("span",null,$(e.message),1),c("div",l$,[e.cancelButton?(l(),w(a,{key:0,outlined:"",onClick:o._cancel},{default:C(()=>[R($(e.cancelButton),1)]),_:1},8,["onClick"])):T("",!0),y(a,{outlined:"",onClick:o._confirm},{default:C(()=>[R($(e.okButton),1)]),_:1},8,["onClick"])])])]),_:1},512)}var c$=g(r$,[["render",d$],["__scopeId","data-v-7901fe19"]]);const u$={emits:["change"],computed:m({},k("directory",["directories"])),methods:{async fileChangeHandler(e){const t=e.target.files[0];e.target.value="";const s=await this.readExcel(t);this.$emit("change",s)},readExcel(e){return new Promise((t,s)=>{const n=new FileReader;n.onload=function(r){const o=r.target.result,a=qn(o,{type:"binary"}),i=a.SheetNames,d=a.Sheets[i[0]],_=Hn.sheet_to_json(d,{header:1});t(_)},n.onerror=function(){s([])},n.readAsBinaryString(e)})}}},_$=e=>(x("data-v-e22e1988"),e=e(),P(),e),h$=_$(()=>c("label",{class:"file-uploader",for:"file"},"\u0418\u043C\u043F\u043E\u0440\u0442 \u0438\u0437 Excel",-1));function m$(e,t,s,n,r,o){return l(),u(b,null,[h$,c("input",{type:"file",id:"file",hidden:"",onChange:t[0]||(t[0]=(...a)=>o.fileChangeHandler&&o.fileChangeHandler(...a))},null,32)],64)}var p$=g(u$,[["render",m$],["__scopeId","data-v-e22e1988"]]);const y$={components:{ContentBody:Le,SearchInput:Gt,DirectoryList:kn,CreateButton:bn,DirectoryForm:wn,DataTable:n$,ExcelModal:c$,ExcelUploader:p$,RemoveModal:$n},mixins:[se,Qe],data(){return{search:"",showCreateFolder:!1}},computed:f(m({},k("directory",["directories","root","roots"])),{directoryId(){return this.$route.params.id},directory(){return this.directoryId?this.directories.find(e=>e._id===this.directoryId):null},values(){return this.directory.values.map(e=>e.data)},subFolders(){return this.directory?this.directories.filter(e=>e.parent===this.directory._id):[]},architectureValues(){return this.directories.filter(t=>t._id!==this.directoryId&&t.values.length>0).map(t=>{const r=this.getRoot(t._id).keys.filter(o=>o.type!==this.InputType.SELECT||o.type!==this.InputType.FORMULA).map(o=>({keyId:o.id,value:t.values.map(i=>i.data[o.id])}));return{dirId:t._id,values:r}})}}),methods:f(m({},A("directory",["updateById","updateDirectoryValues"])),{openCreateDirectory(){this.showCreateFolder=!0},async createArchitecture(){await this.updateValues([])},async removeArchitecture(){if(this.directory.values.length===0)return await this.updateValues(!1);await this.$refs["remove-modal"].show({title:"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0435",message:"\u0412 \u0434\u0430\u043D\u043D\u043E\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0435 \u0435\u0441\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435, \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0435 \u0431\u0443\u0434\u0443\u0442 \u0443\u0442\u0435\u0440\u044F\u043D\u044B",cancelButton:" \u041E\u0442\u043C\u0435\u043D\u0430",okButton:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",folderName:this.directory.name})&&await this.updateValues(!1)},getTypeOfColumn(e){let t=null;const s=this.architectureValues.find(r=>{t=null;const o=r.values.find(a=>e.every(i=>a.value.includes(i)));if(o)return t=o.keyId,!0});if(!s)return{type:typeof e[0]=="string"?this.InputType.STRING:this.InputType.NUMBER};const n=this.getRoot(s.dirId)._id;return{type:this.InputType.SELECT,keys:[t],dirId:s.dirId,root:n}},isSameKeys(e){return e.length!==this.root.keys.length?!1:e.every((t,s)=>t===this.root.keys[s].name)},async fileChangeHandler(e){if(e.length===0)return;if(this.root.keys.length>0&&!this.isSameKeys(e[0]))return await this.$refs["excel-modal"].show({title:"\u041E\u0448\u0438\u0431\u043A\u0430",message:"\u0414\u0430\u043D\u043D\u044B\u0435 \u0438\u0437 Excel \u0441\u043E\u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \u0430\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0435 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0430",okButton:"Ok"});if(this.directory.values.length>0&&await this.$refs["excel-modal"].show({title:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043F\u043E\u0441\u043E\u0431 \u0438\u043C\u043F\u043E\u0440\u0442\u0430 \u0434\u0430\u043D\u043D\u044B\u0445",message:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435 \u0438\u043B\u0438 \u0437\u0430\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0435?",okButton:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",cancelButton:"\u0417\u0430\u043C\u0435\u043D\u0438\u0442\u044C"})){const r=this.mergedData(e),{keys:o,values:a}=r;return await this.updateArchitecture(o),await this.updateValues(a)}const{keys:t,values:s}=this.replacedData(e);await this.updateArchitecture(t),await this.updateValues(s)},async updateArchitecture(e){if(!!this.root)try{await this.updateById({id:this.root._id,data:{keys:e}})}catch(t){const{response:s}=t,n=s?s.data.message:t.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:n,life:3e3})}},async updateValues(e){const t=JSON.parse(JSON.stringify(this.directory)),s=f(m({},t),{values:e});try{await this.updateById({id:this.directory._id,data:s})}catch(n){const{response:r}=n,o=r?r.data.message:n.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:o,life:3e3})}},getExcelKeysAndValues(e){const s=e.filter(o=>!o.every(i=>{if(!i||typeof i=="string"&&i.trim().length===0)return!0})).map(o=>o.map(a=>typeof a=="string"?a.trim():a)),n=s[0].map((o,a)=>({name:o,id:Date.now()+a+""})),r=[...s];return r.shift(),{keys:n,values:r}},getTableKeys(e,t){const s=e.map((n,r)=>t.map(o=>o[r]));return e.map((n,r)=>{if(n.type)return n;const o=this.getTypeOfColumn(s[r]);return m(m({},n),o)})},getTableValues(e,t){return t.map((s,n)=>{const r=e.reduce((o,a,i)=>{if(a.type===this.InputType.SELECT||a.type===this.InputType.FORMULA){const _=this.directories.find(p=>p._id===a.dirId).values.find(p=>a.keys.map(I=>p.data[I]).includes(s[i]));return o[a.id]=(_==null?void 0:_.id)||"no data",o}return o[a.id]=s[i],o},{});return{id:Date.now()+n+"",data:r}})},replacedData(e){const{keys:t,values:s}=this.getExcelKeysAndValues(e),n=t.map((a,i)=>{const d=this.root.keys.find(({name:v})=>v===a.name);if(d)return d;const _=s.map(v=>v[i]),p=this.getTypeOfColumn(_);return m(m({},a),p)}),r=this.getTableKeys(n,s),o=this.getTableValues(n,s);return{keys:r,values:o}},mergedData(e){const{keys:t,values:s}=this.getExcelKeysAndValues(e),n=t.map((_,p)=>{const v=this.root.keys.find(({name:L})=>L===_.name);if(v)return v;const I=s.map(L=>L[p]),O=this.getTypeOfColumn(I);return m(m({},_),O)}),r=this.getTableValues(n,s),o=[...this.directory.values,...r],a=[...this.root.keys,...n];return{keys:[...new Set(a.map(_=>_.id))].map(_=>a.find(p=>p.id===_)),values:o}}})},f$={class:"header"},v$={key:0,class:"header__actions"},g$={class:"header__actions-group"},b$=R(" \u0423\u0434\u043B\u0430\u0438\u0442\u044C \u0430\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0443 "),w$={key:0,class:"create-form"},$$={key:1,class:"choose"};function k$(e,t,s,n,r,o){const a=h("ExcelModal"),i=h("SearchInput"),d=h("AppButton"),_=h("ExcelUploader"),p=h("RemoveModal"),v=h("DirectoryForm"),I=h("CreateButton"),O=h("DirectoryList"),L=h("DataTable"),D=h("ContentBody");return o.directory?(l(),w(D,{key:0},{header:C(()=>[y(a,{ref:"excel-modal"},null,512),c("div",f$,[y(i,{modelValue:r.search,"onUpdate:modelValue":t[0]||(t[0]=V=>r.search=V),class:"search-input"},null,8,["modelValue"]),!o.subFolders.length&&o.directory.values?(l(),u("div",v$,[c("div",g$,[y(d,{outlined:"",onClick:o.removeArchitecture},{default:C(()=>[b$]),_:1},8,["onClick"])]),y(_,{onChange:o.fileChangeHandler},null,8,["onChange"])])):T("",!0)])]),content:C(()=>[y(p,{ref:"remove-modal"},null,512),r.showCreateFolder?(l(),u("div",w$,[y(v,{onCreated:t[1]||(t[1]=V=>r.showCreateFolder=!1)})])):!o.subFolders.length&&!o.directory.values?(l(),u("div",$$,[y(I,{text:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0430\u043F\u043A\u0443",onClick:o.openCreateDirectory},null,8,["onClick"]),y(I,{text:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0430\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0443",onClick:o.createArchitecture},null,8,["onClick"])])):o.subFolders.length&&!o.directory.values?(l(),w(O,{key:2,items:o.subFolders},null,8,["items"])):(l(),w(L,{key:3,directory:o.directory},null,8,["directory"]))]),_:1})):T("",!0)}var C$=g(y$,[["render",k$],["__scopeId","data-v-c9a20fd8"]]),Zt={data(){return{expandedKeys:{},expandedKeysLength:null,filters:{}}},methods:{expandAll(){for(const e of this.tree)this.expandNode(e);this.expandedKeys=m({},this.expandedKeys),this.expandedKeysLength=Object.keys(this.expandedKeys).length},expandNode(e){if(e.children&&e.children.length){this.expandedKeys[e.key]=!0;for(const t of e.children)this.expandNode(t)}},filterHandler(){this.expandedKeysLength!==Object.keys(this.expandedKeys).length&&this.expandAll()}}};const I$={components:{Dialog:go,DataTable:wo,Column:Ae},props:{modelValue:{type:Boolean,default:!1},nodeToSort:{type:Object}},emits:["update:modelValue"],data(){return{loading:!1,node:null,tableData:[]}},computed:f(m({},k("edition",["selectedEdition"])),{keys(){if(!this.selectedEdition)return[];const{keys:e}=this.selectedEdition;return[e[0]]},display:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}),methods:f(m({},A("edition",["update"])),{onShow(){this.node=JSON.parse(JSON.stringify(this.nodeToSort)),this.tableData=this.nodeToSort.children.map(e=>f(m({},e.data),{key:e.key}))},onRowReorder(e){const{value:t}=e;this.tableData=t},updateNodeInTree(e,t){const{key:s,children:n}=e,{key:r}=t;return s===r?t:(n&&n.length>0&&(e.children=n.map(o=>this.updateNodeInTree(o,t))),e)},async save(){this.loading=!0;try{const e=this.tableData.map(o=>{const{key:a}=o;return this.node.children.find(d=>d.key===a)});this.node.children=e;const t=JSON.parse(JSON.stringify(this.selectedEdition)),{data:s}=t,n=this.updateNodeInTree(s,this.node),r=f(m({},t),{data:n});await this.update({id:r._id,data:r}),this.close()}catch(e){const{response:t}=e,s=t?t.data.message:e.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:s,life:3e3})}finally{this.loading=!1}},close(){const{dialog:e}=this.$refs;e.close(),this.node=null,this.tableData=[]}})},S$={class:"modal-title"},O$={class:"modal-body"},T$=["disabled"],R$={key:0,class:"pi pi-spin pi-spinner"},V$=R(" \u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C "),L$=["disabled"];function D$(e,t,s,n,r,o){const a=h("Column"),i=h("DataTable"),d=h("Dialog");return l(),w(d,{visible:o.display,"onUpdate:visible":t[2]||(t[2]=_=>o.display=_),ref:"dialog",style:{width:"70vw"},modal:!0,draggable:!1,closeOnEscape:!1,closable:!r.loading,onShow:o.onShow},{header:C(()=>[c("span",S$,' \u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u043F\u043E\u0440\u044F\u0434\u043E\u043A \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 "'+$(s.nodeToSort.data[o.keys[0].id])+'" ',1)]),footer:C(()=>[c("button",{class:"button save-button",disabled:r.loading,onClick:t[0]||(t[0]=(..._)=>o.save&&o.save(..._))},[r.loading?(l(),u("i",R$)):T("",!0),V$],8,T$),c("button",{class:"button cancel-button",disabled:r.loading,onClick:t[1]||(t[1]=(..._)=>o.close&&o.close(..._))}," \u041E\u0442\u043C\u0435\u043D\u0430 ",8,L$)]),default:C(()=>[c("div",O$,[y(i,{value:r.tableData,reorderableColumns:!0,scrollHeight:"flex",scrollable:!0,onRowReorder:o.onRowReorder},{default:C(()=>[y(a,{rowReorder:!0,headerStyle:"width: 3rem",reorderableColumn:!1}),(l(!0),u(b,null,S(o.keys,_=>(l(),w(a,{key:_.id,field:_.id,header:_.name},null,8,["field","header"]))),128))]),_:1},8,["value","onRowReorder"])])]),_:1},8,["visible","closable","onShow"])}var N$=g(I$,[["render",D$],["__scopeId","data-v-32b10584"]]);const x$={components:{TreeTable:pt,Column:Ae,ContentBody:Le,InputText:Oe,SortModal:N$},mixins:[Zt],data(){return{nodeToSort:null,showModal:!1}},computed:f(m({},k("edition",["selectedEdition"])),{columns(){return this.selectedEdition.keys.map((e,t)=>f(m({},e),{id:e.id+"",expander:t===0}))},tree(){if(!this.selectedEdition)return[];const{data:e}=this.selectedEdition;return[e]}}),watch:{tree:{handler(){this.expandAll()},immediate:!0}},methods:{sortCategory(e){this.nodeToSort=e,this.showModal=!0}}},Cn=e=>(x("data-v-062a60f0"),e=e(),P(),e),P$={class:"text-right"},A$={class:"p-input-icon-left"},E$=Cn(()=>c("i",{class:"pi pi-search"},null,-1)),B$=["onClick"],M$=Cn(()=>c("i",{class:"pi pi-sort-alt"},null,-1)),J$=[M$];function K$(e,t,s,n,r,o){const a=h("SortModal"),i=h("InputText"),d=h("Column"),_=h("TreeTable"),p=h("ContentBody");return l(),w(p,null,{content:C(()=>[y(a,{modelValue:r.showModal,"onUpdate:modelValue":t[0]||(t[0]=v=>r.showModal=v),nodeToSort:r.nodeToSort},null,8,["modelValue","nodeToSort"]),o.tree?(l(),w(_,{key:0,value:o.tree,expandedKeys:e.expandedKeys,scrollable:!0,class:"p-treetable-sm",filters:e.filters,scrollHeight:"flex"},{header:C(()=>[c("div",P$,[c("div",A$,[E$,y(i,{modelValue:e.filters.global,"onUpdate:modelValue":t[1]||(t[1]=v=>e.filters.global=v),onInput:e.filterHandler,placeholder:"\u0413\u043B\u043E\u0431\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u043E\u0438\u0441\u043A"},null,8,["modelValue","onInput"])])])]),default:C(()=>[(l(!0),u(b,null,S(o.columns,(v,I)=>(l(),w(d,{key:v.id,field:v.id,header:v.name,expander:v.expander,class:N(v.expander?"first":"secondary")},{body:C(({node:O})=>[c("span",{class:N(["column-body",{bold:O.children.length>0}])},[O.children.length&&O.children.length>0&&I===0?(l(),u("button",{key:0,class:"button",onClick:L=>o.sortCategory(O)},J$,8,B$)):T("",!0),R(" "+$(O.data[v.id]),1)],2)]),_:2},1032,["field","header","expander","class"]))),128))]),_:1},8,["value","expandedKeys","filters"])):T("",!0)]),_:1})}var In=g(x$,[["render",K$],["__scopeId","data-v-062a60f0"]]);const _o=()=>({title:void 0,okButton:void 0,cancelButton:void 0,paths:[],resolvePromise:void 0,rejectPromise:void 0,name:""}),j$={components:{PopupModal:ae},data(){return _o()},methods:f(m({},A("priceList",["create"])),{async show(e){return this.title=e.title,this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.paths=e.paths,this.$refs.popup.open(),await this.$nextTick(),this.$refs.input.focus(),new Promise(t=>{this.resolvePromise=t})},async _confirm(){await this.createPriceList(),this.$refs.popup.close(),this.resolvePromise(!0),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},async createPriceList(){try{await this.create({name:this.name})}catch(e){const{response:t}=e,s=t?t.data.message:e.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:s,life:3e3})}},reset(){Object.assign(this.$data,_o())}})},q$=e=>(x("data-v-077d35ff"),e=e(),P(),e),H$={class:"modal"},U$={class:"modal__title"},W$=q$(()=>c("label",null,"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",-1)),F$={class:"modal__actions"};function G$(e,t,s,n,r,o){const a=h("AppButton"),i=h("PopupModal");return l(),w(i,{ref:"popup"},{default:C(()=>[c("div",H$,[c("span",U$,$(e.title),1),c("form",{onSubmit:t[1]||(t[1]=Y((...d)=>o._confirm&&o._confirm(...d),["prevent"]))},[W$,H(c("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>e.name=d),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",ref:"input",type:"text"},null,512),[[te,e.name]])],32),c("div",F$,[y(a,{outlined:"",onClick:o._cancel},{default:C(()=>[R($(e.cancelButton),1)]),_:1},8,["onClick"]),y(a,{outlined:"",onClick:o._confirm},{default:C(()=>[R($(e.okButton),1)]),_:1},8,["onClick"])])])]),_:1},512)}var Sn=g(j$,[["render",G$],["__scopeId","data-v-077d35ff"]]);const Q$={components:{InputText:Oe,InputNumber:ht,Dropdown:We},mixins:[se],props:{modelValue:{required:!0},field:{required:!0,type:String},root:{required:!0,type:Object},updated:{type:Boolean,default:!1},disabled:Boolean},emits:["update:modelValue"],computed:f(m({},k("directory",["roots","directories"])),{key(){return this.root.keys.find(e=>e.id===this.field)},type(){var e;return(e=this.key)==null?void 0:e.type},newValue:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},options(){if(this.type!==this.InputType.SELECT)return[];const e=this.roots.find(n=>n._id===this.key.root);if(!e)return[];const t=e.keys.filter(n=>this.key.keys.includes(n.id));return t.length?this.directories.find(n=>n._id===this.key.dirId).values.map(n=>{const r=t.map(o=>{if(o.type===this.InputType.SELECT||o.type===this.InputType.FORMULA){const a=n.data[o.id];return this.getValueOfCell(o.dirId,o.root,a,o.keys)}return n.data[o.id]});return{hidden:!1,text:r.join(", ")}}):[]}}),mounted(){if(this.type!==this.InputType.SELECT)return;!!this.options.find(t=>t.text===this.modelValue)||(this.newValue=this.options[0].text)},methods:{getValueOfCell(e,t,s,n){const r=this.directories.find(d=>d._id===e);return r?this.roots.find(d=>d._id===t).keys.filter(d=>n.includes(d.id)).map(d=>{const _=r.values.find(p=>p.id===+s);if(d.type===this.InputType.SELECT){const p=_.data[d.id];return this.getValueOfCell(d.dirId,d.root,p,d.keys)}return _.data[d.id]}):null}}};function Z$(e,t,s,n,r,o){const a=h("InputText"),i=h("InputNumber"),d=h("Dropdown");return o.type===e.InputType.STRING?(l(),w(a,{key:0,modelValue:o.newValue,"onUpdate:modelValue":t[0]||(t[0]=_=>o.newValue=_),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",disabled:s.disabled,class:N({updated:s.updated})},null,8,["modelValue","disabled","class"])):o.type===e.InputType.NUMBER||o.type===e.InputType.PRICE||o.type===e.InputType.QUANTITY?(l(),w(i,{key:1,modelValue:o.newValue,"onUpdate:modelValue":t[1]||(t[1]=_=>o.newValue=_),format:!1,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",disabled:s.disabled,class:N({updated:s.updated})},null,8,["modelValue","disabled","class"])):o.type===e.InputType.SELECT?(l(),w(d,{key:2,modelValue:o.newValue,"onUpdate:modelValue":t[2]||(t[2]=_=>o.newValue=_),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",options:o.options,optionLabel:"text",optionValue:"text",disabled:s.disabled,class:N({updated:s.updated})},null,8,["modelValue","options","disabled","class"])):o.type===e.InputType.FORMULA?(l(),w(d,{key:3,modelValue:o.newValue,"onUpdate:modelValue":t[3]||(t[3]=_=>o.newValue=_),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",options:e.formulaOptions,disabled:s.disabled,class:N({updated:s.updated})},null,8,["modelValue","options","disabled","class"])):T("",!0)}var z$=g(Q$,[["render",Z$]]),On={data(){return{selectedValues:null,selectedColumns:[],readOnlyColumns:[],name:"",rootId:null}},computed:f(m(m(m({},k("directory",["roots"])),k("edition",["clonedDirectories","editions","clone","selectedEdition"])),k("priceList",["selectedPriceList"])),{selectedRoot(){if(!this.rootId&&!this.selectedPriceList)return null;const e=this.selectedPriceList&&this.selectedPriceList.editions[0],t=e&&this.editions.find(n=>n._id===e),s=t?t.dirId:this.rootId;return this.roots.find(n=>n._id===s)},columns(){return this.selectedRoot?this.selectedRoot.keys.map((e,t)=>f(m({},e),{id:e.id+"",expander:t===0,editable:t===2})):[]}}),methods:f(m(m({},B("edition",["setClonedDirectories","setClone"])),A("edition",["create"])),{getSubItems(e){const t=this.clonedDirectories.filter(o=>(o==null?void 0:o.parent)===e._id),{values:s}=e,n=s?s.map(o=>({key:o.id,data:o.data,children:[]})):t.map(o=>this.getSubItems(o)),r={[this.columns[0].id]:e.name};return{key:e._id,data:r,children:n}},convertData(e){const{children:t}=e;return t&&t.length>0&&(e.children=t.filter(s=>this.selectedValues[s.key]),e.children=e.children.map(this.convertData)),e},multiSelectChangeHandler(){this.readOnlyColumns=this.selectedColumns.map(e=>this.columns.find(t=>t.id===e.id))},async createHandler(){if(!this.selectedRoot||!this.selectedValues||!this.name||this.selectedColumns.length===0||Object.keys(this.selectedValues).length===0||!this.selectedPriceList&&!await this.$refs["create-priceList"].show({title:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442",okButton:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430"}))return;const e=this.selectedColumns.map(n=>{const r=!!this.readOnlyColumns.find(o=>o.id===n.id);return{id:n.id,name:n.name,readonly:r}}),t=this.convertData(JSON.parse(JSON.stringify(this.tree[0]))),s={keys:e,data:t,dirId:this.selectedRoot._id,name:this.name};try{await this.create(s),this.setClone(null),this.$router.push("/pricelists")}catch(n){const{response:r}=n,o=r?r.data.message:n.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:o,life:3e3})}}})};const Y$={components:{ContentBody:Le,CreatePriceList:Sn,TreeTable:pt,Column:Ae,MultiSelect:ut,InputText:Oe,InputNumber:ht,Dropdown:We,EditableCell:z$},mixins:[On,se,Zt],data(){return{selectedValues:null,selectedColumns:[],readOnlyColumns:[],name:"",tree:[],oldKeys:[],newKeys:[],differenceKeys:[],isMassiveChangeMode:!1,selectedValuesBefore:null,listOfTreeValues:null,listOfTreeValuesInit:null,selectedKey:null,percent:0,treeBefore:null,timeout:null,updatedFields:[]}},computed:{columns(){return this.selectedEdition?this.selectedEdition.keys.map((e,t)=>f(m({},e),{id:e.id+"",expander:t===0})):[]},selectedRows(){if(!this.isMassiveChangeMode)return[];const e=Object.keys(this.selectedValues).filter(t=>!z(t));return this.listOfTreeValues.filter(t=>e.includes(t.key))},keysToEdit(){return this.selectedRoot?this.selectedColumns.map(t=>{const s=this.selectedRoot.keys.find(n=>n.id===t.id);if(s){const{type:n}=s;return f(m({},t),{type:n})}return t}).filter(t=>t.readonly?!1:t.type===this.InputType.NUMBER||t.type===this.InputType.QUANTITY||t.type===this.InputType.PRICE):[]}},mounted(){(!this.selectedRoot||!this.clone)&&(this.tree=[]);const e=JSON.parse(JSON.stringify(this.getSubItems(this.selectedRoot))),t=this.clone.value,s=JSON.parse(JSON.stringify(t)),r=this.treeToList(JSON.parse(JSON.stringify(e)),[]).filter(O=>typeof O=="string"),a=this.treeToList(JSON.parse(JSON.stringify(s[0])),[]).filter(O=>typeof O=="string"),i=X.exports.difference(a,r),d=X.exports.difference(r,a),_=this.clone.mergeType==="full"?this.merge1(JSON.parse(JSON.stringify([e])),JSON.parse(JSON.stringify(s))):this.merge2(JSON.parse(JSON.stringify([e])),JSON.parse(JSON.stringify(s))),p=JSON.parse(JSON.stringify(this.selectedEdition.keys));this.selectedColumns=p.map((O,L)=>f(m({},O),{id:O.id+"",expander:L===0})),this.readOnlyColumns=this.selectedColumns.filter(O=>O.readonly),this.selectedValues=this.getSelectedValues(this.clone.value[0]),this.tree=_,this.listOfTreeValues=this.treeToListOnlyValues(this.tree[0]),this.listOfTreeValuesInit=JSON.parse(JSON.stringify(this.listOfTreeValues));const v=new Set(this.getFullDifference(this.tree[0],i)),I=new Set(this.getFullDifference(this.tree[0],d));this.oldKeys=[...v],this.newKeys=[...I]},methods:{getKeys(e){return e!=null&&e.key?[e.key]:e!=null&&e.children?Object.values(e.children).map(this.getKeys).flat():[]},treeToList(e,t){const{key:s,children:n}=e;return n&&n.length>0&&s?[e,...e.children.map(r=>this.treeToList(r,t)).flat()]:[...t,e.key]},treeToListOnlyValues(e){const{children:t,key:s}=e,n=t.map(this.treeToListOnlyValues).flat();return z(s)?n:[...n,e]},getFullDifference(e,t){const{children:s,key:n}=e,r=z(n);let o=[];return r&&t.includes(e.key)?o=[...this.treeToList(e,[])]:r&&s.length>0&&(o=[...s.map(i=>this.getFullDifference(i,t)).flat()]),r||t.includes(n)&&o.push(n),o.length>0?[n,...o]:[]},getSelectedValues(e){const t={[e.key]:{checked:!0}};let s=[];return e.children&&e.children.length>0&&(s=e.children.reduce((n,r)=>{const o=this.getSelectedValues(r);return n=m(m({},n),o),n},{})),m(m({},t),s)},merge1(e,t){return X.exports.merge(e,t)},merge2(e,t){return X.exports.mergeWith(e,t,(s,n)=>{if(X.exports.isArray(s))return n=n.filter(r=>!!s.find(({key:o})=>+r.key===o)),X.exports.merge(s,n)})},resetMassiveChangeMode(){this.percent=null,this.selectedValuesBefore=null,this.isMassiveChangeMode=!1,this.treeBefore=null,this.selectedKey=null},enableMassiveChangeMode(){this.isMassiveChangeMode=!0,this.selectedValuesBefore=JSON.parse(JSON.stringify(this.selectedValues)),this.listOfTreeValues=this.treeToListOnlyValues(this.tree[0]),this.treeBefore=JSON.parse(JSON.stringify(this.tree)),this.selectedValues={}},cacnelMassiveChangeMode(){this.selectedValues=JSON.parse(JSON.stringify(this.selectedValuesBefore)),this.tree=this.treeBefore,this.resetMassiveChangeMode()},updateValues(e){this.timeout&&(this.timeout=clearTimeout(this.timeout)),this.timeout=setTimeout(()=>{const{value:t}=e;this.selectedRows.forEach(s=>{const r=this.listOfTreeValuesInit.find(a=>a.key===s.key).data[this.selectedKey],o=r/100*t;s.data[this.selectedKey]=+(r+o).toFixed(2)})},500)},applyChanges(){this.updatedFields=X.exports.differenceWith(this.listOfTreeValues,this.listOfTreeValuesInit,(e,t)=>X.exports.isEqual(e.data,t.data)),this.updatedFields=this.updatedFields.map(({key:e})=>e),this.selectedValues=JSON.parse(JSON.stringify(this.selectedValuesBefore)),this.resetMassiveChangeMode()},onNodeSelect(e){if(!this.isMassiveChangeMode||!this.selectedKey)return;if(!z(e.key)){const n=e.data[this.selectedKey]/100*this.percent;e.data[this.selectedKey]=+(e.data[this.selectedKey]+n).toFixed(2);return}return this.treeToListOnlyValues(e).forEach(n=>{const o=this.listOfTreeValuesInit.find(i=>i.key===n.key).data[this.selectedKey],a=o/100*this.percent;n.data[this.selectedKey]=+(o+a).toFixed(2)})},onNodeUnselect(e){if(!this.isMassiveChangeMode)return;if(!z(e.key)){const r=this.listOfTreeValuesInit.find(o=>o.key===e.key).data[this.selectedKey];e.data[this.selectedKey]=r;return}return this.treeToListOnlyValues(e).forEach(n=>{const o=this.listOfTreeValuesInit.find(a=>a.key===n.key).data[this.selectedKey];n.data[this.selectedKey]=o})},editableCellUpdateHandler(){this.timeout&&(this.timeout=clearTimeout(this.timeout)),this.timeout=setTimeout(()=>{const e=this.treeToListOnlyValues(this.tree[0]);this.updatedFields=X.exports.differenceWith(e,this.listOfTreeValuesInit,(t,s)=>X.exports.isEqual(t.data,s.data)),this.updatedFields=this.updatedFields.map(({key:t})=>t)},500)}}},zt=e=>(x("data-v-4c2b434f"),e=e(),P(),e),X$={class:"header"},ek={class:"header__row"},tk={class:"header__actions"},sk=R(" \u041C\u0430\u0441\u0441\u043E\u0432\u043E\u0435 \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u0435 "),ok=R("\u041E\u0442\u043C\u0435\u043D\u0430"),nk=R("\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"),rk={key:0,class:"header__message"},ak=R(" \u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F "),ik=R(" \u041E\u0442\u043C\u0435\u043D\u0430 "),lk={class:"table-header"},dk={class:"table-header__row"},ck={class:"p-input-icon-left"},uk=zt(()=>c("i",{class:"pi pi-search"},null,-1)),_k={class:"table-header__row"},hk={class:"table-header__multiselect"},mk=zt(()=>c("span",null," \u041E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0435\u043C\u044B\u0435 \u043A\u043E\u043B\u043D\u043A\u0438 ",-1)),pk={class:"table-header__multiselect"},yk=zt(()=>c("span",null," \u041A\u043E\u043B\u043E\u043D\u043A\u0438 \u0434\u043B\u044F \u0447\u0442\u0435\u043D\u0438\u044F ",-1)),fk={key:0,class:"bold"},vk={key:2};function gk(e,t,s,n,r,o){const a=h("InputText"),i=h("AppButton"),d=h("InputNumber"),_=h("Dropdown"),p=h("CreatePriceList"),v=h("MultiSelect"),I=h("EditableCell"),O=h("Column"),L=h("TreeTable"),D=h("ContentBody");return l(),w(D,null,{header:C(()=>[c("div",X$,[c("div",ek,[y(a,{modelValue:r.name,"onUpdate:modelValue":t[0]||(t[0]=V=>r.name=V),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u0438"},null,8,["modelValue"]),c("div",tk,[r.isMassiveChangeMode?(l(),u(b,{key:1},[o.selectedRows.length===0?(l(),u("span",rk,"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F")):r.selectedKey?(l(),w(d,{key:1,modelValue:r.percent,"onUpdate:modelValue":t[2]||(t[2]=V=>r.percent=V),suffix:" %",placeholder:"\u041F\u0440\u043E\u0446\u0435\u043D\u0442",minFractionDigits:2,onInput:o.updateValues},null,8,["modelValue","onInput"])):T("",!0),y(_,{modelValue:r.selectedKey,"onUpdate:modelValue":t[3]||(t[3]=V=>r.selectedKey=V),options:o.keysToEdit,placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043B\u044E\u0447",optionLabel:"name",optionValue:"id"},null,8,["modelValue","options"]),y(i,{outlined:"",onClick:o.applyChanges},{default:C(()=>[ak]),_:1},8,["onClick"]),y(i,{outlined:"",onClick:o.cacnelMassiveChangeMode},{default:C(()=>[ik]),_:1},8,["onClick"])],64)):(l(),u(b,{key:0},[y(i,{outlined:"",onClick:o.enableMassiveChangeMode},{default:C(()=>[sk]),_:1},8,["onClick"]),y(i,{outlined:"",onClick:t[1]||(t[1]=V=>e.setClone(null))},{default:C(()=>[ok]),_:1}),y(i,{outlined:"",onClick:e.createHandler},{default:C(()=>[nk]),_:1},8,["onClick"])],64))])])])]),content:C(()=>[y(p,{ref:"create-priceList"},null,512),r.tree?(l(),w(L,{key:0,selectionKeys:r.selectedValues,"onUpdate:selectionKeys":t[7]||(t[7]=V=>r.selectedValues=V),value:r.tree,selectionMode:"checkbox",expandedKeys:e.expandedKeys,scrollable:!0,filters:e.filters,scrollHeight:"flex",class:"p-treetable-sm",onNodeSelect:o.onNodeSelect,onNodeUnselect:o.onNodeUnselect},{header:C(()=>[c("div",lk,[c("div",dk,[c("div",ck,[uk,y(a,{modelValue:e.filters.global,"onUpdate:modelValue":t[4]||(t[4]=V=>e.filters.global=V),onInput:e.filterHandler,placeholder:"\u0413\u043B\u043E\u0431\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u043E\u0438\u0441\u043A"},null,8,["modelValue","onInput"])])]),c("div",_k,[c("div",hk,[mk,y(v,{modelValue:r.selectedColumns,"onUpdate:modelValue":t[5]||(t[5]=V=>r.selectedColumns=V),onChange:e.multiSelectChangeHandler,options:o.columns,optionLabel:"name",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043E\u043B\u043E\u043D\u043A\u0438"},null,8,["modelValue","onChange","options"])]),c("div",pk,[yk,y(v,{modelValue:r.readOnlyColumns,"onUpdate:modelValue":t[6]||(t[6]=V=>r.readOnlyColumns=V),options:r.selectedColumns,optionLabel:"name",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043E\u043B\u043E\u043D\u043A\u0438"},null,8,["modelValue","options"])])])])]),default:C(()=>[(l(!0),u(b,null,S(r.selectedColumns,V=>(l(),w(O,{key:V.id,field:V.id,header:V.name,expander:V.expander,class:N(V.expander?"first":"secondary")},{body:C(({node:K})=>{var q;return[c("div",{class:N(["wrapper",[{neutral:r.oldKeys.includes(K.key)&&r.newKeys.includes(K.key)},{oldest:r.oldKeys.includes(K.key)},{newest:r.newKeys.includes(K.key)}]])},[K.children.length>0?(l(),u("span",fk,$(K.data[V.id]),1)):!V.readonly&&V.id in K.data?(l(),w(I,{key:1,modelValue:K.data[V.id],"onUpdate:modelValue":[M=>K.data[V.id]=M,o.editableCellUpdateHandler],root:e.selectedRoot,field:V.id,style:Q(V.expander&&"width: 100%"),updated:(q=r.updatedFields)==null?void 0:q.includes(K.key),disabled:r.isMassiveChangeMode},null,8,["modelValue","onUpdate:modelValue","root","field","style","updated","disabled"])):(l(),u("span",vk,$(K.data[V.id]),1))],2)]}),_:2},1032,["field","header","expander","class"]))),128))]),_:1},8,["selectionKeys","value","expandedKeys","filters","onNodeSelect","onNodeUnselect"])):T("",!0)]),_:1})}var Tn=g(Y$,[["render",gk],["__scopeId","data-v-4c2b434f"]]);const ho=()=>({title:void 0,okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0}),bk={components:{PopupModal:ae},data(){return ho()},methods:f(m({},A("priceList",["create"])),{show(e){return this.title=e.title,this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.$refs.popup.open(),new Promise(t=>{this.resolvePromise=t})},_confirm(){this.$refs.popup.close(),this.resolvePromise(!0),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},reset(){Object.assign(this.$data,ho())}})},Rn=e=>(x("data-v-4b88314e"),e=e(),P(),e),wk={class:"modal"},$k={class:"modal__title"},kk=Rn(()=>c("span",null," \u0414\u0430\u043D\u043D\u044B\u0435 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0430 \u0438 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u0438 \u043E\u0442\u043B\u0438\u0447\u0430\u044E\u0442\u0441\u044F. ",-1)),Ck=Rn(()=>c("span",null,"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0430?",-1)),Ik={class:"modal__actions"};function Sk(e,t,s,n,r,o){const a=h("AppButton"),i=h("PopupModal");return l(),w(i,{ref:"popup"},{default:C(()=>[c("div",wk,[c("span",$k,$(e.title),1),kk,Ck,c("div",Ik,[y(a,{outlined:"",onClick:o._cancel},{default:C(()=>[R($(e.cancelButton),1)]),_:1},8,["onClick"]),y(a,{outlined:"",onClick:o._confirm},{default:C(()=>[R($(e.okButton),1)]),_:1},8,["onClick"])])])]),_:1},512)}var Ok=g(bk,[["render",Sk],["__scopeId","data-v-4b88314e"]]);const Tk={components:{ConfirmModal:Ok},computed:f(m({},k("edition",["active","selectedEdition","clonedDirectories"])),{tree(){if(!this.selectedEdition)return[];const{data:e}=this.selectedEdition;return[e]},isSame(){if(!this.selectedEdition)return!1;const e=!!this.clonedDirectories.find(s=>s._id===this.selectedEdition.dirId),t=!![this.selectedEdition.data].find(this.isSameNode);return e&&t},isActive(){var e,t;return((e=this.selectedEdition)==null?void 0:e._id)===((t=this.active)==null?void 0:t._id)}}),methods:f(m(m({},B("edition",["setClone"])),A("edition",["remove","setActive"])),{isSameNode(e,t){const{children:s,key:n}=e;if(z(n)){const a=this.clonedDirectories.find(i=>i._id===e.key);return a?s.every(i=>this.isSameNode(i,a)):!1}const{values:o}=t;return!!o.find(a=>a.id===n)},async activeEdition(){if(!this.isActive)try{await this.setActive(this.selectedEdition._id)}catch(e){const{response:t}=e,s=t?t.data.message:e.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:s,life:3e3})}},async clone(){if(!this.isSame&&await this.$refs["confirm-modal"].show({title:"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F",okButton:"\u0414\u0430",cancelButton:"\u041D\u0435\u0442"}))return this.setClone({value:this.tree,mergeType:"rightJoin"});this.setClone({value:this.tree,mergeType:"full"})},async removeHandler(){try{await this.remove(this.selectedEdition._id)}catch(e){const{response:t}=e,s=t?t.data.message:e.message;this.$toast.add({severity:"error",summary:"\u041E\u0448\u0438\u0431\u043A\u0430",detail:s,life:3e3})}}})},Rk=R(" \u0423\u0434\u0430\u043B\u0438\u0442\u044C ");function Vk(e,t,s,n,r,o){const a=h("ConfirmModal"),i=h("AppButton");return l(),u("div",null,[y(a,{ref:"confirm-modal"},null,512),y(i,{outlined:"",onClick:o.activeEdition},{default:C(()=>[R($(o.isActive?"\u0410\u043A\u0442\u0438\u0432\u043D\u0430\u044F \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u044F":"\u0421\u0434\u0435\u043B\u0430\u0442\u044C \u0430\u043A\u0442\u0438\u0432\u043D\u043E\u0439"),1)]),_:1},8,["onClick"]),y(i,{outlined:"",variant:"primary",onClick:o.clone},{default:C(()=>[R(" \u041A\u043B\u043E\u043D\u0438\u0440\u043E\u0432\u0430\u0442\u044C "+$(o.isSame?"":"*"),1)]),_:1},8,["onClick"]),y(i,{outlined:"",variant:"danger",onClick:o.removeHandler},{default:C(()=>[Rk]),_:1},8,["onClick"])])}var Lk=g(Tk,[["render",Vk]]);const Dk={components:{AppContent:Ft,IndexView:In,CloneView:Tn,Dropdown:We,IndexActions:Lk},mixins:[Qe,se],data(){return{loading:!0}},computed:f(m(m(m({},k("directory",["roots","directories"])),k("priceList",["priceLists","selectedPriceList"])),k("edition",["editions","selectedEdition","clone","active"])),{selectedPriceListId:{get(){return this.$store.state.priceList.selectedPriceList},set(e){this.setSelectedPriceList(e)}},selectedEditionId:{get(){return this.$store.state.edition.selectedEdition},set(e){this.setSelectedEdition(e),this.goToIndex()}},priceListOptions(){return this.priceLists.map(e=>({label:e.name,value:e._id}))},editionOptions(){return this.selectedPriceList?this.editions.filter(t=>this.selectedPriceList.editions.includes(t._id)).map(t=>({label:`${t.name} \u043E\u0442 ${new Date(t.date).toLocaleDateString()}`,value:t._id})):[]}}),watch:{selectedPriceList(e){if(!e&&this.priceLists.length===0)return this.$router.push("/pricelists/create");!e&&this.$route.name!=="createEdition"&&this.setData()},selectedEdition(e){!e&&this.$route.name!=="createEdition"&&this.setData()}},async mounted(){this.priceLists.length===0&&this.$router.push({name:"createEdition"}),this.createClonedDirectories(),this.setData(),this.loading=!1},methods:f(m(m(m({},B("edition",["setSelectedEdition","setClonedDirectories"])),B("priceList",["setSelectedPriceList"])),A("priceList",{create:"create"})),{async goToCreateEdition(){await this.$router.push({name:"createEdition"}),this.setSelectedEdition(null),this.$refs["dropdown-edition"].hide()},async goToCreatePriceList(){await this.$router.push({name:"createEdition"}),this.setSelectedPriceList(null),this.setSelectedEdition(null),this.$refs["dropdown-priceList"].hide()},goToIndex(){this.$router.push("/pricelists"),this.$refs["dropdown-edition"].hide()},priceListChangeHandler(){var t;this.setData();const e=((t=this.active)==null?void 0:t._id)||this.selectedPriceList.editions[this.selectedPriceList.editions.length-1];this.setSelectedEdition(e),this.$router.push({name:"pricelistsIndex"})},setData(){var e;if(!this.selectedPriceList){const t=this.priceLists[this.priceLists.length-1];if(!t){this.loading=!1;return}this.setSelectedPriceList(t._id)}if(this.$route.name!=="createEdition"&&!this.selectedEdition){const t=((e=this.active)==null?void 0:e._id)||this.selectedPriceList.editions[this.selectedPriceList.editions.length-1];this.setSelectedEdition(t)}},getValueOfCell(e,t,s){const n=this.roots.find(o=>o._id===e);return n?n.keys.filter(o=>s.includes(o.id)).map(o=>{const a=n.values.find(i=>i.id===t);if(!a)return null;if(o.type===this.InputType.SELECT||o.type===this.InputType.FORMULA){const i=a.data[o.id];return this.getValueOfCell(o.dirId,i,o.keys)}return a.data[o.id]}):null},isValidClone(e,t){if(!e)return!1;const s=t.find(r=>r.parent===e._id);return this.isValidClone(s,t)||e.values},createClonedDirectories(){const e=JSON.parse(JSON.stringify(this.directories)),s=e.filter(n=>this.isValidClone(n,e)).map(n=>{const{values:r}=n;if(!r)return n;const o=this.getRoot(n._id),{keys:a}=o,i=a.filter(_=>_.type===this.InputType.SELECT||_.type===this.InputType.FORMULA),d=a.filter(_=>_.type===this.InputType.NUMBER||_.type===this.InputType.PRICE||_.type===this.InputType.QUANTITY);return n.values=r.map(_=>(_.data=Object.entries(_.data).reduce((p,[v,I])=>{const O=i.find(D=>D.id===v);if(O){const D=I,V=this.getValueOfCell(O.dirId,D,O.keys);return p[v]=V==null?void 0:V.join(", "),p}return I=d.find(D=>D.id===v)?I||0:I,p[v]=I,p},{}),_)),n});this.setClonedDirectories(s)}})},Vn=e=>(x("data-v-554b2ec5"),e=e(),P(),e),Nk={class:"header"},xk={class:"header__action-group"},Pk={class:"header__action"},Ak=Vn(()=>c("label",{class:"bold"},"\u041F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442",-1)),Ek=R(" \u0421\u043E\u0437\u0434\u0430\u0442\u044C "),Bk={class:"header__action"},Mk=Vn(()=>c("label",{class:"bold"},"\u0420\u0435\u0434\u0430\u043A\u0446\u0438\u044F",-1)),Jk=R(" \u0421\u043E\u0437\u0434\u0430\u0442\u044C "),Kk={key:0};function jk(e,t,s,n,r,o){const a=h("AppButton"),i=h("Dropdown"),d=h("IndexActions"),_=h("CloneView"),p=h("IndexView"),v=h("RouterView"),I=h("AppContent");return r.loading?T("",!0):(l(),w(I,{key:0},{header:C(()=>[c("div",Nk,[c("div",xk,[c("div",Pk,[Ak,y(i,{modelValue:o.selectedPriceListId,"onUpdate:modelValue":t[0]||(t[0]=O=>o.selectedPriceListId=O),ref:"dropdown-priceList",onChange:o.priceListChangeHandler,options:o.priceListOptions,disabled:!!e.clone,filter:!0,optionLabel:"label",optionValue:"value",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442"},{header:C(()=>[y(a,{class:"dropdown-button",outlined:"",onClick:o.goToCreatePriceList},{default:C(()=>[Ek]),_:1},8,["onClick"])]),_:1},8,["modelValue","onChange","options","disabled"])]),c("div",Bk,[Mk,y(i,{modelValue:o.selectedEditionId,"onUpdate:modelValue":t[1]||(t[1]=O=>o.selectedEditionId=O),ref:"dropdown-edition",options:o.editionOptions,disabled:!!e.clone,filter:!0,optionLabel:"label",optionValue:"value",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u044E"},{header:C(()=>[y(a,{class:"dropdown-button",outlined:"",onClick:o.goToCreateEdition},{default:C(()=>[Jk]),_:1},8,["onClick"])]),_:1},8,["modelValue","options","disabled"])])]),e.$route.name==="pricelistsIndex"&&!e.clone&&e.selectedEdition?(l(),w(d,{key:0,class:"header__action-group"})):T("",!0)])]),body:C(()=>[e.directories.length===0?(l(),u("span",Kk," \u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442 \u0431\u0435\u0437 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0430 ")):(l(),w(v,{key:1},{default:C(({Component:O,route:L})=>[e.clone?(l(),w(_,{key:0})):L.name!=="pricelistsIndex"?(l(),w(Se(O),{key:1})):e.selectedPriceList&&e.selectedEdition?(l(),w(p,{key:2,priceList:e.selectedPriceList,edition:e.selectedEdition},null,8,["priceList","edition"])):T("",!0)]),_:1}))]),_:1}))}var qk=g(Dk,[["render",jk],["__scopeId","data-v-554b2ec5"]]);const Hk={components:{ContentBody:Le,CreatePriceList:Sn,TreeTable:pt,Column:Ae,SelectButton:Un,MultiSelect:ut,InputText:Oe},mixins:[On,Zt],computed:{outlayKeys(){return bd},tooltipData(){return`\u0420\u0435\u0434\u0430\u043A\u0446\u0438\u044F \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u0441\u043E\u0437\u0434\u0430\u043D\u0430 \u0438\u0437 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u043E\u0432 \u0441 \u043A\u043E\u043B\u043E\u043D\u043A\u0430\u043C\u0438: ${this.outlayKeys.join(", ")}`},tree(){if(!this.selectedRoot)return[];const e=this.clonedDirectories.find(s=>s._id===this.selectedRoot._id);return[this.getSubItems(e)]},rootOptions(){return this.roots.filter(t=>{const{keys:s}=t;return this.outlayKeys.every(n=>s.find(r=>r.type===n))}).map(t=>({name:t.name,value:t._id}))}},watch:{selectedRoot(){this.selectedColumns=this.columns,this.readOnlyColumns=this.columns}},mounted(){this.selectedColumns=this.columns,this.readOnlyColumns=this.columns},methods:{changeRoot(){this.selectedValues=null,this.selectedColumns=this.columns,this.readOnlyColumns=this.columns}}},Yt=e=>(x("data-v-ac397b16"),e=e(),P(),e),Uk={class:"header"},Wk={class:"header__row"},Fk=R("\u0421\u043E\u0437\u0434\u0430\u0442\u044C"),Gk={class:"select"},Qk={key:0,class:"header__row"},Zk=R(" \u041A\u043E\u0440\u043D\u0435\u0432\u043E\u0439 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A "),zk={class:"pi pi-question-circle",style:{"font-size":"16px"}},Yk={class:"table-header"},Xk={class:"table-header__row"},e2={class:"p-input-icon-left"},t2=Yt(()=>c("i",{class:"pi pi-search"},null,-1)),s2={class:"table-header__row"},o2={class:"table-header__multiselect"},n2=Yt(()=>c("span",null," \u041E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0435\u043C\u044B\u0435 \u043A\u043E\u043B\u043D\u043A\u0438 ",-1)),r2={class:"table-header__multiselect"},a2=Yt(()=>c("span",null," \u041A\u043E\u043B\u043E\u043D\u043A\u0438 \u0434\u043B\u044F \u0447\u0442\u0435\u043D\u0438\u044F ",-1));function i2(e,t,s,n,r,o){const a=h("InputText"),i=h("AppButton"),d=h("SelectButton"),_=h("CreatePriceList"),p=h("MultiSelect"),v=h("Column"),I=h("TreeTable"),O=h("ContentBody"),L=Pe("tooltip");return l(),w(O,null,{header:C(()=>[c("div",Uk,[c("div",Wk,[y(a,{modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=D=>e.name=D),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u0438"},null,8,["modelValue"]),y(i,{outlined:"",onClick:e.createHandler},{default:C(()=>[Fk]),_:1},8,["onClick"])]),c("div",Gk,[e.selectedPriceList?T("",!0):(l(),u("div",Qk,[c("span",null,[Zk,H(c("i",zk,null,512),[[L,o.tooltipData,void 0,{top:!0}]])]),y(d,{modelValue:e.rootId,"onUpdate:modelValue":t[1]||(t[1]=D=>e.rootId=D),options:o.rootOptions,onChange:o.changeRoot,optionLabel:"name",optionValue:"value"},null,8,["modelValue","options","onChange"])]))])])]),content:C(()=>[y(_,{ref:"create-priceList"},null,512),e.selectedRoot?(l(),w(I,{key:0,value:o.tree,selectionMode:"checkbox",expandedKeys:e.expandedKeys,scrollable:!0,class:"p-treetable-sm",filters:e.filters,scrollHeight:"flex",selectionKeys:e.selectedValues,"onUpdate:selectionKeys":t[5]||(t[5]=D=>e.selectedValues=D)},{header:C(()=>[c("div",Yk,[c("div",Xk,[c("div",e2,[t2,y(a,{modelValue:e.filters.global,"onUpdate:modelValue":t[2]||(t[2]=D=>e.filters.global=D),onInput:e.filterHandler,placeholder:"\u0413\u043B\u043E\u0431\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u043E\u0438\u0441\u043A"},null,8,["modelValue","onInput"])])]),c("div",s2,[c("div",o2,[n2,y(p,{modelValue:e.selectedColumns,"onUpdate:modelValue":t[3]||(t[3]=D=>e.selectedColumns=D),onChange:e.multiSelectChangeHandler,options:e.columns,optionLabel:"name",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043E\u043B\u043E\u043D\u043A\u0438",style:{width:"20em"}},null,8,["modelValue","onChange","options"])]),c("div",r2,[a2,y(p,{modelValue:e.readOnlyColumns,"onUpdate:modelValue":t[4]||(t[4]=D=>e.readOnlyColumns=D),options:e.selectedColumns,optionLabel:"name",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043E\u043B\u043E\u043D\u043A\u0438",style:{width:"20em"}},null,8,["modelValue","options"])])])])]),default:C(()=>[(l(!0),u(b,null,S(e.selectedColumns,D=>(l(),w(v,{key:D.id,field:D.id,header:D.name,expander:D.expander,class:N(D.expander?"first":"secondary")},{body:C(({node:V})=>[c("span",{class:N({bold:V.children.length>0})},$(V.data[D.id]),3)]),_:2},1032,["field","header","expander","class"]))),128))]),_:1},8,["value","expandedKeys","filters","selectionKeys"])):T("",!0)]),_:1})}var l2=g(Hk,[["render",i2],["__scopeId","data-v-ac397b16"]]);const d2={components:{AppDropdown:gn,ThreeDotsIcon:vn},props:{outlay:{type:Object,default:()=>({}),required:!0}},data(){return{items:[{text:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0430\u043A\u0442\u044B",handler:()=>{this.$router.push(`/outlay/${this.outlay._id}/acts`)}}]}},methods:{openFolder(){this.$router.push("/outlay/2")}}},c2={class:"outlay-item__header"},u2={class:"outlay-item__name"};function _2(e,t,s,n,r,o){const a=h("ThreeDotsIcon"),i=h("AppDropdown");return l(),u("li",{class:"outlay-item",onDblclick:t[0]||(t[0]=(...d)=>o.openFolder&&o.openFolder(...d))},[c("div",c2,[c("span",u2,$(s.outlay.name),1),y(i,{ref:"dropdown",items:r.items},{default:C(()=>[y(a)]),_:1},8,["items"])])],32)}var h2=g(d2,[["render",_2],["__scopeId","data-v-60648e0f"]]);const m2={components:{OutlayItem:h2},computed:f(m({},k("outlays",["outlays"])),{reversedOutlays(){return[...this.outlays]}})},p2={key:0,class:"outlay-list"};function y2(e,t,s,n,r,o){const a=h("OutlayItem");return o.reversedOutlays&&o.reversedOutlays.length>0?(l(),u("ul",p2,[(l(!0),u(b,null,S(o.reversedOutlays,i=>(l(),w(a,{key:i._id,outlay:i},null,8,["outlay"]))),128))])):T("",!0)}var f2=g(m2,[["render",y2],["__scopeId","data-v-4b058f88"]]);const v2={components:{ContentBody:Le,SearchInput:Gt,OutlayList:f2}},g2={class:"header"};function b2(e,t,s,n,r,o){const a=h("SearchInput"),i=h("OutlayList"),d=h("ContentBody");return l(),w(d,null,{header:C(()=>[c("div",g2,[y(a)])]),content:C(()=>[y(i)]),_:1})}var w2=g(v2,[["render",b2]]);const $2={components:{AppContent:Ft}},k2=c("span",{class:"page-title"},"\u0421\u043C\u0435\u0442\u044B",-1);function C2(e,t,s,n,r,o){const a=h("RouterView"),i=h("AppContent");return l(),w(i,null,{header:C(()=>[k2]),body:C(()=>[y(a)]),_:1})}var st=g($2,[["render",C2]]);const I2={components:{PrintPage:Go},computed:f(m(m({},k("outlays",["outlays"])),k("outlay",["outlay"])),{outlayId(){return this.$route.params.id}}),watch:{outlayId:{handler(){if(this.outlay)return;const e=this.outlays.find(t=>t._id===this.outlayId);!e||this.setOutlay(e)},immediate:!0}},methods:m({},A("outlay",["setOutlay"]))};function S2(e,t,s,n,r,o){const a=h("PrintPage");return e.outlay?(l(),w(a,{key:0,outlay:e.outlay},null,8,["outlay"])):T("",!0)}var O2=g(I2,[["render",S2]]);const T2={components:{PrintPage:yn},computed:f(m(m(m({},k("outlays",["outlays"])),k("acts",["act"])),Ce("acts",["acts"])),{actId(){return this.$route.params.id}}),watch:{actId:{handler(){this.act||this.setData()},immediate:!0}},methods:f(m(m({},A("outlay",{prepareOutlay:"setOutlay"})),A("acts",["setOutlay","setAct"])),{async setData(){const e=this.acts.find(n=>n._id===this.actId);if(!e)return;const{outlay:t}=e,s=this.outlays.find(n=>n._id===t);await this.prepareOutlay(s),await this.setOutlay(s),await this.setAct(e)}})};function R2(e,t,s,n,r,o){const a=h("PrintPage");return e.act?(l(),w(a,{key:0,act:e.act},null,8,["act"])):T("",!0)}var V2=g(T2,[["render",R2]]);const L2=Wn({history:Fn("/"),routes:[{path:"/",name:"home",component:Wb,meta:{layout:"MainLayout"}},{path:"/directories",name:"directories",component:i0,meta:{layout:"MainLayout"},children:[{path:"",name:"directoriesIndex",component:Sw},{path:":id",name:"directoriyView",component:C$}]},{path:"/pricelists",name:"pricelists",component:qk,meta:{layout:"MainLayout"},children:[{path:"",name:"pricelistsIndex",component:In},{path:"create",name:"createEdition",component:l2},{path:"clone/:id",name:"cloneEdition",component:Tn}]},{path:"/outlay",name:"outlay",component:st,meta:{layout:"MainLayout"},children:[{path:"",name:"smetaIndexView",component:w2}]},{path:"/outlay/:id",name:"outlayView",component:st,meta:{layout:"OutlayLayout"}},{path:"/print/:id",name:"printView",component:O2,meta:{layout:"PrintLayout"}},{path:"/print/act/:id",name:"printActView",component:V2,meta:{layout:"PrintLayout"}},{path:"/outlay/:id/acts",name:"actsView",component:st,meta:{layout:"ActLayout"}}]});var D2={namespaced:!0,state:{priceLists:[],contentLoaded:!1,selectedPriceList:null},mutations:{setPriceLists(e,t){e.priceLists=t},setContentLoaded(e,t){e.contentLoaded=t},pushPriceList(e,t){e.priceLists.push(t)},removePriceList(e,t){e.priceLists=e.priceLists.filter(s=>s._id!==t)},setSelectedPriceList(e,t){e.selectedPriceList=t},updatePriceList(e,{id:t,value:s}){e.priceLists=e.priceLists.map(n=>n._id===t?s:n)},removeEdition(e,{id:t,editionId:s}){const n=e.priceLists.find(r=>r._id===t);!n||(n.editions=n.editions.filter(r=>r!==s))}},actions:{async fetchAll({state:e,commit:t,rootState:s}){if(!(e.contentLoaded||s.isOffline))try{const n=await J.get("/pricelist");return t("setPriceLists",n.data),t("setContentLoaded",!0),await j.setArrayToCollection("priceLists",n.data),n}catch(n){return Promise.reject(n)}},async updateEditions({commit:e},{id:t,editions:s}){try{const n=await J.put(`/pricelist/${t}`,{editions:s});e("updatePriceList",{id:t,value:n.data})}catch(n){return Promise.reject(n)}},async create({commit:e},t){try{const s=await J.post("/pricelist",t);return e("pushPriceList",s.data),e("setSelectedPriceList",s.data._id),s}catch(s){return Promise.reject(s)}},async remove({commit:e},t){try{const s=await J.delete(`/pricelist/${t}`);return e("setSelectedPriceList",null),e("removePriceList",t),s}catch(s){return Promise.reject(s)}}},getters:{priceLists:e=>e.priceLists,selectedPriceList:e=>e.priceLists.find(t=>t._id===e.selectedPriceList)}},N2={namespaced:!0,state:{editions:[],contentLoaded:!1,clonedDirectories:[],selectedEdition:null,clone:null},mutations:{setEditions(e,t){e.editions=t},setContentLoaded(e,t){e.contentLoaded=t},pushEditions(e,t){e.editions.push(t)},removeEdition(e,t){e.editions=e.editions.filter(s=>s._id!==t)},setSelectedEdition(e,t){e.selectedEdition=t},setClone(e,t){if(!t)return e.clone=t;const{value:s,mergeType:n}=t;e.clone={value:JSON.parse(JSON.stringify(s)),mergeType:n}},setClonedDirectories(e,t){e.clonedDirectories=t},update(e,{id:t,data:s}){e.editions=e.editions.map(n=>n._id===t?m(m({},n),s):n)}},actions:{async fetchAll({state:e,commit:t,rootGetters:s}){if(!(e.contentLoaded||s.isOffline))try{const n=await J.get("/edition");return t("setEditions",n.data),t("setContentLoaded",!0),await j.setArrayToCollection("editions",n.data),n}catch(n){return Promise.reject(n)}},async create({commit:e,rootGetters:t,dispatch:s},n){try{const r=t["priceList/selectedPriceList"];if(!r)return;const o=await J.post("/edition",n);return e("pushEditions",o.data),await s("priceList/updateEditions",{id:r._id,editions:[...r.editions,o.data._id]},{root:!0}),e("setSelectedEdition",o.data._id),o}catch(r){return console.log(r),Promise.reject(r)}},async setActive({commit:e,rootGetters:t},s){try{const n=await J.patch(`/edition/${s}/active`),r=t["priceList/selectedPriceList"],{editions:o}=r;return o.forEach(a=>{e("update",{id:a,data:{active:a===s}})}),n}catch(n){return Promise.reject(n)}},async update({commit:e},{id:t,data:s}){try{const n=await J.put(`/edition/${t}`,s),{data:r}=n,{_id:o}=r;return e("update",{id:o,data:r}),n}catch(n){return Promise.reject(n)}},async remove({commit:e,rootGetters:t,dispatch:s},n){try{const r=await J.delete(`/edition/${n}`);e("removeEdition",n),e("setSelectedEdition",null);const o=t["priceList/selectedPriceList"],a=o.editions.filter(i=>i!==n);return a.length>0?(await s("priceList/updateEditions",{id:o._id,editions:a},{root:!0}),e("setSelectedEdition",a[a.length-1]),r):(await s("priceList/remove",o._id,{root:!0}),r)}catch(r){return Promise.reject(r)}}},getters:{editions:e=>e.editions,clonedDirectories:e=>e.clonedDirectories,selectedEdition:e=>e.editions.find(t=>t._id===e.selectedEdition),clone:e=>e.clone,active:(e,t,s,n)=>{const r=n["priceList/selectedPriceList"];if(!r)return null;const{editions:o}=r;return e.editions.filter(i=>o.includes(i._id)).find(i=>i.active)}}},x2={namespaced:!0,state:{contentLoaded:!1,outlays:[],loading:!1},mutations:{setContentLoaded(e,t){e.contentLoaded=t},setOutlays(e,t){e.outlays=t},pushOutlay(e,t){e.outlays.push(t)},updateById(e,{id:t,data:s}){e.outlays=e.outlays.map(n=>n._id===t?s:n)},async updateField(e,{id:t,key:s,value:n}){const r=e.outlays.find(o=>o._id===t);r[s]=n,await j.saveDataInCollection("outlays",r)},removeById(e,t){e.outlays=e.outlays.filter(s=>s._id!==t)}},actions:{async fetchAll({commit:e,state:t,rootGetters:s,dispatch:n}){if(t.contentLoaded||t.loading)return;t.loading=!0;const{isOffline:r}=s;try{const o=await ue.getAll();if(r)return e("setOutlays",o),e("setContentLoaded",!0),Promise.resolve(o);e("setOutlays",o);const a=s["outlay/outlay"];if(a){const i=o.find(d=>d._id===a._id);await n("outlay/setOutlay",i,{root:!0})}return await n("syncData"),e("setContentLoaded",!0),Promise.resolve(o)}catch(o){return Promise.reject(o)}finally{t.loading=!1}},async syncData({dispatch:e,state:t,rootGetters:s}){try{const n=t.outlays,r=await j.getCollectionData("outlays"),o=s["status/status"],a=nn(n,r,o),{created:i,updated:d,removed:_}=a;await j.setArrayToCollection("outlays",n),await Promise.all(i.map(async p=>await e("clone",p)),d.map(async p=>{const O=p,{_id:v}=O,I=be(O,["_id"]);return await e("update",{id:v,data:I})}),_.map(async p=>await e("removeLocal",p)))}catch(n){return Promise.reject(n)}},async uploadFromServer({rootGetters:e,commit:t,dispatch:s}){const{isOffline:n}=e;if(!n)try{return t("setContentLoaded",!1),await s("fetchAll")}catch(r){return Promise.reject(r)}},async saveArray({commit:e},t){try{return Promise.all(t.map(async s=>{const n=await J.post("/outlay",s);return e("updateById",{id:n._id,data:n.data}),n}))}catch(s){return Promise.reject(s)}},async create({commit:e,dispatch:t},s){try{const n=await ue.create(s);return e("pushOutlay",n.data),await t("outlay/setOutlay",n.data,{root:!0}),await j.saveDataInCollection("outlays",n.data),n}catch(n){return Promise.reject(n)}},async clone({dispatch:e},t){try{const s=Ro.getClone(t);return await e("create",s)}catch(s){return Promise.reject(s)}},async remove({state:e,commit:t,dispatch:s,rootGetters:n},r){var o;try{const{outlays:a}=e,i=a.find(_=>_._id===r);if(!i)throw new Error("Outlay not found");const d=await ue.remove(i);return((o=n["outlay/outlay"])==null?void 0:o._id)===r&&s("outlay/setOutlay",null,{root:!0}),t("updateById",{id:r,data:d.data}),d}catch(a){return Promise.reject(a)}},async removeLocal({commit:e},t){try{const s=await ue.remove(t);return e("removeById",t._id),s}catch(s){return Promise.reject(s)}},async setActive({commit:e},t){try{const s=await J.patch(`/outlay/${t}/active`),{updated:n}=s.data;return n.forEach(r=>e("updateField",{id:r._id,key:"active",value:r.active})),s}catch(s){return Promise.reject(s)}},async print(e,t){try{if(!t)throw new Error("id is required");return await J.post(`/outlay/pdf/${t}`,{domain:window.location.origin})}catch(s){return Promise.reject(s)}},getQuantityKey({rootState:e,rootGetters:t},s){const{quantityKey:n}=e.outlay;if(n)return n;const r=t["edition/editions"].find(i=>i._id===s.edition);return t["directory/directories"].find(i=>i._id===r.dirId).keys.find(i=>i.type===F.QUANTITY)},async update({commit:e,dispatch:t,rootGetters:s},{id:n,data:r}){try{const o=await ue.update(m({_id:n},r));e("updateById",{id:n,data:o.data});const a=s["outlay/outlay"];return a&&a._id===n&&await t("outlay/setOutlay",o.data,{root:!0}),o}catch(o){return Promise.reject(o)}}},getters:{outlays:e=>{const{outlays:t}=e;return t.filter(s=>!s.removedAt)}}},P2={namespaced:!0,state:{status:null,contentLoaded:!1},mutations:{setStatus(e,t){e.status=t},setContentLoaded(e,t){e.contentLoaded=t}},actions:{async getStatus({state:e,commit:t,rootState:s}){if(!(e.contentLoaded||s.isOffline))try{const n=await J.get("/status");return t("setStatus",n.data),t("setContentLoaded",!0),n}catch(n){return Promise.reject(n)}}},getters:{status:e=>{const{status:t}=e;return t&&t.startedAt}}};const A2=Gn({state:{isOffline:!1},mutations:{setIsOffline(e,t){e.isOffline=t,ue.isOffline=t,ce.isOffline=t}},getters:{isOffline:e=>e.isOffline},modules:{directory:Gw,priceList:D2,edition:N2,outlay:kd,outlays:x2,acts:hp,status:P2},actions:{async initApp({commit:e}){navigator.onLine||e("setIsOffline",!0)},async fetchAll({dispatch:e,commit:t,state:s}){try{return s.isOffline?await Promise.all(Object.keys(ot).map(async n=>{const r=await j.getCollectionData(n),{variableNameInModule:o,moduleName:a}=ot[n];return s[a][o]=r,r})):(t("status/setContentLoaded",!1,{root:!0}),t("directory/setContentLoaded",!1,{root:!0}),t("edition/setContentLoaded",!1,{root:!0}),t("priceList/setContentLoaded",!1,{root:!0}),t("outlays/setContentLoaded",!1,{root:!0}),t("acts/setContentLoaded",!1,{root:!0}),await e("status/getStatus",null,{root:!0}),await Promise.all([e("directory/fetchAll",null,{root:!0}),e("edition/fetchAll",null,{root:!0}),e("priceList/fetchAll",null,{root:!0}),e("outlays/fetchAll",null,{root:!0}),e("acts/fetchAll",null,{root:!0})]))}catch(n){return Promise.reject(n)}}}});function E2(e={}){const{immediate:t=!1,onNeedRefresh:s,onOfflineReady:n,onRegistered:r,onRegisterError:o}=e;let a,i;const d=async(_=!0)=>{_&&(a==null||a.addEventListener("controlling",p=>{p.isUpdate&&window.location.reload()})),i&&i.waiting&&await Zn(i.waiting,{type:"SKIP_WAITING"})};if("serviceWorker"in navigator){a=new Qn("/sw.js",{scope:"/",type:"classic"}),a.addEventListener("activated",_=>{_.isUpdate||n==null||n()});{const _=()=>{s==null||s()};a.addEventListener("waiting",_),a.addEventListener("externalwaiting",_)}a.register({immediate:t}).then(_=>{i=_,r==null||r(_)}).catch(_=>{o==null||o(_)})}return d}const B2={props:{outlined:Boolean,variant:String}};function M2(e,t,s,n,r,o){return l(),u("button",{class:N(["app-button",s.variant,{outlined:s.outlined}])},[ne(e.$slots,"default",{},void 0,!0)],2)}var J2=g(B2,[["render",M2],["__scopeId","data-v-21464fce"]]);const he=zn(jb);he.config.unwrapInjectedRef=!0;he.component("AppButton",J2);he.component("AppInput",fn);he.directive("tooltip",Yn);he.use(L2);he.use(A2);he.use(Xn);he.use(er);he.mount("#app");E2({immediate:!0});
