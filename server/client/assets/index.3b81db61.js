var ns=Object.defineProperty,os=Object.defineProperties;var rs=Object.getOwnPropertyDescriptors;var qe=Object.getOwnPropertySymbols;var is=Object.prototype.hasOwnProperty,as=Object.prototype.propertyIsEnumerable;var We=(e,t,s)=>t in e?ns(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,m=(e,t)=>{for(var s in t||(t={}))is.call(t,s)&&We(e,s,t[s]);if(qe)for(var s of qe(t))as.call(t,s)&&We(e,s,t[s]);return e},b=(e,t)=>os(e,rs(t));import{o as l,c as u,p as O,a as P,b as c,r as _,d as h,w as v,n as D,F as k,e as S,f as V,t as g,g as R,h as $,m as I,i as N,j as J,T as ls,k as Q,l as M,v as j,s as yt,q as ae,u as X,x as pe,y as de,z as K,A as ft,B as ue,C as vt,D as ds,E as F,G as gt,H as cs,I as us,J as Le,K as _s,L as he,M as ps,N as Te,O as me,P as hs,Q as bt,R as ms,S as ys,U as ye,V as fs,W as vs,X as gs,Y as Re,Z as fe,_ as bs,$ as $s,a0 as ws,a1 as Cs,a2 as ks,a3 as Is}from"./vendor.d08ca399.js";const Vs=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}};Vs();var Ss="/assets/logo.90913ff0.png";var f=(e,t)=>{const s=e.__vccOpts||e;for(const[o,r]of t)s[o]=r;return s};const Ls={},Ts=e=>(O("data-v-2522ba5c"),e=e(),P(),e),Rs={class:"logo"},xs=Ts(()=>c("img",{class:"logo__img",src:Ss,alt:"\u0421\u0442\u0443\u0434\u0442\u044F \u0440\u0435\u043C\u043E\u043D\u0442\u043E\u0432"},null,-1)),Os=[xs];function Ps(e,t,s,o,r,n){return l(),u("div",Rs,Os)}var xe=f(Ls,[["render",Ps],["__scopeId","data-v-2522ba5c"]]);const Ns={},Bs={width:"10",height:"9",viewBox:"0 0 10 9",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ds=c("path",{d:"M5.00008 8.41663L2.6546 4.66663L0.309111 0.916625L5.00008 0.916626L9.69105 0.916626L7.34557 4.66663L5.00008 8.41663Z",fill:"white"},null,-1),Es=[Ds];function Ms(e,t){return l(),u("svg",Bs,Es)}var As=f(Ns,[["render",Ms]]);const Ks={},Js={width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Hs=c("rect",{width:"14",height:"14",rx:"2",fill:"white"},null,-1),Us=c("path",{d:"M7.00363 10.08C6.43697 10.08 5.92697 9.96333 5.47363 9.73C5.02697 9.49 4.67697 9.16 4.42363 8.74C4.1703 8.32 4.04363 7.84333 4.04363 7.31C4.04363 6.77667 4.1703 6.3 4.42363 5.88C4.67697 5.46 5.02697 5.13333 5.47363 4.9C5.92697 4.66 6.43697 4.54 7.00363 4.54C7.5703 4.54 8.07697 4.66 8.52363 4.9C8.9703 5.13333 9.3203 5.46 9.57363 5.88C9.82697 6.3 9.95363 6.77667 9.95363 7.31C9.95363 7.84333 9.82697 8.32 9.57363 8.74C9.3203 9.16 8.9703 9.49 8.52363 9.73C8.07697 9.96333 7.5703 10.08 7.00363 10.08ZM7.00363 8.8C7.40363 8.8 7.7303 8.66667 7.98363 8.4C8.24363 8.12667 8.37363 7.76333 8.37363 7.31C8.37363 6.85667 8.24363 6.49667 7.98363 6.23C7.7303 5.95667 7.40363 5.82 7.00363 5.82C6.60363 5.82 6.27363 5.95667 6.01363 6.23C5.75363 6.49667 5.62363 6.85667 5.62363 7.31C5.62363 7.76333 5.75363 8.12667 6.01363 8.4C6.27363 8.66667 6.60363 8.8 7.00363 8.8Z",fill:"black"},null,-1),js=[Hs,Us];function Fs(e,t){return l(),u("svg",Js,js)}var qs=f(Ks,[["render",Fs]]);const Ws={components:{OpenIcon:As,NavItemIcon:qs},data(){return{isListVisible:!1,links:[{text:"\u0421\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0438",to:"/directories"},{text:"\u041F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442\u0430",to:"/pricelists"},{text:"\u0421\u043C\u0435\u0442\u0430",to:"/outlay"}]}},methods:{toggleList(){this.isListVisible=!this.isListVisible}}},Zs=e=>(O("data-v-092b9219"),e=e(),P(),e),Gs={class:"nav-menu"},Qs={class:"menu-item"},zs={class:"menu-item__body"},Ys=Zs(()=>c("span",{class:"menu-item__title"}," \u0410\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0430 \u0441\u043C\u0435\u0442\u044B ",-1)),Xs={key:0,class:"menu-item__list"};function en(e,t,s,o,r,n){const i=_("NavItemIcon"),a=_("OpenIcon"),d=_("AppButton"),p=_("RouterLink");return l(),u("nav",Gs,[c("div",Qs,[h(i),c("div",zs,[c("div",{class:"menu-item__head",onClick:t[0]||(t[0]=(...y)=>n.toggleList&&n.toggleList(...y))},[Ys,h(d,{class:D(["menu-item__button",{rotated:r.isListVisible}])},{default:v(()=>[h(a)]),_:1},8,["class"])]),r.isListVisible?(l(),u("ul",Xs,[(l(!0),u(k,null,S(r.links,y=>(l(),u("li",{key:y.to,class:"menu-item__list-item"},[h(p,{class:"menu-item__list-link",to:y.to,"active-class":"menu-item__list-link--active"},{default:v(()=>[V(g(y.text),1)]),_:2},1032,["to"])]))),128))])):R("",!0)])])])}var tn=f(Ws,[["render",en],["__scopeId","data-v-092b9219"]]);const sn={components:{AppLogo:xe,NavMenu:tn}},nn={class:"sidebar"},on={class:"sidebar__header"},rn={class:"sidebar__body"};function an(e,t,s,o,r,n){const i=_("AppLogo"),a=_("NavMenu");return l(),u("aside",nn,[c("div",on,[h(i)]),c("div",rn,[h(a)])])}var ln=f(sn,[["render",an],["__scopeId","data-v-6f172735"]]);const dn={},cn={width:"18",height:"16",viewBox:"0 0 18 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},un=c("line",{y1:"1",x2:"18",y2:"1",stroke:"white","stroke-width":"2"},null,-1),_n=c("line",{y1:"8",x2:"18",y2:"8",stroke:"white","stroke-width":"2"},null,-1),pn=c("line",{y1:"15",x2:"18",y2:"15",stroke:"white","stroke-width":"2"},null,-1),hn=[un,_n,pn];function mn(e,t){return l(),u("svg",cn,hn)}var yn=f(dn,[["render",mn]]);const fn={},vn=e=>(O("data-v-6612f46e"),e=e(),P(),e),gn={class:"user-avatar"},bn=vn(()=>c("span",{class:"user-avatar__name"}," CPP ",-1)),$n=[bn];function wn(e,t,s,o,r,n){return l(),u("div",gn,$n)}var $t=f(fn,[["render",wn],["__scopeId","data-v-6612f46e"]]);const Cn={},kn={width:"14",height:"17",viewBox:"0 0 14 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"},In=c("path",{d:"M6.99992 16.3334C7.91658 16.3334 8.66658 15.5834 8.66658 14.6667H5.33325C5.33325 15.5834 6.08325 16.3334 6.99992 16.3334ZM11.9999 11.3334V7.16671C11.9999 4.60837 10.6416 2.46671 8.24992 1.90004V1.33337C8.24992 0.641707 7.69158 0.083374 6.99992 0.083374C6.30825 0.083374 5.74992 0.641707 5.74992 1.33337V1.90004C3.36659 2.46671 1.99992 4.60004 1.99992 7.16671V11.3334L0.333252 13V13.8334H13.6666V13L11.9999 11.3334ZM10.3333 12.1667H3.66658V7.16671C3.66658 5.10004 4.92492 3.41671 6.99992 3.41671C9.07492 3.41671 10.3333 5.10004 10.3333 7.16671V12.1667Z",fill:"white"},null,-1),Vn=[In];function Sn(e,t){return l(),u("svg",kn,Vn)}var Ln=f(Cn,[["render",Sn]]);const Tn={components:{NotificationIcon:Ln}},Rn=e=>(O("data-v-3aad635a"),e=e(),P(),e),xn=Rn(()=>c("div",{class:"notification-button__counter"},"35",-1));function On(e,t,s,o,r,n){const i=_("NotificationIcon"),a=_("AppButton");return l(),$(a,{class:"notification-button"},{default:v(()=>[h(i,{class:"notification-button__icon"}),xn]),_:1})}var wt=f(Tn,[["render",On],["__scopeId","data-v-3aad635a"]]);const Pn={components:{BurgerIcon:yn,NotificationButton:wt,UserAvatar:$t}},Nn={class:"app-header"},Bn={class:"app-header__left-side"},Dn={class:"app-header__right-side"};function En(e,t,s,o,r,n){const i=_("BurgerIcon"),a=_("AppButton"),d=_("NotificationButton"),p=_("UserAvatar");return l(),u("div",Nn,[c("div",Bn,[h(a,null,{default:v(()=>[h(i)]),_:1})]),c("div",Dn,[h(d),h(a,null,{default:v(()=>[h(p)]),_:1})])])}var Mn=f(Pn,[["render",En],["__scopeId","data-v-f943073e"]]);const An={components:{AppHeader:Mn}},Kn={class:"app-container"},Jn={class:"app-container__content"};function Hn(e,t,s,o,r,n){const i=_("AppHeader"),a=_("RouterView");return l(),u("div",Kn,[h(i),c("div",Jn,[h(a)])])}var Un=f(An,[["render",Hn],["__scopeId","data-v-06cbdee2"]]);const jn={components:{AppSidebar:ln,AppContainer:Un}},Fn={class:"main"};function qn(e,t,s,o,r,n){const i=_("AppSidebar"),a=_("AppContainer");return l(),u("main",Fn,[h(i),h(a)])}var Wn=f(jn,[["render",qn],["__scopeId","data-v-20aea961"]]);const Zn={components:{AppLogo:xe}},Gn={class:"left-side"};function Qn(e,t,s,o,r,n){const i=_("AppLogo");return l(),u("div",Gn,[h(i)])}var zn=f(Zn,[["render",Qn],["__scopeId","data-v-6179896a"]]);const Yn={},Xn={width:"13",height:"13",viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},eo=c("path",{d:"M6.5 0.25C3.05 0.25 0.25 3.05 0.25 6.5C0.25 9.95 3.05 12.75 6.5 12.75C9.95 12.75 12.75 9.95 12.75 6.5C12.75 3.05 9.95 0.25 6.5 0.25ZM7.125 9.625H5.875V5.875H7.125V9.625ZM7.125 4.625H5.875V3.375H7.125V4.625Z",fill:"black"},null,-1),to=[eo];function so(e,t){return l(),u("svg",Xn,to)}var no=f(Yn,[["render",so]]);const oo={props:{outlay:{type:Object,required:!0}},computed:b(m({},I("outlay",{selected:"outlay"})),{isSelected(){var e;return((e=this.selected)==null?void 0:e._id)===this.outlay._id},date(){return new Date(this.outlay.date).toLocaleDateString()}}),methods:b(m({},N("outlay",["setOutlay"])),{selectOutlay(){this.setOutlay(this.outlay)},openMenu(e){this.$emit("open-menu",e,this.outlay._id)}})},ro=e=>(O("data-v-9c89bc04"),e=e(),P(),e),io={class:"outlay-item__dot-wrapper"},ao={key:0,class:"outlay-item__dot"},lo={class:"outlay-item__text"},co={class:"outlay-item__date"},uo=["title"],_o=ro(()=>c("i",{class:"pi pi-ellipsis-h icon"},null,-1)),po=[_o];function ho(e,t,s,o,r,n){return l(),u("div",{class:D(["outlay-item",{selected:n.isSelected,active:s.outlay.active}]),onClick:t[1]||(t[1]=(...i)=>n.selectOutlay&&n.selectOutlay(...i))},[c("div",io,[s.outlay.active?(l(),u("div",ao)):R("",!0)]),c("div",lo,[c("div",co,"\u043E\u0442 "+g(n.date),1),c("span",{class:"outlay-item__name",title:s.outlay.name},g(s.outlay.name),9,uo)]),c("button",{class:"button",onClick:t[0]||(t[0]=J((...i)=>n.openMenu&&n.openMenu(...i),["stop"]))},po)],2)}var mo=f(oo,[["render",ho],["__scopeId","data-v-9c89bc04"]]);const yo={data(){return{isVisible:!1}},methods:{open(){this.isVisible=!0},close(){this.$emit("onClose"),this.isVisible=!1}}};function fo(e,t,s,o,r,n){return l(),$(ls,{name:"fade"},{default:v(()=>[r.isVisible?(l(),u("div",{key:0,class:"popup-modal",onMousedown:t[1]||(t[1]=(...i)=>n.close&&n.close(...i))},[c("div",{class:"popup-modal__window",onMousedown:t[0]||(t[0]=J(()=>{},["stop"]))},[Q(e.$slots,"default",{},void 0,!0)],32)],32)):R("",!0)]),_:3})}var G=f(yo,[["render",fo],["__scopeId","data-v-50fe556e"]]);const Ze=()=>({okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0,name:""}),vo={components:{PopupModal:G},data(){return Ze()},methods:{async show(e){return this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.name=e.name,this.$refs.popup.open(),await this.$nextTick(),this.$refs.input.focus(),new Promise((t,s)=>{this.resolvePromise=t,this.rejectPromise=s})},_confirm(){if(!this.name)return;const e={name:this.name};this.$refs.popup.close(),this.resolvePromise(e),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},reset(){Object.assign(this.$data,Ze())}}},Ct=e=>(O("data-v-24a6981c"),e=e(),P(),e),go={class:"modal"},bo=Ct(()=>c("span",{class:"modal__title"},"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043D\u043E\u0432\u0443\u044E \u0441\u043C\u0435\u0442\u0443",-1)),$o={class:"form__group"},wo=Ct(()=>c("label",{class:"form__label"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",-1)),Co={class:"modal__actions"};function ko(e,t,s,o,r,n){const i=_("AppButton"),a=_("PopupModal");return l(),$(a,{ref:"popup"},{default:v(()=>[c("div",go,[bo,c("form",{class:"form",onSubmit:t[1]||(t[1]=J((...d)=>n._confirm&&n._confirm(...d),["prevent"]))},[c("div",$o,[wo,M(c("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>e.name=d),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",ref:"input",class:"input"},null,512),[[j,e.name]])])],32),c("div",Co,[h(i,{outlined:"",onClick:n._cancel},{default:v(()=>[V(g(e.cancelButton),1)]),_:1},8,["onClick"]),h(i,{outlined:"",onClick:n._confirm},{default:v(()=>[V(g(e.okButton),1)]),_:1},8,["onClick"])])])]),_:1},512)}var Io=f(vo,[["render",ko],["__scopeId","data-v-24a6981c"]]);const Vo={components:{OutlayItem:mo,Menu:yt,EditModal:Io},data(){return{selectedItem:null}},computed:b(m({},I("outlays",["outlays"])),{selectedOutlay(){return this.outlays.find(e=>e._id===this.selectedItem)},items(){var e,t;return[{label:"\u0421\u0434\u0435\u043B\u0430\u0442\u044C \u0430\u043A\u0442\u0438\u0432\u043D\u043E\u0439",command:async()=>{try{await this.setActive(this.selectedItem)}catch(s){console.log(s)}},disabled:(e=this.selectedOutlay)==null?void 0:e.active},{label:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",command:async()=>{const s=await this.$refs["edit-modal"].show({okButton:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430",name:this.selectedOutlay.name});try{await this.update({id:this.selectedItem,data:m(m({},this.selectedOutlay),s)})}catch(o){console.log(o)}},disabled:(t=this.selectedOutlay)==null?void 0:t.active},{label:"\u041A\u043B\u043E\u043D\u0438\u0440\u043E\u0432\u0430\u0442\u044C",command:async()=>{const s=this.outlays.find(n=>n._id===this.selectedItem),o=JSON.parse(JSON.stringify(s)),r=b(m({},o),{active:!1,date:void 0,_id:void 0});try{await this.create(r)}catch(n){console.log(n)}},disabled:!1},{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",command:async()=>{try{await this.remove(this.selectedItem)}catch(s){console.log(s)}finally{this.selectedItem=null}},disabled:!1}]},outlayList(){return[...this.outlays].reverse()}}),methods:b(m({},N("outlays",["create","remove","setActive","update"])),{openMenu(e,t){this.selectedItem=t,this.$refs.menu.toggle(e)}})},So={key:0,class:"outlay-list"};function Lo(e,t,s,o,r,n){const i=_("Menu"),a=_("EditModal"),d=_("OutlayItem");return l(),u(k,null,[h(i,{ref:"menu",model:n.items,popup:!0},null,8,["model"]),h(a,{ref:"edit-modal"},null,512),e.outlays&&e.outlays.length>0?(l(),u("div",So,[(l(!0),u(k,null,S(n.outlayList,p=>(l(),$(d,{key:p._id,outlay:p,onOpenMenu:n.openMenu},null,8,["outlay","onOpenMenu"]))),128))])):R("",!0)],64)}var To=f(Vo,[["render",Lo],["__scopeId","data-v-6318c125"]]);const Ge=()=>({okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0}),Ro={components:{PopupModal:G},data(){return Ge()},computed:m({},I("outlay",["outlay"])),methods:{show(){return this.$refs.popup.open(),new Promise((e,t)=>{this.resolvePromise=e,this.rejectPromise=t})},_confirm(){this.$refs.popup.close(),this.resolvePromise(!0),this.reset()},reset(){Object.assign(this.$data,Ge())}}},kt=e=>(O("data-v-0c5666f3"),e=e(),P(),e),xo={class:"modal"},Oo=kt(()=>c("span",{class:"modal__title"},"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F",-1)),Po=kt(()=>c("span",null," \u041E\u0431\u044A\u0435\u043A\u0442: .... ",-1)),No={class:"modal__actions"},Bo=V(" \u0417\u0430\u043A\u0440\u044B\u0442\u044C ");function Do(e,t,s,o,r,n){const i=_("AppButton"),a=_("PopupModal");return l(),$(a,{ref:"popup"},{default:v(()=>[c("div",xo,[Oo,Po,c("div",No,[h(i,{outlined:"",onClick:n._confirm},{default:v(()=>[Bo]),_:1},8,["onClick"])])])]),_:1},512)}var Eo=f(Ro,[["render",Do],["__scopeId","data-v-0c5666f3"]]);const Qe=()=>({okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0,name:"",priceList:null}),Mo={components:{PopupModal:G},data(){return Qe()},computed:b(m(m({},I("priceList",["priceLists"])),I("edition",["editions"])),{priceListOptions(){return this.priceLists.map(e=>({label:e.name,value:e}))}}),methods:{async show(e){return this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.priceListOptions.length>0&&(this.priceList=this.priceLists[0]),this.$refs.popup.open(),await this.$nextTick(),this.$refs.input.focus(),new Promise((t,s)=>{this.resolvePromise=t,this.rejectPromise=s})},_confirm(){if(!this.priceList||!this.name)return;const e=this.priceList.editions.find(s=>{const o=this.editions.find(r=>r._id===s);return o?o.active===!0:!1});if(!e){console.error("\u0412 \u0434\u0430\u043D\u043D\u043E\u043C \u043F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442\u0435 \u043D\u0435\u0442\u0443 \u0430\u043A\u0442\u0438\u0432\u043D\u043E\u0439 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u0438");return}const t={name:this.name,edition:e};this.$refs.popup.close(),this.resolvePromise(t),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},reset(){Object.assign(this.$data,Qe())}}},Oe=e=>(O("data-v-cefdcaf6"),e=e(),P(),e),Ao={class:"modal"},Ko=Oe(()=>c("span",{class:"modal__title"},"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043D\u043E\u0432\u0443\u044E \u0441\u043C\u0435\u0442\u0443",-1)),Jo={class:"form__group"},Ho=Oe(()=>c("label",{class:"form__label"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",-1)),Uo={class:"form__group"},jo=Oe(()=>c("label",null,"\u041F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442",-1)),Fo=["value"],qo={class:"modal__actions"};function Wo(e,t,s,o,r,n){const i=_("AppButton"),a=_("PopupModal");return l(),$(a,{ref:"popup"},{default:v(()=>[c("div",Ao,[Ko,c("form",{class:"form",onSubmit:t[2]||(t[2]=J((...d)=>n._confirm&&n._confirm(...d),["prevent"]))},[c("div",Jo,[Ho,M(c("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>e.name=d),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",ref:"input",class:"input"},null,512),[[j,e.name]])]),c("div",Uo,[jo,M(c("select",{"onUpdate:modelValue":t[1]||(t[1]=d=>e.priceList=d),class:"select"},[(l(!0),u(k,null,S(n.priceListOptions,d=>(l(),u("option",{key:d.value,value:d.value},g(d.label),9,Fo))),128))],512),[[ae,e.priceList]])])],32),c("div",qo,[h(i,{outlined:"",onClick:n._cancel},{default:v(()=>[V(g(e.cancelButton),1)]),_:1},8,["onClick"]),h(i,{outlined:"",onClick:n._confirm},{default:v(()=>[V(g(e.okButton),1)]),_:1},8,["onClick"])])])]),_:1},512)}var Zo=f(Mo,[["render",Wo],["__scopeId","data-v-cefdcaf6"]]);const Go={components:{InfoCircleFill:no,OutlayList:To,InfoModal:Eo,CreateModal:Zo},methods:b(m({},N("outlays",["create"])),{showInfo(){this.$refs["info-modal"].show()},async createOutlay(){const e=await this.$refs["create-modal"].show({okButton:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430"});if(e)try{await this.create(e)}catch(t){console.log(t)}}})},It=e=>(O("data-v-5de3e50f"),e=e(),P(),e),Qo={class:"center"},zo={class:"center__info"},Yo={class:"center__info-wrapper"},Xo=It(()=>c("div",{class:"center__info-text"},[c("span",{class:"center__info-id"}," 423423432 "),c("span",{class:"center__info-name"},"\u0421\u0435\u0440\u0433\u0435\u0439 \u0410\u043B\u0435\u043A\u0441\u0435\u0435\u0432\u0438\u0447")],-1)),er={class:"center__outlays"},tr=It(()=>c("i",{class:"pi pi-plus create__icon"},null,-1)),sr=[tr];function nr(e,t,s,o,r,n){const i=_("CreateModal"),a=_("InfoModal"),d=_("InfoCircleFill"),p=_("OutlayList");return l(),u(k,null,[h(i,{ref:"create-modal"},null,512),h(a,{ref:"info-modal"},null,512),c("div",Qo,[c("div",zo,[c("div",Yo,[Xo,c("button",{class:"button",onClick:t[0]||(t[0]=(...y)=>n.showInfo&&n.showInfo(...y))},[h(d)])])]),c("div",er,[c("button",{class:"button create",onClick:t[1]||(t[1]=(...y)=>n.createOutlay&&n.createOutlay(...y))},sr),h(p)])])],64)}var or=f(Go,[["render",nr],["__scopeId","data-v-5de3e50f"]]);const rr={components:{NotificationButton:wt,UserAvatar:$t}},ir={class:"right-side"};function ar(e,t,s,o,r,n){const i=_("NotificationButton"),a=_("UserAvatar"),d=_("AppButton");return l(),u("div",ir,[h(i),h(d,null,{default:v(()=>[h(a)]),_:1})])}var lr=f(rr,[["render",ar],["__scopeId","data-v-9dece412"]]);const dr={components:{LeftSide:zn,CenterSide:or,RightSide:lr}},cr={class:"header-row"};function ur(e,t,s,o,r,n){const i=_("LeftSide"),a=_("CenterSide"),d=_("RightSide");return l(),u("div",cr,[h(i),h(a),h(d)])}var _r=f(dr,[["render",ur],["__scopeId","data-v-626564aa"]]);const U=e=>(e==null?void 0:e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))||"\u041E\u0448\u0438\u0431\u043A\u0430";const Pe={name:"TableRow",props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String},computed:b(m({},I("outlay",["keys","quantityKey","priceKey","striped"])),{data(){return this.node.data},children(){return this.node.children||[]},isCategory(){return this.children.length>0},headerStyle(){return{gridTemplateColumns:`4fr repeat(${this.keys.length}, minmax(100px, 1fr))`}},sum(){const e=this.node.data[this.quantityKey.id],t=this.node.data[this.priceKey.id];return U(e*t)}})},ze=()=>{pe(e=>({c03c2612:e.level}))},Ye=Pe.setup;Pe.setup=Ye?(e,t)=>(ze(),Ye(e,t)):ze;const pr=Pe,hr=["data-id","data-level","data-room"],mr={class:"table-cell"};function yr(e,t,s,o,r,n){const i=_("TableRow",!0);return l(),u(k,null,[c("div",{class:D(["table-row",{category:n.isCategory,striped:e.striped}]),"data-id":s.node.key,"data-level":s.level,"data-room":s.room,style:X(n.headerStyle)},[(l(!0),u(k,null,S(e.keys,a=>(l(),u("div",{key:a.id,class:"table-cell"},g(n.data[a.id]),1))),128)),c("div",mr,g(n.sum),1)],14,hr),n.isCategory?(l(!0),u(k,{key:0},S(n.children,a=>(l(),$(i,{key:a.key,node:a,room:s.room,level:s.level+1},null,8,["node","room","level"]))),128)):R("",!0)],64)}var fr=f(pr,[["render",yr],["__scopeId","data-v-0c0cbef4"]]);const vr={props:{data:{type:Object,default(){return{}}},level:{type:Number}},computed:b(m({},I("outlay",["keys"])),{cells(){const e=this.keys[0].id,t=this.data[e],s={id:e,name:t};return this.level===0?[...this.keys.map((r,n)=>n===0?s:r),{id:"\u0421\u0443\u043C\u043C\u0430",name:"\u0421\u0443\u043C\u043C\u0430"}]:[s]}})};function gr(e,t,s,o,r,n){return l(!0),u(k,null,S(n.cells,i=>(l(),u("div",{key:i.id,class:"table-cell"},g(i.name),1))),128)}var br=f(vr,[["render",gr],["__scopeId","data-v-006c8480"]]);const $r={emits:["clone"],computed:m({},I("outlay",["showOnlyChecked"]))},wr=e=>(O("data-v-774e3082"),e=e(),P(),e),Cr={class:"table-cell table-cell--actions"},kr=wr(()=>c("i",{class:"pi pi-copy"},null,-1)),Ir=[kr];function Vr(e,t,s,o,r,n){return l(),u("div",Cr,[c("button",{class:"button",onClick:t[0]||(t[0]=J(i=>this.$emit("clone"),["stop"]))},Ir)])}var Vt=f($r,[["render",Vr],["__scopeId","data-v-774e3082"]]);const Sr={props:{value:{required:!0},keyData:{type:Object},isSum:{type:Boolean,default:!1},isClone:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},index:Number},computed:b(m({},I("outlay",["priceKey","quantityKey"])),{viewValue(){var e,t;return((e=this.keyData)==null?void 0:e.id)===this.priceKey.id||((t=this.keyData)==null?void 0:t.id)===this.quantityKey.id||this.isSum?U(this.value):this.value},isValidQuantity(){var e;return((e=this.keyData)==null?void 0:e.id)!==this.quantityKey.id?!0:this.value>0}})},Lr=["title","data-cellIndex"];function Tr(e,t,s,o,r,n){return l(),u("div",{class:D(["table-cell",{danger:!n.isValidQuantity&&s.isClone&&s.selected}]),title:n.viewValue,"data-cellIndex":s.index},g(n.viewValue),11,Lr)}var Ne=f(Sr,[["render",Tr],["__scopeId","data-v-a57f7e62"]]);const Rr={components:{DefaultActions:Vt,ViewCell:Ne},props:{node:{type:Object,default(){return{}}},sum:{type:Number,required:!0}},emits:["clone"],computed:m({},I("outlay",["keys"]))};function xr(e,t,s,o,r,n){const i=_("ViewCell"),a=_("DefaultActions");return l(),u(k,null,[(l(!0),u(k,null,S(e.keys,(d,p)=>(l(),$(i,{key:d.id,keyData:d,value:s.node.data[d.id],index:p},null,8,["keyData","value","index"]))),128)),h(i,{isSum:!0,value:s.sum},null,8,["value"]),h(a,{onClone:t[0]||(t[0]=d=>e.$emit("clone"))})],64)}var Or=f(Rr,[["render",xr]]);const Pr={props:{modelValue:{default:0},min:Number,max:Number,step:{type:Number,default:1}},emits:["update:modelValue"],data(){return{value:null}},computed:{newValue:{get(){return this.modelValue},set(e){return this.$emit("update:modelValue",e)}}},methods:{inputHandler(e){const{data:t,target:s}=e;let o=s.value;if(t===","&&(o=o.replace(",","."),s.value=o),!o.includes(".")){const d=+o;this.newValue=d;return}const n=o.split(".");if(n.length!==2||!n.every(d=>d))return;const a=+o;this.newValue=a},increaseValue(){this.newValue=this.newValue+this.step},decreaseValue(){this.newValue=this.newValue-this.step},checkKey(e){const t=/^[0-9.,]*$/,{key:s,ctrlKey:o}=e;if(s==="ArrowUp")return e.preventDefault(),this.increaseValue();if(s==="ArrowDown")return e.preventDefault(),this.decreaseValue();if(s==="Space")return e.preventDefault();if(["ArrowRight","ArrowLeft","Backspace","Tab"].includes(s)||o&&/a/i.test(s))return;t.test(s)||e.preventDefault()}}},Nr=["value"];function Br(e,t,s,o,r,n){return l(),u("input",{value:n.newValue,class:"input",ref:"input",type:"text",onInput:t[0]||(t[0]=(...i)=>n.inputHandler&&n.inputHandler(...i)),onKeydown:t[1]||(t[1]=(...i)=>n.checkKey&&n.checkKey(...i))},null,40,Nr)}var ve=f(Pr,[["render",Br]]);const Dr={components:{InputNumber:ve},props:{modelValue:{required:!0}},emits:["update:modelValue"],data(){return{isEditing:!1,coef:1,initValue:null}},computed:{newValue:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},viewValue(){return U(this.modelValue)}},mounted(){this.initValue=this.modelValue},methods:{changePrice(){this.coef<1&&(this.coef=1),this.newValue=this.initValue*this.coef},async toggleEditMode(){if(this.isEditing=!this.isEditing,this.isEditing){await this.$nextTick();const{input:e}=this.$refs;e.$el.focus(),e.$el.select()}}}},Er=e=>(O("data-v-d3e1fe46"),e=e(),P(),e),Mr={class:"table-cell__wrapper"},Ar=Er(()=>c("span",null,"x",-1));function Kr(e,t,s,o,r,n){const i=_("InputNumber");return l(),u("div",{class:"table-cell",onClick:t[3]||(t[3]=J((...a)=>n.toggleEditMode&&n.toggleEditMode(...a),["stop"]))},[c("div",Mr,[c("span",null,g(n.viewValue),1),r.isEditing?(l(),u(k,{key:0},[Ar,h(i,{modelValue:r.coef,"onUpdate:modelValue":[t[0]||(t[0]=a=>r.coef=a),n.changePrice],class:"input",ref:"input",onBlur:t[1]||(t[1]=a=>r.isEditing=!1),onKeyup:t[2]||(t[2]=de(a=>r.isEditing=!1,["enter"]))},null,8,["modelValue","onUpdate:modelValue"])],64)):R("",!0)])])}var Jr=f(Dr,[["render",Kr],["__scopeId","data-v-d3e1fe46"]]);const Hr={components:{InputNumber:ve},props:{modelValue:{required:!0},isEditing:Boolean},emits:["update:modelValue","save"],computed:{newValue:{get(){return this.modelValue},set(e){if(e<0)return this.$emit("update:modelValue",0);this.$emit("update:modelValue",e)}},isCorrectValue(){return this.modelValue>0},viewValue(){return U(this.modelValue)}},watch:{isEditing(e){!e||this.openEditMode()}},methods:{async openEditMode(){await this.$nextTick();const{input:e}=this.$refs;e.$el.focus(),e.$el.select()},save(){this.$emit("save")}}},Ur={key:0};function jr(e,t,s,o,r,n){const i=_("InputNumber");return l(),u("div",{class:D(["table-cell",{danger:!n.isCorrectValue}])},[s.isEditing?(l(),$(i,{key:1,modelValue:n.newValue,"onUpdate:modelValue":t[0]||(t[0]=a=>n.newValue=a),class:"input",ref:"input",onBlur:n.save,onKeyup:de(n.save,["enter"])},null,8,["modelValue","onBlur","onKeyup"])):(l(),u("span",Ur,g(n.viewValue),1))],2)}var Fr=f(Hr,[["render",jr],["__scopeId","data-v-613b20b2"]]);const Z={STRING:"\u0422\u0435\u043A\u0441\u0442",NUMBER:"\u0427\u0438\u0441\u043B\u043E",SELECT:"\u0421\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A",COUNTER:"\u0421\u0447\u0435\u0442\u0447\u0438\u043A",PRICE:"\u0421\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C",QUANTITY:"\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E",FORMULA:"\u0424\u043E\u0440\u043C\u0443\u043B\u0430"};var Y={computed:{typeOptions(){return Object.values(Z)},InputType(){return Z}}};const qr={components:{DefaultActions:Vt,ViewCell:Ne,PriceCell:Jr,QuantityCell:Fr},mixins:[Y],props:{node:{type:Object,default(){return{}}},sum:{type:Number,required:!0}},emits:["clone"],computed:b(m(m({},I("directory",["directories"])),I("outlay",["keys","edition"])),{data(){return this.node.data},keysWithType(){return this.keys.map(e=>{const s=this.directories.find(r=>r._id===this.edition.dirId).keys.find(r=>r.id===e.id),o=this.keys.find(r=>r.id===e.id);return b(m({},o),{type:s.type})})},type(){return this.key.type}}),methods:b(m({},K("outlay",["setNodeEditing","toggleNodeEditing"])),{closeEditing(){this.setNodeEditing({node:this.node,value:!1})},quantityClick(){this.toggleNodeEditing(this.node)}})};function Wr(e,t,s,o,r,n){const i=_("PriceCell"),a=_("QuantityCell"),d=_("ViewCell"),p=_("DefaultActions");return l(),u(k,null,[(l(!0),u(k,null,S(n.keysWithType,(y,w)=>(l(),u(k,{key:y.id},[y.type===e.InputType.PRICE?(l(),$(i,{key:0,modelValue:n.data[y.id],"onUpdate:modelValue":C=>n.data[y.id]=C},null,8,["modelValue","onUpdate:modelValue"])):y.type===e.InputType.QUANTITY?(l(),$(a,{key:1,modelValue:n.data[y.id],"onUpdate:modelValue":C=>n.data[y.id]=C,ref_for:!0,ref:"quantity",isEditing:s.node.isEditing,onSave:n.closeEditing,onClick:J(n.quantityClick,["stop"])},null,8,["modelValue","onUpdate:modelValue","isEditing","onSave","onClick"])):(l(),$(d,{key:2,value:n.data[y.id],index:w,keyData:y},null,8,["value","index","keyData"]))],64))),128)),h(d,{value:s.sum,isSum:!0},null,8,["value"]),h(p,{onClone:t[0]||(t[0]=y=>e.$emit("clone"))})],64)}var Zr=f(qr,[["render",Wr],["__scopeId","data-v-3ef77a69"]]);const Gr={props:{isEditing:{type:Boolean,required:!0}},emits:["toggleEdit","remove"]},Qr=e=>(O("data-v-2eca9fc7"),e=e(),P(),e),zr={class:"table-cell table-cell--actions"},Yr={key:0,class:"pi pi-check"},Xr={key:1,class:"pi pi-pencil"},ei=Qr(()=>c("i",{class:"pi pi-trash"},null,-1)),ti=[ei];function si(e,t,s,o,r,n){return l(),u("div",zr,[c("button",{class:"button",onClick:t[0]||(t[0]=J(i=>e.$emit("toggleEdit"),["stop"]))},[s.isEditing?(l(),u("i",Yr)):(l(),u("i",Xr))]),c("button",{class:"button",onClick:t[1]||(t[1]=J(i=>e.$emit("remove"),["stop"]))},ti)])}var ni=f(Gr,[["render",si],["__scopeId","data-v-2eca9fc7"]]);const oi={components:{InputNumber:ve},props:{modelValue:{required:!0}},emits:["update:modelValue"],data(){return{coef:1,initPrice:null}},computed:{newValue:{get(){return this.modelValue},set(e){const t=+e.toFixed(2);this.$emit("update:modelValue",t)}}},mounted(){this.initPrice=this.modelValue},methods:{changePrice(e){e<1&&(this.newValue=1),this.initPrice=e,this.coef=1},inputCoef(){this.coef<1&&(this.coef=1),this.newValue=this.initPrice*this.coef}}},ri={class:"price-cell"};function ii(e,t,s,o,r,n){const i=_("InputNumber");return l(),u("div",ri,[h(i,{modelValue:n.newValue,"onUpdate:modelValue":[t[0]||(t[0]=a=>n.newValue=a),n.changePrice],class:"price"},null,8,["modelValue","onUpdate:modelValue"]),h(i,{modelValue:r.coef,"onUpdate:modelValue":[t[1]||(t[1]=a=>r.coef=a),n.inputCoef],class:"coef",step:.1},null,8,["modelValue","step","onUpdate:modelValue"])])}var ai=f(oi,[["render",ii],["__scopeId","data-v-d2f9f22c"]]);const li={props:{modelValue:{required:!0},options:{type:Array,required:!0}},emits:["update:modelValue"],computed:{newValue:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}},di=["value"];function ci(e,t,s,o,r,n){return M((l(),u("select",{"onUpdate:modelValue":t[0]||(t[0]=i=>n.newValue=i),class:"select"},[(l(!0),u(k,null,S(s.options,i=>(l(),u("option",{key:i.value,value:i.text},g(i.text),9,di))),128))],512)),[[ae,n.newValue]])}var ui=f(li,[["render",ci],["__scopeId","data-v-049a0dc6"]]);const _i={components:{CloneActions:ni,ViewCell:Ne,PriceCell:ai,SelectCell:ui,InputNumber:ve},mixins:[Y],props:{node:{type:Object,default(){return{}}},sum:{type:Number,required:!0},isEditing:{type:Boolean,required:!0},selected:{type:Boolean,required:!0}},emits:["toggleEdit","remove"],computed:b(m(m({},I("directory",["directories","roots"])),I("outlay",["keys","edition"])),{data(){return this.node.data},keysWithType(){return this.keys.map(e=>{const s=this.directories.find(r=>r._id===this.edition.dirId).keys.find(r=>r.id===e.id),o=this.keys.find(r=>r.id===e.id);return b(m({},o),{type:s.type})})},options(){return this.keysWithType.filter(t=>t.type===this.InputType.SELECT).reduce((t,s)=>{const r=this.roots.find(p=>p._id===this.edition.dirId).keys.find(p=>p.id===s.id),i=this.roots.find(p=>p._id===r.root).keys.filter(p=>r.keys.includes(p.id));if(!i.length)return[];const d=this.directories.find(p=>p._id===r.dirId).values.map(p=>{const y=i.map(w=>{if(w.type===this.InputType.SELECT){const C=p.data[w.id];return this.getValueOfCell(w.dirId,w.root,C,w.keys)}return p.data[w.id]});return{value:p.id,text:y.join(", ")}});return t[s.id]=d,t},{})}}),watch:{isEditing:{handler(e){!e||this.focusFirstCell()},immediate:!0}},methods:{getValueOfCell(e,t,s,o){const r=this.directories.find(d=>d._id===e);return r?this.roots.find(d=>d._id===t).keys.filter(d=>o.includes(d.id)).map(d=>{const p=r.values.find(y=>y.id===+s);if(d.type===this.InputType.SELECT){const y=p.data[d.id];return this.getValueOfCell(d.dirId,d.root,y,d.keys)}return p.data[d.id]}):null},async focusFirstCell(){await this.$nextTick();const{cell:e}=this.$refs;if(e&&e.length>0){const s=e[0].querySelector("input, select");if(!s)return;s.focus()}}}},pi=["onUpdate:modelValue"];function hi(e,t,s,o,r,n){const i=_("ViewCell"),a=_("InputNumber"),d=_("PriceCell"),p=_("SelectCell"),y=_("CloneActions");return l(),u(k,null,[s.isEditing?(l(!0),u(k,{key:1},S(n.keysWithType,w=>(l(),u("td",{ref_for:!0,ref:"cell",key:w.id,class:"table-cell",onClick:t[0]||(t[0]=J(()=>{},["stop"])),onKeydown:t[1]||(t[1]=de(C=>e.$emit("toggleEdit"),["enter"]))},[w.type===e.InputType.STRING?M((l(),u("input",{key:0,"onUpdate:modelValue":C=>n.data[w.id]=C,class:"input",type:"text"},null,8,pi)),[[j,n.data[w.id]]]):w.type===e.InputType.NUMBER||w.type===e.InputType.QUANTITY?(l(),$(a,{key:1,modelValue:n.data[w.id],"onUpdate:modelValue":C=>n.data[w.id]=C,class:"input"},null,8,["modelValue","onUpdate:modelValue"])):w.type===e.InputType.PRICE?(l(),$(d,{key:2,modelValue:n.data[w.id],"onUpdate:modelValue":C=>n.data[w.id]=C},null,8,["modelValue","onUpdate:modelValue"])):w.type===e.InputType.SELECT?(l(),$(p,{key:3,modelValue:n.data[w.id],"onUpdate:modelValue":C=>n.data[w.id]=C,options:n.options[w.id]},null,8,["modelValue","onUpdate:modelValue","options"])):R("",!0)],32))),128)):(l(!0),u(k,{key:0},S(e.keys,(w,C)=>(l(),$(i,{key:w.id,keyData:w,value:n.data[w.id],isClone:!0,selected:s.selected,index:C},null,8,["keyData","value","selected","index"]))),128)),h(i,{value:s.sum,isSum:!0},null,8,["value"]),h(y,{isEditing:s.isEditing,onToggleEdit:t[2]||(t[2]=w=>e.$emit("toggleEdit")),onRemove:t[3]||(t[3]=w=>e.$emit("remove"))},null,8,["isEditing"])],64)}var mi=f(_i,[["render",hi],["__scopeId","data-v-646cc404"]]),ge={data(){return{colors:["#4A5356","#268AAD","#57ABC8"]}}};const yi={name:"TalbeRow",components:{StretchedRow:br,DefaultRow:Or,SelectedRow:Zr,CloneRow:mi},mixins:[ge],inheritAttrs:!1,props:{node:{type:Object},level:Number,index:Number,parent:{type:Object}},computed:b(m({},I("outlay",["keys","striped","selectedValues","quantityKey","priceKey","showOnlyChecked","currentRoomData","currentNode"])),{data(){return this.node.data},children(){return this.showOnlyChecked?this.node.children.filter(e=>this.selectedValues.includes(e.key)):this.node.children},isCategory(){return this.children.length>0},isClone(){return this.node.isClone},rowAttrs(){return this.isCategory?{"data-id":this.node.key,"data-level":this.level}:{"data-id":this.node.key,"data-level":this.level}},rowStyle(){const e=this.keys.length;return this.isCategory?{backgroundColor:this.colors[this.level],gridTemplateColumns:`4fr repeat(${e}, minmax(100px, 1fr)) 50px`}:{gridTemplateColumns:`4fr repeat(${e}, minmax(100px, 1fr)) 50px`}},sum(){const e=this.data[this.quantityKey.id],t=this.data[this.priceKey.id];return e*t},selected(){return this.selectedValues.includes(this.node.key)},current(){var e;return((e=this.currentNode)==null?void 0:e.key)===this.node.key}}),methods:b(m(m({},K("outlay",["selectJob","updateNodeChildren","toggleNodeEditing","setCurrentNode"])),N("outlay",["selectJob","unSelectJob"])),{rowClickHandler(e){const{target:t}=e,{cellindex:s}=t.dataset,o=parseInt(s);o>0||isNaN(o)||this.node.isEditing||(this.selectJob(this.node),this.setCurrentNode(this.node))},getNodeFromTree(e,t,s){const{key:o,children:r}=e;return o===t?[...s,e]:r.map(n=>this.getNodeFromTree(n,t,[...s,e])).flat()},async clone(){const e=JSON.parse(JSON.stringify(this.node)),t=b(m({},e),{data:b(m({},e.data),{[this.keys[0].id]:e.data[this.keys[0].id]+"*"}),key:Date.now()+"",isClone:!0,isEditing:!0}),{children:s}=this.parent,o=this.showOnlyChecked?s.findIndex(i=>i.key===this.node.key):this.index,r=[...s.slice(0,o+1),m({},t),...s.slice(o+1)];this.updateNodeChildren({node:this.parent,children:r}),this.currentRoomData.map(i=>this.getNodeFromTree(i,t.key,[])).flat().forEach(this.selectJob),await this.$nextTick(),this.setCurrentNode(t)},removeClone(){const e=this.parent.children.filter(t=>t.key!==this.node.key);this.updateNodeChildren({node:this.parent,children:e}),this.unSelectJob(this.node)},toggleEdit(){this.toggleNodeEditing(this.node)}})};function fi(e,t,s,o,r,n){const i=_("StretchedRow"),a=_("DefaultRow"),d=_("SelectedRow"),p=_("CloneRow"),y=_("TableRow",!0);return l(),u(k,null,[c("div",ft({class:"table-row"},n.rowAttrs,{class:{parent:n.isCategory,selected:n.selected,striped:e.striped,current:n.current},style:[n.rowStyle,e.$attrs.style],onClick:t[0]||(t[0]=(...w)=>n.rowClickHandler&&n.rowClickHandler(...w))}),[n.isCategory?(l(),$(i,{key:0,data:n.data,level:s.level},null,8,["data","level"])):n.isClone?(l(),$(p,{key:2,node:s.node,sum:n.sum,selected:n.selected,isEditing:s.node.isEditing,onToggleEdit:n.toggleEdit,onRemove:n.removeClone},null,8,["node","sum","selected","isEditing","onToggleEdit","onRemove"])):(l(),u(k,{key:1},[n.selected?(l(),$(d,{key:1,ref:"selectedRow",node:s.node,sum:n.sum,onClone:n.clone},null,8,["node","sum","onClone"])):(l(),$(a,{key:0,node:s.node,sum:n.sum,onClone:n.clone},null,8,["node","sum","onClone"]))],64))],16),n.isCategory?(l(!0),u(k,{key:0},S(n.children,(w,C)=>(l(),$(y,{key:w.key,node:w,level:s.level+1,index:C,parent:s.node,style:X(e.$attrs.style)},null,8,["node","level","index","parent","style"]))),128)):R("",!0)],64)}var vi=f(yi,[["render",fi],["__scopeId","data-v-24a9ef58"]]);const Be={name:"JobList",components:{TableRow:fr,EditableTableRow:vi},inject:["editable"],props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String,hasTitle:{type:Boolean,default:!0}},emits:["select-node"],computed:b(m({},I("outlay",["keys","selectedValues","showOnlyChecked"])),{data(){return this.node.data},children(){return this.showOnlyChecked?this.node.children.filter(e=>this.selectedValues.includes(e.key)):this.node.children||[]},isCategory(){return this.children.length>0},title(){return this.isCategory&&this.hasTitle?this.data[this.keys[0].id]:null},headerStyle(){const e=this.keys.length;return this.editable?{gridTemplateColumns:`4fr repeat(${e}, minmax(100px, 1fr)) 50px`}:{gridTemplateColumns:`4fr repeat(${e}, minmax(100px, 1fr))`}},selected(){return this.selectedValues.includes(this.node.key)}}),methods:b(m(m({},K("outlay",["selectJob","unselectJob"])),N("outlay",["toggleCategoryJobs"])),{select(){if(!this.selected)return this.selectJob(this.node),this.$emit("select-node");if(this.isCategory)return!!this.node.children.find(t=>this.selectedValues.includes(t.key))||this.unselectJob(this.node),this.$emit("select-node");this.unselectJob(this.node),this.$emit("select-node")},categoryClick(){!this.editable||this.toggleCategoryJobs(this.node)}})},Xe=()=>{pe(e=>({"7764bb74":e.level}))},et=Be.setup;Be.setup=et?(e,t)=>(Xe(),et(e,t)):Xe;const gi=Be;function bi(e,t,s,o,r,n){const i=_("EditableTableRow"),a=_("TableRow");return l(),u(k,null,[n.title?(l(),u("div",{key:0,class:"table-row table-row--category",style:X(n.headerStyle)},[c("div",{class:"table-cell",onClick:t[0]||(t[0]=(...d)=>n.categoryClick&&n.categoryClick(...d))},g(n.title),1)],4)):R("",!0),n.editable?(l(!0),u(k,{key:1},S(n.children,(d,p)=>(l(),$(i,{key:d.key,node:d,level:s.level+1,room:s.room,parent:s.node,index:p,onSelectNode:n.select},null,8,["node","level","room","parent","index","onSelectNode"]))),128)):(l(!0),u(k,{key:2},S(n.children,d=>(l(),$(a,{key:d.key,node:d,level:s.level,room:s.room},null,8,["node","level","room"]))),128))],64)}var $i=f(gi,[["render",bi],["__scopeId","data-v-58b0cba9"]]);const wi={props:{title:String,level:Number},emits:["name-click"],computed:b(m({},I("outlay",["keys"])),{cells(){const e=[...this.keys,{id:"\u0421\u0443\u043C\u043C\u0430",name:"\u0421\u0443\u043C\u043C\u0430"}];return this.title?e.map((t,s)=>s==0?b(m({},t),{name:this.title}):t):e}}),methods:{nameClick(){this.$emit("name-click")}}};function Ci(e,t,s,o,r,n){return l(!0),u(k,null,S(n.cells,(i,a)=>(l(),u("div",{key:i.id,class:"table-cell"},[a===0?(l(),u("span",{key:0,onClick:t[0]||(t[0]=(...d)=>n.nameClick&&n.nameClick(...d))},g(i.name),1)):(l(),u(k,{key:1},[V(g(i.name),1)],64))]))),128)}var ki=f(wi,[["render",Ci],["__scopeId","data-v-8ac9d388"]]);const W=e=>/^[0-9a-fA-F]{24}$/.test(e);const De={name:"TableGroup",components:{JobList:$i,HeaderCells:ki},mixins:[ge],inject:["editable"],props:{node:{type:Object,required:!0,default:()=>{}},level:Number,room:String,isRoom:Boolean},computed:b(m({},I("outlay",["keys","quantityKey","priceKey","selectedValues","selectedRoom","showOnlyChecked","selectedValues"])),{data(){return this.node.data},title(){return this.node.data[this.keys[0].id]},children(){return this.showOnlyChecked?this.node.children.filter(e=>this.selectedValues.includes(e.key)):this.node.children||[]},isCategory(){return this.children.length>0},categories(){return this.children.filter(e=>{const{children:t}=e;return t&&t.length>0})},sum(){const e=this.node.children.map(this.treeToListOnlyValues).flat();if(this.selectedRoom){const o=e.filter(r=>this.selectedValues.includes(r.key)).reduce((r,n)=>{const{data:i}=n,a=i[this.priceKey.id]*i[this.quantityKey.id];return r+a},0);return U(o)}const t=e.reduce((s,o)=>{const{data:r}=o,n=r[this.priceKey.id]*r[this.quantityKey.id];return s+n},0);return U(t)},result(){return`\u0418\u0442\u043E\u0433\u043E \u043F\u043E ${this.isRoom?"\u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u044E":"\u0440\u0430\u0437\u0434\u0435\u043B\u0443"} (${this.title})`},resultsRowStyle(){const e=this.keys.length;return{gridTemplateColumns:`${4+e-1}fr minmax(100px, 1fr)`}},categoryRowStyle(){return{gridTemplateColumns:`4fr repeat(${this.keys.length}, minmax(100px, 1fr)) ${this.selectedRoom?"50px":""}`}},selected(){return this.selectedValues.includes(this.node.key)}}),methods:b(m(m({},K("outlay",["selectJob","unselectJob"])),N("outlay",["toggleCategoryJobs"])),{treeToListOnlyValues(e){const{children:t,key:s}=e,o=t.map(this.treeToListOnlyValues).flat();return W(s)?o:[e]},select(){if(!this.selected)return this.selectJob(this.node),this.$emit("select-node");if(this.isCategory)return!!this.node.children.find(t=>this.selectedValues.includes(t.key))||this.unselectJob(this.node),this.$emit("select-node");this.unselectJob(this.node),this.$emit("select-node")},toggleCategory(){!this.editable||this.toggleCategoryJobs(this.node)}})},tt=()=>{pe(e=>({"5418064f":e.level}))},st=De.setup;De.setup=st?(e,t)=>(tt(),st(e,t)):tt;const Ii=De,Vi={class:"table-group"},Si={key:0,class:"title-row"},Li={class:"table-cell table-cell--results"},Ti=["title"];function Ri(e,t,s,o,r,n){const i=_("HeaderCells"),a=_("TableGroup",!0),d=_("JobList");return l(),u("div",Vi,[s.isRoom?(l(),u("div",Si,g(n.title),1)):(l(),u("div",{key:1,class:"table-row table-row--category",style:X(n.categoryRowStyle)},[h(i,{title:n.title,onNameClick:n.toggleCategory},null,8,["title","onNameClick"])],4)),s.isRoom&&n.children.length>0?(l(!0),u(k,{key:2},S(n.children,p=>(l(),$(a,{key:p.key,node:p,level:s.level+1,room:s.room},null,8,["node","level","room"]))),128)):(l(),u(k,{key:3},[n.categories.length>0?(l(!0),u(k,{key:0},S(n.children,p=>(l(),$(d,{key:p.key,node:p,level:s.level+1,room:s.room,onSelectNode:n.select},null,8,["node","level","room","onSelectNode"]))),128)):(l(),$(d,{key:1,node:s.node,level:s.level+1,room:s.room,hasTitle:!1,onSelectNode:n.select},null,8,["node","level","room","onSelectNode"]))],64)),c("div",{class:"results-row",style:X(n.resultsRowStyle)},[c("div",Li,g(n.result),1),c("div",{class:"table-cell",title:n.sum},g(n.sum),9,Ti)],4)])}var St=f(Ii,[["render",Ri],["__scopeId","data-v-be7a001c"]]),ie={$on:(...e)=>ue.on(...e),$once:(...e)=>ue.once(...e),$off:(...e)=>ue.off(...e),$emit:(...e)=>ue.emit(...e)};const xi={components:{TableGroup:St},mixins:[ge],provide(){return{editable:!0}},data(){return{category:null,subCategory:null,timeout:null,currentCategory:null,currentSubCategory:null,currentNodeIndex:0}},computed:b(m({},I("outlay",["keys","showOnlyChecked","selectedRoom","outlay","currentRoomData","selectedValues","priceKey","roomsData","rooms","currentNode","quantityKey"])),{tableKeys(){return this.keys?this.keys.map((e,t)=>t===0&&this.currentCategory?b(m({},e),{name:this.currentCategory.data[this.keys[0].id]}):e):[]},tableData(){if(!this.selectedRoom)return[];const e=this.showOnlyChecked?this.currentRoomData.filter(t=>this.selectedValues.includes(t.key)):this.currentRoomData;return[{key:this.selectedRoom.id,data:{[this.keys[0].id]:this.selectedRoom.name},room:!0,children:e}]},nodes(){const e=this.tableData.map(this.treeToListOnlyValues).flat();return this.showOnlyChecked?e.filter(t=>this.selectedValues.includes(t.key)):e},headerStyle(){return{gridTemplateColumns:`4fr repeat(${this.tableKeys.length}, minmax(100px, 1fr)) 50px`}}}),watch:{selectedRoom(){this.currentNodeIndex=0;const e=this.nodes[this.currentNodeIndex];this.setCurrentNode(e)},currentRoomData:{handler(){this.selectedRoom&&this.save()},deep:!0},"selectedValues.length"(){this.selectedRoom&&this.save()}},async mounted(){this.setCurrentNode(this.nodes[this.currentNodeIndex]),ie.$on("scrollTo",e=>{this.scrollTo(e),this.setCurrentNodeByKey(e)}),ie.$on("selectNode",this.setCurrentNodeByKey),document.addEventListener("keydown",this.keyHandler)},unmounted(){ie.$off("scrollTo"),ie.$off("selectNode"),document.removeEventListener("keydown",this.keyHandler)},methods:b(m(m(m({},K("outlay",["selectJob","setCurrentNode","toggleNodeEditing","setNodeEditing"])),K("outlays",["updateById"])),N("outlay",["saveLocaly","selectJob"])),{isObjectId(e){return/^[0-9a-fA-F]{24}$/.test(e)},treeToListOnlyValues(e){const{children:t,key:s,room:o}=e,r=t.map(this.treeToListOnlyValues).flat();return this.isObjectId(s)||o?r:[e]},save(){this.timeout&&(this.timeout=clearTimeout(this.timeout)),this.timeout=setTimeout(async()=>{await this.saveLocaly()},500)},getNodeFromTree(e,t,s){const{key:o,children:r}=e;return o===t?[...s,e]:r.map(n=>this.getNodeFromTree(n,t,[...s,e])).flat()},scrollTo(e,t=!0){const{wrapper:s}=this.$refs;if(!s)return;const o=s.getBoundingClientRect(),r=s.querySelector(`.table-row[data-id="${e}"]`);if(!r)return;const n=r.getBoundingClientRect(),a=+r.dataset.level*32,d=n.top-o.top-a;s.scrollTo({top:d+s.scrollTop,behavior:t?"smooth":"instant"})},scrollToAndSelect(e){const{key:t}=e;this.scrollTo(t),this.selectNode(e)},selectNode(e){this.selectJob(e),this.setCurrentNodeByKey(e.key)},setCurrentNodeByKey(e){const t=this.nodes.findIndex(s=>s.key===e);t<0||(this.currentNodeIndex=t,this.setCurrentNode(this.nodes[t]))},keyHandler(e){const{key:t,code:s}=e,o=e.composedPath(),r=["INPUT","TEXTAREA","SELECT"];if(o.find(H=>r.includes(H.tagName))||(t!=="F12"&&t!=="F5"&&e.preventDefault(),document.querySelector(".popup-modal"))||!this.currentNode)return;if(s==="Space"){if(this.selectJob(this.currentNode),!this.showOnlyChecked)return;this.currentNodeIndex>=this.nodes.length-1&&(this.currentNodeIndex=this.nodes.length-1);const H=this.nodes[this.currentNodeIndex];return this.setCurrentNode(H)}if(t==="ArrowRight")return this.toggleNodeEditing(this.currentNode);if(t==="ArrowLeft"||t==="Enter")return this.setNodeEditing({node:this.currentNode,value:!1});const a=["ArrowUp","ArrowDown"];if(!a.includes(t))return;if(this.setCurrentNodeByKey(this.currentNode.key),t===a[0]){if(this.currentNodeIndex<=0)return this.currentNodeIndex=0;this.currentNodeIndex--}if(t===a[1]){if(this.currentNodeIndex>=this.nodes.length-1)return this.currentNodeIndex=this.nodes.length-1;this.currentNodeIndex++}const{wrapper:d}=this.$refs,p=d.getBoundingClientRect(),y=this.nodes[this.currentNodeIndex],w=d.querySelector(`.table-row[data-id="${y.key}"]`),C=w.getBoundingClientRect(),{clientHeight:T}=w,B=+w.dataset.level*32,L=C.top-p.top-B,A=p.height-B;if(L+T>=A){const H=L-A+d.scrollTop+T;d.scrollTo({top:H})}L+T<T&&this.scrollTo(y.key,!1),this.setCurrentNode(y)}})},Oi={class:"tree-table"},Pi={class:"table-grid__body",ref:"wrapper"};function Ni(e,t,s,o,r,n){const i=_("TableGroup");return l(),u("div",Oi,[c("div",Pi,[(l(!0),u(k,null,S(n.tableData,(a,d)=>(l(),$(i,{key:a.key,node:a,level:0,index:d,style:X(n.headerStyle),isRoom:""},null,8,["node","index","style"]))),128))],512)])}var Bi=f(xi,[["render",Ni],["__scopeId","data-v-7b8800d4"]]);const Di="http://localhost:8000/api",E=vt.create({baseURL:Di}),Ei="outlay",Mi=1;let _e=null;var se={async getDb(){return new Promise((e,t)=>{if(_e)return e(_e);const s=indexedDB.open(Ei,Mi);s.onerror=o=>{console.log("Error opening db",o),t("Error")},s.onsuccess=o=>{_e=o.target.result,e(_e)},s.onupgradeneeded=o=>{console.log("onupgradeneeded"),o.target.result.createObjectStore("outlays",{keyPath:"_id"})}})},async getOutlays(){const e=await this.getDb();return new Promise(t=>{const s=e.transaction(["outlays"],"readonly"),o=s.objectStore("outlays"),r=[];s.oncomplete=()=>{t(r)},o.openCursor().onsuccess=n=>{const i=n.target.result;i&&(r.push(i.value),i.continue())}})},async saveOutlay(e){const t=await this.getDb();return new Promise(s=>{const o=t.transaction(["outlays"],"readwrite");o.oncomplete=()=>{s()};const r=o.objectStore("outlays"),n=JSON.parse(JSON.stringify(e));r.put(n)})},async removeOutlay(e){const t=await this.getDb();return new Promise(s=>{const o=t.transaction(["outlays"],"readwrite");o.oncomplete=()=>{s()},o.objectStore("outlays").delete(e)})}};const q={width:"\u0428\u0438\u0440\u0438\u043D\u0430",height:"\u0412\u044B\u0441\u043E\u0442\u0430",length:"\u0414\u043B\u0438\u043D\u0430",perimeter:"\u041F\u0435\u0440\u0438\u043C\u0435\u0442\u0440",floorArea:"\u041F\u043B\u043E\u0449\u0430\u0434\u044C \u043F\u043E\u043B\u0430",wallArea:"\u041F\u043B\u043E\u0449\u0430\u0434\u044C \u0441\u0442\u0435\u043D",spaces:"\u041F\u0440\u043E\u0435\u043C\u044B"};var ee={computed:{roomOptions(){return q}},methods:{calculate(e){try{return ds.eval(e)}catch{return 0}},getPerimeter(e,t){return(e+t)*2},getFloorArea(e,t){return e*t},getWallArea(e,t,s){return e*t-s},calculateAllParameters(e){const t=this.calculate(e.spaces),s=this.calculate(e.width),o=this.calculate(e.height),r=this.calculate(e.length),n=this.getPerimeter(s,r),i=this.getFloorArea(s,r),a=this.getWallArea(n,o,t);return{computed:{[q.perimeter]:n,[q.floorArea]:i,[q.wallArea]:a},options:{[q.height]:o,[q.width]:s,[q.length]:r,[q.spaces]:t}}}}};const{methods:Lt}=ee,Tt=e=>{const{children:t}=e;return t&&t.length>0?t[0].children.length===0?[e]:e.children.map(Tt).flat():[]},Rt=e=>{const{children:t}=e;return[e.key,...t.map(Rt)].flat()},xt=e=>{const{children:t}=e;return t&&t.length>0?[e.key,...e.children.map(xt)].flat():[e.key]},Ee=e=>{const{children:t}=e;return t&&t.length>0?t.map(Ee).flat():[e]},Ai=e=>/^[0-9a-fA-F]{24}$/.test(e),Me=(e,t,s,o)=>{const{children:r}=e;if(r.length===0){const n=e.data[o];e.data[s]=t[n]||0;return}r.forEach(n=>Me(n,t,s,o))},Ot=(e,t,s)=>{e.key==t?e.children=s:e.children.length>0&&e.children.forEach(o=>{Ot(o,t,s)})},Pt=(e,t)=>{const{key:s,children:o}=e,r=t.find(n=>n.key===s);return r?(e.children=F.exports.uniqBy([...r.children,...o],"key"),e.children=e.children.map(n=>b(m({},n),{isEditing:!1})),[e]):[b(m({},e),{children:o.map(n=>Pt(n,t)).flat()})]},Ie=(e,t,s,o)=>{const r=JSON.parse(JSON.stringify(t)),{options:n}=e,{computed:i}=Lt.calculateAllParameters(n);return r.forEach(a=>Me(a,i,s,o)),r},le=(e,t)=>{const{children:s}=e;return e.children=s.filter(o=>t.includes(o.key)),e.children.length>0?(e.children.map(o=>le(o,t)),e):[]},Se=(e,t,s)=>{const{key:o,children:r}=e;return o===t?s:r.map(n=>Se(n,t,[e,...s])).flat()},Ve=(e,t,s)=>{const o=new RegExp(`^${e}\\s[\u2116]\\d+$|^${e}$`),r=t.filter(i=>i.name.match(o));if(r.length===0)return e;const n=r.reduce((i,a)=>{const d=/\d+/gm,y=a.name.replace(e,"").match(d);if(!y)return s(a),i;const T=+y[0].split("\u2116")[1];return T>i?T:i},0);return n?`${e} \u2116${n+1}`:`${e} \u21162`};var Ki={namespaced:!0,state:{outlay:null,edition:null,selectedRoom:null,showOnlyChecked:!1,keys:[],initNodes:null,initData:null,roomsData:{},selectedValues:{},room:null,quantityKey:null,priceKey:null,formulaKey:null,striped:!1,currentNode:null,showResults:!1},mutations:{setOutlay(e){const{selectedValues:t,roomsData:s,outlay:o}=e;if(!o)return;const r=JSON.parse(JSON.stringify(o)),{rooms:n}=r,a=JSON.parse(JSON.stringify(n)).map(p=>{const C=JSON.parse(JSON.stringify(s[p.id])).filter(T=>t[p.id].includes(T.key)).map(T=>le(T,t[p.id]));return b(m({},p),{jobs:C})}),d=b(m({},r),{rooms:a});Object.assign(e.outlay,d)},setSale(e,t){if(!e.outlay)return;const s=parseInt(t);if(isNaN(s)||s<0)return e.outlay.sale=0;if(s>20)return e.outlay.sale=20;e.outlay.sale=s},setSelectedRoom(e,t){e.showResults=!1,e.selectedRoom=t,e.showOnlyChecked=!1},setShowResults(e,t){e.selectedRoom=null,e.showResults=t},setShowOnlyChecked(e,t){e.showOnlyChecked=t},setCurrentNode(e,t){e.currentNode=t},setStriped(e,t){e.striped=t},selectJob(e,t){if(!e.selectedRoom)return;const s=e.selectedValues[e.selectedRoom.id];!s||s.includes(t.key)||s.push(t.key)},unselectJob(e,t){if(!e.selectedRoom)return;const s=e.selectedValues[e.selectedRoom.id];!s||(e.selectedValues[e.selectedRoom.id]=s.filter(o=>o!==t.key))},updateNodeChildren(e,{node:t,children:s}){e.roomsData[e.selectedRoom.id].forEach(o=>{Ot(o,t.key,s)})},removeNode(e,t){!e.selectedRoom||(e.roomsData[e.selectedRoom.id]=e.roomsData[e.selectedRoom.id].filter(s=>s.key!==t))},toggleNodeEditing(e,t){t.isEditing=!t.isEditing},setNodeEditing(e,{node:t,value:s}){t.isEditing=s},resetOutlay(e){e.outlay=null,e.edition=null,e.quantityKey=null,e.priceKey=null,e.formulaKey=null,e.initData=null,e.keys=null,e.roomsData=null,e.selectedValues=null,e.showResults=!1}},actions:{setOutlay({state:e,commit:t,rootGetters:s},o){if(!o)return t("resetOutlay");e.outlay=JSON.parse(JSON.stringify(o));const r=s["edition/editions"].find(d=>d._id===e.outlay.edition);e.edition=r;const n=s["directory/directories"].find(d=>d._id===r.dirId);e.quantityKey=n.keys.find(d=>d.type===Z.QUANTITY),e.priceKey=n.keys.find(d=>d.type===Z.PRICE),e.formulaKey=n.keys.find(d=>d.type===Z.FORMULA);const i=JSON.parse(JSON.stringify(r.data.children));e.initData=i,e.keys=r.keys;const a=JSON.parse(JSON.stringify(e.outlay.rooms));e.roomsData=a.reduce((d,p)=>{const y=p.jobs.map(Tt).flat(),w=JSON.parse(JSON.stringify(i)),{options:C}=p,{computed:T}=Lt.calculateAllParameters(C);w.forEach(B=>Me(B,T,e.quantityKey.id,e.formulaKey.id));const x=w.map(B=>Pt(B,y)).flat();return d[p.id]=x,d},{}),e.selectedValues=e.outlay.rooms.reduce((d,p)=>{const y=p.jobs.map(xt).flat();return d[p.id]=y,d},{}),t("setSelectedRoom",null)},updateRooms({state:e,dispatch:t},s){const{outlay:o}=e;!o||(o.rooms=s,t("saveLocaly"))},selectJob({state:e,dispatch:t},s){const{roomsData:o,selectedRoom:r,selectedValues:n}=e;if(n[r.id].includes(s.key))return t("unSelectJob",s);const d=JSON.parse(JSON.stringify(o[r.id])).map(y=>Se(y,s.key,[])).flat();[s,...d].forEach(y=>{n[r.id].includes(y.key)||n[r.id].push(y.key)})},unSelectJob({state:e,dispatch:t},s){const{roomsData:o,selectedRoom:r,selectedValues:n}=e;if(!n[r.id].includes(s.key))return t("selectJob",s);const d=JSON.parse(JSON.stringify(o[r.id])).map(p=>Se(p,s.key,[])).flat();n[r.id]=n[r.id].filter(p=>p!==s.key),d.forEach(p=>{const{children:y}=p;y.find(C=>n[r.id].includes(C.key))||(n[r.id]=n[r.id].filter(C=>C!==p.key))})},toggleCategoryJobs({state:e,dispatch:t},s){const{selectedValues:o,selectedRoom:r}=e,n=o[r.id],{children:i}=s,a=i.map(Rt).flat();if(i.filter(C=>n.includes(C.key)).length===i.length)return o[r.id]=o[r.id].filter(C=>!a.includes(C)),t("selectJob",s);const p=[...o[r.id],...a],y=[...new Set(p)];if(o[r.id]=y,!o[r.id].includes(s.key))return t("selectJob",s)},async createRoom({commit:e,state:t,dispatch:s},{name:o,options:r}){if(!t.outlay)return;const{rooms:n}=t.outlay,i=Ve(o,n,p=>{p.name=`${p.name} \u21161`}),a={id:Date.now()+"",name:i,options:r,jobs:[]};t.outlay.rooms.push(a);const d=Ie(a,t.initData,t.quantityKey.id,t.formulaKey.id);return t.roomsData[a.id]=d,t.selectedValues[a.id]=[],e("setSelectedRoom",a),await s("saveLocaly")},async cloneRoom({getters:e,state:t,dispatch:s,commit:o},{name:r,options:n,cloningRoomId:i}){const a=e.rooms.find(ce=>ce.id===i),d=JSON.parse(JSON.stringify(a)),{rooms:p}=t.outlay,y=Ve(r,p,ce=>{ce.name=`${ce.name} \u21161`}),{jobs:w}=d,C={id:Date.now()+"",name:y,options:n,jobs:w},{selectedValues:T,roomsData:x,outlay:B,quantityKey:L,formulaKey:A}=t;B.rooms.push(C);const H=JSON.parse(JSON.stringify(x[i])),te=JSON.parse(JSON.stringify(T[i])),ss=Ie(C,H,L.id,A.id);return t.roomsData[C.id]=ss,t.selectedValues[C.id]=te,o("setSelectedRoom",C),await s("saveLocaly")},async updateRoom({state:e,dispatch:t,commit:s},o){if(!e.outlay||!e.selectedRoom)return;const{rooms:r}=e.outlay,n=[...r].filter(i=>i.id!==e.selectedRoom.id);return e.outlay.rooms=r.map(i=>{if(i.id===e.selectedRoom.id){i.name!==o.name&&(o.name=Ve(o.name,n,p=>{p.name=`${p.name} \u21161`}));const a=m(m({},i),o);s("setSelectedRoom",a);const d=Ie(a,e.roomsData[e.selectedRoom.id],e.quantityKey.id,e.formulaKey.id);return e.roomsData[i.id]=d,a}return i}),await t("saveLocaly")},async removeRoom({state:e,commit:t,dispatch:s},o){if(!!e.outlay)return e.outlay.rooms=e.outlay.rooms.filter(r=>r.id!==o),e.room===o&&(e.room=null),delete e.roomsData[o],delete e.selectedValues[o],t("setSelectedRoom",null),await s("saveLocaly")},async create({rootGetters:e},t){try{return await E.post("/outlay",b(m({},t),{edition:e["edition/active"]._id}))}catch(s){return Promise.reject(s)}},async update({state:e,commit:t}){if(!e.outlay)return;const{_id:s}=e.outlay;try{const o=await E.put(`/outlay/${s}`,e.outlay);return t("outlays/updateById",{id:s,data:o.data},{root:!0}),await se.removeOutlay(s),o}catch(o){return Promise.reject(o)}},async saveLocaly({state:e,commit:t}){try{t("setOutlay");const{outlay:s}=e;if(!s)return;const o=JSON.parse(JSON.stringify(s));await se.saveOutlay(o),t("outlays/updateById",{id:s._id,data:o},{root:!0})}catch(s){return Promise.reject(s)}}},getters:{outlay:e=>e.outlay,edition:e=>e.edition,rooms:e=>{var t;return((t=e.outlay)==null?void 0:t.rooms)||[]},selectedRoom:e=>e.selectedRoom,roomsData:e=>e.roomsData,currentRoomData:e=>!e.selectedRoom||!e.outlay?[]:e.roomsData[e.selectedRoom.id],selectedValues:e=>e.outlay?e.selectedRoom?e.selectedValues[e.selectedRoom.id]||[]:Object.entries(e.selectedValues).reduce((t,[s,o])=>(t[s]=o,t),{}):[],roots:e=>!e.selectedRoom||!e.roomsData[e.selectedRoom.id]?[]:e.roomsData[e.selectedRoom.id].filter(t=>Ai(t.key)),keys:e=>e.keys,showOnlyChecked:e=>e.showOnlyChecked,quantityKey:e=>e.quantityKey,priceKey:e=>e.priceKey,striped:e=>e.striped,sale:e=>e.outlay.sale,currentNode:e=>e.currentNode,showResults:e=>e.showResults}};const Ji={components:{TableGroup:St},mixins:[ge],provide(){return{editable:!1}},computed:b(m({},I("outlay",["rooms","selectedValues","keys","roomsData","selectedRoom"])),{data(){if(!this.roomsData)return[];const e=[...this.rooms].reverse();return e.length===0||this.selectedRoom?[]:e.map(t=>{const o=JSON.parse(JSON.stringify(this.roomsData[t.id])).map(r=>le(r,this.selectedValues[t.id])).flat();return t?{key:t.id,data:{[this.keys[0].id]:t.name},children:o,room:!0,level:0}:{}})},headerStyle(){return{gridTemplateColumns:`4fr repeat(${this.keys.length}, minmax(100px, 1fr))`}}}),methods:{treeToList(e,t){const{children:s}=e;return s&&s.length>0?s[0].children.length===0?[e]:[...t,e,...e.children.map(o=>this.treeToList(o,t)).flat()]:t},scrollTo(e,t){const{wrapper:s}=this.$refs;if(!s)return;const o=s.getBoundingClientRect(),r=s.querySelector(`.table-row[data-room="${e}"][data-id="${t}"]`);if(!r)return;const n=r.getBoundingClientRect(),a=(+r.dataset.level+1)*32,d=n.top-o.top-a;s.scrollTo({top:d+s.scrollTop,behavior:"smooth"})}}},Hi={class:"tree-table"},Ui={class:"table-grid"},ji={class:"table-grid__body",ref:"wrapper"};function Fi(e,t,s,o,r,n){const i=_("TableGroup");return l(),u("div",Hi,[c("div",Ui,[c("div",ji,[(l(!0),u(k,null,S(n.data,a=>(l(),$(i,{ref_for:!0,ref:"table",key:a.key,node:a,room:a.key,level:0,isRoom:""},null,8,["node","room"]))),128))],512)])])}var qi=f(Ji,[["render",Fi],["__scopeId","data-v-d7a3688e"]]),Nt=["\u0421\u043F\u0435\u0446\u043C\u043E\u043D\u0442\u0430\u0436"];const Wi={mixins:[ee],computed:b(m(m({},gt("outlay",["selectedValues"])),I("outlay",["rooms","roomsData","quantityKey","priceKey","keys","sale"])),{roomList(){return[...this.rooms].reverse()},parameters(){return{perimeter:this.roomOptions.perimeter,floorArea:this.roomOptions.floorArea,wallArea:this.roomOptions.wallArea}},roomParameters(){return this.roomList.map(e=>{const{options:t,id:s}=e,{computed:o}=this.calculateAllParameters(t);return{id:s,computed:o}})},totalParameters(){return this.roomList.reduce((e,t)=>{const{options:s}=t,{computed:o}=this.calculateAllParameters(s);return this.sumParameters(e,o)},{})},categories(){const e=this.roomList.reduce((o,r)=>[...o,...r.jobs],[]),t=F.exports.uniqBy(e,"key"),s=JSON.parse(JSON.stringify(this.roomsData));return t.map(o=>{const r=this.roomList.reduce((a,d)=>{const p=this.selectedValues[d.id],C=s[d.id].map(L=>le(L,p)).find(L=>L.key===o.key);if(!C)return a[d.id]=0,a;const B=this.getOnlyMontage(C).map(this.treeToListOnlyValues).flat().reduce((L,A)=>{const{data:H}=A;return L+=H[this.quantityKey.id]*H[this.priceKey.id],L},0);return a[d.id]=B,a},{}),n=this.roomList.reduce((a,d)=>{const p=this.selectedValues[d.id],C=s[d.id].map(L=>le(L,p)).find(L=>L.key===o.key);if(!C)return a[d.id]=0,a;const B=this.getSelectedItems(C.children,p).map(this.treeToListOnlyValues).flat().reduce((L,A)=>{const{data:H}=A,te=H[this.quantityKey.id]*H[this.priceKey.id];return L+te},0);return a[d.id]=B-r[d.id],a},{}),i=Object.values(r).reduce((a,d)=>a+=d,0);return{id:o.key,name:o.data[this.keys[0].id],rooms:n,specMontage:i}})},sumOfCategory(){return this.categories.reduce((e,t)=>(e[t.id]=Object.values(t.rooms).reduce((s,o)=>s+o,0),e[t.id]+=t.specMontage,e),{})},priceOfRooms(){return this.roomList.map(e=>{const t=this.categories.reduce((s,o)=>(s+=Object.entries(o.rooms).reduce((n,[i,a])=>(i===e.id&&(n+=a),n),0),s),0);return{id:e.id,result:t}})},priceOfRoomsWithSale(){return this.priceOfRooms.map(e=>{const t=e.result/100*this.sale,s=e.result-t;return b(m({},e),{result:s})})},totalPrice(){return this.priceOfRooms.reduce((e,t)=>(e+=t.result,e),0)},totalPriceWithSale(){const e=this.totalPrice/100*this.sale;return this.totalPrice-e},specMontage(){return this.roomList.reduce((r,n)=>[...r,...n.jobs],[]).map(this.getOnlyMontage).flat().map(this.treeToListOnlyValues).flat().reduce((r,n)=>{const{data:i}=n;return r+=i[this.quantityKey.id]*i[this.priceKey.id],r},0)},workTime(){const e=this.getPriceForDay(this.totalPrice+this.specMontage);return Math.ceil(this.totalPrice/e)},subTableData(){const e=this.totalPrice/100*this.sale;return[{text:"\u0421\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C \u0431\u0435\u0437 \u0443\u0447\u0435\u0442\u0430 \u0441\u043A\u0438\u0434\u043A\u0438",value:this.format(this.totalPrice+this.specMontage),render:!0},{text:"\u0421\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C \u043E\u0431\u0449\u0435\u0441\u0442\u0440-\u0445 \u0440\u0430\u0431\u043E\u0442",value:this.format(this.totalPrice),render:!0},{text:"\u0421\u043A\u0438\u0434\u043A\u0430 \u043D\u0430 \u043E\u0431\u0449\u0435\u0441\u0442\u0440-\u0435 \u0440\u0430\u0431\u043E\u0442\u044B",value:`${this.sale} %`,render:this.sale>0},{text:"\u0421\u043A\u0438\u0434\u043A\u0430 \u043D\u0430 \u043E\u0431\u0449\u0435\u0441\u0442\u0440-\u0435 \u0440\u0430\u0431\u043E\u0442\u044B",value:this.format(e),render:this.sale>0},{text:"\u041E\u0431\u0449\u0435\u0441\u0442\u0440-\u0435 \u0440\u0430\u0431\u043E\u0442\u044B \u0441 \u0443\u0447\u0435\u0442\u043E\u043C \u0441\u043A\u0438\u0434\u043A\u0438",value:this.format(this.totalPriceWithSale),render:this.sale>0},{text:"\u0421\u043F\u0435\u0446\u043C\u043E\u043D\u0442\u0430\u0436",value:this.format(this.specMontage),render:this.specMontage>0},{text:"\u0418\u0442\u043E\u0433\u043E \u0441\u043C\u0435\u0442\u043D\u0430\u044F \u0441\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C",value:this.format(this.totalPriceWithSale+this.specMontage),render:!0},{text:"\u0421\u0440\u043E\u043A \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0440\u0430\u0431\u043E\u0442",value:`${this.workTime} \u0434\u043D\u044F`,render:!0}]}}),methods:{sumParameters(e,t){return Object.entries(t).reduce((s,[o,r])=>{const n=r+(e[o]||0);return s[o]=n,s},{})},treeToListOnlyValues(e){const{children:t,key:s}=e,o=t.map(this.treeToListOnlyValues).flat();return W(s)?o:[e]},getSelectedItems(e,t){return e.filter(s=>t.includes(s.key))},format(e){return U(e)},getOnlyMontage(e){let t=[];const{data:s,children:o}=e,r=s[this.keys[0].id];Nt.includes(r)&&t.push(e);const n=o.map(this.getOnlyMontage).flat();return t=[...t,...n],t},getPriceForDay(e){return e>=1e5&&e<3e5?5100:e>=3e5&&e<6e5?6900:e>=6e5&&e<1e6?8e3:e>=1e6&&e<2e6?1e4:e>=2e6?13e3:5100}}},ne=e=>(O("data-v-06d25fe6"),e=e(),P(),e),Zi={class:"table-wrapper"},Gi={class:"results-table"},Qi={class:"results-table__row results-table__row--head"},zi=ne(()=>c("th",{class:"results-table__cell"},"\u041F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B",-1)),Yi={key:0,class:"results-table__cell"},Xi=ne(()=>c("th",{class:"results-table__cell"},"\u0418\u0442\u043E\u0433\u043E",-1)),ea={class:"results-table__cell"},ta={key:0,class:"results-table__cell"},sa={class:"results-table__cell bold"},na={class:"results-table__row results-table__row--head"},oa=ne(()=>c("th",{class:"results-table__cell"},"\u041D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u0435 \u0440\u0430\u0431\u043E\u0442",-1)),ra={key:0,class:"results-table__cell"},ia=ne(()=>c("th",{class:"results-table__cell"},"\u0418\u0442\u043E\u0433\u043E",-1)),aa={class:"results-table__cell"},la={key:0,class:"results-table__cell"},da={class:"results-table__cell bold price"},ca={class:"results-table__row results-table__row--head"},ua=ne(()=>c("th",{class:"results-table__cell"},"\u0418\u0422\u041E\u0413\u041E \u041F\u041E \u0420\u0410\u0411\u041E\u0422\u0410\u041C",-1)),_a={key:0,class:"results-table__cell price"},pa={class:"results-table__cell price"},ha={key:0,class:"results-table__row results-table__row--head"},ma=ne(()=>c("th",{class:"results-table__cell"},"\u0418\u0422\u041E\u0413\u041E \u0421\u041E \u0421\u041A\u0418\u0414\u041A\u041E\u0419",-1)),ya={key:0,class:"results-table__cell price"},fa={class:"results-table__cell price"},va={class:"subtable"},ga={key:0,class:"subtable__row"},ba={class:"subtable__cell"},$a={class:"subtable__cell bold price"};function wa(e,t,s,o,r,n){return l(),u("div",Zi,[c("table",Gi,[c("tr",Qi,[zi,(l(!0),u(k,null,S(n.roomList,i=>(l(),u("th",{key:i.id,class:"results-table__cell"},g(i.name),1))),128)),n.specMontage>0?(l(),u("th",Yi,"\u0421\u043F\u0435\u0446\u043C\u043E\u043D\u0442\u0430\u0436")):R("",!0),Xi]),(l(!0),u(k,null,S(n.parameters,(i,a)=>(l(),u("tr",{key:a,class:"results-table__row"},[c("td",ea,g(i),1),(l(!0),u(k,null,S(n.roomParameters,d=>(l(),u("td",{key:d.id,class:"results-table__cell"},g(d.computed[i]),1))),128)),n.specMontage>0?(l(),u("td",ta,"-")):R("",!0),c("td",sa,g(n.totalParameters[i]),1)]))),128)),c("tr",na,[oa,(l(!0),u(k,null,S(n.roomList,i=>(l(),u("th",{key:i.id,class:"results-table__cell"},g(i.name),1))),128)),n.specMontage>0?(l(),u("th",ra,"\u0421\u043F\u0435\u0446\u043C\u043E\u043D\u0442\u0430\u0436")):R("",!0),ia]),(l(!0),u(k,null,S(n.categories,i=>(l(),u("tr",{key:i.id,class:"results-table__table__row"},[c("td",aa,g(i.name),1),(l(!0),u(k,null,S(i.rooms,(a,d)=>(l(),u("td",{key:d,class:"results-table__cell price"},g(n.format(a)),1))),128)),n.specMontage>0?(l(),u("td",la,g(n.format(i.specMontage)),1)):R("",!0),c("td",da,g(n.format(n.sumOfCategory[i.id])),1)]))),128)),c("tr",ca,[ua,(l(!0),u(k,null,S(n.priceOfRooms,i=>(l(),u("th",{key:i.id,class:"results-table__cell price"},g(n.format(i.result)),1))),128)),n.specMontage>0?(l(),u("th",_a,g(n.format(n.specMontage)),1)):R("",!0),c("th",pa,g(n.format(n.totalPrice+n.specMontage)),1)]),e.sale?(l(),u("tr",ha,[ma,(l(!0),u(k,null,S(n.priceOfRoomsWithSale,i=>(l(),u("th",{key:i.id,class:"results-table__cell price"},g(n.format(i.result)),1))),128)),n.specMontage>0?(l(),u("th",ya,g(n.format(n.specMontage)),1)):R("",!0),c("th",fa,g(n.format(n.totalPriceWithSale+n.specMontage)),1)])):R("",!0)]),c("table",va,[(l(!0),u(k,null,S(n.subTableData,i=>(l(),u(k,{key:i.text},[i.render?(l(),u("tr",ga,[c("td",ba,g(i.text),1),c("td",$a,g(i.value),1)])):R("",!0)],64))),128))])])}var Bt=f(Wi,[["render",wa],["__scopeId","data-v-06d25fe6"]]);const Ca={components:{AutoComplete:cs,InputSwitch:us,TreeTable:Bi,TreeTableView:qi,MultiSelect:Le,ResultsTable:Bt},data(){return{screenHeight:null,selectedJob:null,filteredJobs:[],selectedFastJobs:[],fastJobs:[{label:"\u0420\u0430\u0431\u043E\u0442\u044B 1"},{label:"\u0420\u0430\u0431\u043E\u0442\u044B 2"},{label:"\u0420\u0430\u0431\u043E\u0442\u044B 3"}]}},computed:b(m({},I("outlay",["selectedRoom","roots","outlay","currentRoomData","roomsData","keys","rooms","selectedValues","showResults"])),{striped:{get(){return this.$store.getters["outlay/striped"]},set(e){this.setStriped(e)}},scrollHeight(){return`${this.screenHeight-100}px`},jobs(){return this.selectedRoom?this.roots.map(e=>this.getGroups(e,null)).flat():[...this.rooms].reverse().map(s=>({key:s.id,data:{[this.keys[0].id]:s.name},name:s.name,children:this.roomsData[s.id]})).map(s=>this.getGroupsWithRoom(s,null,s.key)).flat()}}),watch:{selectedRoom(){this.windowResize()},outlay(){this.windowResize()}},mounted(){this.windowResize(),window.addEventListener("resize",this.windowResize)},unmounted(){window.removeEventListener("resize",this.windowResize)},methods:b(m({},K("outlay",["selectJob","setStriped"])),{async windowResize(){if(!this.outlay||this.showResults)return;await this.$nextTick();const{autocomplete:e}=this.$refs,{top:t}=e.$el.getBoundingClientRect();this.screenHeight=window.innerHeight-t},getGroupsWithRoom(e,t=null,s){const{children:o,key:r,data:n}=e;if(o&&o.length>0){e.parent=t;const i=b(m({},e),{name:n[this.keys[0].id],items:[],roomId:s}),d=e.children.map(y=>this.getGroupsWithRoom(y,r,s)).flat().filter(y=>this.selectedValues[s].includes(y.key));if(W(o[0].key))return[m({},i),...d];const p=e.children.filter(y=>this.selectedValues[s].includes(y.key));return[b(m({},i),{items:p.map(y=>b(m({},y),{name:y.data[this.keys[0].id],roomId:s}))}),...d]}return[]},getGroups(e,t){const{children:s,key:o,data:r}=e;if(s&&s.length>0){e.parent=t;const n=b(m({},e),{name:r[this.keys[0].id],items:[]}),i=e.children.map(a=>this.getGroups(a,o)).flat();return W(s[0].key)?[m({},n),...i]:[b(m({},n),{items:e.children.map(a=>b(m({},a),{name:a.data[this.keys[0].id]}))}),...i]}return[]},getParentsOfNode(e){const t=this.jobs.find(s=>s.key===e);return t?t.parent?[this.getParentsOfNode(t.parent),t]:[t]:[]},getParentsOfRoom(e,t){const s=this.jobs.find(o=>o.key===t&&o.roomId===e);return s.parent?[this.getParentsOfRoom(e,s.parent),s]:[s]},async searchJob(e){const t=e.query,s=[];for(const r of this.jobs){const n=r.items.filter(i=>i.name.toLowerCase().includes(t.toLowerCase()));n&&n.length&&((this.selectedRoom?this.getParentsOfNode(r.parent):this.getParentsOfRoom(r.roomId,r.parent).flat()).forEach(a=>{s.push(a)}),s.push(b(m({},r),{items:n})))}if(this.selectedRoom)return this.filteredJobs=F.exports.uniqBy(s,"key");const o=s.reduce((r,n)=>(r[n.roomId]=r[n.roomId]||[],r[n.roomId].push(n),r),{});this.filteredJobs=Object.values(o).reduce((r,n)=>{const i=F.exports.uniqBy(n,"key");return[...r,...i]},[])},async findJob(e){const t=e.value.key,s=e.value.roomId,{table:o,autocomplete:r}=this.$refs,n=r.$el.querySelector("input");if(n&&(await this.$nextTick(),n.blur()),!this.selectedRoom)return o.scrollTo(s,t);o.scrollToAndSelect(e.value)},autoCompleteClickHanler(){this.selectedJob=null},autocompleteInput(){this.$refs.autocomplete.hideOverlay()}})},Dt=e=>(O("data-v-0cbbbc3a"),e=e(),P(),e),ka={class:"center"},Ia={key:0,class:"center__body"},Va={key:0,class:"body-actions"},Sa={class:"search-wrapper"},La=Dt(()=>c("i",{class:"pi pi-search"},null,-1)),Ta={class:"body-actions__group"},Ra={class:"switch-wrapper"},xa={class:"switch"},Oa=Dt(()=>c("span",null,"\u0427\u0435\u0440\u0435\u0434\u043E\u0432\u043D\u0438\u0435 \u0446\u0432\u0435\u0442\u043E\u0432",-1)),Pa={key:1,class:"results-wrapper"};function Na(e,t,s,o,r,n){const i=_("AutoComplete"),a=_("MultiSelect"),d=_("InputSwitch"),p=_("ResultsTable"),y=_("TreeTable"),w=_("TreeTableView");return l(),u("div",ka,[e.outlay?(l(),u("div",Ia,[e.showResults?R("",!0):(l(),u("div",Va,[c("div",Sa,[La,h(i,{modelValue:r.selectedJob,"onUpdate:modelValue":t[0]||(t[0]=C=>r.selectedJob=C),ref:"autocomplete",class:"search",field:"name",optionGroupLabel:"name",optionGroupChildren:"items",scrollHeight:n.scrollHeight,suggestions:r.filteredJobs,placeholder:"\u041F\u043E\u0438\u0441\u043A",delay:300,onInput:n.autocompleteInput,onComplete:t[1]||(t[1]=C=>n.searchJob(C)),onItemSelect:n.findJob,onClick:n.autoCompleteClickHanler},null,8,["modelValue","scrollHeight","suggestions","onInput","onItemSelect","onClick"])]),c("div",Ta,[e.selectedRoom?(l(),$(a,{key:0,modelValue:r.selectedFastJobs,"onUpdate:modelValue":t[2]||(t[2]=C=>r.selectedFastJobs=C),class:"multiselect",placeholder:"\u0411\u044B\u0441\u0442\u0440\u044B\u0435 \u0440\u0430\u0431\u043E\u0442\u044B",options:r.fastJobs,optionLabel:"label"},null,8,["modelValue","options"])):R("",!0),c("div",Ra,[c("div",xa,[h(d,{modelValue:n.striped,"onUpdate:modelValue":t[3]||(t[3]=C=>n.striped=C)},null,8,["modelValue"])]),Oa])])])),e.showResults?(l(),u("div",Pa,[h(p)])):e.selectedRoom?(l(),$(y,{key:2,ref:"table",striped:n.striped},null,8,["striped"])):e.rooms.length>0?(l(),$(w,{key:3,ref:"table"},null,512)):R("",!0)])):R("",!0)])}var Ba=f(Ca,[["render",Na],["__scopeId","data-v-0cbbbc3a"]]);const Da={},Ea={width:"7",height:"7",viewBox:"0 0 7 7",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ma=c("path",{d:"M7 3.5L0.25 6.53109L0.25 0.468911L7 3.5Z",fill:"#1C1D2A"},null,-1),Aa=[Ma];function Ka(e,t){return l(),u("svg",Ea,Aa)}var Ja=f(Da,[["render",Ka]]);const Ha={name:"CategoryItem",components:{TriangleIcon:Ja},props:{category:{type:Object,required:!0}},data(){return{showChildren:!1}},computed:{sum(){return U(this.category.sum)},jobs(){return this.category.jobs.filter(t=>{const{id:s}=t;return W(s)}).map(t=>b(m({},t),{sum:U(t.sum)}))}}},Ua={class:"category-item"},ja={class:"category-item__head"},Fa=["title"],qa={class:"category-item__price"},Wa={key:0,class:"category-item__list"},Za={class:"category-item__head"},Ga=["title"],Qa={class:"category-item__price"};function za(e,t,s,o,r,n){const i=_("TriangleIcon");return l(),u("div",Ua,[c("div",ja,[c("div",{class:"category-item__text",onClick:t[0]||(t[0]=a=>r.showChildren=!r.showChildren)},[c("button",{class:D(["button",{rotated:r.showChildren,hidden:n.jobs.length===0}])},[h(i,{class:"button__icon"})],2),c("span",{class:"category-item__name",title:s.category.name},g(s.category.name),9,Fa)]),c("span",qa,g(n.sum),1)]),n.jobs&&n.jobs.length>0&&r.showChildren?(l(),u("div",Wa,[(l(!0),u(k,null,S(n.jobs,a=>(l(),u("div",{key:a.key,class:"category-item"},[c("div",Za,[c("span",{class:"category-item__name",title:a.name},g(a.name),9,Ga),c("span",Qa,g(a.sum.toLocaleString()),1)])]))),128))])):R("",!0)])}var Ya=f(Ha,[["render",za],["__scopeId","data-v-6f9cec45"]]);const Xa={name:"CategoryList",components:{CategoryItem:Ya},props:{categories:{type:Array,required:!0}},computed:b(m({},I("outlay",["roomsData","selectedRoom"])),{categoryList(){return this.selectedRoom?this.categories.find(t=>t.id===this.selectedRoom.id).jobs:[...this.categories].reverse()}})},el={class:"category-list"};function tl(e,t,s,o,r,n){const i=_("CategoryItem");return l(),u("div",el,[(l(!0),u(k,null,S(n.categoryList,a=>(l(),$(i,{key:a.id,category:a},null,8,["category"]))),128))])}var sl=f(Xa,[["render",tl],["__scopeId","data-v-2a84c66d"]]);const nl={props:{data:{type:Array,required:!0}},data(){return{timeout:null}},computed:b(m({},I("outlay",["sale"])),{saleValue:{get(){return this.sale},set(e){this.setSale(e)}},totalSum(){return this.data.reduce((e,t)=>e+ +t.sum,0)},totalSumFormatted(){return U(this.totalSum)},totalSumWithSale(){if(!this.saleValue||this.saleValue<0||this.saleValue>20)return this.totalSumFormatted;const e=this.data.map(this.findCategoriesWithoutSale).flat();if(e.length>0){const o=e.reduce((a,d)=>a+=d.sum,0),n=(this.totalSum-o)/100*this.saleValue,i=this.totalSum-n;return U(i)}const t=this.totalSum/100*this.saleValue,s=this.totalSum-t;return U(s)}}),methods:b(m(m({},K("outlay",["setSale"])),N("outlay",["saveLocaly"])),{inputSale(e){const{target:t}=e,{valueAsNumber:s}=t;if(s<0){t.value=0;return}s>20&&(t.value=20),t.value=this.saleValue},changeSale(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(async()=>{await this.saveLocaly()},400)},findCategoriesWithoutSale(e){const{name:t,jobs:s}=e;let o=[];if(Nt.includes(t)&&o.push(e),s){const r=s.map(this.findCategoriesWithoutSale).flat();o=[...o,...r]}return o}})},ol=e=>(O("data-v-a10b4164"),e=e(),P(),e),rl={class:"results"},il=V(" \u0411\u0435\u0437 \u0441\u043A\u0438\u0434\u043A\u0438: "),al={class:"result"},ll={class:"right-side__sale"},dl=ol(()=>c("span",null,"\u0421\u043A\u0438\u0434\u043A\u0430, %: ",-1)),cl=V(" \u0418\u0422\u041E\u0413\u041E: "),ul={class:"result result--sale"};function _l(e,t,s,o,r,n){return l(),u("div",rl,[c("span",null,[il,c("span",al,g(n.totalSumFormatted),1)]),c("div",ll,[dl,M(c("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>n.saleValue=i),class:"input",placeholder:"%",type:"number",max:20,min:0,onInput:t[1]||(t[1]=(...i)=>n.inputSale&&n.inputSale(...i)),onChange:t[2]||(t[2]=(...i)=>n.changeSale&&n.changeSale(...i))},null,544),[[j,n.saleValue]])]),c("span",null,[cl,c("span",ul,g(n.totalSumWithSale),1)])])}var pl=f(nl,[["render",_l],["__scopeId","data-v-a10b4164"]]);const hl={},ml={class:"outlay-block"};function yl(e,t){return l(),u("div",ml,[Q(e.$slots,"default",{},void 0,!0)])}var Et=f(hl,[["render",yl],["__scopeId","data-v-6ad65585"]]);const fl={props:{name:{required:!0,type:String},value:{required:!0}}},vl={class:"parameter"},gl={class:"parameter__name"},bl=["value"];function $l(e,t,s,o,r,n){return l(),u("div",vl,[c("label",gl,g(s.name),1),c("input",{value:s.value,class:"parameter__input"},null,8,bl)])}var Mt=f(fl,[["render",$l],["__scopeId","data-v-367b23e9"]]);const wl={components:{ParameterItem:Mt},mixins:[ee],props:{parametersData:{type:Object,default(){return{}}}}},Cl={class:"computed-parameters"};function kl(e,t,s,o,r,n){const i=_("ParameterItem");return l(),u("div",Cl,[h(i,{name:"S \u043F\u043E\u043B\u0430",value:s.parametersData[e.roomOptions.floorArea]},null,8,["value"]),h(i,{name:"S \u0441\u0442\u0435\u043D",value:s.parametersData[e.roomOptions.wallArea]},null,8,["value"]),h(i,{name:"\u041F\u0435\u0440\u0438\u043C\u0435\u0442\u0440",value:s.parametersData[e.roomOptions.perimeter]},null,8,["value"])])}var At=f(wl,[["render",kl],["__scopeId","data-v-8e89d10c"]]);const Il={components:{ParameterItem:Mt},props:{parameters:{type:Object,default(){return{}}}}},Vl={class:"room-options"};function Sl(e,t,s,o,r,n){const i=_("ParameterItem");return l(),u("div",Vl,[(l(!0),u(k,null,S(s.parameters,(a,d)=>(l(),$(i,{key:d,name:d,value:a},null,8,["name","value"]))),128))])}var Ll=f(Il,[["render",Sl],["__scopeId","data-v-58c12efa"]]);const Tl={components:{RoomParameters:Ll,ComputedParameters:At},mixins:[ee],computed:b(m({},I("outlay",["selectedRoom"])),{parameters(){return this.selectedRoom.options},allParameters(){const e=this.calculateAllParameters(this.parameters);return Object.keys(e).reduce((t,s)=>(t[s]=Object.entries(e[s]).reduce((o,[r,n])=>(o[r]=U(n),o),{}),t),{})}})},Rl={class:"title"},xl={class:"groups"};function Ol(e,t,s,o,r,n){const i=_("RoomParameters",!0),a=_("ComputedParameters");return l(),u(k,null,[c("span",Rl,g(e.selectedRoom.name),1),c("div",xl,[h(i,{parameters:n.allParameters.options},null,8,["parameters"]),h(a,{parametersData:n.allParameters.computed},null,8,["parametersData"])])],64)}var Pl=f(Tl,[["render",Ol],["__scopeId","data-v-629bd96c"]]);const Nl={components:{ComputedParameters:At},mixins:[ee],computed:b(m({},I("outlay",["rooms"])),{totalComputedParameters(){return this.rooms.reduce((e,t)=>{const{options:s}=t,{computed:o}=this.calculateAllParameters(s);return this.sumParameters(e,o)},{})}}),methods:{sumParameters(e,t){return Object.entries(t).reduce((s,[o,r])=>{const n=r+(e[o]||0);return s[o]=n,s},{})}}},Bl=e=>(O("data-v-3ecacac5"),e=e(),P(),e),Dl=Bl(()=>c("span",{class:"title"}," \u0418\u0442\u043E\u0433\u043E\u0432\u044B\u0435 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B ",-1));function El(e,t,s,o,r,n){const i=_("ComputedParameters");return l(),u(k,null,[Dl,h(i,{parametersData:n.totalComputedParameters},null,8,["parametersData"])],64)}var Ml=f(Nl,[["render",El],["__scopeId","data-v-3ecacac5"]]);const Al={components:{OutlayBlock:Et,RoomParameters:Pl,TotalParameters:Ml},computed:m({},I("outlay",["selectedRoom"]))},Kl={class:"parameters"};function Jl(e,t,s,o,r,n){const i=_("RoomParameters"),a=_("TotalParameters"),d=_("OutlayBlock");return l(),$(d,null,{default:v(()=>[c("div",Kl,[e.selectedRoom?(l(),$(i,{key:0})):(l(),$(a,{key:1}))])]),_:1})}var Hl=f(Al,[["render",Jl],["__scopeId","data-v-4fcfcb88"]]);const Ul={components:{CategoryList:sl,ResultsForm:pl,ParameterList:Hl,OutlayBlock:Et},computed:b(m(m({},gt("outlay",["selectedValues"])),I("outlay",["outlay","rooms","roomsData","quantityKey","priceKey","keys","selectedRoom","currentRoomData"])),{data(){if(this.selectedRoom){const s=JSON.parse(JSON.stringify(this.currentRoomData)),o=JSON.parse(JSON.stringify(this.selectedRoom));return[this.getRoomWithSum(o,s)]}const e=JSON.parse(JSON.stringify(this.roomsData));return[...this.rooms].map(s=>{const o=e[s.id];return this.getRoomWithSum(s,o)})}}),methods:{treeToListOnlyValues(e){const{children:t,key:s}=e,o=t.map(this.treeToListOnlyValues).flat();return W(s)?o:[e]},getSelectedItems(e,t){return e.filter(s=>t.includes(s.key))},getSubCategoriesWithSum(e,t){return e.map(s=>{const o=this.treeToListOnlyValues(s),n=this.getSelectedItems(o,t).reduce((i,a)=>{const d=a.data[this.quantityKey.id]*a.data[this.priceKey.id];return i+d},0);return{id:s.key,name:s.data[this.keys[0].id],sum:n}})},getSum(e){return e.reduce((t,s)=>t+=+s.sum,0)},getRoomWithSum(e,t){const s=this.selectedValues[e.id],r=this.getSelectedItems(t,s).map(i=>{const a=this.getSelectedItems(i.children,s),d=this.getSubCategoriesWithSum(a,s),p=this.getSum(d);return{id:i.key,name:i.data[this.keys[0].id],sum:p,jobs:d}}),n=this.getSum(r);return{id:e.id,name:e.name,jobs:r,sum:n}}}},jl={class:"wrapper"};function Fl(e,t,s,o,r,n){const i=_("ParameterList"),a=_("CategoryList"),d=_("ResultsForm"),p=_("OutlayBlock");return l(),u("div",jl,[h(i,{class:"wrapper__parameters"}),h(p,{class:"wrapper__results"},{default:v(()=>[h(a,{categories:n.data},null,8,["categories"]),h(d,{data:n.data},null,8,["data"])]),_:1})])}var ql=f(Ul,[["render",Fl],["__scopeId","data-v-faa5c0c0"]]);const Wl={},Zl={width:"11",height:"11",viewBox:"0 0 11 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Gl=c("path",{d:"M10.5 4.875H2.89375L6.3875 1.38125L5.5 0.5L0.5 5.5L5.5 10.5L6.38125 9.61875L2.89375 6.125H10.5V4.875Z",fill:"#545454"},null,-1),Ql=[Gl];function zl(e,t){return l(),u("svg",Zl,Ql)}var Yl=f(Wl,[["render",zl]]);const Xl={},ed={width:"13",height:"13",viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},td=c("path",{d:"M9.625 0.875H2.125C1.43125 0.875 0.875 1.4375 0.875 2.125V10.875C0.875 11.5625 1.43125 12.125 2.125 12.125H10.875C11.5625 12.125 12.125 11.5625 12.125 10.875V3.375L9.625 0.875ZM6.5 10.875C5.4625 10.875 4.625 10.0375 4.625 9C4.625 7.9625 5.4625 7.125 6.5 7.125C7.5375 7.125 8.375 7.9625 8.375 9C8.375 10.0375 7.5375 10.875 6.5 10.875ZM8.375 4.625H2.125V2.125H8.375V4.625Z",fill:"#545454"},null,-1),sd=[td];function nd(e,t){return l(),u("svg",ed,sd)}var od=f(Xl,[["render",nd]]);const rd={},id={width:"9",height:"12",viewBox:"0 0 9 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ad=c("path",{d:"M8.875 4.625H6.375V0.875H2.625V4.625H0.125L4.5 9L8.875 4.625ZM0.125 10.25V11.5H8.875V10.25H0.125Z",fill:"#545454"},null,-1),ld=[ad];function dd(e,t){return l(),u("svg",id,ld)}var cd=f(rd,[["render",dd]]);const ud={},_d={width:"13",height:"13",viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},pd=c("path",{d:"M10.875 4H2.125C1.0875 4 0.25 4.8375 0.25 5.875V9.625H2.75V12.125H10.25V9.625H12.75V5.875C12.75 4.8375 11.9125 4 10.875 4ZM9 10.875H4V7.75H9V10.875ZM10.875 6.5C10.5312 6.5 10.25 6.21875 10.25 5.875C10.25 5.53125 10.5312 5.25 10.875 5.25C11.2188 5.25 11.5 5.53125 11.5 5.875C11.5 6.21875 11.2188 6.5 10.875 6.5ZM10.25 0.875H2.75V3.375H10.25V0.875Z",fill:"#545454"},null,-1),hd=[pd];function md(e,t){return l(),u("svg",_d,hd)}var yd=f(ud,[["render",md]]);const fd={props:{bold:Boolean,results:Boolean,category:Boolean}};function vd(e,t,s,o,r,n){return l(),u("tr",{class:D(["table-row",{bold:s.bold,results:s.results,category:s.category}])},[Q(e.$slots,"default",{},void 0,!0)],2)}var be=f(fd,[["render",vd],["__scopeId","data-v-55ab7156"]]);const gd={props:{result:Boolean,category:Boolean,right:Boolean,colspan:Number}},bd=["colspan"];function $d(e,t,s,o,r,n){return l(),u("td",{class:D(["table-cell",{result:s.result,category:s.category,right:s.right}]),colspan:s.colspan},[Q(e.$slots,"default",{},void 0,!0)],10,bd)}var $e=f(gd,[["render",$d],["__scopeId","data-v-656c5c8e"]]);const wd={components:{RowWrapper:be,CellWrapper:$e},props:{node:{type:Object,required:!0,default:()=>({})}},computed:b(m({},I("outlay",["keys","quantityKey","priceKey"])),{data(){return this.node.data},children(){return this.node.children||[]},isCategory(){return this.children.length>0},sum(){const e=this.node.data[this.quantityKey.id],t=this.node.data[this.priceKey.id];return U(e*t)}})};function Cd(e,t,s,o,r,n){const i=_("CellWrapper"),a=_("RowWrapper");return l(),$(a,null,{default:v(()=>[(l(!0),u(k,null,S(e.keys,d=>(l(),$(i,{key:d.id},{default:v(()=>[V(g(n.data[d.id]),1)]),_:2},1024))),128)),h(i,{right:""},{default:v(()=>[V(g(n.sum),1)]),_:1})]),_:1})}var kd=f(wd,[["render",Cd]]);const Id={components:{TableRow:kd,RowWrapper:be,CellWrapper:$e},props:{node:{type:Object,required:!0}},computed:b(m({},I("outlay",["keys","quantityKey","priceKey"])),{children(){return this.node.children},title(){return this.children.length>0?this.node.data[this.keys[0].id]:null},visibleKeys(){return this.keys.map((e,t)=>t===0&&this.title?this.title:e.name)}})},Vd=V("\u0421\u0443\u043C\u043C\u0430");function Sd(e,t,s,o,r,n){const i=_("CellWrapper"),a=_("RowWrapper"),d=_("TableRow");return l(),u(k,null,[n.title?(l(),$(a,{key:0,bold:""},{default:v(()=>[(l(!0),u(k,null,S(n.visibleKeys,p=>(l(),$(i,{key:p},{default:v(()=>[V(g(p),1)]),_:2},1024))),128)),h(i,{result:""},{default:v(()=>[Vd]),_:1})]),_:1})):(l(),$(d,{key:1,node:s.node},null,8,["node"])),(l(!0),u(k,null,S(n.children,p=>(l(),$(d,{node:p,key:p.key},null,8,["node"]))),128))],64)}var Ld=f(Id,[["render",Sd]]);const Td={components:{JobList:Ld,RowWrapper:be,CellWrapper:$e},props:{node:{type:Object,required:!0}},computed:b(m({},I("outlay",["keys","quantityKey","priceKey"])),{title(){return this.node.data[this.keys[0].id]},children(){return this.node.children},sum(){const t=Ee(this.node).flat().reduce((s,o)=>{const{data:r}=o;return s+=r[this.quantityKey.id]*r[this.priceKey.id],s},0);return U(t)}})};function Rd(e,t,s,o,r,n){const i=_("CellWrapper"),a=_("RowWrapper"),d=_("JobList");return l(),u(k,null,[h(a,{category:""},{default:v(()=>[h(i,{category:"",colspan:e.keys.length+1},{default:v(()=>[V(g(n.title),1)]),_:1},8,["colspan"])]),_:1}),(l(!0),u(k,null,S(n.children,p=>(l(),$(d,{key:p.key,node:p},null,8,["node"]))),128)),h(a,{results:""},{default:v(()=>[h(i,{result:"",colspan:e.keys.length},{default:v(()=>[V(" \u0418\u0442\u043E\u0433\u043E \u043F\u043E \u0440\u0430\u0437\u0434\u0435\u043B\u0443 ("+g(n.title)+") ",1)]),_:1},8,["colspan"]),h(i,{result:""},{default:v(()=>[V(g(n.sum),1)]),_:1})]),_:1})],64)}var xd=f(Td,[["render",Rd]]);const Od={components:{CategoryRow:xd,RowWrapper:be,CellWrapper:$e},props:{tableKeys:{type:Array,required:!0},tableData:{type:Array,required:!0},room:{type:Object,required:!0}},computed:b(m({},I("outlay",["quantityKey","priceKey"])),{sum(){const t=this.room.jobs.map(Ee).flat().reduce((s,o)=>{const{data:r}=o;return s+=r[this.quantityKey.id]*r[this.priceKey.id],s},0);return U(t)}})},Pd={class:"print-table"},Nd=["width"];function Bd(e,t,s,o,r,n){const i=_("CategoryRow"),a=_("CellWrapper"),d=_("RowWrapper");return l(),u("table",Pd,[(l(!0),u(k,null,S(s.tableKeys,(p,y)=>(l(),u("col",{key:p.id,width:y===0?"50%":"100px"},null,8,Nd))),128)),(l(!0),u(k,null,S(s.tableData,p=>(l(),$(i,{key:p.key,node:p},null,8,["node"]))),128)),h(d,null,{default:v(()=>[h(a,{result:"",colspan:s.tableKeys.length},{default:v(()=>[V(" \u0418\u0442\u043E\u0433\u043E \u043F\u043E \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u044E ("+g(s.room.name)+") ",1)]),_:1},8,["colspan"]),h(a,{result:""},{default:v(()=>[V(g(n.sum),1)]),_:1})]),_:1})])}var Dd=f(Od,[["render",Bd],["__scopeId","data-v-6a4fc9ba"]]);const Ed={components:{AppLogo:xe},mixins:[ee],props:{room:{type:Object,required:!0}},computed:{options(){return this.room.options},parameterKeys(){const e={[q.length]:"\u0414\u043B\u0438\u043D\u0430, \u043C/\u043F",[q.width]:"\u0428\u0438\u0440\u0438\u043D\u0430, \u043C/\u043F",[q.height]:"\u0412\u044B\u0441\u043E\u0442\u0430, \u043C/\u043F",[q.spaces]:"\u041F\u0440\u043E\u0435\u043C, \u043C2"};return Object.entries(e).map(([t,s])=>{const o=Object.keys(q).find(r=>q[r]===t);return{text:s,key:o}})},calculatedParameters(){const{computed:e}=this.calculateAllParameters(this.options);return e}}},we=e=>(O("data-v-2ce6da24"),e=e(),P(),e),Md={class:"page-header"},Ad={class:"top"},Kd=we(()=>c("div",{class:"top__text"},[c("span",{class:"top__phone"}," 8 (495) 104-51-21 "),c("span",{class:"top__subtext"},"\u0441\u043B\u0443\u0436\u0431\u0430 \u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u043E\u0433\u043E \u043A\u043E\u043D\u0442\u0440\u043E\u043B\u044F")],-1)),Jd=we(()=>c("div",{class:"address"},[c("span",{class:"text"}," \u0410\u0434\u0440\u0435\u0441 \u043E\u0431\u044A\u0435\u043A\u0442\u0430: "),c("div",{class:"underline"})],-1)),Hd={class:"row"},Ud=we(()=>c("span",{class:"application"},[V("\u041F\u0440\u0438\u043B\u043E\u0436\u0435\u043D\u0438\u0435 \u043A \u21161 \u043A \u0434\u043E\u0433\u043E\u0432\u043E\u0440\u0443 \u2116 \u041A\u0421 "),c("div",{class:"application__underline"}),V(" \u043E\u0442 "),c("div",{class:"application__underline"}),V(" 2022\u0433.")],-1)),jd={class:"parameters"},Fd={class:"parameters-table"},qd={class:"parameters-table__row"},Wd={class:"parameters-table__row"},Zd={class:"parameters-table"},Gd={class:"parameters-table__row"},Qd={class:"parameters-table__row"},zd=we(()=>c("div",{class:"row"},[c("span",{class:"date"},[V(' \u0421\u043C\u0435\u0442\u0430 \u043E\u0442 " '),c("div",{class:"date__space"}),V(' " '),c("div",{class:"date__underline"}),V(" 2022 ")])],-1));function Yd(e,t,s,o,r,n){const i=_("AppLogo");return l(),u("div",Md,[c("div",Ad,[h(i,{class:"top__logo"}),Kd]),Jd,c("div",Hd,[Ud,c("div",jd,[c("table",Fd,[c("tr",qd,[(l(!0),u(k,null,S(n.parameterKeys,a=>(l(),u("td",{key:a.key,class:"parameters-table__cell"},g(a.text),1))),128))]),c("tr",Wd,[(l(!0),u(k,null,S(n.parameterKeys,a=>(l(),u("td",{key:a.key,class:"parameters-table__cell"},g(n.options[a.key]),1))),128))])]),c("table",Zd,[c("tr",Gd,[(l(!0),u(k,null,S(n.calculatedParameters,(a,d)=>(l(),u("td",{key:d,class:"parameters-table__cell"},g(d),1))),128))]),c("tr",Qd,[(l(!0),u(k,null,S(n.calculatedParameters,(a,d)=>(l(),u("td",{key:d,class:"parameters-table__cell"},g(a),1))),128))])])])]),zd])}var Xd=f(Ed,[["render",Yd],["__scopeId","data-v-2ce6da24"]]);const ec={components:{PrintTable:Dd,PageHeader:Xd,ResultsTable:Bt},props:{outlay:{required:!0,type:Object}},computed:b(m({},I("outlay",["keys"])),{tableKeys(){return this.edition?[...this.keys,{id:"\u0421\u0443\u043C\u043C\u0430",name:"\u0421\u0443\u043C\u043C\u0430"}]:[]},tableData(){return[...this.outlay.rooms].reverse()}})},tc=e=>(O("data-v-613f960a"),e=e(),P(),e),sc={class:"container"},nc={class:"title"},oc=_s('<div class="signs" data-v-613f960a><span class="sign" data-v-613f960a> \u0421\u043E\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u043E: <div class="sign__underline" data-v-613f960a></div></span><div class="sign" data-v-613f960a> \u0421\u043E\u0433\u043B\u0430\u0441\u043E\u0432\u0430\u043D\u043E: <div class="sign__underline" data-v-613f960a></div></div></div>',1),rc=tc(()=>c("span",{class:"title results-table"}," \u0421\u0432\u043E\u0434\u043D\u0430\u044F \u0442\u0430\u0431\u043B\u0438\u0446\u0430 ",-1));function ic(e,t,s,o,r,n){const i=_("PageHeader"),a=_("PrintTable"),d=_("ResultsTable");return l(),u("div",sc,[(l(!0),u(k,null,S(n.tableData,p=>(l(),u("div",{class:"room",key:p.id},[h(i,{room:p},null,8,["room"]),c("span",nc,g(p.name),1),h(a,{tableKeys:e.keys,tableData:p.jobs,room:p},null,8,["tableKeys","tableData","room"]),oc]))),128)),rc,h(d)])}var Kt=f(ec,[["render",ic],["__scopeId","data-v-613f960a"]]);const nt=()=>({okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0}),ac={components:{PopupModal:G},data(){return nt()},methods:{show(e){return this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.$refs.popup.open(),new Promise((t,s)=>{this.resolvePromise=t,this.rejectPromise=s})},_confirm(){this.$refs.popup.close(),this.resolvePromise(!0),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},reset(){Object.assign(this.$data,nt())}}},lc=e=>(O("data-v-7d5e7c96"),e=e(),P(),e),dc={class:"modal"},cc=lc(()=>c("span",{class:"modal__title"}," \u0421\u043A\u0430\u0447\u0430\u0442\u044C ",-1)),uc={class:"modal__actions"},_c=V(" \u041E\u0442\u043C\u0435\u043D\u0430 "),pc=V(" \u0421\u043A\u0430\u0447\u0430\u0442\u044C ");function hc(e,t,s,o,r,n){const i=_("AppButton"),a=_("PopupModal");return l(),$(a,{ref:"popup"},{default:v(()=>[c("div",dc,[cc,c("div",uc,[h(i,{outlined:"",onClick:n._cancel},{default:v(()=>[_c]),_:1},8,["onClick"]),h(i,{outlined:"",onClick:n._confirm},{default:v(()=>[pc]),_:1},8,["onClick"])])])]),_:1},512)}var mc=f(ac,[["render",hc],["__scopeId","data-v-7d5e7c96"]]);const yc={components:{BackIcon:Yl,SaveIcon:od,DownloadIcon:cd,PrintIcon:yd,PrintPage:Kt,DownloadModal:mc},data(){return{isDownloading:!1,isSaving:!1}},computed:b(m({},I("outlay",["outlay"])),{actions(){return[{text:"\u041D\u0430\u0437\u0430\u0434",handler:()=>{this.$router.push("/")},icon:"BackIcon",disabled:!1,loading:!1},{text:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",handler:()=>{this.save()},icon:"SaveIcon",disabled:this.isSaving,loading:this.isSaving},{text:"\u0421\u043A\u0430\u0447\u0430\u0442\u044C",handler:()=>{this.download()},icon:"DownloadIcon",disabled:this.isDownloading,loading:this.isDownloading},{text:"\u0420\u0430\u0441\u043F\u0435\u0447\u0430\u0442\u0430\u0442\u044C",handler(){window.print()},icon:"PrintIcon",disabled:!1,loading:!1}]}}),methods:b(m(m(m({},K("outlay",["setOutlay"])),N("outlay",["update"])),N("outlays",["print"])),{async save(){this.isSaving=!0,this.setOutlay();try{await this.update()}catch(e){console.log(e)}finally{this.isSaving=!1}},async download(){if(!this.outlay)return console.error("select outlay");this.isDownloading=!0;try{await this.update(),await this.print(this.outlay._id);const t="http://localhost:8000/api".split("/");t.pop();const s=t.join("/"),o=await vt.get(`${s}/pdf/smeta.pdf`,{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([o.data])),n=document.createElement("a");n.href=r,n.setAttribute("download",`${this.outlay.name}.pdf`),document.body.appendChild(n),n.click(),n.remove()}catch(e){console.log(e)}finally{this.isDownloading=!1}}})},fc={class:"action-list"},vc=["disabled","onClick"],gc={class:"action__text"},bc={key:0,class:"pi pi-spin pi-spinner"};function $c(e,t,s,o,r,n){const i=_("DownloadModal"),a=_("PrintPage");return l(),u(k,null,[h(i,{ref:"download"},null,512),c("div",fc,[(l(!0),u(k,null,S(n.actions,d=>(l(),u("button",{class:"button action",key:d.text,disabled:d.disabled,onClick:d.handler},[(l(),$(he(d.icon),{class:"action__icon"})),c("span",gc,g(d.text),1),d.loading?(l(),u("i",bc)):R("",!0)],8,vc))),128))]),(l(),$(ps,{to:"#print"},[e.outlay?(l(),$(a,{key:0,outlay:e.outlay},null,8,["outlay"])):R("",!0)]))],64)}var wc=f(yc,[["render",$c],["__scopeId","data-v-cc234e9e"]]);const Cc={},kc={width:"12",height:"9",viewBox:"0 0 12 9",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ic=c("path",{d:"M0.5 3.875H3.625V0.125H0.5V3.875ZM0.5 8.25H3.625V4.5H0.5V8.25ZM4.25 8.25H7.375V4.5H4.25V8.25ZM8 8.25H11.125V4.5H8V8.25ZM4.25 3.875H7.375V0.125H4.25V3.875ZM8 0.125V3.875H11.125V0.125H8Z",fill:"currentColor"},null,-1),Vc=[Ic];function Sc(e,t){return l(),u("svg",kc,Vc)}var Lc=f(Cc,[["render",Sc]]);const Tc={},Rc={width:"13",height:"13",viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},xc=c("path",{d:"M10.875 0.875H2.125C1.4375 0.875 0.875 1.4375 0.875 2.125V10.875C0.875 11.5625 1.4375 12.125 2.125 12.125H10.875C11.5625 12.125 12.125 11.5625 12.125 10.875V2.125C12.125 1.4375 11.5625 0.875 10.875 0.875ZM7.75 9.625H3.375V8.375H7.75V9.625ZM9.625 7.125H3.375V5.875H9.625V7.125ZM9.625 4.625H3.375V3.375H9.625V4.625Z",fill:"currentColor"},null,-1),Oc=[xc];function Pc(e,t){return l(),u("svg",Rc,Oc)}var Nc=f(Tc,[["render",Pc]]);const Bc={},Dc={width:"13",height:"13",viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ec=c("path",{d:"M7.125 3.375H5.875V5.875H3.375V7.125H5.875V9.625H7.125V7.125H9.625V5.875H7.125V3.375ZM6.5 0.25C3.05 0.25 0.25 3.05 0.25 6.5C0.25 9.95 3.05 12.75 6.5 12.75C9.95 12.75 12.75 9.95 12.75 6.5C12.75 3.05 9.95 0.25 6.5 0.25ZM6.5 11.5C3.74375 11.5 1.5 9.25625 1.5 6.5C1.5 3.74375 3.74375 1.5 6.5 1.5C9.25625 1.5 11.5 3.74375 11.5 6.5C11.5 9.25625 9.25625 11.5 6.5 11.5Z",fill:"white"},null,-1),Mc=[Ec];function Ac(e,t){return l(),u("svg",Dc,Mc)}var Kc=f(Bc,[["render",Ac]]);const ot=()=>({title:void 0,okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0,name:"",length:null,width:null,height:null,spaces:null,formDataBefore:{width:null,height:null,length:null,spaces:null},roomTypes:[{label:"\u0412\u0430\u043D\u043D\u0430"},{label:"\u041A\u043E\u043C\u043D\u0430\u0442\u0430"},{label:"\u041A\u0443\u0445\u043D\u044F"},{label:"\u0413\u043E\u0441\u0442\u0438\u043D\u043D\u0430\u044F"}]}),Jc={components:{PopupModal:G,InputNumber:Te,Dropdown:me},mixins:[ee],data(){return ot()},computed:b(m({},I("outlay",["selectedRoom"])),{calculatedWidth(){return this.calculate(this.width)},calculatedLength(){return this.calculate(this.length)},calculatedHeight(){return this.calculate(this.height)},calculatedSpaces(){return this.calculate(this.spaces)},perimeter(){return!this.calculatedWidth||!this.calculatedLength?0:this.getPerimeter(this.calculatedWidth,this.calculatedLength)},floorArea(){return!this.calculatedWidth||!this.calculatedLength?0:this.getFloorArea(this.calculatedWidth,this.calculatedLength)},wallArea(){return!this.perimeter||!this.calculatedHeight?0:this.getWallArea(this.perimeter,this.calculatedHeight,this.calculatedSpaces)},isCorrectFields(){return this.name?this.isCorrectField(this.calculatedWidth)&&this.isCorrectField(this.calculatedLength)&&this.isCorrectField(this.calculatedHeight):!1}}),watch:{length(e,t){this.formDataBefore.length=t},height(e,t){this.formDataBefore.height=t},width(e,t){this.formDataBefore.width=t}},methods:{async show(e){this.title=e.title,this.okButton=e.okButton,this.cancelButton=e.cancelButton,e.edit&&(this.name=this.selectedRoom.name,this.width=this.selectedRoom.options.width,this.height=this.selectedRoom.options.height,this.length=this.selectedRoom.options.length,this.spaces=this.selectedRoom.options.spaces),this.$refs.popup.open(),await this.$nextTick();const{input:t}=this.$refs,s=t.$el.querySelector("input");return s&&s.focus(),new Promise((o,r)=>{this.resolvePromise=o,this.rejectPromise=r})},_confirm(){if(!this.isCorrectFields)return;this.$refs.popup.close();const e={name:this.name,options:{width:this.width||0,height:this.height||0,length:this.length||0,spaces:this.spaces||0}};this.resolvePromise(e),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},_remove(){this.$refs.popup.close(),this.resolvePromise({remove:!0}),this.reset()},reset(){Object.assign(this.$data,ot())},inputHandler(e,t){if(!/^[0-9+-/*.,]*$/.test(this[t]))return this[t]=this.formDataBefore[t];const{data:r}=e;r===","&&(this[t]=this[t].replace(",","."));const n=/[-]?\d+(\.\d+)?/g,i=this[t].match(n);!i||i.forEach(a=>{const d=+a;d>0&&(this[t]=this[t].replace(a,d))})},isCorrectField(e){return!isNaN(e)&&e>0}}},z=e=>(O("data-v-61e266ec"),e=e(),P(),e),Hc={class:"modal"},Uc={class:"modal__title"},jc={class:"form__group"},Fc=z(()=>c("label",{class:"form__label"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",-1)),qc=z(()=>c("span",null,"\u041F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u044F",-1)),Wc={class:"form__grid"},Zc={class:"form__group"},Gc=z(()=>c("label",{class:"form__label"},"\u0414\u043B\u0438\u043D\u0430",-1)),Qc={class:"form__group"},zc=z(()=>c("label",{class:"form__label"},"\u0428\u0438\u0440\u0438\u043D\u0430",-1)),Yc={class:"form__group"},Xc=z(()=>c("label",{class:"form__label"},"\u0412\u044B\u0441\u043E\u0442\u0430",-1)),eu={class:"form__group"},tu=z(()=>c("label",{class:"form__label"},"\u041F\u0440\u043E\u0435\u043C\u044B",-1)),su=z(()=>c("span",null,"\u0412\u044B\u0447\u0438\u0441\u043B\u044F\u0435\u043C\u044B\u0435 \u0441\u0432\u043E\u0439\u0441\u0442\u0432\u0430",-1)),nu={class:"form__grid"},ou={class:"form__group"},ru=z(()=>c("label",{class:"form__label"},"\u041F\u0435\u0440\u0438\u043C\u0435\u0442\u0440",-1)),iu={class:"form__group"},au=z(()=>c("label",{class:"form__label"},"\u041F\u043B\u043E\u0449\u0430\u0434\u044C \u043F\u043E\u043B\u0430",-1)),lu={class:"form__group"},du=z(()=>c("label",{class:"form__label"},"\u041F\u043B\u043E\u0449\u0430\u0434\u044C \u0441\u0442\u0435\u043D",-1)),cu={class:"modal__actions"};function uu(e,t,s,o,r,n){const i=_("Dropdown"),a=_("InputNumber"),d=_("AppButton"),p=_("PopupModal");return l(),$(p,{ref:"popup"},{default:v(()=>[c("div",Hc,[c("span",Uc,g(e.title),1),c("form",{class:"form",onSubmit:t[12]||(t[12]=J((...y)=>n._confirm&&n._confirm(...y),["prevent"]))},[c("div",jc,[Fc,h(i,{modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=y=>e.name=y),modelModifiers:{trim:!0},options:e.roomTypes,editable:!0,optionLabel:"label",optionValue:"label",ref:"input"},null,8,["modelValue","options"])]),qc,c("div",Wc,[c("div",Zc,[Gc,M(c("input",{"onUpdate:modelValue":t[1]||(t[1]=y=>e.length=y),class:"input",type:"text",onInput:t[2]||(t[2]=y=>n.inputHandler(y,"length"))},null,544),[[j,e.length]])]),c("div",Qc,[zc,M(c("input",{"onUpdate:modelValue":t[3]||(t[3]=y=>e.width=y),class:"input",type:"text",onInput:t[4]||(t[4]=y=>n.inputHandler(y,"width"))},null,544),[[j,e.width]])]),c("div",Yc,[Xc,M(c("input",{"onUpdate:modelValue":t[5]||(t[5]=y=>e.height=y),class:"input",type:"text",onInput:t[6]||(t[6]=y=>n.inputHandler(y,"height"))},null,544),[[j,e.height]])]),c("div",eu,[tu,M(c("input",{"onUpdate:modelValue":t[7]||(t[7]=y=>e.spaces=y),class:"input",type:"text",onInput:t[8]||(t[8]=y=>n.inputHandler(y,"spaces"))},null,544),[[j,e.spaces]])])]),su,c("div",nu,[c("div",ou,[ru,h(a,{modelValue:n.perimeter,"onUpdate:modelValue":t[9]||(t[9]=y=>n.perimeter=y),placeholder:"\u041F\u0435\u0440\u0438\u043C\u0435\u0442\u0435\u0440",disabled:!0,minFractionDigits:2,maxFractionDigits:2},null,8,["modelValue"])]),c("div",iu,[au,h(a,{modelValue:n.floorArea,"onUpdate:modelValue":t[10]||(t[10]=y=>n.floorArea=y),placeholder:"\u041F\u043B\u043E\u0449\u0430\u0434\u044C \u043F\u043E\u043B\u0430",disabled:!0,minFractionDigits:2,maxFractionDigits:2},null,8,["modelValue"])]),c("div",lu,[du,h(a,{modelValue:n.wallArea,"onUpdate:modelValue":t[11]||(t[11]=y=>n.wallArea=y),placeholder:"\u041F\u043B\u043E\u0449\u0430\u0434\u044C \u0441\u0442\u0435\u043D",disabled:!0,minFractionDigits:2,maxFractionDigits:2},null,8,["modelValue"])])])],32),c("div",cu,[h(d,{outlined:"",onClick:n._cancel},{default:v(()=>[V(g(e.cancelButton),1)]),_:1},8,["onClick"]),h(d,{outlined:"",disabled:!n.isCorrectFields,onClick:n._confirm},{default:v(()=>[V(g(e.okButton),1)]),_:1},8,["disabled","onClick"])])])]),_:1},512)}var Jt=f(Jc,[["render",uu],["__scopeId","data-v-61e266ec"]]);const _u={},pu={width:"12",height:"9",viewBox:"0 0 12 9",fill:"none",xmlns:"http://www.w3.org/2000/svg"},hu=c("path",{d:"M0.5 5.75H3V3.25H0.5V5.75ZM0.5 8.875H3V6.375H0.5V8.875ZM0.5 2.625H3V0.125H0.5V2.625ZM3.625 5.75H11.125V3.25H3.625V5.75ZM3.625 8.875H11.125V6.375H3.625V8.875ZM3.625 0.125V2.625H11.125V0.125H3.625Z",fill:"currentColor"},null,-1),mu=[hu];function yu(e,t){return l(),u("svg",pu,mu)}var fu=f(_u,[["render",yu]]);const Ht=e=>{const{children:t,key:s}=e,o=t.map(Ht).flat();return W(s)?o:[e]};const Ae={components:{ViewListIcon:fu},props:{room:{type:Object,required:!0},active:Boolean},emits:["edit","remove","open-menu"],data(){return{items:[{label:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",icon:"pi pi-pencil",command:()=>{this.setSelectedRoom(this.room),this.$emit("edit")}},{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",icon:"pi pi-trash",command:()=>{this.$emit("remove",this.room.id)}}]}},computed:b(m({},I("outlay",["showOnlyChecked","quantityKey"])),{textColor(){return this.active?"#545454":"#c8c8c8"},viewMode:{get(){return this.showOnlyChecked&&this.active},set(e){this.setViewMode(e)}}}),methods:b(m({},K("outlay",["setSelectedRoom","setShowOnlyChecked"])),{openContext(e){this.$emit("open-menu",e,this.room)},getInvalidJobs(){return this.room.jobs.map(Ht).flat().filter(t=>t.data[this.quantityKey.id]===0)},async setViewMode(e){if(this.setSelectedRoom(this.room),e){await this.$nextTick();const t=this.getInvalidJobs();if(t.length>0){const s=t[0];return ie.$emit("scrollTo",s.key)}}this.setShowOnlyChecked(e)}})},rt=()=>{pe(e=>({"02db1c56":e.textColor}))},it=Ae.setup;Ae.setup=it?(e,t)=>(rt(),it(e,t)):rt;const vu=Ae,gu=e=>(O("data-v-0107bcab"),e=e(),P(),e),bu={class:"room-item__text"},$u=["title"],wu=gu(()=>c("i",{class:"pi pi-ellipsis-h icon"},null,-1)),Cu=[wu];function ku(e,t,s,o,r,n){const i=_("ViewListIcon");return l(),u("div",{class:D(["room-item",{active:s.active}]),onClick:t[3]||(t[3]=a=>e.setSelectedRoom(s.room))},[c("div",bu,[c("span",{class:"room-item__title",title:s.room.name},g(s.room.name),9,$u)]),c("div",{class:"room-item__actions",onClick:t[2]||(t[2]=J(()=>{},["stop"]))},[c("button",{class:"button",onClick:t[0]||(t[0]=a=>n.viewMode=!n.viewMode)},[h(i,{class:D(["icon",{active:s.active&&e.showOnlyChecked}])},null,8,["class"])]),c("button",{class:"button room-item__button",onClick:t[1]||(t[1]=J((...a)=>n.openContext&&n.openContext(...a),["stop"]))},Cu)])],2)}var Iu=f(vu,[["render",ku],["__scopeId","data-v-0107bcab"]]);const Vu={components:{RoomItem:Iu,RoomModal:Jt,Menu:yt,draggable:hs},emits:["open-edit","clone"],data(){return{selectedItem:null,items:[{label:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",icon:"pi pi-pencil",command:()=>{this.setSelectedRoom(this.selectedItem),this.openEditModal()}},{label:"\u041A\u043B\u043E\u043D\u0438\u0440\u043E\u0432\u0430\u0442\u044C",icon:"pi pi-clone",command:()=>{this.$emit("clone",this.selectedItem.id)}},{label:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",icon:"pi pi-trash",command:()=>{this.remove(this.selectedItem.id)}}],dragOptions:{animation:200,ghostClass:"ghost"}}},computed:b(m({},I("outlay",["outlay","selectedRoom","rooms"])),{roomsModel:{get(){return[...this.rooms].reverse()},set(e){const t=[...e].reverse();this.updateRooms(t)}},activeRoomId(){var e;return(e=this.selectedRoom)==null?void 0:e.id}}),methods:b(m(m({},K("outlay",["setSelectedRoom"])),N("outlay",["removeRoom","updateRoom","updateRooms"])),{openMenu(e,t){this.selectedItem=t,this.$refs.menu.toggle(e)},async remove(e){try{await this.removeRoom(e)}catch(t){console.log(t)}},async openEditModal(){const e=await this.$refs["edit-modal"].show({title:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u0435",okButton:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430",edit:!0});!e||this.updateRoom(e)}})};function Su(e,t,s,o,r,n){const i=_("Menu"),a=_("RoomModal"),d=_("RoomItem"),p=_("draggable");return l(),u(k,null,[h(i,{ref:"menu",model:r.items,popup:!0},null,8,["model"]),h(a,{ref:"edit-modal"},null,512),h(p,ft({modelValue:n.roomsModel,"onUpdate:modelValue":t[0]||(t[0]=y=>n.roomsModel=y),"item-key":"id",tag:"transition-group","component-data":{tag:"div",type:"transition-group"}},r.dragOptions,{class:"room-list"}),{item:v(({element:y})=>[(l(),$(d,{key:y.id,room:y,active:n.activeRoomId===y.id,onEdit:n.openEditModal,onRemove:e.removeRoom,onOpenMenu:n.openMenu},null,8,["room","active","onEdit","onRemove","onOpenMenu"]))]),_:1},16,["modelValue"])],64)}var Lu=f(Vu,[["render",Su],["__scopeId","data-v-727be42f"]]);const Tu={components:{RoomsIcon:Lc,DocumentIcon:Nc,RoomList:Lu,Button:bt,CirclePlusIcon:Kc,RoomModal:Jt},computed:b(m({},I("outlay",["selectedRoom","showResults"])),{mainTabs(){return[{text:"\u0412\u0441\u0435 \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u044F",handler:()=>{this.setSelectedRoom(null)},icon:"RoomsIcon",active:!this.selectedRoom&&!this.showResults},{text:"\u0421\u0432\u043E\u0434\u043D\u0430\u044F",handler:()=>{this.setShowResults(!0)},icon:"DocumentIcon",active:this.showResults}]}}),methods:b(m(m({},K("outlay",["setSelectedRoom","setShowResults"])),N("outlay",["createRoom","cloneRoom"])),{async openCreateModal(){const e=await this.$refs["room-modal"].show({title:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u0435",okButton:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430"});!e||this.createRoom(e)},async clone(e){const t=await this.$refs["room-modal"].show({title:"\u041A\u043B\u043E\u043D\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u0435",okButton:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430"});if(!!t)try{await this.cloneRoom(b(m({},t),{cloningRoomId:e}))}catch(s){console.log(s)}}})},Ru={class:"tab-list"},xu={class:"rooms"},Ou=V(" \u041F\u043E\u043C\u0435\u0449\u0435\u043D\u0438\u0435 "),Pu={class:"main-tabs"},Nu=["onClick"],Bu={class:"main-tab__text"};function Du(e,t,s,o,r,n){const i=_("RoomModal"),a=_("CirclePlusIcon"),d=_("RoomList");return l(),u(k,null,[h(i,{ref:"room-modal"},null,512),c("div",Ru,[c("div",xu,[c("button",{class:"button create",onClick:t[0]||(t[0]=(...p)=>n.openCreateModal&&n.openCreateModal(...p))},[h(a),Ou]),h(d,{onClone:n.clone},null,8,["onClone"])]),c("div",Pu,[(l(!0),u(k,null,S(n.mainTabs,p=>(l(),u("button",{key:p.text,class:D(["button main-tab",{active:p.active}]),onClick:p.handler},[(l(),$(he(p.icon),{class:"main-tab__icon"})),c("span",Bu,g(p.text),1)],10,Nu))),128))])])],64)}var Eu=f(Tu,[["render",Du],["__scopeId","data-v-80ff7030"]]);const Mu={components:{ActionList:wc,TabList:Eu}};function Au(e,t,s,o,r,n){const i=_("ActionList"),a=_("TabList");return l(),u(k,null,[h(i),h(a)],64)}var Ku=f(Mu,[["render",Au]]);const Ju={components:{LeftSide:Ku,CenterSide:Ba,RightSide:ql}},Hu={class:"body-row"},Uu={class:"left-side"},ju={class:"right-side"};function Fu(e,t,s,o,r,n){const i=_("LeftSide"),a=_("CenterSide"),d=_("RightSide");return l(),u("div",Hu,[c("div",Uu,[h(i)]),h(a),c("div",ju,[h(d)])])}var qu=f(Ju,[["render",Fu],["__scopeId","data-v-b32c2094"]]);const Wu={components:{HeaderRow:_r,BodyRow:qu},computed:m({},I("outlay",["outlay"])),async mounted(){await this.fetchAll()},methods:m({},N("outlays",["fetchAll"]))},Zu=e=>(O("data-v-e7bd5a10"),e=e(),P(),e),Gu={class:"main"},Qu=Zu(()=>c("div",{id:"print",class:"print"},null,-1));function zu(e,t,s,o,r,n){const i=_("HeaderRow"),a=_("BodyRow");return l(),u(k,null,[c("main",Gu,[h(i),e.outlay?(l(),$(a,{key:0})):R("",!0)]),Qu],64)}var Yu=f(Wu,[["render",zu],["__scopeId","data-v-e7bd5a10"]]);const Xu={data(){return{loading:!0}},async mounted(){try{await this.fetchAll()}catch(e){console.log(e)}finally{this.loading=!1}},methods:m({},N("outlays",["fetchAll"]))},e_={class:"wrapper"};function t_(e,t,s,o,r,n){const i=_("RouterView");return l(),u("div",e_,[r.loading?R("",!0):(l(),$(i,{key:0}))])}var s_=f(Xu,[["render",t_],["__scopeId","data-v-f70de7fc"]]);const n_={components:{MainLayout:Wn,OutlayLayout:Yu,PrintLayout:s_},data(){return{loading:!1}},computed:{layout(){var e,t;return((t=(e=this.$route)==null?void 0:e.meta)==null?void 0:t.layout)||"MainLayout"}},async mounted(){this.loading=!0,await Promise.all([this.fetchDirectories(),this.fetchEditions(),this.fetchPriceLists()]),this.loading=!1},methods:m(m(m({},N("directory",{fetchDirectories:"fetchAll"})),N("edition",{fetchEditions:"fetchAll"})),N("priceList",{fetchPriceLists:"fetchAll"}))};function o_(e,t,s,o,r,n){return r.loading?R("",!0):(l(),$(he(n.layout),{key:0}))}var r_=f(n_,[["render",o_]]);const i_={},a_={class:"index-view"};function l_(e,t,s,o,r,n){return l(),u("div",a_,"Index")}var d_=f(i_,[["render",l_]]);const c_={},u_={class:"app-content"},__={class:"app-content__header"},p_={class:"app-content__body"};function h_(e,t){return l(),u("div",u_,[c("div",__,[Q(e.$slots,"header",{},void 0,!0)]),c("div",p_,[Q(e.$slots,"body",{},void 0,!0)])])}var Ke=f(c_,[["render",h_],["__scopeId","data-v-b0fbb878"]]);const m_={props:{url:{type:String,required:!0},text:{type:String,required:!0},delimeter:{type:Boolean,default:!1}}},y_={key:0,class:"link__delimeter"};function f_(e,t,s,o,r,n){const i=_("RouterLink");return l(),u(k,null,[h(i,{class:"link",to:s.url},{default:v(()=>[V(g(s.text),1)]),_:1},8,["to"]),s.delimeter?(l(),u("span",y_,"/")):R("",!0)],64)}var v_=f(m_,[["render",f_],["__scopeId","data-v-124bc896"]]);const g_={components:{NavigationLink:v_},computed:b(m({},I("directory",["directories","loading"])),{directoryId(){return this.$route.params.id},directory(){return this.directoryId?this.directories.find(e=>e._id===this.directoryId):null},parentTree(){return this.directory?this.getParentTree(this.directory):[]},links(){const e={text:"\u0421\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0438",url:"/directories"},t=this.parentTree.map(s=>({text:s.name,url:`/directories/${s._id}`}));return[e,...t]}}),watch:{parentTree:{handler(e){if(e.length===0)return this.setRoot(null);const t=e[0];this.setRoot(t._id)},immediate:!0}},methods:b(m({},K("directory",["setRoot"])),{getParentTree(e){if(e.parent){const t=this.directories.find(({_id:s})=>s===e.parent);return[...this.getParentTree(t),e]}return[e]}})};function b_(e,t,s,o,r,n){const i=_("NavigationLink");return l(),u("div",{class:D(["links",{disabled:e.loading}])},[(l(!0),u(k,null,S(n.links,(a,d)=>(l(),$(i,{key:a.url,url:a.url,delimeter:d!==n.links.length-1,text:a.text},null,8,["url","delimeter","text"]))),128))],2)}var $_=f(g_,[["render",b_],["__scopeId","data-v-78ab9234"]]);const w_={components:{AppContent:Ke,NavigationLinks:$_}};function C_(e,t,s,o,r,n){const i=_("NavigationLinks"),a=_("RouterView"),d=_("AppContent");return l(),$(d,null,{header:v(()=>[h(i)]),body:v(()=>[h(a)]),_:1})}var k_=f(w_,[["render",C_]]);const I_={computed:{hasHeaderSlot(){return!!this.$slots.header}}},V_={class:"content-body"},S_={key:0,class:"content-body__header"},L_={class:"content-body__content"};function T_(e,t,s,o,r,n){return l(),u("div",V_,[n.hasHeaderSlot?(l(),u("div",S_,[Q(e.$slots,"header",{},void 0,!0)])):R("",!0),c("div",L_,[Q(e.$slots,"content",{},void 0,!0)])])}var oe=f(I_,[["render",T_],["__scopeId","data-v-41a401f4"]]);const R_={modelValue:{required:!0,default:""},emits:["update:modelValue"],methods:{focus(){this.$refs.input.focus()}}},x_={ref:"input",class:"app-input",type:"text"};function O_(e,t,s,o,r,n){return l(),u("input",x_,null,512)}var Ut=f(R_,[["render",O_],["__scopeId","data-v-249b6485"]]);const P_={},N_={width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},B_=c("path",{d:"M13.7219 15L8.55979 9.83731C7.45222 10.6247 6.08923 10.9672 4.74096 10.7971C3.3927 10.627 2.15756 9.95653 1.28035 8.91869C0.403128 7.88084 -0.0521453 6.55132 0.00475691 5.19364C0.0616591 3.83595 0.626583 2.54919 1.58757 1.58838C2.54829 0.627145 3.83513 0.0619404 5.19299 0.00479688C6.55086 -0.0523467 7.88064 0.402742 8.91874 1.27986C9.95683 2.15697 10.6275 3.39208 10.7977 4.74036C10.968 6.08864 10.6254 7.45168 9.8379 8.55928L15 13.722L13.7228 14.9991L13.7219 15ZM5.41918 1.80695C4.58823 1.80676 3.78262 2.09297 3.13808 2.61736C2.49353 3.14176 2.04945 3.87228 1.88065 4.68584C1.71185 5.49941 1.82866 6.34629 2.21138 7.08379C2.59411 7.8213 3.21937 8.40435 3.9818 8.73471C4.74424 9.06507 5.59726 9.12255 6.39712 8.89746C7.19699 8.67236 7.89482 8.17846 8.37304 7.49897C8.85126 6.81947 9.08063 5.99592 9.02251 5.16706C8.96439 4.33821 8.62233 3.55471 8.05397 2.9486L8.60044 3.49052L7.98442 2.87634L7.97358 2.8655C7.63899 2.52887 7.24093 2.26198 6.80246 2.08027C6.36398 1.89857 5.89381 1.80567 5.41918 1.80695Z",fill:"#808080"},null,-1),D_=[B_];function E_(e,t){return l(),u("svg",N_,D_)}var M_=f(P_,[["render",E_]]);const A_={components:{AppInput:Ut,SearchIcon:M_}},K_={class:"search-input"};function J_(e,t,s,o,r,n){const i=_("SearchIcon"),a=_("AppInput");return l(),u("div",K_,[h(i),h(a,{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0434\u043B\u044F \u043F\u043E\u0438\u0441\u043A\u0430..."})])}var Je=f(A_,[["render",J_],["__scopeId","data-v-4ae1be5a"]]);const H_={},U_={width:"20",height:"4",viewBox:"0 0 20 4",fill:"none",xmlns:"http://www.w3.org/2000/svg"},j_=c("circle",{cx:"2",cy:"2",r:"2",fill:"#808080"},null,-1),F_=c("circle",{cx:"18",cy:"2",r:"2",fill:"#808080"},null,-1),q_=c("circle",{cx:"10",cy:"2",r:"2",fill:"#808080"},null,-1),W_=[j_,F_,q_];function Z_(e,t){return l(),u("svg",U_,W_)}var jt=f(H_,[["render",Z_]]);const G_={props:{items:{type:Array,required:!0}},emits:["update:modelValue"],data(){return{isItemsVisible:!1}},methods:{toggle(){this.isItemsVisible?this.hideItems():this.showItems()},showItems(){this.isItemsVisible=!0},hideItems(){this.isItemsVisible=!1},clickHandler(e){e(),this.hideItems()}}},Q_={class:"app-dropdown"},z_={ref:"items",class:"app-dropdown__items"},Y_=["onClick"];function X_(e,t,s,o,r,n){const i=_("AppButton");return l(),u("div",Q_,[h(i,{class:"app-dropdown__body",onClick:n.toggle},{default:v(()=>[Q(e.$slots,"default",{},void 0,!0)]),_:3},8,["onClick"]),r.isItemsVisible?(l(),u(k,{key:0},[c("div",{class:"app-dropdown__backdrop",onClick:t[0]||(t[0]=(...a)=>n.hideItems&&n.hideItems(...a))}),c("ul",z_,[(l(!0),u(k,null,S(s.items,a=>(l(),u("li",{key:a.text,class:"app-dropdown__item",onClick:d=>n.clickHandler(a.handler)},g(a.text),9,Y_))),128))],512)],64)):R("",!0)])}var Ft=f(G_,[["render",X_],["__scopeId","data-v-6261e4c9"]]),Ce={methods:{getRoot(e){const t=this.directories.find(s=>s._id===e);return t!=null&&t.parent?this.getRoot(t.parent):t},getTree(e){const t=this.directories.find(s=>s._id===e);return t?t.parent?[...this.getTree(t.parent),t]:[t]:[]}}};const ep={components:{ThreeDotsIcon:jt,AppDropdowm:Ft},mixins:[Ce],props:{directory:{type:Object,required:!0}},data(){return{isEditing:!1,items:[{text:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",handler:async()=>{this.isEditing=!0,await this.$nextTick(),this.$refs.input.focus()}},{text:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",handler:async()=>{const{values:e}=this.directory;if((!e||(e==null?void 0:e.length)===0)&&!this.subFolders.length)return await this.removeDirectory(this.directory._id);const t=this.editions.find(a=>a.dirId===this.directory._id);if(t){const a=this.priceLists.find(d=>d.editions.includes(t._id));if(a)return this.$emit("alert",{priceList:a.name})}if(e){const a=this.checkIfArchitectureInUse(this.directory),d=a.map(({name:p})=>p);if(a.length>0)return this.$emit("alert",{directories:d});if(e.length>0)return this.$emit("remove",{id:this.directory._id,folderName:this.directory.name,subItemsLength:e.length})}const n=this.getItemsInsideDirectory(this.directory).filter(a=>a.data).map(a=>this.checkIfArchitectureInUse(a)).flat().map(a=>[...this.getRoots(a.parent),a]);if(n.length>0)return this.$emit("alert",{paths:n});const i=this.subFolders.length;if(i>0)return this.$emit("remove",{id:this.directory._id,folderName:this.directory.name,subItemsLength:i})}}]}},computed:b(m(m(m({},I("directory",["directories","root","roots"])),I("edition",["editions"])),I("priceList",["priceLists"])),{subFolders(){return this.directories.filter(e=>e.parent===this.directory._id)},counter(){if(this.subFolders.length>0)return this.subFolders.length;const{values:e}=this.directory;return(e?e.length:0)>0?e.length:"\u041D\u0435\u0442 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432"}}),methods:b(m(m({},K("directory",["setRoot"])),N("directory",["removeDirectory","updateById"])),{openFolder(){this.directory.parent||this.setRoot(this.directory._id),this.$router.push(`/directories/${this.directory._id}`)},async focusInput(){this.isEditing=!0,await this.$nextTick(),this.$refs.input.focus(),this.$refs.input.select()},async update(e){this.$refs.input.blur();const t=e.target.value;await this.updateById({id:this.directory._id,data:{name:t}})},getItemsInsideDirectory(e){const{data:t}=e;if(t)return[];const s=this.directories.filter(o=>o.parent===e._id);if(s.length>0){const o=s.map(r=>this.getItemsInsideDirectory(r)).flat();return[...s,...o]}return[]},checkIfArchitectureInUse(e){return this.roots.filter(t=>{const{parent:s}=t;return s?!1:t.keys.some(o=>o.dirId===e._id)})}})},tp={class:"directory-item__header"},sp=["value"],np={key:0,class:"directory-item__counter"};function op(e,t,s,o,r,n){const i=_("ThreeDotsIcon"),a=_("AppDropdowm");return l(),u("li",{class:"directory-item",onDblclick:t[4]||(t[4]=(...d)=>n.openFolder&&n.openFolder(...d))},[c("div",tp,[r.isEditing?(l(),u("input",{key:1,ref:"input",value:s.directory.name,class:"directory-item__input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0430\u043A\u0438",onChange:t[1]||(t[1]=(...d)=>n.update&&n.update(...d)),onFocus:t[2]||(t[2]=d=>r.isEditing=!0),onBlur:t[3]||(t[3]=d=>r.isEditing=!1)},null,40,sp)):(l(),u("span",{key:0,onDblclick:t[0]||(t[0]=J((...d)=>n.focusInput&&n.focusInput(...d),["stop"])),class:"directory-item__name"},g(s.directory.name),33)),r.isEditing?R("",!0):(l(),$(a,{key:2,ref:"dropdown",items:r.items},{default:v(()=>[h(i)]),_:1},8,["items"]))]),r.isEditing?R("",!0):(l(),u("span",np,g(n.counter),1))],32)}var rp=f(ep,[["render",op],["__scopeId","data-v-2057b987"]]);const ip={},ap={width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg"},lp=c("path",{d:"M15 0C6.72 0 0 6.72 0 15C0 23.28 6.72 30 15 30C23.28 30 30 23.28 30 15C30 6.72 23.28 0 15 0ZM22.5 16.5H16.5V22.5H13.5V16.5H7.5V13.5H13.5V7.5H16.5V13.5H22.5V16.5Z",fill:"#C8C8C8"},null,-1),dp=[lp];function cp(e,t){return l(),u("svg",ap,dp)}var up=f(ip,[["render",cp]]);const _p={components:{PlusIcon:up},props:{text:{type:String,default:""}}},pp={class:"directory-create"},hp={class:"directory-create__body"},mp={class:"directory-create__text"};function yp(e,t,s,o,r,n){const i=_("PlusIcon");return l(),u("li",pp,[c("div",hp,[h(i),c("span",mp,g(s.text),1)])])}var He=f(_p,[["render",yp],["__scopeId","data-v-3490001a"]]);const fp={data(){return{name:""}},computed:{parent(){var e;return(e=this.$route.params)==null?void 0:e.id}},mounted(){this.$refs.input.focus()},methods:b(m({},N("directory",["createDirectory"])),{async create(){if(!this.name)return this.$emit("created");const e={name:this.name,parent:this.parent};try{await this.createDirectory(e),this.name="",this.$emit("created")}catch(t){console.log(t)}}})},vp={class:"directory-item"};function gp(e,t,s,o,r,n){return l(),u("li",vp,[M(c("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>r.name=i),onKeyup:t[1]||(t[1]=de((...i)=>n.create&&n.create(...i),["enter"])),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0430\u043A\u0438",onBlur:t[2]||(t[2]=(...i)=>n.create&&n.create(...i)),ref:"input",class:"directory-item__input"},null,544),[[j,r.name]])])}var qt=f(fp,[["render",gp],["__scopeId","data-v-5587dcd6"]]);const at=()=>({title:void 0,message:void 0,folderName:void 0,okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0,keyWord:""}),bp={components:{PopupModal:G},data(){return at()},computed:{isWordCorrect(){return this.folderName===this.keyWord}},methods:{async show(e){return this.title=e.title,this.message=e.message,this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.folderName=e.folderName,this.$refs.popup.open(),await this.$nextTick(),this.$refs.input.focus(),new Promise((t,s)=>{this.resolvePromise=t,this.rejectPromise=s})},_confirm(){!this.isWordCorrect||(this.$refs.popup.close(),this.resolvePromise(!0),this.reset())},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},reset(){Object.assign(this.$data,at())}}},$p={class:"modal"},wp={class:"modal__title"},Cp={class:"modal__message"},kp=V(" \u0427\u0442\u043E\u0431\u044B \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0430\u043F\u043A\u0443 \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0430\u043F\u043A\u0438 "),Ip={class:"modal__actions"};function Vp(e,t,s,o,r,n){const i=_("AppButton"),a=_("PopupModal");return l(),$(a,{ref:"popup"},{default:v(()=>[c("div",$p,[c("span",wp,g(e.title),1),c("span",Cp,g(e.message),1),c("span",null,[kp,c("strong",null,g(e.folderName),1)]),M(c("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>e.keyWord=d),class:"input",ref:"input",type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0430\u043F\u043A\u0438",onKeyup:t[1]||(t[1]=de((...d)=>n._confirm&&n._confirm(...d),["enter"]))},null,544),[[j,e.keyWord]]),c("div",Ip,[h(i,{outlined:"",onClick:n._cancel},{default:v(()=>[V(g(e.cancelButton),1)]),_:1},8,["onClick"]),h(i,{outlined:"",disabled:!n.isWordCorrect,onClick:n._confirm},{default:v(()=>[V(g(e.okButton),1)]),_:1},8,["disabled","onClick"])])])]),_:1},512)}var Wt=f(bp,[["render",Vp],["__scopeId","data-v-3bacd03c"]]);const lt=()=>({title:void 0,okButton:void 0,directories:null,priceList:null,resolvePromise:void 0,rejectPromise:void 0}),Sp={components:{PopupModal:G},data(){return lt()},methods:{show(e){return this.title=e.title,this.okButton=e.okButton,this.directories=e.directories,this.priceList=e.priceList,this.$refs.popup.open(),new Promise(t=>{this.resolvePromise=t})},_confirm(){this.$refs.popup.close(),this.resolvePromise(!0),this.reset()},reset(){Object.assign(this.$data,lt())}}},Lp=e=>(O("data-v-039e94e8"),e=e(),P(),e),Tp={class:"modal"},Rp={class:"modal__title"},xp={key:0},Op=V(" \u0414\u0430\u043D\u043D\u044B\u0439 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F \u0432 \u043F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442\u0435 "),Pp=Lp(()=>c("span",null," \u0421\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F \u0432 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0445 \u0430\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0430\u0445: ",-1)),Np={class:"modal__actions"};function Bp(e,t,s,o,r,n){const i=_("AppButton"),a=_("PopupModal");return l(),$(a,{ref:"popup"},{default:v(()=>[c("div",Tp,[c("span",Rp,g(e.title),1),e.priceList?(l(),u("span",xp,[Op,c("strong",null,g(e.priceList),1)])):e.directories?(l(),u(k,{key:1},[Pp,c("ul",null,[(l(!0),u(k,null,S(e.directories,d=>(l(),u("li",{key:d},[c("strong",null,g(d),1)]))),128))])],64)):R("",!0),c("div",Np,[h(i,{outlined:"",onClick:n._confirm},{default:v(()=>[V(g(e.okButton),1)]),_:1},8,["onClick"])])])]),_:1},512)}var Dp=f(Sp,[["render",Bp],["__scopeId","data-v-039e94e8"]]);const Ep={components:{DirectoryItem:rp,CreateButton:He,DirectoryForm:qt,RemoveModal:Wt,AlertModal:Dp},props:{items:{type:Array}},data(){return{formVisible:!1}},methods:b(m({},N("directory",["removeDirectory"])),{async openRemove({id:e,folderName:t,subItemsLength:s}){if(await this.$refs["remove-modal"].show({title:"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0435",message:`\u0414\u0430\u043D\u043D\u0430\u044F \u043F\u0430\u043F\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u0440\u0436\u0438\u0442 ${s} \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430. \u041F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u044D\u0442\u043E\u0439 \u043F\u0430\u043F\u043A\u0438 \u0432\u0441\u0435 \u0432\u043B\u043E\u0436\u0435\u043D\u043D\u044B\u0435 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u044B \u0431\u0443\u0434\u0443\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u044B.`,folderName:t,okButton:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430"}))try{await this.removeDirectory(e)}catch(r){console.log(r)}},openAlert({priceList:e,directories:t}){this.$refs["alert-modal"].show({title:"\u0414\u0430\u043D\u043D\u044B\u0439 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A \u043D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0443\u0434\u0430\u043B\u0438\u0442\u044C",directories:t,priceList:e,okButton:"\u041E\u043A"})}})},Mp={class:"directory-list"};function Ap(e,t,s,o,r,n){const i=_("DirectoryItem"),a=_("DirectoryForm"),d=_("CreateButton"),p=_("RemoveModal"),y=_("AlertModal");return l(),u("ul",Mp,[(l(!0),u(k,null,S(s.items,w=>(l(),$(i,{key:w.id,directory:w,onRemove:n.openRemove,onAlert:n.openAlert},null,8,["directory","onRemove","onAlert"]))),128)),r.formVisible?(l(),$(a,{key:0,onCreated:t[0]||(t[0]=w=>r.formVisible=!1)})):(l(),$(d,{key:1,text:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0430\u043F\u043A\u0443",onClick:t[1]||(t[1]=w=>r.formVisible=!0)})),h(p,{ref:"remove-modal"},null,512),h(y,{ref:"alert-modal"},null,512)])}var Zt=f(Ep,[["render",Ap],["__scopeId","data-v-1967925b"]]);const Kp={components:{ContentBody:oe,SearchInput:Je,DirectoryList:Zt},data(){return{search:""}},computed:m({},I("directory",["roots"]))};function Jp(e,t,s,o,r,n){const i=_("SearchInput"),a=_("DirectoryList"),d=_("ContentBody");return l(),$(d,null,{header:v(()=>[h(i,{class:"search-input"})]),content:v(()=>[h(a,{items:e.roots},null,8,["items"])]),_:1})}var Hp=f(Kp,[["render",Jp],["__scopeId","data-v-19ced106"]]);const dt=()=>({title:void 0,okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0,name:"",type:"",selectedDirectory:"",visibleKeys:[],updateMode:!1}),Up={components:{PopupModal:G},mixins:[Y,Ce],data(){return dt()},computed:b(m({},I("directory",["directories","root"])),{id(){return this.$route.params.id},filteredTypeOptions(){const t=[this.InputType.PRICE,this.InputType.QUANTITY,this.InputType.COUNTER].filter(s=>this.type===s?!1:this.root.keys.find(o=>o.type===s));return this.typeOptions.filter(s=>!t.includes(s))},options(){return this.id?this.directories.filter(s=>s._id!==this.id&&s.values).map(s=>{const n=this.getParentTree(s).map(i=>i.name).join("/");return b(m({},s),{text:n})}):[]},avaliableKeys(){if(!this.selectedDirectory)return[];const e=this.directories.find(s=>s._id===this.selectedDirectory);return e?(e.parent?this.getRoot(e.parent):e).keys:[]}}),methods:{async show(e){return this.reset(),this.title=e.title,this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.type=this.InputType.STRING,e.key&&(this.updateMode=!0,this.name=e.key.name,this.type=e.key.type,this.selectedDirectory=e.key.dirId,this.visibleKeys=e.key.keys),this.$refs.popup.open(),await this.$nextTick(),this.$refs.input.focus(),new Promise((t,s)=>{this.resolvePromise=t,this.rejectPromise=s})},_confirm(){this.$refs.popup.close();const e={name:this.name,type:this.type};if(this.type===this.InputType.SELECT||this.type===this.InputType.FORMULA){if(!this.selectedDirectory)return;const t=this.getRoot(this.selectedDirectory)._id,s=this.selectedDirectory;e.dirId=s,e.root=t,e.keys=this.visibleKeys}this.resolvePromise(e),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},_remove(){this.$refs.popup.close(),this.resolvePromise({remove:!0}),this.reset()},reset(){Object.assign(this.$data,dt())},resetSelectData(){this.selectedDirectory="",this.visibleKeys=[]},getParentTree(e){if(e.parent){const t=this.directories.find(({_id:s})=>s===e.parent);return[...this.getParentTree(t),e]}return[e]}}},Ue=e=>(O("data-v-546a4d61"),e=e(),P(),e),jp={class:"modal"},Fp={class:"modal__title"},qp={class:"form__group"},Wp=Ue(()=>c("label",{class:"form__label"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",-1)),Zp={class:"form__group"},Gp=Ue(()=>c("label",{class:"form__label"},"\u0422\u0438\u043F",-1)),Qp=["value"],zp={key:0,class:"form__group"},Yp=["value"],Xp={key:0},eh=Ue(()=>c("span",null,"\u0417\u043D\u0430\u0447\u0435\u043D\u0438\u044F \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0442\u044C",-1)),th=["id","value"],sh=["for"],nh=V(" \u0423\u0434\u0430\u043B\u0438\u0442\u044C "),oh={class:"modal__actions"};function rh(e,t,s,o,r,n){const i=_("AppButton"),a=_("PopupModal");return l(),$(a,{ref:"popup"},{default:v(()=>[c("div",jp,[c("span",Fp,g(e.title),1),c("form",{class:"form",onSubmit:t[6]||(t[6]=J((...d)=>n._confirm&&n._confirm(...d),["prevent"]))},[c("div",qp,[Wp,M(c("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>e.name=d),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",ref:"input",class:"input"},null,512),[[j,e.name]])]),c("div",Zp,[Gp,M(c("select",{"onUpdate:modelValue":t[1]||(t[1]=d=>e.type=d),class:"select",onChange:t[2]||(t[2]=(...d)=>n.resetSelectData&&n.resetSelectData(...d))},[(l(!0),u(k,null,S(n.filteredTypeOptions,d=>(l(),u("option",{class:"select__option",key:d,value:d},g(d),9,Qp))),128))],544),[[ae,e.type]])]),e.type===e.InputType.SELECT||e.type===e.InputType.FORMULA?(l(),u("div",zp,[M(c("select",{"onUpdate:modelValue":t[3]||(t[3]=d=>e.selectedDirectory=d),class:"select",onChange:t[4]||(t[4]=d=>e.visibleKeys=[])},[(l(!0),u(k,null,S(n.options,d=>(l(),u("option",{key:d._id,value:d._id},g(d.text),9,Yp))),128))],544),[[ae,e.selectedDirectory]]),e.selectedDirectory?(l(),u("div",Xp,[eh,(l(!0),u(k,null,S(n.avaliableKeys,d=>(l(),u("div",{class:"key",key:d.id},[M(c("input",{"onUpdate:modelValue":t[5]||(t[5]=p=>e.visibleKeys=p),id:d.id,value:d.id,type:"checkbox"},null,8,th),[[ms,e.visibleKeys]]),c("label",{for:d.id},g(d.name),9,sh)]))),128))])):R("",!0)])):R("",!0)],32),e.updateMode?(l(),$(i,{key:0,outlined:"",variant:"danger",onClick:n._remove},{default:v(()=>[nh]),_:1},8,["onClick"])):R("",!0),c("div",oh,[h(i,{outlined:"",onClick:n._cancel},{default:v(()=>[V(g(e.cancelButton),1)]),_:1},8,["onClick"]),h(i,{outlined:"",onClick:n._confirm},{default:v(()=>[V(g(e.okButton),1)]),_:1},8,["onClick"])])])]),_:1},512)}var ih=f(Up,[["render",rh],["__scopeId","data-v-546a4d61"]]);const ah={mixins:[Y],props:{value:{required:!0},field:{required:!0,type:String},rowIndex:{required:!0,type:Number}},emits:["change"],data(){return{timeout:null,hasUnmounted:!1}},computed:b(m({},I("directory",["root","roots","directories"])),{key(){return this.root.keys.find(e=>e.id===this.field)},type(){var e;return(e=this.key)==null?void 0:e.type},componentName(){const e=[this.InputType.NUMBER,this.InputType.PRICE,this.InputType.QUANTITY],t=[this.InputType.SELECT,this.InputType.FORMULA];return e.includes(this.type)?"InputNumber":t.includes(this.type)?"Dropdown":"InputText"},newValue:{get(){return this.value},set(e){if([this.InputType.PRICE,this.InputType.QUANTITY,this.InputType.NUMBER].includes(this.type)){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{if(!this.hasUnmounted)return this.$emit("change",this.rowIndex,this.field,e)},300);return}this.$emit("change",this.rowIndex,this.field,e)}},options(){if(this.type!==this.InputType.SELECT&&this.type!==this.InputType.FORMULA)return[];const e=this.roots.find(r=>r._id===this.key.root);if(!e)return[];const t=e.keys.filter(r=>this.key.keys.includes(r.id));if(!t.length)return[];const o=this.directories.find(r=>r._id===this.key.dirId).values.map(r=>{const n=t.map(i=>{if(i.type===this.InputType.SELECT){const a=r.data[i.id];return this.getValueOfCell(i.dirId,i.root,a,i.keys)}return r.data[i.id]});return{value:r.id,text:n.join(", ")}});return[{value:void 0,text:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",hidden:!0},...o]}}),unmounted(){this.hasUnmounted=!0},methods:{getValueOfCell(e,t,s,o){const r=this.directories.find(d=>d._id===e);return r?this.roots.find(d=>d._id===t).keys.filter(d=>o.includes(d.id)).map(d=>{const p=r.values.find(y=>y.id===+s);if(d.type===this.InputType.SELECT){const y=p.data[d.id];return this.getValueOfCell(d.dirId,d.root,y,d.keys)}return p.data[d.id]}):null}}},lh=["hidden","value"];function dh(e,t,s,o,r,n){return n.type===e.InputType.STRING?M((l(),u("input",{key:0,"onUpdate:modelValue":t[0]||(t[0]=i=>n.newValue=i),class:"input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",type:"text"},null,512)),[[j,n.newValue,void 0,{lazy:!0}]]):n.type===e.InputType.NUMBER?M((l(),u("input",{key:1,"onUpdate:modelValue":t[1]||(t[1]=i=>n.newValue=i),class:"input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",type:"number"},null,512)),[[j,n.newValue,void 0,{lazy:!0}]]):n.type===e.InputType.PRICE||n.type===e.InputType.QUANTITY?M((l(),u("input",{key:2,"onUpdate:modelValue":t[2]||(t[2]=i=>n.newValue=i),class:"input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",type:"number",min:0},null,512)),[[j,n.newValue,void 0,{lazy:!0}]]):n.type===e.InputType.SELECT||n.type===e.InputType.FORMULA?M((l(),u("select",{key:3,"onUpdate:modelValue":t[3]||(t[3]=i=>n.newValue=i),class:"input"},[(l(!0),u(k,null,S(n.options,i=>(l(),u("option",{key:i.value,hidden:i.hidden,value:i.value},g(i.text),9,lh))),128))],512)),[[ae,n.newValue]]):R("",!0)}var ch=f(ah,[["render",dh],["__scopeId","data-v-c35e799e"]]);const uh={components:{KeyModal:ih,DataTable:ys,Column:ye,Button:bt,TableCell:ch},mixins:[Y],props:{directory:{type:Object,required:!0}},computed:b(m(m({},I("directory",["root"])),I("edition",["editions"])),{directoryId(){return this.$route.params.id},allKeys(){var e;return(e=this.root)==null?void 0:e.keys.map(t=>b(m({},t),{id:t.id+""}))},eidtableKeys(){var e;return(e=this.root)==null?void 0:e.keys.filter(t=>t.type!==this.InputType.COUNTER)},counter(){var e;return(e=this.root)==null?void 0:e.keys.find(t=>t.type===this.InputType.COUNTER)},data(){var e;return(e=this.tableData)!=null&&e.length?this.tableData.map(t=>t.data):[]},values(){return this.directory.values},tableData(){return this.values.map(e=>e.data)},isArchirectureInUse(){return this.editions.find(e=>{var t;return e.dirId===((t=this.root)==null?void 0:t._id)})}}),watch:{directoryId(e,t){!t||this.removeEmptyRows({id:t})}},methods:b(m(m({},K("directory",["removeEmptyRows","setLoading","updateDirectory"])),N("directory",["createTableRow","updateValues","createKey","removeKey","updateKey"])),{async createRow(){this.createTableRow(this.directoryId)},removeRow(e){const t=this.values.filter((s,o)=>o!==e);this.updateValues({id:this.directoryId,values:t})},async change(e,t,s){try{const r=JSON.parse(JSON.stringify(this.values)).map((n,i)=>(i===e&&(n.data[t]=s),n));await this.updateValues({id:this.directoryId,values:r})}catch{this.updateDirectory({id:this.directory._id,data:this.directory})}},async createKeyHandler(){if(this.isArchirectureInUse)return console.error("\u0414\u0430\u043D\u043D\u0430\u044F \u0430\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0430 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F \u0432 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u0438");const e=await this.$refs["key-modal"].show({title:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043A\u043E\u043B\u043E\u043D\u043A\u0443",okButton:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430"});!e||this.createKey(e)},async editKey(e){if(this.isArchirectureInUse)return console.error("\u0414\u0430\u043D\u043D\u0430\u044F \u0430\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0430 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F \u0432 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u0438");const t=this.allKeys.find(o=>o.id===e),s=await this.$refs["key-modal"].show({title:"\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u043A\u043E\u043B\u043E\u043D\u043A\u0443",okButton:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430",key:t});if(!!s)try{if(s.remove)return await this.removeKey(e);await this.updateKey({id:e,newKey:s})}catch(o){console.log(o)}}})},_h={class:"table-header"},ph=V("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u044D\u043B\u0435\u043C\u0435\u043D\u0442");function hh(e,t,s,o,r,n){const i=_("KeyModal"),a=_("Button"),d=_("Column"),p=_("TableCell"),y=_("DataTable",!0);return l(),u(k,null,[h(i,{ref:"key-modal"},null,512),h(y,{ref:"table",value:n.tableData,resizableColumns:!0,showGridlines:"",scrollable:!0,scrollHeight:"flex"},fs({default:v(()=>[n.counter?(l(),$(d,{key:0,field:n.counter.id,header:n.counter.name},{header:v(()=>[h(a,{icon:"pi pi-pencil",class:"p-button-rounded p-button-text",onClick:t[0]||(t[0]=w=>n.editKey(n.counter.id))})]),body:v(({index:w})=>[V(g(w+1),1)]),_:1},8,["field","header"])):R("",!0),(l(!0),u(k,null,S(n.eidtableKeys,w=>(l(),$(d,{key:w.id,field:w.id,header:w.name,class:"column"},{header:v(({column:C})=>[h(a,{icon:"pi pi-pencil",class:"p-button-rounded p-button-text",onClick:T=>n.editKey(C.key)},null,8,["onClick"])]),body:v(({data:C,field:T,index:x})=>[h(p,{value:C[T],field:T,rowIndex:x,onChange:n.change},null,8,["value","field","rowIndex","onChange"])]),_:2},1032,["field","header"]))),128)),h(d,{field:"create",class:"create-cell"},{header:v(()=>[h(a,{label:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043A\u043E\u043B\u043E\u043D\u043A\u0443",onClick:n.createKeyHandler,icon:"pi pi-plus"},null,8,["onClick"])]),body:v(({index:w})=>[h(a,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:C=>n.removeRow(w)},null,8,["onClick"])]),_:1})]),_:2},[n.allKeys&&n.allKeys.length>0?{name:"header",fn:v(()=>[c("div",_h,[h(a,{onClick:n.createRow},{default:v(()=>[ph]),_:1},8,["onClick"])])])}:void 0]),1032,["value"])],64)}var mh=f(uh,[["render",hh],["__scopeId","data-v-59d357a7"]]);const ct=()=>({title:void 0,message:void 0,okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0}),yh={components:{PopupModal:G},data(){return ct()},methods:{show(e){return this.title=e.title,this.message=e.message,this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.$refs.popup.open(),new Promise(t=>{this.resolvePromise=t})},_confirm(){this.$refs.popup.close(),this.resolvePromise(!0),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},reset(){Object.assign(this.$data,ct())}}},fh={class:"modal"},vh={class:"modal__title"},gh={class:"modal__actions"};function bh(e,t,s,o,r,n){const i=_("AppButton"),a=_("PopupModal");return l(),$(a,{ref:"popup"},{default:v(()=>[c("div",fh,[c("span",vh,g(e.title),1),c("span",null,g(e.message),1),c("div",gh,[e.cancelButton?(l(),$(i,{key:0,outlined:"",onClick:n._cancel},{default:v(()=>[V(g(e.cancelButton),1)]),_:1},8,["onClick"])):R("",!0),h(i,{outlined:"",onClick:n._confirm},{default:v(()=>[V(g(e.okButton),1)]),_:1},8,["onClick"])])])]),_:1},512)}var $h=f(yh,[["render",bh],["__scopeId","data-v-7901fe19"]]);const wh={emits:["change"],computed:m({},I("directory",["directories"])),methods:{async fileChangeHandler(e){const t=e.target.files[0];e.target.value="";const s=await this.readExcel(t);this.$emit("change",s)},readExcel(e){return new Promise((t,s)=>{const o=new FileReader;o.onload=function(r){const n=r.target.result,i=vs(n,{type:"binary"}),a=i.SheetNames,d=i.Sheets[a[0]],p=gs.sheet_to_json(d,{header:1});t(p)},o.onerror=function(){s([])},o.readAsBinaryString(e)})}}},Ch=e=>(O("data-v-e22e1988"),e=e(),P(),e),kh=Ch(()=>c("label",{class:"file-uploader",for:"file"},"\u0418\u043C\u043F\u043E\u0440\u0442 \u0438\u0437 Excel",-1));function Ih(e,t,s,o,r,n){return l(),u(k,null,[kh,c("input",{type:"file",id:"file",hidden:"",onChange:t[0]||(t[0]=(...i)=>n.fileChangeHandler&&n.fileChangeHandler(...i))},null,32)],64)}var Vh=f(wh,[["render",Ih],["__scopeId","data-v-e22e1988"]]);const Sh={components:{ContentBody:oe,SearchInput:Je,DirectoryList:Zt,CreateButton:He,DirectoryForm:qt,DataTable:mh,ExcelModal:$h,ExcelUploader:Vh,RemoveModal:Wt},mixins:[Y,Ce],data(){return{search:"",showCreateFolder:!1}},computed:b(m({},I("directory",["directories","root","roots"])),{directoryId(){return this.$route.params.id},directory(){return this.directoryId?this.directories.find(e=>e._id===this.directoryId):null},values(){return this.directory.values.map(e=>e.data)},subFolders(){return this.directory?this.directories.filter(e=>e.parent===this.directory._id):[]},architectureValues(){return this.directories.filter(t=>t._id!==this.directoryId&&t.values.length>0).map(t=>{const r=this.getRoot(t._id).keys.filter(n=>n.type!==this.InputType.SELECT||n.type!==this.InputType.FORMULA).map(n=>({keyId:n.id,value:t.values.map(a=>a.data[n.id])}));return{dirId:t._id,values:r}})}}),methods:b(m({},N("directory",["updateById","updateDirectoryValues"])),{openCreateDirectory(){this.showCreateFolder=!0},async createArchitecture(){await this.updateValues([])},async removeArchitecture(){if(this.directory.values.length===0)return await this.updateValues(!1);await this.$refs["remove-modal"].show({title:"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0435",message:"\u0412 \u0434\u0430\u043D\u043D\u043E\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0435 \u0435\u0441\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435, \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0435 \u0431\u0443\u0434\u0443\u0442 \u0443\u0442\u0435\u0440\u044F\u043D\u044B",cancelButton:" \u041E\u0442\u043C\u0435\u043D\u0430",okButton:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",folderName:this.directory.name})&&await this.updateValues(!1)},getTypeOfColumn(e){let t=null;const s=this.architectureValues.find(r=>{t=null;const n=r.values.find(i=>e.every(a=>i.value.includes(a)));if(n)return t=n.keyId,!0});if(!s)return{type:typeof e[0]=="string"?this.InputType.STRING:this.InputType.NUMBER};const o=this.getRoot(s.dirId)._id;return{type:this.InputType.SELECT,keys:[t],dirId:s.dirId,root:o}},isSameKeys(e){return e.length!==this.root.keys.length?!1:e.every((t,s)=>t===this.root.keys[s].name)},async fileChangeHandler(e){if(e.length===0)return;if(this.root.keys.length>0&&!this.isSameKeys(e[0]))return await this.$refs["excel-modal"].show({title:"\u041E\u0448\u0438\u0431\u043A\u0430",message:"\u0414\u0430\u043D\u043D\u044B\u0435 \u0438\u0437 Excel \u0441\u043E\u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \u0430\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0435 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0430",okButton:"Ok"});if(this.directory.values.length>0&&await this.$refs["excel-modal"].show({title:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043F\u043E\u0441\u043E\u0431 \u0438\u043C\u043F\u043E\u0440\u0442\u0430 \u0434\u0430\u043D\u043D\u044B\u0445",message:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435 \u0438\u043B\u0438 \u0437\u0430\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0435?",okButton:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",cancelButton:"\u0417\u0430\u043C\u0435\u043D\u0438\u0442\u044C"})){const r=this.mergedData(e),{keys:n,values:i}=r;return await this.updateArchitecture(n),await this.updateValues(i)}const{keys:t,values:s}=this.replacedData(e);await this.updateArchitecture(t),await this.updateValues(s)},async updateArchitecture(e){if(!!this.root)try{await this.updateById({id:this.root._id,data:{keys:e}})}catch(t){console.log(t)}},async updateValues(e){const t=JSON.parse(JSON.stringify(this.directory)),s=b(m({},t),{values:e});try{await this.updateById({id:this.directory._id,data:s})}catch(o){console.log(o)}},getExcelKeysAndValues(e){const s=e.filter(n=>!n.some(a=>{if(!a||typeof a=="string"&&a.trim().length===0)return!0})).map(n=>n.map(i=>typeof i=="string"?i.trim():i)),o=s[0].map((n,i)=>({name:n,id:Date.now()+i+""})),r=[...s];return r.shift(),{keys:o,values:r}},getTableKeys(e,t){const s=e.map((o,r)=>t.map(n=>n[r]));return e.map((o,r)=>{if(o.type)return o;const n=this.getTypeOfColumn(s[r]);return m(m({},o),n)})},getTableValues(e,t){return t.map((s,o)=>{const r=e.reduce((n,i,a)=>{if(i.type===this.InputType.SELECT||i.type===this.InputType.FORMULA){const p=this.directories.find(y=>y._id===i.dirId).values.find(y=>i.keys.map(C=>y.data[C]).includes(s[a]));return n[i.id]=(p==null?void 0:p.id)||"no data",n}return n[i.id]=s[a],n},{});return{id:Date.now()+o+"",data:r}})},replacedData(e){const{keys:t,values:s}=this.getExcelKeysAndValues(e),o=t.map((i,a)=>{const d=this.root.keys.find(({name:w})=>w===i.name);if(d)return d;const p=s.map(w=>w[a]),y=this.getTypeOfColumn(p);return m(m({},i),y)}),r=this.getTableKeys(o,s),n=this.getTableValues(o,s);return{keys:r,values:n}},mergedData(e){const{keys:t,values:s}=this.getExcelKeysAndValues(e),o=t.map((p,y)=>{const w=this.root.keys.find(({name:x})=>x===p.name);if(w)return w;const C=s.map(x=>x[y]),T=this.getTypeOfColumn(C);return m(m({},p),T)}),r=this.getTableValues(o,s),n=[...this.directory.values,...r],i=[...this.root.keys,...o];return{keys:[...new Set(i.map(p=>p.id))].map(p=>i.find(y=>y.id===p)),values:n}}})},Lh={class:"header"},Th={key:0,class:"header__actions"},Rh={class:"header__actions-group"},xh=V(" \u0423\u0434\u043B\u0430\u0438\u0442\u044C \u0430\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0443 "),Oh={key:0,class:"create-form"},Ph={key:1,class:"choose"};function Nh(e,t,s,o,r,n){const i=_("ExcelModal"),a=_("SearchInput"),d=_("AppButton"),p=_("ExcelUploader"),y=_("RemoveModal"),w=_("DirectoryForm"),C=_("CreateButton"),T=_("DirectoryList"),x=_("DataTable"),B=_("ContentBody");return n.directory?(l(),$(B,{key:0},{header:v(()=>[h(i,{ref:"excel-modal"},null,512),c("div",Lh,[h(a,{modelValue:r.search,"onUpdate:modelValue":t[0]||(t[0]=L=>r.search=L),class:"search-input"},null,8,["modelValue"]),!n.subFolders.length&&n.directory.values?(l(),u("div",Th,[c("div",Rh,[h(d,{outlined:"",onClick:n.removeArchitecture},{default:v(()=>[xh]),_:1},8,["onClick"])]),h(p,{onChange:n.fileChangeHandler},null,8,["onChange"])])):R("",!0)])]),content:v(()=>[h(y,{ref:"remove-modal"},null,512),r.showCreateFolder?(l(),u("div",Oh,[h(w,{onCreated:t[1]||(t[1]=L=>r.showCreateFolder=!1)})])):!n.subFolders.length&&!n.directory.values?(l(),u("div",Ph,[h(C,{text:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0430\u043F\u043A\u0443",onClick:n.openCreateDirectory},null,8,["onClick"]),h(C,{text:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0430\u0440\u0445\u0438\u0442\u0435\u043A\u0442\u0443\u0440\u0443",onClick:n.createArchitecture},null,8,["onClick"])])):n.subFolders.length&&!n.directory.values?(l(),$(T,{key:2,items:n.subFolders},null,8,["items"])):(l(),$(x,{key:3,directory:n.directory},null,8,["directory"]))]),_:1})):R("",!0)}var Bh=f(Sh,[["render",Nh],["__scopeId","data-v-94c95286"]]),je={data(){return{expandedKeys:{},expandedKeysLength:null,filters:{}}},methods:{expandAll(){for(const e of this.tree)this.expandNode(e);this.expandedKeys=m({},this.expandedKeys),this.expandedKeysLength=Object.keys(this.expandedKeys).length},expandNode(e){if(e.children&&e.children.length){this.expandedKeys[e.key]=!0;for(const t of e.children)this.expandNode(t)}},filterHandler(){this.expandedKeysLength!==Object.keys(this.expandedKeys).length&&this.expandAll()}}};const Dh={components:{TreeTable:Re,Column:ye,ContentBody:oe,InputText:fe},mixins:[je],computed:b(m({},I("edition",["selectedEdition"])),{columns(){return this.selectedEdition.keys.map((e,t)=>b(m({},e),{id:e.id+"",expander:t===0}))},tree(){if(!this.selectedEdition)return[];const{data:e}=this.selectedEdition;return[e]}}),watch:{tree:{handler(){this.expandAll()},immediate:!0}}},Eh=e=>(O("data-v-aa1df15a"),e=e(),P(),e),Mh={class:"text-right"},Ah={class:"p-input-icon-left"},Kh=Eh(()=>c("i",{class:"pi pi-search"},null,-1));function Jh(e,t,s,o,r,n){const i=_("InputText"),a=_("Column"),d=_("TreeTable"),p=_("ContentBody");return l(),$(p,null,{content:v(()=>[n.tree?(l(),$(d,{key:0,value:n.tree,expandedKeys:e.expandedKeys,scrollable:!0,class:"p-treetable-sm",filters:e.filters,scrollHeight:"flex"},{header:v(()=>[c("div",Mh,[c("div",Ah,[Kh,h(i,{modelValue:e.filters.global,"onUpdate:modelValue":t[0]||(t[0]=y=>e.filters.global=y),onInput:e.filterHandler,placeholder:"\u0413\u043B\u043E\u0431\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u043E\u0438\u0441\u043A"},null,8,["modelValue","onInput"])])])]),default:v(()=>[(l(!0),u(k,null,S(n.columns,y=>(l(),$(a,{key:y.id,field:y.id,header:y.name,expander:y.expander,class:D(y.expander?"first":"secondary")},{body:v(({node:w})=>[c("span",{class:D({bold:w.children.length>0})},g(w.data[y.id]),3)]),_:2},1032,["field","header","expander","class"]))),128))]),_:1},8,["value","expandedKeys","filters"])):R("",!0)]),_:1})}var Gt=f(Dh,[["render",Jh],["__scopeId","data-v-aa1df15a"]]);const ut=()=>({title:void 0,okButton:void 0,cancelButton:void 0,paths:[],resolvePromise:void 0,rejectPromise:void 0,name:""}),Hh={components:{PopupModal:G},data(){return ut()},methods:b(m({},N("priceList",["create"])),{async show(e){return this.title=e.title,this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.paths=e.paths,this.$refs.popup.open(),await this.$nextTick(),this.$refs.input.focus(),new Promise(t=>{this.resolvePromise=t})},async _confirm(){await this.createPriceList(),this.$refs.popup.close(),this.resolvePromise(!0),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},async createPriceList(){try{await this.create({name:this.name})}catch(e){console.log(e)}},reset(){Object.assign(this.$data,ut())}})},Uh=e=>(O("data-v-28658c0d"),e=e(),P(),e),jh={class:"modal"},Fh={class:"modal__title"},qh=Uh(()=>c("label",null,"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",-1)),Wh={class:"modal__actions"};function Zh(e,t,s,o,r,n){const i=_("AppButton"),a=_("PopupModal");return l(),$(a,{ref:"popup"},{default:v(()=>[c("div",jh,[c("span",Fh,g(e.title),1),c("form",{onSubmit:t[1]||(t[1]=J((...d)=>n._confirm&&n._confirm(...d),["prevent"]))},[qh,M(c("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>e.name=d),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",ref:"input",type:"text"},null,512),[[j,e.name]])],32),c("div",Wh,[h(i,{outlined:"",onClick:n._cancel},{default:v(()=>[V(g(e.cancelButton),1)]),_:1},8,["onClick"]),h(i,{outlined:"",onClick:n._confirm},{default:v(()=>[V(g(e.okButton),1)]),_:1},8,["onClick"])])])]),_:1},512)}var Qt=f(Hh,[["render",Zh],["__scopeId","data-v-28658c0d"]]);const Gh={components:{InputText:fe,InputNumber:Te,Dropdown:me},mixins:[Y],props:{modelValue:{required:!0},field:{required:!0,type:String},root:{required:!0,type:Object},updated:{type:Boolean,default:!1},disabled:Boolean},emits:["update:modelValue"],computed:b(m({},I("directory",["roots","directories"])),{key(){return this.root.keys.find(e=>e.id===this.field)},type(){var e;return(e=this.key)==null?void 0:e.type},newValue:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},options(){if(this.type!==this.InputType.SELECT)return[];const e=this.roots.find(o=>o._id===this.key.root);if(!e)return[];const t=e.keys.filter(o=>this.key.keys.includes(o.id));return t.length?this.directories.find(o=>o._id===this.key.dirId).values.map(o=>{const r=t.map(n=>{if(n.type===this.InputType.SELECT||n.type===this.InputType.FORMULA){const i=o.data[n.id];return this.getValueOfCell(n.dirId,n.root,i,n.keys)}return o.data[n.id]});return{hidden:!1,text:r.join(", ")}}):[]}}),mounted(){if(this.type!==this.InputType.SELECT)return;!!this.options.find(t=>t.text===this.modelValue)||(this.newValue=this.options[0].text)},methods:{getValueOfCell(e,t,s,o){const r=this.directories.find(d=>d._id===e);return r?this.roots.find(d=>d._id===t).keys.filter(d=>o.includes(d.id)).map(d=>{const p=r.values.find(y=>y.id===+s);if(d.type===this.InputType.SELECT){const y=p.data[d.id];return this.getValueOfCell(d.dirId,d.root,y,d.keys)}return p.data[d.id]}):null}}};function Qh(e,t,s,o,r,n){const i=_("InputText"),a=_("InputNumber"),d=_("Dropdown");return n.type===e.InputType.STRING?(l(),$(i,{key:0,modelValue:n.newValue,"onUpdate:modelValue":t[0]||(t[0]=p=>n.newValue=p),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",disabled:s.disabled,class:D({updated:s.updated})},null,8,["modelValue","disabled","class"])):n.type===e.InputType.NUMBER||n.type===e.InputType.PRICE||n.type===e.InputType.QUANTITY?(l(),$(a,{key:1,modelValue:n.newValue,"onUpdate:modelValue":t[1]||(t[1]=p=>n.newValue=p),format:!1,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",disabled:s.disabled,class:D({updated:s.updated})},null,8,["modelValue","disabled","class"])):n.type===e.InputType.SELECT?(l(),$(d,{key:2,modelValue:n.newValue,"onUpdate:modelValue":t[2]||(t[2]=p=>n.newValue=p),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",options:n.options,optionLabel:"text",optionValue:"text",disabled:s.disabled,class:D({updated:s.updated})},null,8,["modelValue","options","disabled","class"])):n.type===e.InputType.FORMULA?(l(),$(d,{key:3,modelValue:n.newValue,"onUpdate:modelValue":t[3]||(t[3]=p=>n.newValue=p),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435",options:e.formulaOptions,disabled:s.disabled,class:D({updated:s.updated})},null,8,["modelValue","options","disabled","class"])):R("",!0)}var zh=f(Gh,[["render",Qh]]),zt={data(){return{selectedValues:null,selectedColumns:[],readOnlyColumns:[],name:"",rootId:null}},computed:b(m(m(m({},I("directory",["roots"])),I("edition",["clonedDirectories","editions","clone","selectedEdition"])),I("priceList",["selectedPriceList"])),{selectedRoot(){if(!this.rootId&&!this.selectedPriceList)return null;const e=this.selectedPriceList&&this.selectedPriceList.editions[0],t=e&&this.editions.find(o=>o._id===e),s=t?t.dirId:this.rootId;return this.roots.find(o=>o._id===s)},columns(){return this.selectedRoot?this.selectedRoot.keys.map((e,t)=>b(m({},e),{id:e.id+"",expander:t===0,editable:t===2})):[]}}),methods:b(m(m({},K("edition",["setClonedDirectories","setClone"])),N("edition",["create"])),{getSubItems(e){const t=this.clonedDirectories.filter(n=>(n==null?void 0:n.parent)===e._id),{values:s}=e,o=s?s.map(n=>({key:n.id,data:n.data,children:[]})):t.map(n=>this.getSubItems(n)),r={[this.columns[0].id]:e.name};return{key:e._id,data:r,children:o}},convertData(e){const{children:t}=e;return t&&t.length>0&&(e.children=t.filter(s=>this.selectedValues[s.key]),e.children=e.children.map(this.convertData)),e},multiSelectChangeHandler(){this.readOnlyColumns=this.selectedColumns.map(e=>this.columns.find(t=>t.id===e.id))},async createHandler(){if(!this.selectedRoot||!this.selectedValues||!this.name||this.selectedColumns.length===0||Object.keys(this.selectedValues).length===0||!this.selectedPriceList&&!await this.$refs["create-priceList"].show({title:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442",okButton:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C",cancelButton:"\u041E\u0442\u043C\u0435\u043D\u0430"}))return;const e=this.selectedColumns.map(o=>{const r=!!this.readOnlyColumns.find(n=>n.id===o.id);return{id:o.id,name:o.name,readonly:r}}),t=this.convertData(JSON.parse(JSON.stringify(this.tree[0]))),s={keys:e,data:t,dirId:this.selectedRoot._id,name:this.name};try{await this.create(s),this.setClone(null),this.$router.push("/pricelists")}catch(o){console.log(o)}}})};const Yh={components:{ContentBody:oe,CreatePriceList:Qt,TreeTable:Re,Column:ye,MultiSelect:Le,InputText:fe,InputNumber:Te,Dropdown:me,EditableCell:zh},mixins:[zt,Y,je],data(){return{selectedValues:null,selectedColumns:[],readOnlyColumns:[],name:"",tree:[],oldKeys:[],newKeys:[],differenceKeys:[],isMassiveChangeMode:!1,selectedValuesBefore:null,listOfTreeValues:null,listOfTreeValuesInit:null,selectedKey:null,percent:0,treeBefore:null,timeout:null,updatedFields:[]}},computed:{columns(){return this.selectedEdition?this.selectedEdition.keys.map((e,t)=>b(m({},e),{id:e.id+"",expander:t===0})):[]},selectedRows(){if(!this.isMassiveChangeMode)return[];const e=Object.keys(this.selectedValues).filter(t=>!W(t));return this.listOfTreeValues.filter(t=>e.includes(t.key))},keysToEdit(){return this.selectedRoot?this.selectedColumns.map(t=>{const s=this.selectedRoot.keys.find(o=>o.id===t.id);if(s){const{type:o}=s;return b(m({},t),{type:o})}return t}).filter(t=>t.readonly?!1:t.type===this.InputType.NUMBER||t.type===this.InputType.QUANTITY||t.type===this.InputType.PRICE):[]}},mounted(){(!this.selectedRoot||!this.clone)&&(this.tree=[]);const e=JSON.parse(JSON.stringify(this.getSubItems(this.selectedRoot))),t=this.clone.value,s=JSON.parse(JSON.stringify(t)),r=this.treeToList(JSON.parse(JSON.stringify(e)),[]).filter(T=>typeof T=="string"),i=this.treeToList(JSON.parse(JSON.stringify(s[0])),[]).filter(T=>typeof T=="string"),a=F.exports.difference(i,r),d=F.exports.difference(r,i),p=this.clone.mergeType==="full"?this.merge1(JSON.parse(JSON.stringify([e])),JSON.parse(JSON.stringify(s))):this.merge2(JSON.parse(JSON.stringify([e])),JSON.parse(JSON.stringify(s))),y=JSON.parse(JSON.stringify(this.selectedEdition.keys));this.selectedColumns=y.map((T,x)=>b(m({},T),{id:T.id+"",expander:x===0})),this.readOnlyColumns=this.selectedColumns.filter(T=>T.readonly),this.selectedValues=this.getSelectedValues(this.clone.value[0]),this.tree=p,this.listOfTreeValues=this.treeToListOnlyValues(this.tree[0]),this.listOfTreeValuesInit=JSON.parse(JSON.stringify(this.listOfTreeValues));const w=new Set(this.getFullDifference(this.tree[0],a)),C=new Set(this.getFullDifference(this.tree[0],d));this.oldKeys=[...w],this.newKeys=[...C]},methods:{getKeys(e){return e!=null&&e.key?[e.key]:e!=null&&e.children?Object.values(e.children).map(this.getKeys).flat():[]},treeToList(e,t){const{key:s,children:o}=e;return o&&o.length>0&&s?[e,...e.children.map(r=>this.treeToList(r,t)).flat()]:[...t,e.key]},treeToListOnlyValues(e){const{children:t,key:s}=e,o=t.map(this.treeToListOnlyValues).flat();return W(s)?o:[...o,e]},getFullDifference(e,t){const{children:s,key:o}=e,r=W(o);let n=[];return r&&t.includes(e.key)?n=[...this.treeToList(e,[])]:r&&s.length>0&&(n=[...s.map(a=>this.getFullDifference(a,t)).flat()]),r||t.includes(o)&&n.push(o),n.length>0?[o,...n]:[]},getSelectedValues(e){const t={[e.key]:{checked:!0}};let s=[];return e.children&&e.children.length>0&&(s=e.children.reduce((o,r)=>{const n=this.getSelectedValues(r);return o=m(m({},o),n),o},{})),m(m({},t),s)},merge1(e,t){return F.exports.merge(e,t)},merge2(e,t){return F.exports.mergeWith(e,t,(s,o)=>{if(F.exports.isArray(s))return o=o.filter(r=>!!s.find(({key:n})=>+r.key===n)),F.exports.merge(s,o)})},resetMassiveChangeMode(){this.percent=null,this.selectedValuesBefore=null,this.isMassiveChangeMode=!1,this.treeBefore=null,this.selectedKey=null},enableMassiveChangeMode(){this.isMassiveChangeMode=!0,this.selectedValuesBefore=JSON.parse(JSON.stringify(this.selectedValues)),this.listOfTreeValues=this.treeToListOnlyValues(this.tree[0]),this.treeBefore=JSON.parse(JSON.stringify(this.tree)),this.selectedValues={}},cacnelMassiveChangeMode(){this.selectedValues=JSON.parse(JSON.stringify(this.selectedValuesBefore)),this.tree=this.treeBefore,this.resetMassiveChangeMode()},updateValues(e){this.timeout&&(this.timeout=clearTimeout(this.timeout)),this.timeout=setTimeout(()=>{const{value:t}=e;this.selectedRows.forEach(s=>{const r=this.listOfTreeValuesInit.find(i=>i.key===s.key).data[this.selectedKey],n=r/100*t;s.data[this.selectedKey]=+(r+n).toFixed(2)})},500)},applyChanges(){this.updatedFields=F.exports.differenceWith(this.listOfTreeValues,this.listOfTreeValuesInit,(e,t)=>F.exports.isEqual(e.data,t.data)),this.updatedFields=this.updatedFields.map(({key:e})=>e),this.selectedValues=JSON.parse(JSON.stringify(this.selectedValuesBefore)),this.resetMassiveChangeMode()},onNodeSelect(e){if(!this.isMassiveChangeMode||!this.selectedKey)return;if(!W(e.key)){const o=e.data[this.selectedKey]/100*this.percent;e.data[this.selectedKey]=+(e.data[this.selectedKey]+o).toFixed(2);return}return this.treeToListOnlyValues(e).forEach(o=>{const n=this.listOfTreeValuesInit.find(a=>a.key===o.key).data[this.selectedKey],i=n/100*this.percent;o.data[this.selectedKey]=+(n+i).toFixed(2)})},onNodeUnselect(e){if(!this.isMassiveChangeMode)return;if(!W(e.key)){const r=this.listOfTreeValuesInit.find(n=>n.key===e.key).data[this.selectedKey];e.data[this.selectedKey]=r;return}return this.treeToListOnlyValues(e).forEach(o=>{const n=this.listOfTreeValuesInit.find(i=>i.key===o.key).data[this.selectedKey];o.data[this.selectedKey]=n})},editableCellUpdateHandler(){this.timeout&&(this.timeout=clearTimeout(this.timeout)),this.timeout=setTimeout(()=>{const e=this.treeToListOnlyValues(this.tree[0]);this.updatedFields=F.exports.differenceWith(e,this.listOfTreeValuesInit,(t,s)=>F.exports.isEqual(t.data,s.data)),this.updatedFields=this.updatedFields.map(({key:t})=>t)},500)}}},Fe=e=>(O("data-v-4c2b434f"),e=e(),P(),e),Xh={class:"header"},em={class:"header__row"},tm={class:"header__actions"},sm=V(" \u041C\u0430\u0441\u0441\u043E\u0432\u043E\u0435 \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u0435 "),nm=V("\u041E\u0442\u043C\u0435\u043D\u0430"),om=V("\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"),rm={key:0,class:"header__message"},im=V(" \u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F "),am=V(" \u041E\u0442\u043C\u0435\u043D\u0430 "),lm={class:"table-header"},dm={class:"table-header__row"},cm={class:"p-input-icon-left"},um=Fe(()=>c("i",{class:"pi pi-search"},null,-1)),_m={class:"table-header__row"},pm={class:"table-header__multiselect"},hm=Fe(()=>c("span",null," \u041E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0435\u043C\u044B\u0435 \u043A\u043E\u043B\u043D\u043A\u0438 ",-1)),mm={class:"table-header__multiselect"},ym=Fe(()=>c("span",null," \u041A\u043E\u043B\u043E\u043D\u043A\u0438 \u0434\u043B\u044F \u0447\u0442\u0435\u043D\u0438\u044F ",-1)),fm={key:0,class:"bold"},vm={key:2};function gm(e,t,s,o,r,n){const i=_("InputText"),a=_("AppButton"),d=_("InputNumber"),p=_("Dropdown"),y=_("CreatePriceList"),w=_("MultiSelect"),C=_("EditableCell"),T=_("Column"),x=_("TreeTable"),B=_("ContentBody");return l(),$(B,null,{header:v(()=>[c("div",Xh,[c("div",em,[h(i,{modelValue:r.name,"onUpdate:modelValue":t[0]||(t[0]=L=>r.name=L),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u0438"},null,8,["modelValue"]),c("div",tm,[r.isMassiveChangeMode?(l(),u(k,{key:1},[n.selectedRows.length===0?(l(),u("span",rm,"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F")):r.selectedKey?(l(),$(d,{key:1,modelValue:r.percent,"onUpdate:modelValue":t[2]||(t[2]=L=>r.percent=L),suffix:" %",placeholder:"\u041F\u0440\u043E\u0446\u0435\u043D\u0442",minFractionDigits:2,onInput:n.updateValues},null,8,["modelValue","onInput"])):R("",!0),h(p,{modelValue:r.selectedKey,"onUpdate:modelValue":t[3]||(t[3]=L=>r.selectedKey=L),options:n.keysToEdit,placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043B\u044E\u0447",optionLabel:"name",optionValue:"id"},null,8,["modelValue","options"]),h(a,{outlined:"",onClick:n.applyChanges},{default:v(()=>[im]),_:1},8,["onClick"]),h(a,{outlined:"",onClick:n.cacnelMassiveChangeMode},{default:v(()=>[am]),_:1},8,["onClick"])],64)):(l(),u(k,{key:0},[h(a,{outlined:"",onClick:n.enableMassiveChangeMode},{default:v(()=>[sm]),_:1},8,["onClick"]),h(a,{outlined:"",onClick:t[1]||(t[1]=L=>e.setClone(null))},{default:v(()=>[nm]),_:1}),h(a,{outlined:"",onClick:e.createHandler},{default:v(()=>[om]),_:1},8,["onClick"])],64))])])])]),content:v(()=>[h(y,{ref:"create-priceList"},null,512),r.tree?(l(),$(x,{key:0,selectionKeys:r.selectedValues,"onUpdate:selectionKeys":t[7]||(t[7]=L=>r.selectedValues=L),value:r.tree,selectionMode:"checkbox",expandedKeys:e.expandedKeys,scrollable:!0,filters:e.filters,scrollHeight:"flex",class:"p-treetable-sm",onNodeSelect:n.onNodeSelect,onNodeUnselect:n.onNodeUnselect},{header:v(()=>[c("div",lm,[c("div",dm,[c("div",cm,[um,h(i,{modelValue:e.filters.global,"onUpdate:modelValue":t[4]||(t[4]=L=>e.filters.global=L),onInput:e.filterHandler,placeholder:"\u0413\u043B\u043E\u0431\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u043E\u0438\u0441\u043A"},null,8,["modelValue","onInput"])])]),c("div",_m,[c("div",pm,[hm,h(w,{modelValue:r.selectedColumns,"onUpdate:modelValue":t[5]||(t[5]=L=>r.selectedColumns=L),onChange:e.multiSelectChangeHandler,options:n.columns,optionLabel:"name",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043E\u043B\u043E\u043D\u043A\u0438"},null,8,["modelValue","onChange","options"])]),c("div",mm,[ym,h(w,{modelValue:r.readOnlyColumns,"onUpdate:modelValue":t[6]||(t[6]=L=>r.readOnlyColumns=L),options:r.selectedColumns,optionLabel:"name",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043E\u043B\u043E\u043D\u043A\u0438"},null,8,["modelValue","options"])])])])]),default:v(()=>[(l(!0),u(k,null,S(r.selectedColumns,L=>(l(),$(T,{key:L.id,field:L.id,header:L.name,expander:L.expander,class:D(L.expander?"first":"secondary")},{body:v(({node:A})=>{var H;return[c("div",{class:D(["wrapper",[{neutral:r.oldKeys.includes(A.key)&&r.newKeys.includes(A.key)},{oldest:r.oldKeys.includes(A.key)},{newest:r.newKeys.includes(A.key)}]])},[A.children.length>0?(l(),u("span",fm,g(A.data[L.id]),1)):!L.readonly&&L.id in A.data?(l(),$(C,{key:1,modelValue:A.data[L.id],"onUpdate:modelValue":[te=>A.data[L.id]=te,n.editableCellUpdateHandler],root:e.selectedRoot,field:L.id,style:X(L.expander&&"width: 100%"),updated:(H=r.updatedFields)==null?void 0:H.includes(A.key),disabled:r.isMassiveChangeMode},null,8,["modelValue","onUpdate:modelValue","root","field","style","updated","disabled"])):(l(),u("span",vm,g(A.data[L.id]),1))],2)]}),_:2},1032,["field","header","expander","class"]))),128))]),_:1},8,["selectionKeys","value","expandedKeys","filters","onNodeSelect","onNodeUnselect"])):R("",!0)]),_:1})}var Yt=f(Yh,[["render",gm],["__scopeId","data-v-4c2b434f"]]);const _t=()=>({title:void 0,okButton:void 0,cancelButton:void 0,resolvePromise:void 0,rejectPromise:void 0}),bm={components:{PopupModal:G},data(){return _t()},methods:b(m({},N("priceList",["create"])),{show(e){return this.title=e.title,this.okButton=e.okButton,this.cancelButton=e.cancelButton,this.$refs.popup.open(),new Promise(t=>{this.resolvePromise=t})},_confirm(){this.$refs.popup.close(),this.resolvePromise(!0),this.reset()},_cancel(){this.$refs.popup.close(),this.resolvePromise(!1),this.reset()},reset(){Object.assign(this.$data,_t())}})},Xt=e=>(O("data-v-4b88314e"),e=e(),P(),e),$m={class:"modal"},wm={class:"modal__title"},Cm=Xt(()=>c("span",null," \u0414\u0430\u043D\u043D\u044B\u0435 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0430 \u0438 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u0438 \u043E\u0442\u043B\u0438\u0447\u0430\u044E\u0442\u0441\u044F. ",-1)),km=Xt(()=>c("span",null,"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0430?",-1)),Im={class:"modal__actions"};function Vm(e,t,s,o,r,n){const i=_("AppButton"),a=_("PopupModal");return l(),$(a,{ref:"popup"},{default:v(()=>[c("div",$m,[c("span",wm,g(e.title),1),Cm,km,c("div",Im,[h(i,{outlined:"",onClick:n._cancel},{default:v(()=>[V(g(e.cancelButton),1)]),_:1},8,["onClick"]),h(i,{outlined:"",onClick:n._confirm},{default:v(()=>[V(g(e.okButton),1)]),_:1},8,["onClick"])])])]),_:1},512)}var Sm=f(bm,[["render",Vm],["__scopeId","data-v-4b88314e"]]);const Lm={components:{ConfirmModal:Sm},computed:b(m({},I("edition",["active","selectedEdition","clonedDirectories"])),{tree(){if(!this.selectedEdition)return[];const{data:e}=this.selectedEdition;return[e]},isSame(){if(!this.selectedEdition)return!1;const e=!!this.clonedDirectories.find(s=>s._id===this.selectedEdition.dirId),t=!![this.selectedEdition.data].find(this.isSameNode);return e&&t},isActive(){var e,t;return((e=this.selectedEdition)==null?void 0:e._id)===((t=this.active)==null?void 0:t._id)}}),methods:b(m(m({},K("edition",["setClone"])),N("edition",["remove","setActive"])),{isSameNode(e,t){const{children:s,key:o}=e;if(W(o)){const i=this.clonedDirectories.find(a=>a._id===e.key);return i?s.every(a=>this.isSameNode(a,i)):!1}const{values:n}=t;return!!n.find(i=>i.id===o)},async activeEdition(){if(!this.isActive)try{await this.setActive(this.selectedEdition._id)}catch(e){console.log(e)}},async clone(){if(!this.isSame&&await this.$refs["confirm-modal"].show({title:"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F",okButton:"\u0414\u0430",cancelButton:"\u041D\u0435\u0442"}))return this.setClone({value:this.tree,mergeType:"rightJoin"});this.setClone({value:this.tree,mergeType:"full"})},async removeHandler(){try{await this.remove(this.selectedEdition._id)}catch(e){console.log(e)}}})},Tm=V(" \u0423\u0434\u0430\u043B\u0438\u0442\u044C ");function Rm(e,t,s,o,r,n){const i=_("ConfirmModal"),a=_("AppButton");return l(),u("div",null,[h(i,{ref:"confirm-modal"},null,512),h(a,{outlined:"",onClick:n.activeEdition},{default:v(()=>[V(g(n.isActive?"\u0410\u043A\u0442\u0438\u0432\u043D\u0430\u044F \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u044F":"\u0421\u0434\u0435\u043B\u0430\u0442\u044C \u0430\u043A\u0442\u0438\u0432\u043D\u043E\u0439"),1)]),_:1},8,["onClick"]),h(a,{outlined:"",variant:"primary",onClick:n.clone},{default:v(()=>[V(" \u041A\u043B\u043E\u043D\u0438\u0440\u043E\u0432\u0430\u0442\u044C "+g(n.isSame?"":"*"),1)]),_:1},8,["onClick"]),h(a,{outlined:"",variant:"danger",onClick:n.removeHandler},{default:v(()=>[Tm]),_:1},8,["onClick"])])}var xm=f(Lm,[["render",Rm]]);const Om={components:{AppContent:Ke,IndexView:Gt,CloneView:Yt,Dropdown:me,IndexActions:xm},mixins:[Ce,Y],data(){return{loading:!0}},computed:b(m(m(m({},I("directory",["roots","directories"])),I("priceList",["priceLists","selectedPriceList"])),I("edition",["editions","selectedEdition","clone","active"])),{selectedPriceListId:{get(){return this.$store.state.priceList.selectedPriceList},set(e){this.setSelectedPriceList(e)}},selectedEditionId:{get(){return this.$store.state.edition.selectedEdition},set(e){this.setSelectedEdition(e),this.goToIndex()}},priceListOptions(){return this.priceLists.map(e=>({label:e.name,value:e._id}))},editionOptions(){return this.selectedPriceList?this.editions.filter(t=>this.selectedPriceList.editions.includes(t._id)).map(t=>({label:`${t.name} \u043E\u0442 ${new Date(t.date).toLocaleDateString()}`,value:t._id})):[]}}),watch:{selectedPriceList(e){if(!e&&this.priceLists.length===0)return this.$router.push("/pricelists/create");!e&&this.$route.name!=="createEdition"&&this.setData()},selectedEdition(e){!e&&this.$route.name!=="createEdition"&&this.setData()}},async mounted(){this.priceLists.length===0&&this.$router.push({name:"createEdition"}),this.createClonedDirectories(),this.setData(),this.loading=!1},methods:b(m(m(m({},K("edition",["setSelectedEdition","setClonedDirectories"])),K("priceList",["setSelectedPriceList"])),N("priceList",{create:"create"})),{async goToCreateEdition(){await this.$router.push({name:"createEdition"}),this.setSelectedEdition(null),this.$refs["dropdown-edition"].hide()},async goToCreatePriceList(){await this.$router.push({name:"createEdition"}),this.setSelectedPriceList(null),this.setSelectedEdition(null),this.$refs["dropdown-priceList"].hide()},goToIndex(){this.$router.push("/pricelists"),this.$refs["dropdown-edition"].hide()},priceListChangeHandler(){var t;this.setData();const e=((t=this.active)==null?void 0:t._id)||this.selectedPriceList.editions[this.selectedPriceList.editions.length-1];this.setSelectedEdition(e),this.$router.push({name:"pricelistsIndex"})},setData(){var e;if(!this.selectedPriceList){const t=this.priceLists[this.priceLists.length-1];if(!t){this.loading=!1;return}this.setSelectedPriceList(t._id)}if(this.$route.name!=="createEdition"&&!this.selectedEdition){const t=((e=this.active)==null?void 0:e._id)||this.selectedPriceList.editions[this.selectedPriceList.editions.length-1];this.setSelectedEdition(t)}},getValueOfCell(e,t,s){const o=this.roots.find(n=>n._id===e);return o?o.keys.filter(n=>s.includes(n.id)).map(n=>{const i=o.values.find(a=>a.id===t);if(!i)return null;if(n.type===this.InputType.SELECT||n.type===this.InputType.FORMULA){const a=i.data[n.id];return this.getValueOfCell(n.dirId,a,n.keys)}return i.data[n.id]}):null},isValidClone(e,t){if(!e)return!1;const s=t.find(r=>r.parent===e._id);return this.isValidClone(s,t)||e.values},createClonedDirectories(){const e=JSON.parse(JSON.stringify(this.directories)),s=e.filter(o=>this.isValidClone(o,e)).map(o=>{const{values:r}=o;if(!r)return o;const n=this.getRoot(o._id),{keys:i}=n,a=i.filter(p=>p.type===this.InputType.SELECT||p.type===this.InputType.FORMULA),d=i.filter(p=>p.type===this.InputType.NUMBER||p.type===this.InputType.PRICE||p.type===this.InputType.QUANTITY);return o.values=r.map(p=>(p.data=Object.entries(p.data).reduce((y,[w,C])=>{const T=a.find(B=>B.id===w);if(T){const B=C,L=this.getValueOfCell(T.dirId,B,T.keys);return y[w]=L==null?void 0:L.join(", "),y}return C=d.find(B=>B.id===w)?C||0:C,y[w]=C,y},{}),p)),o});this.setClonedDirectories(s)}})},es=e=>(O("data-v-554b2ec5"),e=e(),P(),e),Pm={class:"header"},Nm={class:"header__action-group"},Bm={class:"header__action"},Dm=es(()=>c("label",{class:"bold"},"\u041F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442",-1)),Em=V(" \u0421\u043E\u0437\u0434\u0430\u0442\u044C "),Mm={class:"header__action"},Am=es(()=>c("label",{class:"bold"},"\u0420\u0435\u0434\u0430\u043A\u0446\u0438\u044F",-1)),Km=V(" \u0421\u043E\u0437\u0434\u0430\u0442\u044C "),Jm={key:0};function Hm(e,t,s,o,r,n){const i=_("AppButton"),a=_("Dropdown"),d=_("IndexActions"),p=_("CloneView"),y=_("IndexView"),w=_("RouterView"),C=_("AppContent");return r.loading?R("",!0):(l(),$(C,{key:0},{header:v(()=>[c("div",Pm,[c("div",Nm,[c("div",Bm,[Dm,h(a,{modelValue:n.selectedPriceListId,"onUpdate:modelValue":t[0]||(t[0]=T=>n.selectedPriceListId=T),ref:"dropdown-priceList",onChange:n.priceListChangeHandler,options:n.priceListOptions,disabled:!!e.clone,filter:!0,optionLabel:"label",optionValue:"value",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442"},{header:v(()=>[h(i,{class:"dropdown-button",outlined:"",onClick:n.goToCreatePriceList},{default:v(()=>[Em]),_:1},8,["onClick"])]),_:1},8,["modelValue","onChange","options","disabled"])]),c("div",Mm,[Am,h(a,{modelValue:n.selectedEditionId,"onUpdate:modelValue":t[1]||(t[1]=T=>n.selectedEditionId=T),ref:"dropdown-edition",options:n.editionOptions,disabled:!!e.clone,filter:!0,optionLabel:"label",optionValue:"value",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u044E"},{header:v(()=>[h(i,{class:"dropdown-button",outlined:"",onClick:n.goToCreateEdition},{default:v(()=>[Km]),_:1},8,["onClick"])]),_:1},8,["modelValue","options","disabled"])])]),e.$route.name==="pricelistsIndex"&&!e.clone&&e.selectedEdition?(l(),$(d,{key:0,class:"header__action-group"})):R("",!0)])]),body:v(()=>[e.directories.length===0?(l(),u("span",Jm," \u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0440\u0430\u0439\u0441 \u043B\u0438\u0441\u0442 \u0431\u0435\u0437 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u0430 ")):(l(),$(w,{key:1},{default:v(({Component:T,route:x})=>[e.clone?(l(),$(p,{key:0})):x.name!=="pricelistsIndex"?(l(),$(he(T),{key:1})):e.selectedPriceList&&e.selectedEdition?(l(),$(y,{key:2,priceList:e.selectedPriceList,edition:e.selectedEdition},null,8,["priceList","edition"])):R("",!0)]),_:1}))]),_:1}))}var Um=f(Om,[["render",Hm],["__scopeId","data-v-554b2ec5"]]);const jm={components:{ContentBody:oe,CreatePriceList:Qt,TreeTable:Re,Column:ye,SelectButton:bs,MultiSelect:Le,InputText:fe},mixins:[zt,je],computed:{tree(){if(!this.selectedRoot)return[];const e=this.clonedDirectories.find(s=>s._id===this.selectedRoot._id);return[this.getSubItems(e)]},rootOptions(){return this.roots.map(e=>({name:e.name,value:e._id}))}},watch:{selectedRoot(){this.selectedColumns=this.columns,this.readOnlyColumns=this.columns}},mounted(){this.selectedColumns=this.columns,this.readOnlyColumns=this.columns},methods:{changeRoot(){this.selectedValues=null,this.selectedColumns=this.columns,this.readOnlyColumns=this.columns}}},ke=e=>(O("data-v-6756398b"),e=e(),P(),e),Fm={class:"header"},qm={class:"header__row"},Wm=V("\u0421\u043E\u0437\u0434\u0430\u0442\u044C"),Zm={class:"select"},Gm={key:0,class:"header__row"},Qm=ke(()=>c("span",null," \u041A\u043E\u0440\u043D\u0435\u0432\u043E\u0439 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A ",-1)),zm={class:"table-header"},Ym={class:"table-header__row"},Xm={class:"p-input-icon-left"},ey=ke(()=>c("i",{class:"pi pi-search"},null,-1)),ty={class:"table-header__row"},sy={class:"table-header__multiselect"},ny=ke(()=>c("span",null," \u041E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0435\u043C\u044B\u0435 \u043A\u043E\u043B\u043D\u043A\u0438 ",-1)),oy={class:"table-header__multiselect"},ry=ke(()=>c("span",null," \u041A\u043E\u043B\u043E\u043D\u043A\u0438 \u0434\u043B\u044F \u0447\u0442\u0435\u043D\u0438\u044F ",-1));function iy(e,t,s,o,r,n){const i=_("InputText"),a=_("AppButton"),d=_("SelectButton"),p=_("CreatePriceList"),y=_("MultiSelect"),w=_("Column"),C=_("TreeTable"),T=_("ContentBody");return l(),$(T,null,{header:v(()=>[c("div",Fm,[c("div",qm,[h(i,{modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=x=>e.name=x),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0440\u0435\u0434\u0430\u043A\u0446\u0438\u0438"},null,8,["modelValue"]),h(a,{outlined:"",onClick:e.createHandler},{default:v(()=>[Wm]),_:1},8,["onClick"])]),c("div",Zm,[e.selectedPriceList?R("",!0):(l(),u("div",Gm,[Qm,h(d,{modelValue:e.rootId,"onUpdate:modelValue":t[1]||(t[1]=x=>e.rootId=x),options:n.rootOptions,onChange:n.changeRoot,optionLabel:"name",optionValue:"value"},null,8,["modelValue","options","onChange"])]))])])]),content:v(()=>[h(p,{ref:"create-priceList"},null,512),e.selectedRoot?(l(),$(C,{key:0,value:n.tree,selectionMode:"checkbox",expandedKeys:e.expandedKeys,scrollable:!0,class:"p-treetable-sm",filters:e.filters,scrollHeight:"flex",selectionKeys:e.selectedValues,"onUpdate:selectionKeys":t[5]||(t[5]=x=>e.selectedValues=x)},{header:v(()=>[c("div",zm,[c("div",Ym,[c("div",Xm,[ey,h(i,{modelValue:e.filters.global,"onUpdate:modelValue":t[2]||(t[2]=x=>e.filters.global=x),onInput:e.filterHandler,placeholder:"\u0413\u043B\u043E\u0431\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u043E\u0438\u0441\u043A"},null,8,["modelValue","onInput"])])]),c("div",ty,[c("div",sy,[ny,h(y,{modelValue:e.selectedColumns,"onUpdate:modelValue":t[3]||(t[3]=x=>e.selectedColumns=x),onChange:e.multiSelectChangeHandler,options:e.columns,optionLabel:"name",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043E\u043B\u043E\u043D\u043A\u0438",style:{width:"20em"}},null,8,["modelValue","onChange","options"])]),c("div",oy,[ry,h(y,{modelValue:e.readOnlyColumns,"onUpdate:modelValue":t[4]||(t[4]=x=>e.readOnlyColumns=x),options:e.selectedColumns,optionLabel:"name",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043E\u043B\u043E\u043D\u043A\u0438",style:{width:"20em"}},null,8,["modelValue","options"])])])])]),default:v(()=>[(l(!0),u(k,null,S(e.selectedColumns,x=>(l(),$(w,{key:x.id,field:x.id,header:x.name,expander:x.expander,class:D(x.expander?"first":"secondary")},{body:v(({node:B})=>[c("span",{class:D({bold:B.children.length>0})},g(B.data[x.id]),3)]),_:2},1032,["field","header","expander","class"]))),128))]),_:1},8,["value","expandedKeys","filters","selectionKeys"])):R("",!0)]),_:1})}var ay=f(jm,[["render",iy],["__scopeId","data-v-6756398b"]]);const ly={components:{ThreeDotsIcon:jt,AppDropdowm:Ft},props:{outlay:{type:Object}},data(){return{isEditing:!1,items:[{text:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",handler:async()=>{this.isEditing=!0,await this.$nextTick(),this.$refs.input.focus()}},{text:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",handler:async()=>{console.log("remve")}}]}},methods:{openFolder(){this.$router.push("/outlay/1")},async focusInput(){this.isEditing=!0,await this.$nextTick(),this.$refs.input.focus(),this.$refs.input.select()},async update(e){this.$refs.input.blur(),e.target.value}}},dy={class:"outlay-item__header"};function cy(e,t,s,o,r,n){const i=_("ThreeDotsIcon"),a=_("AppDropdowm");return l(),u("li",{class:"outlay-item",onDblclick:t[1]||(t[1]=(...d)=>n.openFolder&&n.openFolder(...d))},[c("div",dy,[r.isEditing?R("",!0):(l(),u("span",{key:0,onDblclick:t[0]||(t[0]=J((...d)=>n.focusInput&&n.focusInput(...d),["stop"])),class:"outlay-item__name"}," temp name ",32)),r.isEditing?R("",!0):(l(),$(a,{key:1,ref:"dropdown",items:r.items},{default:v(()=>[h(i)]),_:1},8,["items"]))])],32)}var uy=f(ly,[["render",cy],["__scopeId","data-v-39805b76"]]);const _y={components:{OutlayItem:uy,CreateButton:He},props:{items:{type:Array}},data(){return{formVisible:!1}},methods:{}},py={class:"outlay-list"};function hy(e,t,s,o,r,n){const i=_("OutlayItem"),a=_("CreateButton");return l(),u("ul",py,[h(i),h(a,{text:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0441\u043C\u0435\u0442\u0443",onClick:t[0]||(t[0]=d=>r.formVisible=!0)})])}var my=f(_y,[["render",hy],["__scopeId","data-v-038c8ea0"]]);const yy={components:{ContentBody:oe,SearchInput:Je,OutlayList:my}},fy={class:"header"};function vy(e,t,s,o,r,n){const i=_("SearchInput"),a=_("OutlayList"),d=_("ContentBody");return l(),$(d,null,{header:v(()=>[c("div",fy,[h(i)])]),content:v(()=>[h(a)]),_:1})}var gy=f(yy,[["render",vy]]);const by={components:{AppContent:Ke}},$y=c("span",{class:"page-title"},"\u0421\u043C\u0435\u0442\u044B",-1);function wy(e,t,s,o,r,n){const i=_("RouterView"),a=_("AppContent");return l(),$(a,null,{header:v(()=>[$y]),body:v(()=>[h(i)]),_:1})}var pt=f(by,[["render",wy]]);const Cy={components:{PrintPage:Kt},computed:b(m(m({},I("outlays",["outlays"])),I("outlay",["outlay"])),{outlayId(){return this.$route.params.id}}),watch:{outlayId:{handler(){if(this.outlay)return;const e=this.outlays.find(t=>t._id===this.outlayId);!e||this.setOutlay(e)},immediate:!0}},methods:m({},N("outlay",["setOutlay"]))};function ky(e,t,s,o,r,n){const i=_("PrintPage");return e.outlay?(l(),$(i,{key:0,outlay:e.outlay},null,8,["outlay"])):R("",!0)}var Iy=f(Cy,[["render",ky]]);const Vy=$s({history:ws("/"),routes:[{path:"/",name:"home",component:d_,meta:{layout:"MainLayout"}},{path:"/directories",name:"directories",component:k_,meta:{layout:"MainLayout"},children:[{path:"",name:"directoriesIndex",component:Hp},{path:":id",name:"directoriyView",component:Bh}]},{path:"/pricelists",name:"pricelists",component:Um,meta:{layout:"MainLayout"},children:[{path:"",name:"pricelistsIndex",component:Gt},{path:"create",name:"createEdition",component:ay},{path:"clone/:id",name:"cloneEdition",component:Yt}]},{path:"/outlay",name:"outlay",component:pt,meta:{layout:"MainLayout"},children:[{path:"",name:"smetaIndexView",component:gy}]},{path:"/outlay/:id",name:"outlayView",component:pt,meta:{layout:"OutlayLayout"}},{path:"/print/:id",name:"printView",component:Iy,meta:{layout:"PrintLayout"}}]});class ht{constructor(t,s){this.id=Date.now()+"",this.name=t,this.type=s}static getDefaultValue(t){return t===Z.STRING?"":[Z.NUMBER,Z.QUANTITY,Z.PRICE].includes(t)?1:null}}const ts=(e,t)=>{const s=t.filter(r=>r.parent===e._id),o=s.map(r=>ts(r,t));return[...s,...o].flat()},mt=(e,t)=>ts(e,t).filter(o=>o.values);var Sy={namespaced:!0,state:{root:null,directories:[],contentLoaded:!1,loading:!1},mutations:{setLoading(e,t){e.loading=t},setRoot(e,t){e.root=t},setDirectories(e,t){e.directories=t},setContentLoaded(e,t){e.contentLoaded=t},pushDirectory(e,t){e.directories.push(t)},updateDirectory(e,{id:t,data:s}){e.directories=e.directories.map(o=>o._id===t?s:o)},updateDirectoryValues(e,{id:t,values:s}){const o=e.directories.find(r=>r._id===t);o.values=s},removeDirectory(e,t){e.directories=e.directories.filter(s=>s._id!==t)},removeEmptyRows(e,{id:t}){const s=e.directories.find(o=>o._id===t);!s||(s.values=s.values.filter(o=>!Object.values(o.data).every(n=>!n)))}},actions:{createTableRow({getters:e},t){const s=e.directories.find(i=>i._id===t);if(!s)return;const{values:o}=s,n=(s.parent?e.root.keys:s.keys).reduce((i,a)=>(i[a.id]=a.type===Z.NUMBER?0:"",i),{});o.push({id:Date.now()+"",data:n})},async createDirectory({commit:e},t){try{const s=await E.post("/directory",t);return e("pushDirectory",s.data),s}catch(s){return console.log(s),Promise.reject(s)}},async fetchAll({state:e,commit:t}){if(!e.contentLoaded)try{const s=await E.get("/directory");return t("setDirectories",s.data),t("setContentLoaded",!0),s}catch(s){console.log(s)}},async updateDirectoryValues(e,{id:t,values:s}){try{s=s&&s.filter(r=>!Object.values(r.data).every(i=>!i));const o={values:s};await E.put(`/directory/${t}`,o)}catch(o){return Promise.reject(o)}},async updateById({commit:e},{id:t,data:s}){try{const o=await E.put(`/directory/${t}`,s);return e("updateDirectory",{id:o.data._id,data:o.data}),o}catch(o){return console.log(o),Promise.reject(o)}},async removeDirectory({commit:e},t){if(!!t)try{const s=await E.delete(`/directory/${t}`);return s.data.forEach(o=>{e("removeDirectory",o._id)}),s}catch(s){return console.log(s),Promise.reject(s)}},async createKey({state:e,getters:t,dispatch:s},{name:o,type:r}){try{const n=new ht(o,r),{directories:i}=e,a=i.find(C=>C._id===t.root._id),d=JSON.parse(JSON.stringify(a));d.keys.push(n);const p=await s("updateById",{id:a._id,data:d});if(n.type===Z.COUNTER)return p;const y=mt(a,i),w=ht.getDefaultValue(n.type);return await Promise.all(y.map(async C=>{const T=JSON.parse(JSON.stringify(C));if(!!T.values.length)return T.values=C.values.map(x=>(x.data[n.id]=w,x)),await s("updateById",{id:C._id,data:C})}))}catch(n){return Promise.reject(n)}},async removeKey({state:e,dispatch:t,getters:s},o){try{const{directories:r}=e,n=r.find(d=>d._id===s.root._id),i=JSON.parse(JSON.stringify(n));i.keys=i.keys.filter(d=>d.id!==o),await t("updateById",{id:n._id,data:i});const a=mt(n,r);return await Promise.all(a.map(async d=>{const p=JSON.parse(JSON.stringify(d));if(!!p.values.length)return p.values=d.values.map(y=>(y.data=Object.entries(y.data).reduce((w,[C,T])=>(o!==C&&(w[C]=T),w),{}),y)),await t("updateById",{id:d._id,data:d})}))}catch(r){return Promise.reject(r)}},async updateKey({state:e,getters:t,dispatch:s},{id:o,newKey:r}){try{const{directories:n}=e,i=n.find(p=>p._id===t.root._id),a=JSON.parse(JSON.stringify(i)),{keys:d}=a;return a.keys=d.map(p=>p.id===o?m({id:o},r):p),await s("updateById",{id:i._id,data:a})}catch(n){return Promise.reject(n)}},async updateValues({state:e,commit:t},{id:s,values:o}){try{const r=e.directories.find(d=>d._id===s),n=JSON.parse(JSON.stringify(r));n.values=o;const i=await E.put(`/directory/${s}`,n),a=i.data.values;return t("updateDirectoryValues",{id:s,values:a}),i}catch(r){return Promise.reject(r)}}},getters:{loading:e=>e.loading,root:e=>e.root?e.directories.find(t=>t._id===e.root):null,roots:e=>e.directories.filter(t=>!t.parent),directories:e=>e.directories}},Ly={namespaced:!0,state:{priceLists:[],contentLoaded:!1,selectedPriceList:null},mutations:{setPriceLists(e,t){e.priceLists=t},setContentLoaded(e,t){e.contentLoaded=t},pushPriceList(e,t){e.priceLists.push(t)},removePriceList(e,t){e.priceLists=e.priceLists.filter(s=>s._id!==t)},setSelectedPriceList(e,t){e.selectedPriceList=t},updatePriceList(e,{id:t,value:s}){e.priceLists=e.priceLists.map(o=>o._id===t?s:o)},removeEdition(e,{id:t,editionId:s}){const o=e.priceLists.find(r=>r._id===t);!o||(o.editions=o.editions.filter(r=>r!==s))}},actions:{async fetchAll({state:e,commit:t}){if(!e.contentLoaded)try{const s=await E.get("/pricelist");return t("setPriceLists",s.data),t("setContentLoaded",!0),s}catch(s){return Promise.reject(s)}},async updateEditions({commit:e},{id:t,editions:s}){try{const o=await E.put(`/pricelist/${t}`,{editions:s});e("updatePriceList",{id:t,value:o.data})}catch(o){return Promise.reject(o)}},async create({commit:e},t){try{const s=await E.post("/pricelist",t);return e("pushPriceList",s.data),e("setSelectedPriceList",s.data._id),s}catch(s){return Promise.reject(s)}},async remove({commit:e},t){try{const s=await E.delete(`/pricelist/${t}`);return e("setSelectedPriceList",null),e("removePriceList",t),s}catch(s){return Promise.reject(s)}}},getters:{priceLists:e=>e.priceLists,selectedPriceList:e=>e.priceLists.find(t=>t._id===e.selectedPriceList)}},Ty={namespaced:!0,state:{editions:[],contentLoaded:!1,clonedDirectories:[],selectedEdition:null,clone:null},mutations:{setEditions(e,t){e.editions=t},setContentLoaded(e,t){e.contentLoaded=t},pushEditions(e,t){e.editions.push(t)},removeEdition(e,t){e.editions=e.editions.filter(s=>s._id!==t)},setSelectedEdition(e,t){e.selectedEdition=t},setClone(e,t){if(!t)return e.clone=t;const{value:s,mergeType:o}=t;e.clone={value:JSON.parse(JSON.stringify(s)),mergeType:o}},setClonedDirectories(e,t){e.clonedDirectories=t},update(e,{id:t,data:s}){e.editions=e.editions.map(o=>o._id===t?m(m({},o),s):o)}},actions:{async fetchAll({state:e,commit:t}){if(!e.contentLoaded)try{const s=await E.get("/edition");return t("setEditions",s.data),t("setContentLoaded",!0),s}catch(s){return Promise.reject(s)}},async create({commit:e,rootGetters:t,dispatch:s},o){try{const r=t["priceList/selectedPriceList"];if(!r)return;const n=await E.post("/edition",o);return e("pushEditions",n.data),await s("priceList/updateEditions",{id:r._id,editions:[...r.editions,n.data._id]},{root:!0}),e("setSelectedEdition",n.data._id),n}catch(r){return console.log(r),Promise.reject(r)}},async setActive({commit:e,rootGetters:t},s){try{const o=await E.patch(`/edition/${s}/active`),r=t["priceList/selectedPriceList"],{editions:n}=r;return n.forEach(i=>{e("update",{id:i,data:{active:i===s}})}),o}catch(o){return Promise.reject(o)}},async remove({commit:e,rootGetters:t,dispatch:s},o){try{const r=await E.delete(`/edition/${o}`);e("removeEdition",o),e("setSelectedEdition",null);const n=t["priceList/selectedPriceList"],i=n.editions.filter(a=>a!==o);return i.length>0?(await s("priceList/updateEditions",{id:n._id,editions:i},{root:!0}),e("setSelectedEdition",i[i.length-1]),r):(await s("priceList/remove",n._id,{root:!0}),r)}catch(r){return Promise.reject(r)}}},getters:{editions:e=>e.editions,clonedDirectories:e=>e.clonedDirectories,selectedEdition:e=>e.editions.find(t=>t._id===e.selectedEdition),clone:e=>e.clone,active:(e,t,s,o)=>{const r=o["priceList/selectedPriceList"];if(!r)return null;const{editions:n}=r;return e.editions.filter(a=>n.includes(a._id)).find(a=>a.active)}}};const Ry=(e,t)=>t.map(s=>{const o=e.find(r=>r._id===s._id);return o||s});var xy={namespaced:!0,state:{contentLoaded:!1,outlays:[]},mutations:{setContentLoaded(e,t){e.contentLoaded=t},setOutlays(e,t){e.outlays=t},pushOutlay(e,t){e.outlays.push(t)},updateById(e,{id:t,data:s}){e.outlays=e.outlays.map(o=>o._id===t?s:o)},async updateField(e,{id:t,key:s,value:o}){const r=e.outlays.find(n=>n._id===t);r[s]=o,await se.saveOutlay(r)},removeById(e,t){e.outlays=e.outlays.filter(s=>s._id!==t)}},actions:{async fetchAll({commit:e,state:t}){if(t.contentLoaded)return;const s=await se.getOutlays();try{e("setContentLoaded",!0);const o=await E.get("/outlay"),r=s.length>0?Ry(s,o.data):o.data;return e("setOutlays",r),o}catch(o){return Promise.reject(o)}},async create({commit:e,dispatch:t},s){try{const o=await E.post("/outlay",s);return e("pushOutlay",o.data),t("outlay/setOutlay",o.data,{root:!0}),o}catch(o){return Promise.reject(o)}},async remove({commit:e,dispatch:t,rootGetters:s},o){var r;try{const n=await E.delete(`/outlay/${o}`);return((r=s["outlay/outlay"])==null?void 0:r._id)===o&&t("outlay/setOutlay",null,{root:!0}),e("removeById",o),await se.removeOutlay(o),n}catch(n){return Promise.reject(n)}},async setActive({commit:e},t){try{const s=await E.patch(`/outlay/${t}/active`),{updated:o}=s.data;return o.forEach(r=>e("updateField",{id:r._id,key:"active",value:r.active})),s}catch(s){return Promise.reject(s)}},async print(e,t){try{if(!t)throw"id is required";return await E.post(`/outlay/pdf/${t}`,{domain:window.location.origin})}catch(s){return Promise.reject(s)}},async update({commit:e},{id:t,data:s}){try{const o=await E.put(`/outlay/${t}`,s);return e("updateById",{id:t,data:o.data}),await se.removeOutlay(t),o}catch(o){return Promise.reject(o)}}},getters:{outlays:e=>e.outlays}};const Oy=Cs({state:{},modules:{directory:Sy,priceList:Ly,edition:Ty,outlay:Ki,outlays:xy}});const Py={props:{outlined:Boolean,variant:String}};function Ny(e,t,s,o,r,n){return l(),u("button",{class:D(["app-button",s.variant,{outlined:s.outlined}])},[Q(e.$slots,"default",{},void 0,!0)],2)}var By=f(Py,[["render",Ny],["__scopeId","data-v-21464fce"]]);const re=ks(r_);re.component("AppButton",By);re.component("AppInput",Ut);re.use(Vy);re.use(Oy);re.use(Is);re.mount("#app");
